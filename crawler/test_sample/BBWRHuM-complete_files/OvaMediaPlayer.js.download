!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return e[s].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(32)},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e){me=e}function r(e){if(!e)return!1;var t=parseInt(e.get("ga_factor"));if(null!==fe||!t)return fe;if(1===t)return fe=!0;t>100&&(t=100);var i=f(0,t);return fe=i===t}function a(e){if(e=Math.max(Math.min(100,e),0),0===e)return!1;if(1===e)return!0;var t=this.getRandomInt(0,e);return t===e}function o(e,t,i){r(i)&&h(e,t,i)}function d(e,t,i,s){r(s)&&c(e,t,i,s)}function l(e){return e?1:0}function u(e){return""+(e.requiredViewabilityDrawn?"!ronrv":"")+(e.moatSampling?"!mtsmp":"")}function h(e,t,i){var s=i.get("player_version"),n=i.get("ab_test")||"";n=""+n+u(t.tag);var r=new XMLHttpRequest;r.open("POST",i.get("kbnul")+"/putes",!0);var a={event:e,timestamp:(new Date).toISOString(),version:s,abTest:n};a=Object.assign(a,t),r.send(S(p(a)))}function c(e,t,i,s){var n=s.get("player_version"),r=s.get("ab_test")||"",a=new XMLHttpRequest;a.open("POST",s.get("kbnul")+"/putes/"+e,!0);var o={event:t,timestamp:(new Date).toISOString(),version:n,abTest:r};o=Object.assign(o,i),a.send(S(p(o)))}function p(e){return v(e,!0),e}function v(e,t){var i=[],s=function e(s,n,r){var a=0;if("undefined"==typeof s)a=0;else if("boolean"==typeof s)a=4;else if("string"==typeof s)t&&s.length>ve&&(s=n[r]="STRING TOO LONG"),a=2*s.length;else if("number"==typeof s)a=8;else if("function"==typeof s)try{a=2*s.toString().length}catch(e){}else if("object"===("undefined"==typeof s?"undefined":le(s))&&i.indexOf(s)===-1){i[i.length]=s;for(var r in s)a+=8,a+=e(s[r],s,r)}return a};return s(e,e,null)}function f(e,t){var i=Math.floor(Math.random()*(t-e+1))+e;return i}function m(e,t){var i=ge,s=[],n=0;for(t=t||i.length,e=e||22,n=0;n<e;n++)s[n]=i[0|Math.random()*t];return s.join("")}function g(e){return"string"!=typeof e?e:(e=e.replace(/^(http[s]?:|ftp:)/g,""),0!==e.indexOf("//")&&(e="//"+e),e)}function y(e){if(!e||"string"!=typeof e)return 0;var t;e=b(e);var i="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";"undefined"==typeof t&&(t=0);var s=0,n=0;t^=-1;for(var r=0,a=e.length;r<a;r++)n=255&(t^e.charCodeAt(r)),s="0x"+i.substr(9*n,8),t=t>>>8^s;return t^-1}function _(e){var t=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n]+)/im.exec(e);return t&&t.length?t[1]:null}function b(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t}function w(e){var t=0,i={"pre-roll":0,preroll:0,"mid-roll":-1,midroll:-1,"post-roll":-2,postroll:-2};return i.hasOwnProperty(e)&&(t=i[e]),t}function k(e){return e.replace(/\s/g,"")}function A(e,t){e.className.indexOf(t)===-1&&(e.className+=" "+t),e.className=e.className.split("  ").join(" ")}function T(e,t){e.className=e.className.split(t).join("").split("  ").join(" ")}function C(e){var t={};for(var i in e)if(e.hasOwnProperty(i))if("object"==le(e[i])){var s=C(e[i]);for(var n in s)s.hasOwnProperty(n)&&"function"!=typeof s[n]&&(t[i+"_"+n]=s[n])}else t[i]=e[i];return t}function E(e){try{return JSON.parse(S(e))}catch(e){return{}}}function P(e,t,i,s,n){var r=this;try{!n&&e.contentWindow.console.error&&(e.contentWindow.console.error=function(){});var a="iframe"==e.tagName.toLowerCase()?e.contentDocument:e;if(!a)return;var o=a.querySelectorAll(t);o.forEach(function(e){r.DOMIterator(e,t,i,s,n)}),i(a.querySelectorAll(s))}catch(e){return}}function V(e){if(!e)return null;for(var t=e.querySelector("iframe");t;)try{t=t.contentDocument.querySelector("iframe")}catch(e){break}return t}function I(e,t){return{current:e,hasNext:function(){try{return!t&&e.contentWindow.console.error&&(this.current.contentWindow.console.error=function(){}),this.current=this.current.contentDocument.querySelector("iframe"),!0}catch(e){return!1}}}}function x(e){try{return/\{\s*\[native code\]\s*\}/.test(e.toString())}catch(e){return!0}}function S(e,t){try{var i,s=[],n=null;x(Array.prototype.toJSON)||(n=Array.prototype.toJSON,delete Array.prototype.toJSON),i=JSON.stringify(e,function(e,t){if(null!=t&&"object"==("undefined"==typeof t?"undefined":le(t))){if(s.indexOf(t)>-1)return;s.push(t)}return t},t)}catch(e){i=""}return null!==n&&(Array.prototype.toJSON=n),i}function D(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e&&e.push(t,i,s,n)}function O(e){return e>1?e/100:e}function M(e){return parseInt(e)}function B(e){return e<1e3?1e3*e:e}function R(e){var t=window.cmTag&&window.cmTag.config?window.cmTag.config:{baseReportD:"taboola.com",dataCenter:"am"},i=e.get("baseReportD")||t.baseReportD,s=e.get("dataCenter")||t.dataCenter;return{baseReportD:i,dataCenter:s}}function F(e,t){var i={cijs:"convusmp",ttype:e,cisd:"convusmp",cipid:t.get("cipid")||"",crid:t.get("creativeId")||"",dast:t.get("auc_dast")||"",cmcv:"",uv:t.get("unit_version")||"",unm:t.get("unit_type")||"",cb:Date.now(),abt:t.get("ab_test")||"",mp:t.get("modifiedPlacement")||void 0};return i=Object.assign(i,R(t))}function L(e){var t=W(e)+"?";for(var i in e)"undefined"!=typeof e[i]&&(t+=i+"="+e[i]+"&");var s=document.createElement("img");s.src=t}function W(e){return me.get("pixelsUrl")||"//conv"+e.dataCenter+"mp."+e.baseReportD+"/st"}function j(e){for(var t in e)void 0===e[t]&&delete e[t]}function U(e){var t={};return e.forEach(function(e){t[e.key]=e.value}),t}function N(e,t){for(var i in e)if(e[i]===t)return i;return""}function H(e){var t=e.split("."),i=t[0],s=i.split(":"),n=0,r=1;for(2===t.length&&(n+=parseInt(t[1])/1e3);s.length>0;)n+=r*parseInt(s.pop(),10),r*=60;return n}function q(e,t){var i=t.get("creatives"),s=encodeURIComponent(i.VIDEO_URL&&i.VIDEO_URL.url?i.VIDEO_URL.url:i.VIDEO_URL),n=(new Date).getTime();return e=e.replace(/(%%|\[)referrer(%%|\])/gi,i.REFERRER),e=e.replace(/(%%|\[)domain(%%|\])/gi,i.DOMAIN),e=e.replace(/(%%|\[)video-url(%%|\])/gi,s),e=e.replace(/(%%|\[)page-url(%%|\])/gi,i.PAGE_URL),e=e.replace(/(%%|\[)player-width(%%|\])/gi,i.PLAYER_WIDTH),e=e.replace(/(%%|\[)player-height(%%|\])/gi,i.PLAYER_HEIGHT),e=e.replace(/(%%|\[)timestamp(%%|\])/gi,Math.floor(n/1e3)),e=e.replace(/(%%|\[)vidlength(%%|\])/gi,i.VIDLENGTH),e=e.replace(/(%%|\[)keywords(%%|\])/gi,i.KEY_WORDS),e=e.replace(/(%%|\[)description(%%|\])/gi,i.DESCRIPTION),e=e.replace(/(%%|\[)vertical(%%|\])/gi,i.VERTICAL),e=e.replace(/(%%|\[)tag(%%|\])/gi,i.TAG?i.TAG:""),e=e.replace(/(%%|\[)title(%%|\])/gi,i.TITLE),e=e.replace(/(%%|\[)cirf(%%|\])/gi,encodeURIComponent(decodeURIComponent(i.CIRF))),e=e.replace(/(%%|\[)cb(%%|\])/gi,"R0."+n),e=e.replace(/(%%|\[)country(%%|\])/gi,t.get("country")),e=e.replace(/(%%|\[)ip(%%|\])/gi,t.get("ip")),e=e.replace(/(%%|\[)ua(%%|\])/gi,encodeURIComponent(navigator.userAgent)),e=e.replace(/(%%|\[)dast(%%|\])/gi,t.get("auc_dast")||""),e=e.replace(/%%[^%]*%%/gi,"")}function z(e){for(var t,i=JSON.stringify(e),s="",n="PlAyER",r=0;r<i.length;r++)t=r%n.length,s+=String.fromCharCode(i[r].charCodeAt(0).toString(10)^n[t].charCodeAt(0).toString(10));try{s=btoa(s)}catch(e){return!1}return s}function G(e,t,i){var s=e.document.createElement("script");s.type="text/javascript",s.innerHTML=t,s.onload=function(){i&&i()},s.onerror=function(e){i&&i(e)},e.document.head.appendChild(s)}function Q(e){return e.get("usscrtgurl")||"https:"===window.location.protocol&&e.get("httpsOverride")}function K(e){return"https:"===window.location.protocol&&e.get("scrmf")}function X(e){return e.replace(/\//g,"_").replace(/\+/g,"-")}function Y(e){return X(btoa(unescape(encodeURIComponent(S(e)))))}function J(e){if(!e)return he.default.undefinedError;try{if(e.eventData){var t=S(e.eventData),i=t.match(he.default.codesMatcher);if(i&&i[0])return parseInt(i[0]);if(t.toLowerCase().match(he.default.noAdsMatcher))return he.default.schemaValidationError;if(t.toLowerCase().match("timeout"))return he.default.timeout}}catch(e){}return he.default.undefinedError}function $(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"content",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},n=e.get("videoElement");return new n({decodeUrl:e.get("dcdvdurl"),secureMediaFiles:e.get("scrmf"),isMobile:e.get("isMobile"),isMultiVpaidUnit:e.get("isMultiVpaidUnit"),logToBI:s||function(){},videoState:i,canvas:{force:e.get("forcecnvsmpg"),onCanvasUsage:t.onCanvasUsage||function(){},dataSaverServerSide:e.get("dataSaver"),dataSaverUrl:e.get("dtsvrurl"),disableWebGl:e.get("dsbgl"),parent:t.target||document.body,defaultVolume:e.get("dfltvlm"),aspectRatio:e.get("playerAspectRatio"),canvasLoadRate:e.get("cnvsldrt"),mpegServerBaseUrl:e.get("gtvid2"),additionalCss:t.additionalCss||{},repeat:e.get("repeat")||!1,useAutoplayForContent:e.get("useapforcntnt")||!1,playingEventTimeout:e.get("plyngevnttmt")}})}function Z(e,t){return e.match(new RegExp(t+"$"))}function ee(e,t){t=t||[],t.map(function(t){if("string"==typeof t)delete e[t];else if(t instanceof RegExp)for(var i in e)i.match(t)&&delete e[i]})}function te(e){try{for(var t=e.length,i=[],s=0;s<ye.length;s++)i[ye.charCodeAt(s)]=s;var n=ye.charAt(64);if(n){var r=e.indexOf(n);r!==-1&&(t=r)}for(var a=[],o=0,d=0;d<t;d++)if(d%4){var l=i[e.charCodeAt(d-1)]<<d%4*2,u=i[e.charCodeAt(d)]>>>6-d%4*2;a[o>>>2]|=(l|u)<<24-o%4*8,o++}for(var h=[],d=0;d<o;d++){var c=a[d>>>2]>>>24-d%4*8&255;h.push(String.fromCharCode(c))}return decodeURIComponent(escape(h.join("")))}catch(e){return""}}function ie(e){if(!e||!me)return e;var t=void 0,i=void 0;return 0===e.indexOf("http:")&&(i="absolute",t=e.replace("http:","https:")),0!==e.indexOf("//")||me.get("secured_protocol")||(i="relative",t="https:"+e),t&&se(i,{url:e}),t||e}function se(e,t){d("secure_player",e,t,me)}function ne(e){if(e.isResolved)return e;var t=!0,i=!1,s=!1,n=e.then(function(e){return s=!0,t=!1,e},function(e){throw i=!0,t=!1,e});return n.isFulfilled=function(){return s},n.isPending=function(){return t},n.isRejected=function(){return i},n}function re(){var e=window;try{for(;e.document!==e.top.document;)e=e.top;return e}catch(e){return window}}function ae(e,t){if(!e)return{};try{var i=new pe.default(e,me),s=i.fetchResults();return s}catch(e){return t&&t(e),{}}}function oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t={};return e.substring(e.indexOf("?")+1).split("&").forEach(function(e){var i=e.split("=");i.length>0&&(t[i[0]]=i[1]||"")}),t}function de(e){for(var t=void 0,i=void 0,s=void 0,n=/http/g,r="<![CDATA[",a="]]>",o="</";null!=(t=n.exec(e));)i=e.substr(t.index-r.length,r.length),i!==r&&">"===i[i.length-1]&&(e=e.slice(0,t.index)+r+e.slice(t.index),s=e.indexOf(o,t.index),e=e.slice(0,s)+a+e.slice(s));return e}Object.defineProperty(t,"__esModule",{value:!0});var le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.setStore=n,t.shouldReport=r,t.shouldFirePixels=a,t.reportDb=o,t.reportByIndex=d,t.boolToInt=l,t.addAbTests=u,t.getRandomInt=f,t.generateGuid=m,t.setUrlPrefix=g,t.crc32=y,t.stripDomain=_,t.getStreamType=w,t.trim=k,t.addClass=A,t.removeClass=T,t.flattenObject=C,t.deepClone=E,t.DOMIterator=P,t.getDeepestIframe=V,t.domIframeIterator=I,t.isNativeCode=x,t.stringify=S,t.logToBI=D,t.normalizeVolume=O,t.roundNumericValue=M,t.normalizeMilliseconds=B,t.createPixelBaseUrlParams=R,t.createPixelParams=F,t.sendPixel=L,t.getBasePixelsUrlPath=W,t.filterObjectUdefinedValues=j,t.flattenKeys=U,t.getObjectKeyByValue=N,t.hmsmToSecondsOnly=H,t.replaceMacros=q,t.encodeText=z,t.injectResource=G,t.shouldSecureWfUrl=Q,t.shouldSecureWrapperAndMediaFile=K,t.escapeBase64=X,t.encodeData=Y,t.getIABErrorCode=J,t.createVideoElement=$,t.endsWith=Z,t.deletePropsFromObj=ee,t.cryptoParseBase64=te,t.replaceHttpWithHttps=ie,t.reportToSecurePlayerIndex=se,t.MakeQuerablePromise=ne,t.getTopWindow=re,t.parseDast=ae,t.parseQueryString=oe,t.addCdataSections=de;var ue=i(16),he=s(ue),ce=i(40),pe=s(ce),ve=32766,fe=null,me=void 0,ge="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ye="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(t){i(this,e),this.label="["+t+"]",this.isDevelopModeOn=this.debugLevels.indexOf("develop")>-1,this.isTrackerOn=this.debugLevels.indexOf("*")>-1||this.debugLevels.indexOf("qa")>-1||this.isDevelopModeOn}return s(e,[{key:"table",value:function(e){this.isDevelopModeOn&&console.table(e)}},{key:"_templateLogging",value:function(e,t,i,s){if(this.isTrackerOn){var n="";for(var r in i)n+=r+": "+i[r]+"; ";"string"==typeof t?console[s]("%c"+this.label+" ["+e+"] "+t,n):console[s]("%c"+this.label+" ["+e+"]",n,t)}}},{key:"debug",value:function(e,t,i){}},{key:"error",value:function(e,t,i){this._templateLogging(e,t,i,"error")}},{key:"warn",value:function(e,t,i){this._templateLogging(e,t,i,"warn")}},{key:"info",value:function(e,t,i){this._templateLogging(e,t,i,"info")}},{key:"log",value:function(e,t,i){this._templateLogging(e,t,i,"log")}},{key:"time",value:function(e){this.isTrackerOn&&console.time(e)}},{key:"timeEnd",value:function(e){this.isTrackerOn&&console.timeEnd(e)}}]),e}();n.prototype.debugLevels="",t.default=n},function(e,t,i){/**
	 * event-lite.js - Light-weight EventEmitter (less than 1KB when gzipped)
	 *
	 * @copyright Yusuke Kawasaki
	 * @license MIT
	 * @constructor
	 * @see https://github.com/kawanet/event-lite
	 * @see http://kawanet.github.io/event-lite/EventLite.html
	 * @example
	 * var EventLite = require("event-lite");
	 *
	 * function MyClass() {...}             // your class
	 *
	 * EventLite.mixin(MyClass.prototype);  // import event methods
	 *
	 * var obj = new MyClass();
	 * obj.on("foo", function() {...});     // add event listener
	 * obj.once("bar", function() {...});   // add one-time event listener
	 * obj.emit("foo");                     // dispatch event
	 * obj.emit("bar");                     // dispatch another event
	 * obj.off("foo");                      // remove event listener
	 */
function s(){if(!(this instanceof s))return new s}!function(t){function i(e){for(var t in l)e[t]=l[t];return e}function s(e,t){return o(this,e).push(t),this}function n(e,t){function i(){r.call(s,e,i),t.apply(this,arguments)}var s=this;return i.originalListener=t,o(s,e).push(i),s}function r(e,t){function i(e){return e!==t&&e.originalListener!==t}var s,n=this;if(arguments.length){if(t){if(s=o(n,e,!0)){if(s=s.filter(i),!s.length)return r.call(n,e);n[d][e]=s}}else if(s=n[d],s&&(delete s[e],!Object.keys(s).length))return r.call(n)}else delete n[d];return n}function a(e,t){function i(e){e.call(r)}function s(e){e.call(r,t)}function n(e){e.apply(r,l)}var r=this,a=o(r,e,!0);if(!a)return!1;var d=arguments.length;if(1===d)a.forEach(i);else if(2===d)a.forEach(s);else{var l=Array.prototype.slice.call(arguments,1);a.forEach(n)}return!!a.length}function o(e,t,i){if(!i||e[d]){var s=e[d]||(e[d]={});return s[t]||(s[t]=[])}}e.exports=t;var d="listeners",l={on:s,once:n,off:r,emit:a};i(t.prototype),t.mixin=i}(s)},function(e,t){"use strict";function i(e,t,i,s,n,r){function a(e,t,i,s,n,r,a){if(!e)return!1;t=t||"";var d=new XMLHttpRequest,l=t?"POST":"GET";return d.open(l,e,!0),d.withCredentials=!0,r===!1&&(d.withCredentials=!1),d.setRequestHeader("Content-type",u),d.async=void 0==n||n,d.callback="function"==typeof i?i:function(){},d.fallback="function"==typeof s?s:function(){},d.timeout=a,d.gotResponse=!1,d.addEventListener("error",function(e){this.gotResponse||(this.gotResponse=!0,d.fallback())}),d.addEventListener("load",function(e){this.gotResponse||(this.gotResponse=!0,d.fallback())}),d.addEventListener("abort",function(e){this.gotResponse||(this.gotResponse=!0,d.fallback())}),d.addEventListener("timeout",function(e){this.gotResponse||(this.gotResponse=!0,d.fallback())}),d.addEventListener("readystatechange",function(r){if(4==this.readyState){if(this.gotResponse)return;switch(this.gotResponse=!0,this.status+""){case"200":case"204":case"460":this.callback(this.responseText,p,e);break;default:if(!c)return p.push(this.status),void o(e,t,i,s,n,!1,a,this.status);p.push(this.status),this.fallback(p,e)}}}),d.send(t),!0}function o(e,t,i,s,n,r,o,l){c=!0,d&&(e+=(e.indexOf("?")>-1?"&":"?")+"rt=1&prst="+(l||"")),a(e,t,i,s,n,!1,o)}var d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5e3,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"application/x-www-form-urlencoded",h=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],c=!h,p=[];a(e,t,i,s,n,r,l)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i},function(e,t){"use strict";e.exports={tagStarted:0,tagImpression:1,vastFecthError:2,emptyVast:3,mediaFileNotSupported:4,adError:5,filterVastByRegex:6,playerClosed:7,vastError:8,totalTimeout:9,adErrorBeforeLoad:10,networkError:11,adUnitLoadFailed:12,queueExpired:13,queueTrimmed:14,globalTimeout:15,adtoTimeout:16,adSkiped:17,adloadedTimeout:18,hijackAttempt:19,idleMode:20,videoFirstQuartile:21,videoMidpoint:22,videoThirdQuartile:23,videoComplete:24,newCompletion:25,replayAd:27,soundViolation:34,firstWfMeasurment:35,playerClosedMeasurment:36,maxNetworkCalls:39,adPlaying:40,adLoaded:41,startAd:42,globalAdTimeout:53,adUnmuted:58,vpaidProgress:59,unloadPage:60,adDropped:61,blockedActionByHijack:62,fallBackCanvas:70,unfriendlyVideo:83,buffering:90,bufferingEnded:91,blockingTagPassback:94,VpaidVideoSrcOnAdLoaded:95,firstImpression:99,wrappersData:117,slowConnection:122}},function(e,t){"use strict";e.exports={AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",SoundViolation:"SoundViolation",HijackAttempt:"HijackAttempt",Progress:"Progress",TimeUpdated:"TimeUpdated",BlockingTagPassback:"BlockingTagPassback",SlowConnection:"SlowConnection"}},function(e,t){"use strict";e.exports={KPI:70,playerDisplayImpression:81,getAd:115,emptyWFResponse:91,noTagsInWFResponse:92,passbackOnEmptyFirstWF:97}},function(e,t){"use strict";e.exports={inner:{NonVideoItemInWaterfall:"nonVideoItemInWaterfall"},outer:{NewCompletion:"NewCompletion",EmitQueueStatus:"emitQueueStatus"}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={AdxVpaid:{type:"adx",id:18},iasBlockingTagVpaid:{type:"iasBlockingTag",id:22},doubleVerifyBlockingTagVpaid:{type:"dvBlockingTag",id:23},moatBlockingTagVpaid:{type:"moatBlockingTag",id:24},fortknoxBlockingTagVpaid:{type:"fortknoxBlockingTag",id:25}}},function(e,t,i){!function(t,i){e.exports=i()}(window,function(){return function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.d=function(e,i,s){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:s})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}({"./index.js":function(e,t,i){"use strict";var s=i("./options.js"),n=i("./utils.js"),r=function(e,t){if("trc"===s.mcrsrvcsnmspc)try{return window.TRC[e][t]}catch(e){}if("cmTag"===s.mcrsrvcsnmspc)try{return window.cmTag.config.ms[e][t]}catch(e){}return null};e.exports={get:function(e,t,i,a){e=n.cleanServiceName(e),t=t||function(e){return s.serviceDefaultVersion[e]}(e);var o=r(e,t);if(o)i&&i(o);else{var d=document.createElement("script"),l=n.setUrlPrefix(s.base_url);d.async=s.async,d.type="text/javascript",d.src=l+(/.*\/$/g.test(l)?"":"/")+e+"/"+t+"/"+e+".js",d.onload=function(){document.head.removeChild(d);try{i&&i(r(e,t))}catch(e){a&&a()}},d.onerror=function(){document.head.removeChild(d),a&&a()},document.head.appendChild(d)}},init:function(e){for(var t in s)e.hasOwnProperty(t)&&(s[t]=e[t])}}},"./options.js":function(e,t,i){"use strict";e.exports={base_url:"//vidstat.taboola.com/",async:!0,mcrsrvcsnmspc:"trc",serviceDefaultVersion:{oppsula:"1.0.1"}}},"./utils.js":function(e,t,i){"use strict";e.exports={setUrlPrefix:function(e){return"string"!=typeof e?e:(0!==(e=e.replace(/^(http[s]?:|ftp:)/g,"")).indexOf("//")&&(e="//"+e),e)},cleanServiceName:function(e){return e.replace(/.js$/,"")}}},0:function(e,t,i){e.exports=i("./index.js")}})})},function(e,t){"use strict";function i(){}function s(e,t){return e?null:new Error(t)}function n(e){var t=f[e];t&&(clearTimeout(t),delete f[e])}function r(e,t,s){var r,a;return a=setTimeout(function(){t=i,delete a[r],s()},e),r=function(){t.apply(this,arguments)&&n(r)},f[r]=a,r}function a(e,t,i){var s=document.createElement(t);return i&&(s.id=i),e.appendChild(s),s}function o(e,t,i){var s=d(e,null,i.zIndex);if(h(s,u(t,i)))return s}function d(e,t,i){var s=document.createElement("iframe");return s.src=t||"about:blank",s.className="cm-vpaid-iframe",s.marginWidth="0",s.marginHeight="0",s.frameBorder="0",s.width="100%",s.height="100%",i&&(s.style.zIndex=i),s.setAttribute("SCROLLING","NO"),e.innerHTML="",e.appendChild(s),s}function l(e){e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.margin="0px",e.style.padding="0px",e.style.border="none",e.style.width="100%",e.style.height="100%"}function u(e,t){return Object.keys(t).forEach(function(i){var s="object"===("undefined"==typeof s?"undefined":v(s))?JSON.stringify(t[i]):t[i];e=e.replace(new RegExp("{{"+i+"}}","g"),s)}),e}function h(e,t){var i=e.contentWindow&&e.contentWindow.document;return!!i&&(i.write(t),!0)}function c(e,t){return Object.keys(t).forEach(function(i){e[i]=t[i]}),e}function p(e){var t=-1;return function(){return e+"_"+ ++t}}var v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f={};e.exports={noop:i,validate:s,clearCallbackTimeout:n,callbackTimeout:r,createElementInEl:a,createIframeWithContent:o,createIframe:d,setFullSizeStyle:l,simpleTemplate:u,setIframeContent:h,extend:c,unique:p}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={vpaidCrawler:{serviceKey:"vpaidCrawler",storePathKey:"vpdcrwlr",versionRegex:/(?:\/vpaidCrawler\/)(.*)\/vpaidCrawler.js/,storeDataKey:"vpaidCrawlerFuncString",jsonpCallbackName:"vpdcrwlrclb"},hjk:{serviceKey:"hjk",storePathKey:"hjk",versionRegex:/(?:\/vpaid\/hjk.)(.*).js/,storeDataKey:"hjkFuncString",jsonpCallbackName:"hjkclb"},vpaidAnalytics:{serviceKey:"vpaidAnalytics",storePathKey:"anltcsurl",versionRegex:/(?:\/vpaid\/vpaidAnalytics.)(.*).js/,storeDataKey:"analyticsFuncString",jsonpCallbackName:"anltcsclb"},dsm:{serviceKey:"dsm",storePathKey:"dsu",versionRegex:/(?:\/vpaid\/ds\/)(.*)\//,storeDataKey:"dsm",jsonpCallbackName:""}}},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(){i(this,e),this._startTime=0,this._stopTime=0,this._now=window.performance?window.performance.now.bind(window.performance):Date.now.bind(Date)}return s(e,[{key:"now",value:function(){return parseInt(this._now())}},{key:"start",value:function(){this._startTime=this.now()}},{key:"stop",value:function(){this._stopTime=this.now()}},{key:"reset",value:function(){this._stopTime=this._startTime=0}},{key:"duration",value:function(){return this._startTime&&this._stopTime?this._stopTime-this._startTime:""}}]),e}();t.default=n},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(1),o=s(a),d=i(3),l="ad",u=function(){function e(t,i,s,r,a){n(this,e),d.mixin(this),this.store=i,this.video=t,this.target=t.parentElement||s,this.isMobile=this.store.get("isMobile"),this.useVideoControls=this.store.get("useVideoControls"),this.disclosureText=this.store.get("disctxt"),this.defaultVolume=this.store.get("dfltvlm"),this.hideAdsPlayPauseButton=this.store.get("hdeadsplypusbtn"),this.showAdMuteButton=this.store.get("shwadmtebtn"),this.initBg=!1,this.vpaidWrapper=a,this.state={},this._onSoundChange=function(){},this.isMobile?this._buildMobileControls():this._buildDesktopControls(),this._createElements(),this._addControlsEventListeres(),this._addSoundEventListener(),this._setInitialState(r),this.store.on("playerStatusChanged",this._onPlayerStatusChanged.bind(this))}return r(e,[{key:"_setInitialState",value:function(e){var t={volume:0,volumeBeforeMute:0,adDuration:0,adCurrentTime:0,adTickerId:0,adLastTickTime:0,isMuted:0===this.store.get("volume")||this.isMobile,isPaused:!1,playerState:e,vidDuration:30,vidCurrentTime:0,isVisible:e!==l};this.setState(t)}},{key:"_buildDesktopControls",value:function(){this._createElements=this._createDesktopElements.bind(this),this._addControlsEventListeres=this._addDesktopControlsEventListeners.bind(this),this._renderControls=this._renderDesktopControls.bind(this),this._onVolumeStateChanged=this._onDesktopVolumeStateChanged.bind(this),this._destroyControlsEvents=this._destroyDesktopControlsEvents.bind(this)}},{key:"_buildMobileControls",value:function(){this._createElements=this._createMobileElements.bind(this),this._addControlsEventListeres=this._addMobileControlsEventListeners.bind(this),this._renderControls=this._renderMobileControls.bind(this),this._onVolumeStateChanged=this._onMobileVolumeStateChanged.bind(this),this._destroyControlsEvents=this._destroyMobileControlsEvents.bind(this),this.resetAdControls=function(){}}},{key:"resetAdControls",value:function(){this._isAdState()&&this.vpaidWrapper&&this.setState({preventAdTicker:""!==this.vpaidWrapper.getVideoUrl(),isMuted:!0})}},{key:"_onPlayerStatusChanged",value:function(e){this.setState({playerState:e})}},{key:"_isAdState",value:function(){return this.state.playerState===l}},{key:"_isWorkingVpaid",value:function(e){return this._isAdState()&&e.workingVpaid}},{key:"_onControlsVisibilityChanged",value:function(){var e=this;this.useVideoControls&&requestAnimationFrame(function(){o.removeClass(e.element,e.state.isVisible?"hide":"show"),o.addClass(e.element,e.state.isVisible?"show":"hide")})}},{key:"_addDesktopControlsEventListeners",value:function(){this.target.addEventListener("dragstart",function(){}),this.element.addEventListener("click",function(e){e.stopPropagation()}),this._bindedOnProgressBarDown=this._onProgressBarDown.bind(this),this.progressBarArea.addEventListener("mousedown",this._bindedOnProgressBarDown),this._bindedOnPlayPauseClicked=this._onDesktopPlayPauseClicked.bind(this),this.playBtn.addEventListener("click",this._bindedOnPlayPauseClicked),this.pauseBtn.addEventListener("click",this._bindedOnPlayPauseClicked),this._bindedOnProgressBarOut=this._onProgressBarOut.bind(this),this._bindedOnProgressBarMove=this._onProgressBarMove.bind(this),this._addContentVideoEventListeners(),this._bindedOnMuteClicked=this._onDesktopMuteClicked.bind(this)}},{key:"_addMobileControlsEventListeners",value:function(){this._bindedOnPlayPauseClicked=this._onMobilePlayPauseClicked.bind(this),this._bindedOnMuteClicked=this._onMobileMuteClicked.bind(this),this._bindedOnVideoEvent=this._onVideoEvent.bind(this),this.playPauseArea.addEventListener("click",this._bindedOnPlayPauseClicked),this.video&&this.video.addEventListener("timeupdate",this._bindedOnVideoEvent)}},{key:"_addSoundEventListener",value:function(){this.soundElement.addEventListener("click",this._bindedOnMuteClicked)}},{key:"_createDesktopElements",value:function(){this.element=document.createElement("div"),this.element.className="video_controls hide",this.element.innerHTML="<div class='video_controls video_controls_main_area'>\n                <div class='title text'>"+this.disclosureText+"</div>\n                <div class='cm_video_controls_progressbar_area'>\n                    <div class='cm_video_controls_progressbar_bg white_bg'></div>\n                    <div class='cm_video_controls_progressbar blue_bg'></div>\n                </div>\n                <div class='cm_video_controls_mute interactive display_mute'></div>\n                <div class='cm_video_controls_playpause interactive hide'>\n                    <div class='pause hide'></div>\n                    <div class='play'></div>\n                </div>\n            </div>",this.target.appendChild(this.element),this.mainArea=this.element.children[0],this.progressBarArea=this.mainArea.children[1],this.progressBarBg=this.progressBarArea.children[0],this.progressBarPercentager=this.progressBarArea.children[1],this.soundElement=this.mainArea.children[2],this.playPauseArea=this.mainArea.children[3],this.pauseBtn=this.playPauseArea.children[0],this.playBtn=this.playPauseArea.children[1],this.store.get("can_opt_out")||o.addClass(this.mainArea.children[0],"opt-out-hidden")}},{key:"_createMobileElements",value:function(){this.element=document.createElement("div"),this.element.className="video_controls_mobile",this.element.innerHTML='<div class="mc-pause hide" style="pointer-events: all;"></div>\n            <div class="speaker mute" style="pointer-events: all;"></div>\n            <div class="mc-progressbar_area">\n                <div class=\'mc-progressbar_bg white_bg\'></div>\n                <div class=\'mc-progressbar_bg blue_bg\'></div>\n            </div>\n            <div class="tbl-text">'+this.disclosureText+"</div>",(this.video.parentElement||this.target).appendChild(this.element),this.playPauseArea=this.element.children[0],this.soundElement=this.element.children[1],this.progressBarArea=this.element.children[2],this.progressBarBg=this.progressBarArea.children[0],this.progressBarPercentager=this.progressBarArea.children[1]}},{key:"_setVideoProgress",value:function(){var e=this;requestAnimationFrame(function(){var t=(e.state.vidDuration-e.state.vidCurrentTime)/e.state.vidDuration*100,i=100-t,s=i+"%";if(e.progressBarPercentager.style.width!==s){var n=parseInt(e.progressBarPercentager.style.width);isNaN(n)||parseInt(i)<n?e.initBg||(e.initBg=!0,o.addClass(e.progressBarPercentager,"init_bg")):e.initBg&&(e.initBg=!1,o.removeClass(e.progressBarPercentager,"init_bg")),e.progressBarPercentager.style.width=s}})}},{key:"_addContentVideoEventListeners",value:function(){this._bindedOnVideoEvent=this._onVideoEvent.bind(this),this._bindedOnVideoClick=this._onVideoClick.bind(this),this.video.addEventListener("durationchange",this._bindedOnVideoEvent),this.video.addEventListener("progress",this._bindedOnVideoEvent),this.video.addEventListener("timeupdate",this._bindedOnVideoEvent),this.video.addEventListener("playing",this._bindedOnVideoEvent),this.video.addEventListener("pause",this._bindedOnVideoEvent),this.video.addEventListener("click",this._bindedOnVideoClick)}},{key:"_onVideoClick",value:function(e){this.video.currentTime===this.video.duration&&(this._isAdState()||(this.video.play(),e.stopPropagation()))}},{key:"_onVideoEvent",value:function(e){if(!this._isAdState()){if("timeupdate"===e.type)return void this.setState({vidDuration:this.video.duration,vidCurrentTime:this.video.currentTime});var t={volume:this.video.volume,isMuted:0===this.video.volume};"pause"!==e.type&&"playing"!==e.type||(t.isPaused="pause"===e.type),this.setState(t)}}},{key:"setVpaidHandler",value:function(e){this.vpaid=e,this._addVpaidListeners()}},{key:"_addVpaidListeners",value:function(){this._bindedOnVpaidEvent=this._onVpaidEvent.bind(this),this.vpaid.on("AdVolumeChange",this._bindedOnVpaidEvent),this.vpaid.on("AdPaused",this._bindedOnVpaidEvent),this.vpaid.on("AdPlaying",this._bindedOnVpaidEvent)}},{key:"_removeVpaidListeners",value:function(){this.vpaid&&this._bindedOnVpaidEvent&&(this.vpaid.off("AdVolumeChange",this._bindedOnVpaidEvent),this.vpaid.off("AdPaused",this._bindedOnVpaidEvent),this.vpaid.off("AdPlaying",this._bindedOnVpaidEvent))}},{key:"_onVpaidEvent",value:function(e){if(this._isWorkingVpaid(this.vpaidWrapper)){var t={};if("AdVolumeChange"===e.type)this.isMobile||(t.volume=this.vpaidWrapper.adVolume,t.isMuted=0===this.vpaidWrapper.adVolume);else{var i="AdPaused"===e.type;this.state.isPaused!==i&&(t.isPaused=i)}this.setState(t)}}},{key:"_onAdTicks",value:function(){var e=Date.now(),t={};this.state.isPaused?0!=this.state.adLastTickTime&&(this.adStartTime+=e-this.state.adLastTickTime):(t.adCurrentTime=(e-this.adStartTime)/1e3,t.adCurrentTime>this.state.adDuration&&(t.adCurrentTime=this.adStartTime>0?this.state.adDuration:0),t.vidDuration=t.adDuration,t.vidCurrentTime=t.adCurrentTime),t.adLastTickTime=e,this.setState(t)}},{key:"_isAdsPlayPauseButtonHidden",value:function(){return this.hideAdsPlayPauseButton&&this._isAdState()}},{key:"_onDesktopPlayPauseClicked",value:function(e){var t=!this.state.isPaused;this._isAdsPlayPauseButtonHidden()||(!this.isMobile&&this.video&&(t?this.video.pause():this.video.play()),this.setState({isPaused:t}),e.stopPropagation())}},{key:"_onMobilePlayPauseClicked",value:function(e){this.video.playButtonClick&&this.video.playButtonClick(),this.setState({isPaused:!this.state.isPaused}),e.stopPropagation()}},{key:"_onDesktopMuteClicked",value:function(e){if(this.showAdMuteButton){0===this.state.volume&&this.emit("unmuteClicked");var t={};this.store.set("forceMute",!this.state.isMuted),this.state.isMuted?0===this.state.volumeBeforeMute&&(t.volumeBeforeMute=this.defaultVolume):t.volumeBeforeMute=this.state.volume,t.volume=this.state.isMuted?this.state.volumeBeforeMute||t.volumeBeforeMute:0,this.setState(t),e.stopPropagation()}}},{key:"_onMobileMuteClicked",value:function(e){this.showAdMuteButton&&(0===this.state.volume&&this.emit("unmuteClicked"),this.video.muteButtonClicked&&this.video.muteButtonClicked(),this.setState({isMuted:!this.state.isMuted}),e.stopPropagation())}},{key:"_onProgressBarDown",value:function(e){this._sendProgressBarPercentagesChanged(e.offsetX/this.progressBarArea.offsetWidth,e),this.progressBarArea.addEventListener("mouseleave",this._bindedOnProgressBarOut),this.progressBarArea.addEventListener("mouseup",this._bindedOnProgressBarOut),this.progressBarArea.addEventListener("mouseout",this._bindedOnProgressBarOut),this.progressBarArea.addEventListener("mousemove",this._bindedOnProgressBarMove),e.stopPropagation()}},{key:"_sendProgressBarPercentagesChanged",value:function(e,t){this.store.emit("videoProgressBar",e),t.stopPropagation()}},{key:"_onProgressBarOut",value:function(e){this.progressBarArea.removeEventListener("mouseleave",this._bindedOnProgressBarOut),this.progressBarArea.removeEventListener("mouseup",this._bindedOnProgressBarOut),this.progressBarArea.removeEventListener("mouseout",this._bindedOnProgressBarOut),this.progressBarArea.removeEventListener("mousemove",this._bindedOnProgressBarMove),e.stopPropagation()}},{key:"_onProgressBarMove",value:function(e){this._sendProgressBarPercentagesChanged(e.offsetX/this.progressBarArea.offsetWidth,e)}},{key:"_didStateChanged",value:function(e){for(var t in e)if(void 0!==e[t]&&!this.state.hasOwnProperty(t)||this.state[t]!==e[t])return!0;return!1}},{key:"setState",value:function(e){if(this.state&&e&&Object.keys(e).length>0&&this._didStateChanged(e)){var t=!1;void 0!==e.playerState&&(this.state.playerState=e.playerState,this._updateMuteAndPlayPauseVisibility()),void 0===e.volume&&void 0===e.isMuted||(t=!0,this._onVolumeStateChanged(e),this._setVpaidVolume(),this._onSoundChange(this.state.isMuted)),void 0!==e.isPaused&&this.state.isPaused!==e.isPaused&&(t=!0,this.state.isPaused=e.isPaused,this._onPausedChanged(),this._isAdState()||this._toggleVpaidPlayPause(e)),void 0!==e.preventAdTicker&&e.preventAdTicker!==this.state.preventAdTicker&&(this.state.preventAdTicker=e.preventAdTicker,this.state.adTickerId=clearInterval(this.state.adTickerId),this.state.preventAdTicker?this.vpaidWrapper.registerToVPAIDVideoTimeupdateEvent():(this.adStartTime=Date.now(),this.vpaidWrapper.getAdDuration(),this.state.adTickerId=setInterval(this._onAdTicks.bind(this),250))),void 0===e.vidDuration&&void 0===e.vidCurrentTime||(this.state.vidDuration=e.vidDuration||this.state.vidDuration,this.state.vidCurrentTime=e.vidCurrentTime||this.state.vidCurrentTime,this._setVideoProgress()),void 0!==e.isVisible&&(this.state.isVisible=e.isVisible,this._onControlsVisibilityChanged()),t&&this._renderControls()}}},{key:"_onDesktopVolumeStateChanged",value:function(e){0===e.volume||e.isMuted?(this.state.volumeBeforeMute=void 0!==e.volumeBeforeMute?e.volumeBeforeMute:this.state.volume||this.state.volumeBeforeMute||this.defaultVolume,this.store.emit("volumeBeforeMuteChanged",this.state.volumeBeforeMute),this.state.volume=0,this.state.isMuted=!0):(this.state.isMuted=!1,this.state.volume=void 0!==e.volume?e.volume:this.state.volume||this.state.volumeBeforeMute||this.defaultVolume)}},{key:"_onMobileVolumeStateChanged",value:function(e){0===e.volume||e.isMuted?(this.state.volumeBeforeMute=void 0!==e.volumeBeforeMute?e.volumeBeforeMute:this.state.volume||this.state.volumeBeforeMute||this.defaultVolume,this.state.volume=0,this.state.isMuted=!0):(this.state.isMuted=void 0!==e.isMuted?e.isMuted:this.state.isMuted,this.state.volume=void 0!==e.volume?e.volume:this.state.volumeBeforeMute||this.defaultVolume)}},{key:"_onPausedChanged",value:function(){if(this.video){if(this._isAdsPlayPauseButtonHidden()||this._isVideoEmpty()||!this.isMobile)return;this.state.isPaused?this.video.pause():this.video.play()}}},{key:"_isVideoEmpty",value:function(){return!(this.video.src&&this.video.attributes.src&&""!==this.video.attributes.src.value||0!==this.video.childNodes.length)}},{key:"_renderDesktopControls",value:function(){this._renderDesktopVolume(),this._renderDesktopPlayPause()}},{key:"_renderDesktopVolume",value:function(){if(!this._isAdState()){var e=this.state.volume>1?this.state.volume/100:this.state.volume;this.video.volume=e,this.video.muted=this.state.isMuted}o.removeClass(this.soundElement,"display_unmute"),o.removeClass(this.soundElement,"display_mute"),o.addClass(this.soundElement,"display_"+(this.state.isMuted?"mute":"unmute"))}},{key:"_renderDesktopPlayPause",value:function(){var e=this.state.isPaused?this.playBtn:this.pauseBtn,t=this.state.isPaused?this.pauseBtn:this.playBtn;o.removeClass(t,"show"),o.addClass(t,"hide"),o.removeClass(e,"hide"),o.addClass(e,"show")}},{key:"_renderMobileControls",value:function(){this._setMobilePlayPauseButton(),this._setMobileSoundButton()}},{key:"_setMobilePlayPauseButton",value:function(){var e=this;requestAnimationFrame(function(){e.state.isPaused?(o.removeClass(e.playPauseArea,"mc-pause"),o.addClass(e.playPauseArea,"mc-play")):(o.removeClass(e.playPauseArea,"mc-play"),o.addClass(e.playPauseArea,"mc-pause"))})}},{key:"_setMobileSoundButton",value:function(){var e=this;!this._isAdState()&&this.video&&(this.video.volume=this.state.volume,this.video.muted=this.state.isMuted),requestAnimationFrame(function(){e.state.isMuted?o.addClass(e.soundElement,"mute"):o.removeClass(e.soundElement,"mute")})}},{key:"_toggleVpaidPlayPause",value:function(){this._isAdState()&&this.vpaid&&(this.state.isPaused?this.vpaid.vpaidHandler.pauseAd():this.vpaid.vpaidHandler.resumeAd())}},{key:"_setVpaidVolume",value:function(){this._isAdState()&&this.vpaid&&this.vpaidWrapper&&this.vpaidWrapper.workingVpaid&&this.vpaidWrapper.setAdVolume(this.state.volume,!0)}},{key:"getValueFromControlsState",value:function(e){return this.state.hasOwnProperty(e)?this.state[e]:void 0}},{key:"destroy",value:function(){this._removeVpaidListeners(),this._destroyControlsEvents(),this._destroySoundEvents(),this.element.parentElement.removeChild(this.element),this.vpaid=this._bindedOnVpaidEvent=void 0,clearInterval(this.state.adTickerId)}},{key:"_destroyDesktopControlsEvents",value:function(){this.target.removeEventListener("dragstart",function(){}),this.element.removeEventListener("click",function(e){e.stopPropagation()}),this.progressBarArea.removeEventListener("mousedown",this._bindedOnProgressBarDown),this.video.removeEventListener("durationchange",this._bindedOnVideoEvent),this.video.removeEventListener("progress",this._bindedOnVideoEvent),this.video.removeEventListener("playing",this._bindedOnVideoEvent),this.video.removeEventListener("pause",this._bindedOnVideoEvent),this.video.removeEventListener("click",this._bindedOnVideoClick),this.playBtn.removeEventListener("click",this._bindedOnPlayPauseClicked),this.pauseBtn.removeEventListener("click",this._bindedOnPlayPauseClicked)}},{key:"_destroyMobileControlsEvents",value:function(){this.playPauseArea.removeEventListener("click",this._bindedOnPlayPauseClicked)}},{key:"_destroySoundEvents",value:function(){this.soundElement.removeEventListener("click",this._bindedOnMuteClicked),this.video&&this.video.removeEventListener("timeupdate",this._bindedOnVideoEvent)}},{key:"_updateMuteAndPlayPauseVisibility",value:function(){var e=this;requestAnimationFrame(function(){o.removeClass(e.playPauseArea,"hide"),o.removeClass(e.playPauseArea,"show"),o.removeClass(e.soundElement,"hide"),o.removeClass(e.soundElement,"show"),o.addClass(e.playPauseArea,e._isAdsPlayPauseButtonHidden()?"hide":"show"),o.addClass(e.soundElement,e.showAdMuteButton?"show":"hide")})}},{key:"setOnSoundChangeCallback",value:function(e){this._onSoundChange=e}},{key:"setVideo",value:function(e){this.video=e,this.video.volume===this.state.volume&&this.video.muted===this.state.isMuted||(this.video.volume=this.state.volume,this.video.muted=this.state.isMuted)}}]),e}();t.default=u},function(t,i,s){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),d=s(4),l=(r(d),s(2)),u=r(l),h=s(45),c=r(h),p=s(1),v=n(p),f=s(54),m=r(f),g=s(3),y=function(){function t(e,i,s){a(this,t),g.mixin(this),this.store=s,this.finished=!1,this.isFirstImpression=e.isFirstImpression,this.soundViolationFired=!1,this.iframe={},this.vpaid=null,this.uid="",this.debugTracker=new u.default("VpaidHandler"),this.vpaidCreated=!1,this.store.get("noplrcntr")||(this.videoWrapper={}),this.options=e,this.parent=e.parent,this.parentOptions=i,this.creativeData={},this.height=0,this.width=0,this.eventFunctions={},this.viewMode="normal",this.bitRate=512,this.timerId=0,this.adPlaying=!1,this.isAdPlayerVisible=!1,this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit"),this.environmentVars={};var n=Object.assign({},this.parentOptions.tagDefault,this.options.vpaidTag);this.normalizeVpaidParam(n),this.options.vpaidTag=n,this.prepareVideoTag(),this.run(e.isPreRoll),this.store.on("stop",this.stop.bind(this)),this.store.on("hideAdPlayer",this.hideAdPlayer.bind(this)),this.isMultiAdsActive=this.store.get("mltads"),this.isMultiAdsActive&&this.store.on("resizeVpaidWrapper",this._onResizeAd.bind(this)),this.volumeBeforeMute=0,this.paused=!1,this.hideAdPlayerDelayId=0,this.store.emit("vpaidHandlerCreated",this)}return o(t,[{key:"_onResizeAd",value:function(e){this.finished||(this.options.width=e.width,this.options.height=e.height)}},{key:"volumeControlClick",value:function(e,t,i){var s=e.parentNode.getBoundingClientRect(),n=parseInt((i.pageX-(s.left+5))/(s.width-10)*100);this.setVolumeControls(e,t,n),n>100&&(n=100),this.volume(n/100),this.options.parent.volume(n)}},{key:"setVolumeControls",value:function(e,t,i){i>100&&(i=100),i<=0?(i=0,t.className="vjs-mute-control vjs-control vjs-vol-0",t.muted=!0):(t.className="vjs-mute-control vjs-control vjs-vol-"+Math.floor(i/25),t.muted=!1),e.style.width=i+"%"}},{key:"muteControlClick",value:function(e,t,i){if(t.muted){t.className="vjs-mute-control vjs-control vjs-vol-4",t.muted=!1;var s=100*(this._beforeMuteVolume||1);e.style.width=s+"%",this.volume(s),this.options.parent.volume(100)}else t.className="vjs-mute-control vjs-control vjs-vol-0",t.muted=!0,this._beforeMuteVolume=this._volume,e.style.width="0",this.volume(0),this.options.parent.volume(0)}},{key:"playPauseClick",value:function(e,t){this.paused?(this.vpaid.resumeAd(),this.paused=!1,e.className="vjs-play-control vjs-control"):(this.vpaid.pauseAd(),this.paused=!0,e.className="vjs-play-control vjs-control vjs-playing c-paused"),t.stopPropagation()}},{key:"onVpaidCreated",value:function(e){this.vpaid=e,this.vpaid||this.debugTracker.error("onVpaidCreated","Vpaid Object is Invalid!"),this.subscribeToVpaid(e),this.environmentVars={slot:this.store.get("noplrcntr")?this.parent.target:this.videoWrapper,
videoSlotCanAutoPlay:!0,videoSlotControls:!0},this.store.get("contentClickUrl")&&!this.store.get("noplrcntr")&&this.videoWrapper.addEventListener("click",function(e){e.stopPropagation()}),this.debugTracker.info("onVpaidCreated","Vpaid-Player->Creating..."),this.options.vpaidTag.skip_vast||!this.creativeData.adParameters?this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters=this.options.vpaidTag.ad_parameters:this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters;try{this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars),this.vpaidCreated=!0}catch(e){this.debugTracker.error("onVpaidCreated: Vpaid-initAd->failed!Trying to run with parsed <adParameters>...",e);try{var t=this.creativeData.adParameters;this.creativeData.adParameters={},this.creativeData.adParameters=new Function("return "+t+";")(),this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters,this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars),this.vpaidCreated=!0}catch(t){this.vpaidCreated=!1,this.onVpaidLoadError(e,t)}}this.vpaidCreated&&this.parent.ga.sendGaMessage({type:"vpaidInitiated"})}},{key:"resize",value:function(e,t,i){if(i=i||"normal",t=parseInt(t),e=parseInt(e),this.options.height=t,this.options.width=e,this.viewmode=i,!isNaN(e)||!isNaN(t)){this.store.get("noplrcntr")||(this.videoWrapper.style.width=e+"px",this.videoWrapper.style.height=t+"px");var s=this.isMultiVpaidUnit||!1;if(!this.isMultiVpaidUnit)try{this.vpaid&&(s=this.vpaid.resizeAd(e,t,i))}catch(e){this.debugTracker.error("resize",e),s=!1}return s}}},{key:"viewAdPlayer",value:function(e){clearTimeout(this.hideAdPlayerDelayId),this.adPlaying||(this.store.get("isMobile")||this.antiFlashBlackScreen(),this.adPlaying=!0,this.parent.video.pause(),this.parent.video.style.display="none",this.parent.video.forceCanvas?this.parent.video.hideCanvas():(this.parent.video.style.display="none",this.parent.video.style.zIndex=0),this.store.get("noplrcntr")||(this.videoWrapper.style.zIndex=100,this.videoWrapper.classList.add("_ad-cm-playing"),this.videoWrapper.style.display="block"),this.vpaid.manager.bringVpaidToFront()),this.store.get("vForce")?this.isAdPlayerVisible||(this.isAdPlayerVisible=!0,this.store.emit("AdPlayerVisible")):this.store.emit("AdPlayerVisible")}},{key:"antiFlashBlackScreen",value:function(){document.body.scrollTop=document.body.scrollTop+1,setTimeout(function(){document.body.scrollTop=document.body.scrollTop-1},2)}},{key:"hideAdPlayer",value:function(e){var t=this;clearTimeout(this.hideAdPlayerDelayId);var i=this;this.hideAdPlayerDelayId=setTimeout(function(){window.clearTimeout(i.timerId),i.store.get("vForce")||i.parent.playerIsClosed||i.adPlaying&&(i.adPlaying=!1,i.parent.video.forceCanvas?(i.parent.video.play(),i.parent.video.showCanvas()):(i.parent.video&&i.parent.video.paused&&(i.store.get("dataSaver")||(t.store.get("isMobile")&&(i.parent.video.muted=!0),i.parent.video.play())),i.parent.video&&(i.parent.video.style.display="block",i.parent.video.style.zIndex=1e3)),t.store.get("noplrcntr")||i.videoWrapper.classList.remove("_ad-cm-playing"),i.store.emit("AdPlayerHidden"),e&&e.stop("global_ad_timeout"))})}},{key:"onVpaidError",value:function(e,t,i){i?this.debugTracker.error("VPAID-"+this.options.uid,i?i[0]:""):this.debugTracker.error("VPAID-"+this.options.uid,"Vpaid Threw Error"),this.parent.options.onAdError(this.parent,this),window.setTimeout(function(){this.hideAdPlayer()}.bind(this),0)}},{key:"onVpaidLoadError",value:function(e,t){if(e=e||"",t=t||"",this.parent.ga.sendGaMessage({type:"VpaidLoadError"}),500==parseInt(1e3*Math.random()))try{var i="VpaidLoadError="+encodeURIComponent(e.toString()+"[][][][]"+t.toString()),s=new XMLHttpRequest;s.open("POST","//www.mikysrv.com/push.html",!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(i),this.debugTracker.error("VPAID-"+this.options.uid,[e,t])}catch(e){}this.parent.options.onAdLoadError(this.parent,this),window.setTimeout(function(){this.hideAdPlayer()}.bind(this),0)}},{key:"onVpaidPageError",value:function(e){this.debugTracker.warn("VpaidPageError",e)}},{key:"stop",value:function(e){window.setTimeout(function(e){this.hideAdPlayer(e)}.bind(this,e),0)}},{key:"onVpaidStop",value:function(){window.setTimeout(function(){this.hideAdPlayer()}.bind(this),0)}},{key:"run",value:function(e){var t=this.store.get("ads_playing")||0;if(t)return!1;var i=this.options.vpaidTag;if(!this.vpaid){if(this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters=this.options.vpaidTag.ad_parameters,this.vpaid=new c.default(i,this,this.store),this.store.get("cmbopps")){var s=new m.default(this.store,this.vpaid.config.creatives);this.store.set("oppsAggregator",s)}this.onVpaidCreated(this.vpaid),this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars)}return this.store.set("currentPubid",i.pubid),this.store.set("currentTagid",i.tagid),this.store.set("rollType",i.roll_type),this.vpaid.startAd(e),this.vpaidCreated=!0,!0}},{key:"startAd",value:function(){this.startAdFired=!0,this.vpaid.startAd()}},{key:"prepareVideoTag",value:function(){if(this.getWorkingVolume(),!this.store.get("noplrcntr")){var e=this.parent.target;this.videoWrapper=document.createElement("div"),this.videoWrapper.className=e.className,this.videoWrapper.className+=" vpaid-handler",this.videoWrapper.id=this.options.uid+"_"+e.id,this.videoWrapper.style.cssText=e.style.cssText+";position:absolute;top:0;left:0;border:0; z-index:0"}var t=this.options.vpaidTag.mute?this.options.vpaidTag.mute:this.parentOptions.mute;this.options.vpaidTag.mute=t,this.options.height=v.roundNumericValue(this.store.get("height")),this.options.width=v.roundNumericValue(this.store.get("width")),this.store.get("noplrcntr")||e.appendChild(this.videoWrapper)}},{key:"getWorkingVolume",value:function(){var e=0;return this.options.vpaidTag.volume?"auto"==this.options.vpaidTag.volume&&(e=this.parent.volume()/100,e=this.store.get("volume")):e=this.parentOptions.volume/100,0==e&&this.vpaid&&(e=this.vpaid.manager.getCurrentWorkingVpaidVolume()),e<1?parseInt(100*e):parseInt(e)}},{key:"normalizeVpaidParam",value:function(e){e.adto=e.ad_timeout,e["player-width"]=this.parent.video.offsetWidth||this.parent.video.width,e["player-height"]=this.parent.video.offsetHeight||this.parent.video.height,e["video-url"]=this.parent.video.name,e.vidlength=parseInt(this.parent.video.duration),e.sts=this.parent.repeatCount,e["vpaid-version"]=e.vpaid_version,e["auc-dast"]=e.auc_dast;var t=2;e.use_as_is||(t=0==e.plmd?e.muted?2:1:e.plmd),e.plmd=t}},{key:"volume",value:function(e){if(e=e>1?e/100:e,void 0!=e)try{this.vpaid&&(this.vpaid.setAdVolume(e),this._volume=e)}catch(e){return 0}else try{return this.vpaid.getAdVolume()}catch(e){return 0}}},{key:"subscribeToVpaid",value:function(t){var i=this;this.eventFunctions={AdLoaded:function(e){i.parent.ga.sendGaMessage({type:"AdLoaded"})},AdVideoStart:function(e){if(e.dispatcher.adPlayedCounter||e.dispatcher.isBf||(this.store.incr("ads_playing"),e.dispatcher.adPlayedCounter=!0),!i.finished){var t=i.getWorkingVolume();i.volume(t),i.parent.options.onAdVideoStart(i.parent,i)}},AdImpression:function(e){i.viewAdPlayer(e?e.dispatcher:void 0);var t=this.store.get("ads_playing"),s=this.store.incr("total_impressions");if(e.dispatcher.adPlayedCounter||e.dispatcher.isBf||(this.store.incr("ads_playing"),e.dispatcher.adPlayedCounter=!0),!i.finished){i.parent.ga.sendGaMessage({type:"AdImpression"},{vage:parseInt((Date.now()-e.dispatcher.created)/1e3),vpaidReadyInQue:e.vpaidReady,qsize:e.qsize,dp:e.dp,adImpInMS:e.adImpInMS,readyInMS:e.readyInMS,loadToImpMS:e.loadToImpMS,vast:e.dispatcher.vast,adsPlaying:t,totalImpressions:s,xhrErrors:e.dispatcher.xhrErrors||""});var n=e.tag;i.parent.options.onAdImpression(i,e.dispatcher,n);var r=i.getWorkingVolume();if(i.volume(r),i.vpaid&&!i.store.get("isMultiVpaidUnit"))try{i.vpaid.resizeAd(i.options.width,i.options.height,i.viewmode)}catch(e){console.log(e)}}},AdStopped:function(t){t.dispatcher.adPlayedCounter&&!t.dispatcher.isBf&&this.store.set("ads_playing",0),i.parent.options.onAdStopped(e.dispatcher.index,i),i.onVpaidStop()},AdVideoComplete:function(e){i.hideAdPlayer(),e.dispatcher.adPlayedCounter&&!e.dispatcher.isBf&&this.store.set("ads_playing",0),i.parent.options&&i.parent.options.onAdVideoEnd(i.parent,i)},AdError:function(e){i.onVpaidError("[VPAID-"+i.options.uid+"]::AdError","AdError",arguments),e.dispatcher.adPlayedCounter&&!e.dispatcher.isBf&&this.store.set("ads_playing",0)},AdStarted:function(){var e=i.getWorkingVolume();i.volume(e)},VpaidSpecial:function(){i.parent.ga.sendGaMessage({type:"VpaidSpecial"})},AdBlockEnabled:function(){i.parent.ga.sendGaMessage({type:"AdBlockEnabled"})},SoundViolation:function(){i.soundViolationFired||(i.soundViolationFired=!0,i.parent.ga.sendGaMessage({type:"SoundViolation"}))},HijackAttempt:function(e){var t="";"string"==typeof e&&(t=e),i.parent.ga.sendGaMessage({type:"HijackAttempt"}),(new Image).src=v.getBasePixelsUrlPath({dataCenter:"us",baseReportD:"basebanner.com"})+"?cijs=0&ttype=5&pix=31542217&dast="+i.options.vpaidTag.auc_dast+"&"+(new Date).getTime()},AdPaused:function(e){this.store.emit("contentPaused"),i.paused=!0,i.playButton&&(i.playButton.className="vjs-play-control vjs-control vjs-playing c-paused")},AdPlaying:function(e){i.paused&&(this.store.emit("contentResumed"),i.paused=!1),i.paused=!1,i.playButton&&(i.playButton.className="vjs-play-control vjs-control"),i.finished},AdSkipped:function(){i.eventFunctions.AdStopped()}};var s=this.vpaidEvents;for(var n in s)s[n]&&this.eventFunctions[n]&&(this.eventFunctions[n].controller=this,t.subscribe(this.eventFunctions[n],s[n]),this.on(s[n],this.eventFunctions[n]));this.on("viewAdPlayer",i.viewAdPlayer)}},{key:"trigger",value:function(e,t){this.eventFunctions.hasOwnProperty(e)&&"function"==typeof this.eventFunctions&&(this.emit(e,t),console.log("trigger event",e))}},{key:"getVpaidLogs",value:function(){if(this.vpaid)return this.vpaid.getVpaidLogs()}},{key:"getAd",value:function(e){return this.vpaid.getAd(e)}},{key:"runWaterfall",value:function(e){this.vpaid.runWaterfall(e)}},{key:"pause",value:function(){this.paused||(this.vpaid.pauseAd(),this.paused=!0)}},{key:"resume",value:function(){this.adPlaying&&this.paused&&(this.vpaid.resumeAd(),this.paused=!1)}},{key:"mute",value:function(){this.volumeBeforeMute=0===this._volume?50:this._volume,this.volume(0)}},{key:"unMute",value:function(e){this.volumeBeforeMute||(this.parentOptions.volumeBeforeMute=this.volumeBeforeMute=e||50),this._volume=e,this.volume(this._volume)}},{key:"setPaused",value:function(e){this.paused=e}},{key:"vpaidEvents",get:function(){return{VpaidSpecial:"VpaidSpecial",AdBlockEnabled:"AdBlockEnabled",AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",SoundViolation:"SoundViolation",HijackAttempt:"HijackAttempt"}}}]),t}();i.default=y},function(e,t){"use strict";e.exports={schemaValidationError:101,timeout:304,mediaFileNotSupported:403,undefinedError:900,generalVpaidError:901,noAdsMatcher:"no_fill|no ad|no video|no vast|nofill",codesMatcher:"101|301|302|303|304|402|900|901"}},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(2),d=n(o),l=i(1),u=s(l),h=i(5),c=n(h),p=i(4),v=n(p),f=function(){function e(t,i,s){r(this,e),this.parameters=t,this.store=i,this.debugTracker=new d.default("OpportunityManager"),this._initOppsAggregator(),this.isOppsulaRegisterAPI=this.oppsAggregator&&this.oppsAggregator.registerCallback,this._sentOpps={},this._oppsToSendOnlyOnce=[1,41,21,22,23,24,70],this._isPaused=!1,this.vpaidLog=s,this.billableEvents=this.store.get("bllblevt").split(",")}return a(e,[{key:"_initOppsAggregator",value:function(){this.store.get("usopsla")&&this.store.get("oppsula")?this.oppsAggregator=this.store.get("oppsula"):this.oppsAggregator=this.store.get("oppsAggregator")}},{key:"alreadySent",value:function(e,t){return!(!this._sentOpps[e.sequenceId]||!this._sentOpps[e.sequenceId][e.lineItemId])&&this._sentOpps[e.sequenceId][e.lineItemId].indexOf(t)!=-1}},{key:"send",value:function(e,t,i){var s=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e){if(this._isPaused)return void this.debugTracker.info("OpportunityPixel","[tag-"+(1*e.waterfallTagId+1)+"] Disgarded sending '"+t);if(this._oppsToSendOnlyOnce.indexOf(t)==-1||!this.alreadySent(e,t)){var r=n.debugData||this._getDebugDataStrFromUnit(e);this._sentOpps[e.sequenceId]=this._sentOpps[e.sequenceId]||{},this._sentOpps[e.sequenceId][e.lineItemId]=this._sentOpps[e.sequenceId][e.lineItemId]||[],this._sentOpps[e.sequenceId][e.lineItemId].push(t),this.debugTracker.info("OpportunityPixel","[tag-"+(1*e.waterfallTagId+1)+"] Sending '"+t,{color:"#6ef936"});var a=e.lineItemStats,o=this.store.get("pstn")||1,d=e.vidDast||e.dast,l=(new Date).getTime()-e.created,h=""+this.store.get("ab_test")+u.addAbTests(e),c=e.vpaidWrapperData||(e.vpaidWrapper&&e.vpaidWrapper.tag?e.vpaidWrapper.tag.vpaidWrapperData:void 0),p={st:u.getStreamType(e.rollType),rs:e.sequenceId,os:1*e.waterfallTagId+1,tms:Date.now(),d:l,rst:t,dast:d,pstn:o,dp:u.crc32(e.dp),mob:u.boolToInt(this.store.get("isMobile")),vstt:u.boolToInt(!document.hidden),unv:this.store.get("unit_version"),unt:u.crc32(this.store.get("unit_type")),abt:h,frd:this.store.get("fdScore"),agl:this.store.get("preset.level"),rp:c&&c.vastPrice,mty:c&&c.mediatype,fv_t:a&&a.tries,fv_c:a&&a.conversions,fv_f:a&&a.fails,fv_fr:a&&a.failsRow,awr:this.store.get("performance.dtsvrRoundTripAverageDuration"),pm:this.store.get("performance.performanceMeasurment"),dbg:r,su:this.store.get("subUnitType"),pdast:i};this.store.get("modifiedPlacement")&&(n.mp=this.store.get("modifiedPlacement")),this._addExtraParams(n,p),this._addCmTagParams(p),this._addDelayedParams(p,e),u.filterObjectUdefinedValues(p);var f=function(e,i){s.oppFireSuccess(e,i,t)},m=function(e,i){s.oppFireFailure(e,i,t)};if(this.oppsAggregator&&!this._isBillableEvent(t))this._reportOppToKibana(p,t,n.vidCurrentTime),this.oppsAggregator.send(p);else{var g=this.store.get("opps_base_path")||creativeConfig.CM_DOMAIN;this.url=""+u.setUrlPrefix(g)+(/.*\/$/g.test(g)?"":"/")+"OpportunityServlet?rst="+t,this.postHeaders=this.store.get("psthdrs")||"application/json",(0,v.default)(this.url,u.stringify([p]),f,m,void 0,!1,!1,5e3,this.postHeaders,!1)}}}}},{key:"_getDebugDataStrFromUnit",value:function(e){if(e.setDebugDataFunc)return e.setDebugDataFunc();var t=this.store.get("debugDataFunc");return t?t():e.vpaidWrapperData&&e.vpaidWrapperData.debugData?e.vpaidWrapperData.debugData:this.store.get("debugStr")||void 0}},{key:"_addCmTagParams",value:function(e){var t=this.store.get("oppsQS")||{};Object.assign(e,t)}},{key:"_addDelayedParams",value:function(e,t){var i=this._delayedParams(t)||{};Object.assign(e,i)}},{key:"_addExtraParams",value:function(e,t){for(var i in e)"vidCurrentTime"!==i&&(t[i]=e[i])}},{key:"oppFireSuccess",value:function(e,t,i){"0"!==e&&u.logToBI(this.vpaidLog,"billableEventsTracking",{opp:i,type:"serverError",xhrErrors:t},!1,!1)}},{key:"oppFireFailure",value:function(e,t,i){u.logToBI(this.vpaidLog,"billableEventsTracking",{opp:i,type:"sendingError",url:t,error:e},!1,!1)}},{key:"_reportOppToKibana",value:function(e,t,i){var s={rstStr:u.getObjectKeyByValue(c.default,t)};i&&this._isQuartileOpportunity(t)&&(s.vidCurrentTime=i),u.logToBI(this.vpaidLog,"Opps",Object.assign({},e,s))}},{key:"_isQuartileOpportunity",value:function(e){return e>=21&&e<=25}},{key:"_flattenParams",value:function(e){return e.map(function(e){return e.key+"="+e.value})}},{key:"_delayedParams",value:function(e){var t={"auc-dast":this.parameters.AUC_DAST,sts:this.parameters.STS,wp:this.parameters.WP,vpd:e.pubId||this.parameters.VPD,vptd:e.tagId||this.parameters.VPTD,vmt:(e.isRon?1:0)||this.parameters.VMT||0,pv:this.store.get("player_version")||999,pt:u.crc32(this.store.get("ab_test")||999),w:u.roundNumericValue(this.store.get("width")).toString(),h:u.roundNumericValue(this.store.get("height")).toString()};return t}},{key:"destroy",value:function(){this.debugTracker=void 0,this.store=void 0,this.oppsAggregator=void 0,this.billableEvents=void 0}},{key:"pause",value:function(){this._isPaused=!0}},{key:"unpause",value:function(){this._isPaused=!1}},{key:"_isBillableEvent",value:function(e){return this.billableEvents.indexOf(""+e)>-1}},{key:"isRegisterAvailable",value:function(e,t,i){this.isOppsulaRegisterAPI&&(i?this.oppsAggregator.registerCallback(e,t):this.oppsAggregator.unRegisterCallback(e,t))}}]),e}();t.default=f},function(e,t){"use strict";e.exports={VastData:"VastData",ParserError:"parserError",NetworkFail:"networkFail",WrappersData:"WrappersData"}},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(1),o=s(a),d={undefinedIframeSrc:"undefinedIframeSrc",event_AdImpression:"conversion",event_SoundViolation:"soundViolation",adStartTimeout:"adStartTimeout",AutoKill:"auto_kill",AdStopADTO:"before_startAd_timeout",queueTrimmed:"queueTrimmed",adPlayTimeout:"adPlayTimeout",queueExpired:"removed_from_queue",tagError:"tagError",vastFilterdByRegex:"vast_blacklisted",event_AdLoaded:"adLoaded",fetchVastXhr:"fetchVastXhr",fetchVastFallToXhr:"fetchVastFallToXhr",vpaidTimeout_AdLoaded:"adload_timeout",creatingVpaidHandler:"initVpaid",createdVpaidHandler:"before_adload",creatingVpaidHandlerError:"creatingVpaidHandlerError",networkError:"networkError",adUnitLoadFailed:"vpaid_unit_failed",adloadedTimeout:"adload_timeout",adImpressionTimeout:"adImpressionTimeout",playerClosed:"playerClosed",idleMode:"idleMode",hijackAttempt:"vpaid_blacklisted_url"},l=["conversion","soundViolation","timeout","bfRon","adPlayTimeout","vast_blacklisted","tagError","queueTrimmed","before_startAd_timeout","auto_kill","vpaidTimeout","creatingVpaidHandlerError","networkError","vpaid_unit_failed","adload_timeout","adImpressionTimeout","idleMode","vpaid_blacklisted_url","removed_from_queue"],u={NoMediaFiles:"empty_vast",event_AdError:"ad_error",vastxhrerror_noflash:"vast_fetch_fail",WrapperError:"wrapper_error",ParsingError:"xml_parsing_error",NoMediaFileAfterSort:"unsupported_mediafile"},h={BfRon:!0},c={difa:"idfa",aid:"appId",aname:"appName"},p=1e4,v=function(){function e(t,i){var s=this;n(this,e),this.tag=t,this.store=i,this.created=Date.now(),this.dataChanged=!1,this.friendlyVideoUrl=!1,this.iframesDetector=this.store.get("iframesDetector");var r=this.store.get("dast"),a="";r&&(a=r.cicmp);var d=this.store.get("subUnitType");this.sessionStarted=this.store.get("session_started")||this.created,this.data={_id:o.generateGuid(10),player_id:this.store.get("player_id"),tag:t,isMobile:t.isMobile,created:(new Date).toISOString(),timeSinceSessionStarted:this.created-this.sessionStarted,dp:t.dp,status:"new",statuses:["new"],itemScore:-1,fullPageUrl:this.store.get("fullPageUrl"),documentVisible:!document.hidden,oneAuction:this.store.get("mltads"),su:void 0!=d?d:-99999,redId:this.store.get("red_id")||"na",displayLineItem:a,updatesCount:0,serverSideDataSaver:this.store.get("serverSideDataSaver")||"na",clientSideDataSaver:this.store.get("clientSideDataSaver")||"na",dataSaver:this.store.get("dataSaver"),taboolaVpaid:this.store.get("istblvpd"),hasDsm:!!this.store.get("dsm"),hasVpaidAnalytics:!!this.store.get("analyticsFuncString"),isAmp:this.store.get("isAmp"),isCPCV:t.isCPCV,isPrivateBrowsing:this.store.get("isPrivateBrowsing")||"na",frameType:this.store.get("frameType")||-1},Object.assign(this.data,this._getDastData()),this.isReportDb=!1,this.dtor=!1,this._dataModified=!0,this.updatingInterval=setInterval(function(){s._dataModified&&s._sendData()},p)}return r(e,[{key:"_getDastData",value:function(){var e=this.store.get("dast")||{},t={},i=!1;for(var s in c){var n=e[s];if(n){var r=c[s];t[r]=n,i=!0}}return t.inApp=i,this.store.set("isInApp",i),t}},{key:"push",value:function(e,t,i){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.data){if(e.indexOf("AdError")>-1||"event_SoundViolation"===e)this._addStatus(this._prettyErrorStatus(e,t));else if(d.hasOwnProperty(e)&&"conversion"!==this.data.status)this._addStatus(d[e]);else if(h.hasOwnProperty(e)){var n="is"+e;this.data[n]=!0}if(s){var r=Date.now(),a=r-this.created;t.time=a}if(this._dataChanged(),!i&&this.data.hasOwnProperty(e))return Array.isArray(this.data[e])||(this.data[e]=[this.data[e]]),this.data[e].push(t),void(this.data[e].length>3&&this.data[e].splice(0,1));this.data[e]=t,l.indexOf(this.data.status)!==-1&&this._setDpStats()}}},{key:"_dataChanged",value:function(){this._dataModified=!0}},{key:"_sendData",value:function(){this._collectDataFromVpaidAnalytics(),this.data&&this.data.updatesCount++,o.reportDb("VpaidLog",this.data,this.store),this._dataModified=!1}},{key:"_collectDataFromVpaidAnalytics",value:function(){try{if(this.getVpaidAnalyticsReport){var e=this.getVpaidAnalyticsReport();e.realTotalRequestsCounter=e.totalRequestsCounter,this._wrappersCount&&(e.totalRequestsCounter+=this._wrappersCount,e.wrappersCount=this._wrappersCount);var t=this.iframesDetector.detect(e.iframes,this.friendlyVideoUrl);e.totalRequestsCounter+=this.iframesDetector.calculateWeightsByIframeType(t),e.totalRequestsCounter-=e.iframes.length,this.push("vpaidAnalytics",e,!0),this.push("vpaidIframesDetection",t,!0)}}catch(e){this.push("vpaidAnalyticsCollectFail",{ex:e})}}},{key:"_prettyErrorStatus",value:function(e,t){var i=t.errType?t.errType:e;return u.hasOwnProperty(i)?u[i]:"error_"+i}},{key:"_setDpStats",value:function(){if(!this.isDPStatusSet&&!this.store.get("static_schedule")){var e=Date.now();if(this.data.dtor=!0,this.data.timeFromLastPlayFromQueue=e-this.store.get("playFromQueue"),this.data.timeFromLastPlayFromQueueFound=e-this.store.get("playFromQueueFound"),this.isDPStatusSet=!0,this._incrStats(".tries"),"conversion"===this.data.status){this._incrStats(".conversions"),this.store.set(this.tag.dp+".failsRow",0);var t=this.store.get(this.tag.lineItem+".failsRow");this.store.set(this.tag.lineItem+".failsInARowTillConversion",t<0?0:t),this.store.set(this.tag.lineItem+".failsRow",0)}else this._incrStats(".fails"),this.store.get(this.tag.lineItem+".failsRow")<0?this.store.set(this.tag.lineItem+".failsRow",1):this._incrStats(".failsRow");var i=this.store.get(this.tag.dp)||{fails:0,failsRow:0,conversions:0},s=this.store.get(this.tag.lineItem)||{};s.fails||(s.fails=0),s.failsRow||(s.failsRow=0),s.conversions||(s.conversions=0),i.lineItems=i.lineItems||[],i.lineItems.indexOf(this.tag.lineItem)===-1&&i.lineItems.push(this.tag.lineItem),this.data.lineItemLog=s,this.data.dpLog=i,this.data.conversionsCount=this.store.get("conversionsCount"),this.data.unit={width:this.store.get("width"),height:this.store.get("height")};var n=this.store.get("lineItems")||[];n.indexOf(this.tag.lineItem)===-1&&(n.push(this.tag.lineItem),this.store.set("lineItems",n)),this.store.set(this.tag.lineItem,s)}}},{key:"_incrStats",value:function(e){this.store.incr(this.tag.dp+e),this.store.incr(this.tag.lineItem+e)}},{key:"saveToDb",value:function(){if(this.data){this._collectDataFromVpaidAnalytics(),this._setDpStats();var e;try{e=cmTag.utils.getLoopTime()}catch(e){}e&&(this.data.loopTime=e),this._reportDb()}}},{key:"_reportDb",value:function(){this.isReportDb||(this.data.updatesCount++,o.reportDb("VpaidLog",this.data,this.store),this.tag=null,this.data=null,this.store=null,this.isReportDb=!0,this._dataModified=!1,clearInterval(this.updatingInterval))}},{key:"_addStatus",value:function(e){var t=this;l.indexOf(this.data.status)===-1&&(this.data.status=e,this.data.statuses.push(e),"conversion"===e&&setTimeout(function(){t._sendData()},2e3))}},{key:"toString",value:function(){return o.stringify(this.data,4)}},{key:"setVastWrapperCount",value:function(e){this._wrappersCount=e}}]),e}();t.default=v},function(e,t){"use strict";e.exports=function(){return{adimpression:[],impression:[],aderror:[],error:[],adclickthru:[],clickthru:[],adclickthrough:[],clickthrough:[],adclicktracking:[],clicktracking:[],adoloaded:[],loaded:[],adstarted:[],started:[],adstopped:[],stopped:[],adskipped:[],skipped:[],adskippablestatechange:[],skippablestatechange:[],adsizechange:[],sizechange:[],adlinearchange:[],linearchange:[],addurationchange:[],durationchange:[],adexpandedchange:[],expandedchange:[],advolumechange:[],volumechange:[],advideostart:[],start:[],advideofirstquartile:[],firstquartile:[],advideomidpoint:[],midpoint:[],advideothirdquartile:[],thirdquartile:[],advideocomplete:[],complete:[],adinteraction:[],interaction:[],aduseracceptinvitation:[],acceptinvitation:[],aduserminimize:[],minimize:[],aduserclose:[],close:[],adpaused:[],paused:[],pause:[],adplaying:[],playing:[],resume:[],adlog:[],log:[],adfound:[],admute:[],mute:[],adunmute:[],unmute:[],adfullscreen:[],fullscreen:[],creativeview:[],progress:[],viewability:[],viewable50precent1sec:[],fullyviewable1sec:[]}}},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),l=function e(t,i,s){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,s)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(s):void 0},u=i(2),h=n(u),c=i(6),p=n(c),v=i(1),f=s(v),m=i(23),g=n(m),y=i(26),_=function(e){function t(e,i,s){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,s));return n.vpaidLog=i,n.store=s,n.stopped=!1,n.target=e.slot,n.video=e.videoSlot,n.mediaFiles=e.vpaidFiles,n.mediaUrl,n.debugTracker=new h.default("JsVpaid"),n.baseUrl=n.store.get("base_url"),n._onError=e.onError,n.vpaidEvents=Object.assign({},p.default),n.volume=0,n.isMuted=!0,n.pauseVideoProtection=n.store.get("pusvidprtctn"),n.vpaidResourcesHandler=e.vpaidResourcesHandler,n.playerDAST=e.playerDAST,n.adSettings=e.adSettings,n.vpaidInit={},n.secureMediaFile=f.shouldSecureWrapperAndMediaFile(s),n.tag=e.tag,n.logVpaidTextElements=n.store.get("lgvpdtxtelmnts"),n.countdownRegex=n.store.get("cntdwnrgx"),n.countdownRegex&&(n.countdownRegex=new RegExp(n.countdownRegex,"ig")),n.store.on("stop",function(){n.stopAd()}),n.minValidVideoDuration=n.store.get("mnvlddrtn"),n.adImpressionEvent=n.tag.getValueByKey("adimpevt"),n}return o(t,e),d(t,[{key:"initAd",value:function(e,t,i,s,n,r){var a=this.mediaFiles[0];this.secureMediaFile&&(f.logToBI(this.vpaidLog,"shouldSecureUrl",{replacedProtocol:a.url.indexOf("http:")>-1},!1,!1),a.url=a.url.replace("http:","https:")),this.playerDAST.set({vbr:a.bitrate,vwd:a.width,vht:a.height,ot:a.originalType,st:a.subType}),this.mediaUrl=a.url,this.debugTracker.info("Loading","Iframe was loaded!"),this._shouldHideTarget()&&(this.target.style.display="none");var o=this.tag.getValueByKey("aduntladtmt")||1e4,d=new y(this.target,this.video,{extraOptions:{zIndex:"1"}},{timeout:o},this.store);this.vpaid=d,this.vpaidInit={width:e,height:t,viewMode:i,bitRate:s,creativeData:n,environmentVars:r},d.loadAdUnit(this.mediaUrl,this._onLoadAdUnit.bind(this))}},{key:"handshakeVersion",value:function(e){return"2.0"}},{key:"resizeAd",value:function(e,t,i,s){this.stopped||(this.target.style.width=e+"px",this.target.style.height=t+"px",this.target.setAttribute("width",e),this.target.setAttribute("height",t),this._safeCall("resizeAd",[e,t,i]),this._resizeAd([e,t,s]))}},{key:"stopAd",value:function(){this._safeCall("stopAd",[]),window.setTimeout(this._stopAd.bind(this),1)}},{key:"pauseAd",value:function(){var e=this;l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"pauseAd",this).call(this);var i=function(){};(this.pauseVideoProtection||this.adRestarted)&&(i=function(){!e.stopped&&e.video&&(f.logToBI(e.vpaidLog,"pauseAdProtection",{paused:e.video.paused,adRestarted:e.adRestarted}),e.video.paused||e.video.pause())}),this.video.resumeInvoked=!1,this._safeCall("pauseAd",[i])}},{key:"resumeAd",value:function(e){var i=this;l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resumeAd",this).call(this);var s=function(){};e&&(s=function(){i.video.play()}),this.adSettings&&this.adSettings.hasOwnProperty("onrsm")&&this.adSettings.onrsm&&(s=this.adSettings.onrsm.bind(this)),this.video.resumeInvoked=!0,this._safeCall("resumeAd",[s])}},{key:"skipAd",value:function(){this._safeCall("skipAd",[])}},{key:"startAd",value:function(){this._safeCall("startAd",[])}},{key:"expandAd",value:function(){this._safeCall("expandAd",[])}},{key:"collapseAd",value:function(){this._safeCall("collapseAd",[])}},{key:"restartAd",value:function(e,t){if(!this.stopped)if(this.clickThruUrl=t,""===this._getVideoSrc(this.video)){if(!e)return;this.video.src=e,this._bindedOnRestartVideoLoad=this._onRestartVideoLoad.bind(this),this.video.addEventListener("canplay",this._bindedOnRestartVideoLoad),this.video.load()}else this._onRestartVideoLoad()}},{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&e&&this.off(t,e)}},{key:"getAdWidth",value:function(){return this._activeVideoElement?this._activeVideoElement.videoWidth:this._safeCall("getAdWidth",[])}},{key:"getAdHeight",value:function(){
return this._activeVideoElement?this._activeVideoElement.videoHeight:this._safeCall("getAdHeight",[])}},{key:"getAdSkippableRemainingTime",value:function(){return this._safeCall("getAdSkippableRemainingTime",[])}},{key:"getAdRemainingTime",value:function(e){return this._safeCall("getAdRemainingTime",[e])}},{key:"getAdDuration",value:function(e){return this._safeCall("getAdDuration",[e])}},{key:"getAdSkippableState",value:function(){return this._safeCall("getAdSkippableState",[])}},{key:"getAdVolume",value:function(e){return this._safeCall("getAdVolume",[e])}},{key:"getAdIcons",value:function(e){this._safeCall("getAdIcons",[e])}},{key:"getAdCompanions",value:function(){return this._safeCall("getAdCompanions",[])}},{key:"getAdExpanded",value:function(){return this._safeCall("getAdExpanded",[])}},{key:"getAdLinear",value:function(){return this._safeCall("getAdLinear",[])}},{key:"setAdVolume",value:function(e){var t=this;this.volume=e,this.video.muted=this.isMuted=0===this.volume,this._safeCall("setAdVolume",[e,function(){t.adRestarted&&(t.video.volume=e,t.video.muted=0===e)}])}},{key:"isReplayable",value:function(){return this.video&&""!==this._getVideoSrc(this.video)}},{key:"getDOMContainer",value:function(){return this.target}},{key:"checkUnfriendlyIframe",value:function(){var e=f.getDeepestIframe(this.target),t="";try{return e&&e.contentDocument,!1}catch(i){return t=e.src,f.logToBI(this.vpaidLog,"unfriendlyIframe",{src:t}),!0}}},{key:"getVideoUrl",value:function(){if(this.stopped)return"";var e=this.getActiveVideoElement();return e?this._getVideoSrc(e):""}},{key:"getVPAIDVideoElement",value:function(){return this._activeVideoElement||null}},{key:"logVideoUrl",value:function(){var e=this.getVideoUrl();e&&(f.logToBI(this.vpaidLog,"jsVpaidVideoUrl",{videoUrl:e}),this.vpaidLog.friendlyVideoUrl=!0)}},{key:"toggleIframeContentDisplay",value:function(e){try{var t="none";"hide"===e?t="hidden":"show"===e&&(t="visible"),this.adUnit._iframe.contentWindow.document.body.style.visibility=t}catch(e){f.logToBI(this.vpaidLog,"toggleIframeContentDisplayFail",{ex:e})}}},{key:"setCompletionOnAdStoppedTimeout",value:function(){var e=this,t=this.tag.getValueByKey("cmpltonstpdms");t>0&&(this.completionOnAdStoppedTimeout||(this.completionOnAdStoppedTimeout=setTimeout(function(){e.stopped||e.emit(e.vpaidEvents.AdStopped)},t)))}},{key:"handleVpaidContent",value:function(){var e=this;this.adUnit._iframe&&(this.logVpaidTextElements||this.countdownRegex)&&setTimeout(function(){e.vpaidTextElements={},e._getAndHandleVpaidContent(e.adUnit._iframe),Object.keys(e.vpaidTextElements).length>0&&f.logToBI(e.vpaidLog,"vpaidTextElements",e.vpaidTextElements)},1)}},{key:"onAfterStop",value:function(){}},{key:"removeClickableTarget",value:function(){}},{key:"_onLoadAdUnit",value:function(e,t){try{if(this.stopped)return;if(e)return void this._onLoadAdUnitError(e);f.logToBI(this.vpaidLog,"loadVPAIDJSScript",{scriptLoaded:!0}),this.adUnit=t,this.store.get("imapihok")&&this._hookIMA(),this._bindIframe(t),this._bindAdUnitEvents(t),t.handshakeVersion("2.0",this._onHandshake.bind(this)),this._handleCompleteOnAdStopped()}catch(e){f.logToBI(this.vpaidLog,"loadVPAIDJSScriptErr",{err:e.message})}}},{key:"_onLoadAdUnitError",value:function(e){f.logToBI(this.vpaidLog,"loadVPAIDJSScript",{scriptLoadedError:!0}),this.store&&this.store.get("aduntldflbfruntld")?this._onError(e,"adUnitLoadFailed"):this._onError()}},{key:"_onHandshake",value:function(){this.adUnit.initAd(this.vpaidInit.width,this.vpaidInit.height,this.vpaidInit.viewMode,-1,this.vpaidInit.creativeData,{})}},{key:"_handleCompleteOnAdStopped",value:function(){var e=this.store.get("cmpltonstpddmn");e&&e.length>0&&this.mediaUrl.search(new RegExp(e.join("|"),"i"))!=-1&&(this.completeOnAdStop=!0)}},{key:"_bindIframe",value:function(e){var t=e._iframe;this.vpaidResourcesHandler.inject(t,this),this._onBindIframe(t),this._loadAdditionalScripts()}},{key:"_bindAdUnitEvents",value:function(e){var t=this;for(var i in this.vpaidEvents)!function(i){e.subscribe(i,function(e){t._allEventsHandler(i,e)})}(i)}},{key:"_allEventsHandler",value:function(e,t){if(!this.stopped){if(this._shouldHideTarget()&&"block"!==this.target.style.display&&(this.target.style.display="block"),this.adImpressionEvent){if(e===this.vpaidEvents.AdImpression)return;e===this.adImpressionEvent&&(this.adImpressionEvent=void 0,this._allEventsHandler(this.vpaidEvents.AdImpression))}e===this.vpaidEvents.AdStopped?(this.completionOnAdStoppedTimeout=clearTimeout(this.completionOnAdStoppedTimeout),this.onComplete()):e===this.vpaidEvents.AdLoaded?this.adLoaded=!0:e===this.vpaidEvents.AdImpression&&this._onAdImpression(),this.emit(e,{eventData:t})}}},{key:"_onAdImpression",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onAdImpression",this).call(this);var e=this.video.src;e&&f.logToBI(this.vpaidLog,"videoUrl",{url:e}),this.pauseVideoProtection&&this.video&&this.video.protectPause(),this._registerToTickingEvent()}},{key:"_dispatchAdImpression",value:function(){return!0}},{key:"_safeCall",value:function(e,t){if(!this.stopped&&this.adUnit){"resizeAd"===e&&this._resizeAd(t);try{return this.adUnit[e].apply(this.adUnit,t)}catch(i){return f.logToBI(this.vpaidLog,"initJsError",{err:i.message,funcName:e,args:t,stack:i.stack}),this._onSafeCallAdError(i),!1}}}},{key:"_resizeAd",value:function(e,t,i,s){}},{key:"_onSafeCallAdError",value:function(e){}},{key:"_getVideoSrc",value:function(e){if(!this.stopped)return e.getSrc?e.getSrc():e.src||e.currentSrc||""}},{key:"_stopAd",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stopAd",this).call(this),this.stopped||(this.adUnit&&this._destroyAdUnit(),this._bindedOnTicking&&(this.video.removeEventListener("ticking",this._bindedOnTicking),this._bindedOnTicking=void 0),this.stopped=!0,this.completionOnAdStoppedTimeout=clearTimeout(this.completionOnAdStoppedTimeout),this.iframe=this.vpaid=this.imaApi=this.callIMAApi=this.adUnit=this.mediaFiles=this.video=this.vpaidEvents=this.target=this.debugTracker=this._onSwitchFromCanvasToVideo=this.vpaidLog=this.store=this.tag=this.registerAnalyticsToVpaidLog=void 0,this.onAfterStop())}},{key:"_destroyAdUnit",value:function(){if(this.vpaidResourcesHandler.destroy(this.adUnit._iframe),this.adUnit._iframe&&this.adUnit._iframe.contentWindow&&this.additionalScripts&&this.additionalScripts.length>0)try{for(var e=0;e<this.additionalScripts.length;e++)this.adUnit._iframe.contentDocument.head.removeChild(this.additionalScripts[e]);this.onIframeEvent=void 0}catch(e){}this.adUnit._destroy()}},{key:"_onRestartVideoLoad",value:function(){var e=this;this.adRestarted=!0,this._bindedOnRestartVideoLoad&&(this.video.removeEventListener("canplay",this._bindedOnRestartVideoLoad),this._bindedOnRestartVideoLoad=void 0),this.video.currentTime=0,this._resizeVideotoParentSize(),this.video.play();var t=function(){e.clickThruUrl&&e.emit(e.vpaidEvents.AdClickThru,{eventData:{url:e.clickThruUrl,playerHandles:!0}})},i=function i(){e.video.removeEventListener("ended",i),e.video.removeEventListener("click",t),e._allEventsHandler(e.vpaidEvents.AdStopped,{}),e._allEventsHandler(e.vpaidEvents.AdVideoComplete,{})};this.video.addEventListener("ended",i),this.video.addEventListener("click",t)}},{key:"_resizeVideotoParentSize",value:function(){this.video.style.width=this.target.style.width,this.video.style.height=this.target.style.height}},{key:"_getMediaUrl",value:function(){return this.mediaUrl}},{key:"_getActiveVideoInIframes",value:function(e){var t=this,i=null;if(!e||0===e.length)return i;try{f.DOMIterator(e[0],"iframe",function(e){e.forEach(function(e){i||(t.minValidVideoDuration?e.duration&&e.duration>t.minValidVideoDuration&&(i=e):i=e)})},"video",this.store.get("debug"))}catch(e){}return i}},{key:"_getAndHandleVpaidContent",value:function(e){try{for(var t=e.contentWindow.document.body.getElementsByTagName("*")||[],i=0;i<t.length;i++){var s=t[i],n=s.nodeName.toLowerCase();if("script"!==n)if("iframe"===n)this._getAndHandleVpaidContent(s);else{var r=s.textContent?s.textContent.trim():"";r&&this._logVpaidTextElements(s,n,r)}}}catch(e){}}},{key:"_logVpaidTextElements",value:function(e,t,i){this.logVpaidTextElements&&(this.vpaidTextElements[t]=this.vpaidTextElements[t]||[],this.vpaidTextElements[t].push({id:e.id,className:e.className,text:i}))}},{key:"_loadAdditionalScripts",value:function(){if(this.adSettings&&this.adSettings.hasOwnProperty("adtnlscrpts")&&this.adSettings.adtnlscrpts){this.additionalScripts=[],this.onIframeEvent=this._onIframeEvent.bind(this);try{for(var e=0;e<this.adSettings.adtnlscrpts.length;e++){var t=this.adUnit._iframe.contentDocument.createElement("script");t.src=this.adSettings.adtnlscrpts[e].src,t.type="text/javascript",t.onload=this.adSettings.adtnlscrpts[e].clbk.bind(this),this.adUnit._iframe.contentDocument.head.appendChild(t),this.additionalScripts.push(t)}}catch(e){}}}},{key:"_onIframeEvent",value:function(e){if(!this.stopped&&this._shouldListenToIframeEvents()){if(!this.adSettings.ifrmevts.hasOwnProperty(e.name)||!this.vpaidEvents.hasOwnProperty(this.adSettings.ifrmevts[e.name]))return;this._allEventsHandler(this.adSettings.ifrmevts[e.name],{})}}},{key:"_shouldListenToIframeEvents",value:function(){return this.adSettings&&this.adSettings.hasOwnProperty("ifrmevts")&&this.adSettings.ifrmevts}},{key:"_onAdError",value:function(){}},{key:"_shouldHideTarget",value:function(){return this.adSettings.hasOwnProperty("hdtrgt")&&this.adSettings.hdtrgt}},{key:"_onTicking",value:function(e){this.emit(this.vpaidEvents.TimeUpdated,{eventData:e.data})}},{key:"_registerToTickingEvent",value:function(){var e=this.tag.getValueByKey("vdtck")||0;e>0&&(this._bindedOnTicking=this._onTicking.bind(this),this.video.addEventListener("ticking",this._bindedOnTicking),this.video.registerTickingEvents(e))}},{key:"getActiveVideoElement",value:function(){if(!this.stopped)return this._activeVideoElement?this._activeVideoElement:this._getVideoSrc(this.video)?(this._activeVideoElement=this.video,f.logToBI(this.vpaidLog,"jsVpaidVideo",{videoType:"local"}),this._activeVideoElement):(this._activeVideoElement=this._getActiveVideoInIframes(this.target.querySelectorAll("iframe")),this._activeVideoElement?f.logToBI(this.vpaidLog,"jsVpaidVideo",{videoType:"friendlyIframe"}):f.logToBI(this.vpaidLog,"jsVpaidVideo",{videoType:"unfriendlyIframe"}),this._activeVideoElement)}}]),t}(g.default);t.default=_},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),l=function e(t,i,s){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,s)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(s):void 0},u=i(2),h=(n(u),i(6)),c=n(h),p=i(1),v=s(p),f=i(23),m=n(f),g=function(e){function t(e,i,s){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,s));return n.vpaidLog=i,n.store=s,n.target=e.slot,n.video=e.videoSlot,n.mediaFiles=e.vpaidFiles,n.mediaFile,n.mediaUrl,n.playerWidth=0,n.playerhHeight=0,n.adVolume=0,n.skipTime=60,n.eventsToFire={adLoaded:!1,adImpression:!1},n.adPaused=!0,n.playerReady=!1,n.videoLength=0,n.vpaidEvents=Object.assign({},c.default),n._createBindedCallback(),n.playerDAST=e.playerDAST,n.tag=e.tag,e.trackingPixels.progress.length>0&&(n.progressEvents=e.trackingPixels.progress),n.store.on("stop",function(){n.stopAd()}),n.firstPauseAd=!0,n}return o(t,e),d(t,[{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents[t]&&void 0!==e&&this.off(t,e)}},{key:"handshakeVersion",value:function(){return"1.1"}},{key:"initAd",value:function(e,t,i){this.stopped||(this.resizeAd(e,t,i),this._prepareVideoTag())}},{key:"resizeAd",value:function(e,t,i,s){this.stopped||(this.playerWidth=parseInt(e),this.playerhHeight=parseInt(t),this.video.style.width=this.playerWidth+"px",this.target.style.width=this.playerWidth+"px",this.video.style.height=this.playerhHeight+"px",this.target.style.height=this.playerhHeight+"px",this.video.setAttribute("width",this.playerWidth),this.target.setAttribute("width",this.playerWidth),this.video.setAttribute("height",this.playerhHeight),this.target.setAttribute("height",this.playerhHeight),this._resizeAd(this.playerWidth,this.playerhHeight,i,s))}},{key:"startAd",value:function(){this._bindedOnPlay(),this.startAdFired=!0}},{key:"_onStartAd",value:function(){this.debugTracker.info("VideoVpaid -> startAd()"),this._fireAdImpression(),this.debugTracker.info("VideoVpaid -> startad() -> _fireAdImpression()")}},{key:"pauseAd",value:function(){this.debugTracker.info("VideoVpaid -> pauseAd()"),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"pauseAd",this).call(this),this.stopped||(this.video.pause(),this.firstPauseAd&&(this.debugTracker.info("VideoVpaid -> pauseAd() - reset currentTime"),this.video.currentTime=0,this.firstPauseAd=!1,this.video.buffering=!1))}},{key:"resumeAd",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resumeAd",this).call(this),this.stopped||(this._sendAdPlayingOnProgress=!0,this.video.play())}},{key:"stopAd",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stopAd",this).call(this),this.stopped||(this.stopped=!0,this.video.destroy(),this._disconnectFromVideoTag(),this.vpaidLog=this.store=this.mediaFiles=this.target=this.video=this._onError=this._onSwitchFromCanvasToVideo=this.isReplayable=this.eventsToFire=this.progressEvents=void 0,setTimeout(this.onAfterStop,50))}},{key:"restartAd",value:function(){var e=this;if(!this.stopped){var t=function t(){e.video.removeEventListener("ended",t),e._onComplete()};this.video.addEventListener("ended",t)}}},{key:"skipAd",value:function(){this.stopped||this.getAdSkippableState()&&(this.emit(this.vpaidEvents.AdSkipped),this.stopAd())}},{key:"expandAd",value:function(){}},{key:"collapseAd",value:function(){}},{key:"getAdVolume",value:function(e){e&&e(null,this.adVolume)}},{key:"getAdDuration",value:function(){return this.video.duration||this.videoLength}},{key:"getAdSkippableState",value:function(){return 0==this.getAdSkippableRemainingTime()}},{key:"getAdSkippableRemainingTime",value:function(){var e=this.getAdRemainingTime()-this.skipTime;return e>0?e:0}},{key:"getAdRemainingTime",value:function(){return this.stopped?0:this.video.remainingTime}},{key:"getAdWidth",value:function(){return this.video.videoWidth}},{key:"getAdHeight",value:function(){return this.video.videoHeight}},{key:"getAdIcons",value:function(){return[]}},{key:"getAdCompanions",value:function(){return[]}},{key:"getAdExpanded",value:function(){return!0}},{key:"getAdLinear",value:function(){return!0}},{key:"setAdVolume",value:function(e){this.stopped||(this.video.volume=this.adVolume=parseFloat(e)<=1?e:parseInt(e)/100,this.video.muted=0==e)}},{key:"_connectToVideoTag",value:function(){this.stopped||(this.video.addEventListener("canplay",this._bindedOnCanPlay,!0),this.video.addEventListener("durationchange",this._bindedOnDurationChange,!0))}},{key:"_connectVideoEvents",value:function(){this.stopped||(this.video.addEventListener("play",this._bindedOnPlay,!0),this.video.addEventListener("playing",this._bindedOnPlaying,!0),this.video.addEventListener("pause",this._bindedOnPause,!0),this.video.addEventListener("ended",this._bindedOnComplete,!0),this.video.addEventListener("error",this._bindedOnPlayerError,!0),this.video.addEventListener("click",this._bindedOnClickThru,!0),this.video.addEventListener("volumechange",this._bindedOnVolumeChange,!0),this.video.addEventListener("timeupdate",this._bindedOnTimeUpdate,!0),this.video.addEventListener("ticking",this._bindedOnTicking,!0),this.video.addEventListener("firstQuartile",this._bindedOnProgress,!0),this.video.addEventListener("midpoint",this._bindedOnProgress,!0),this.video.addEventListener("thirdQuartile",this._bindedOnProgress,!0),this.video.addEventListener("timeProgress",this._bindedOnProgress,!0),this.video.addEventListener("waiting",this._bindedOnWaiting,!0))}},{key:"_disconnectFromVideoTag",value:function(){this.video.removeEventListener("canplay",this._bindedOnCanPlay,!0),this.video.removeEventListener("play",this._bindedOnPlay,!0),this.video.removeEventListener("playing",this._bindedOnPlaying,!0),this.video.removeEventListener("pause",this._bindedOnPause,!0),this.video.removeEventListener("ended",this._bindedOnComplete,!0),this.video.removeEventListener("error",this._bindedOnPlayerError,!0),this.video.removeEventListener("click",this._bindedOnClickThru,!0),this.video.removeEventListener("volumechange",this._bindedOnVolumeChange,!0),this.video.removeEventListener("timeupdate",this._bindedOnTimeUpdate,!0),this.video.removeEventListener("ticking",this._bindedOnTicking,!0),this.video.removeEventListener("firstQuartile",this._bindedOnProgress,!0),this.video.removeEventListener("midpoint",this._bindedOnProgress,!0),this.video.removeEventListener("thirdQuartile",this._bindedOnProgress,!0),this.video.removeEventListener("timeProgress",this._bindedOnProgress,!0),this.video.removeEventListener("durationchange",this._bindedOnDurationChange,!0),this.video.removeEventListener("waiting",this._bindedOnWaiting,!0),this._bindedOnCanPlay=this._bindedOnPlay=this._bindedOnPause=this._bindedOnComplete=this._bindedOnPlayerError=this._bindedOnVolumeChange=this._bindedOnTimeUpdate=this._bindedOnTicking=this._bindedOnProgress=this._bindedOnDurationChange=this._bindedOnWaiting=this._bindedOnPlaying=this._bindedOnPlaying=this._bindedOnClickThru=void 0}},{key:"_loadVideoTagSources",value:function(){this.stopped||(this.playingMediaFile=this.video.appendVideoSources(this.mediaFiles),this.playingMediaFile&&(this.mediaUrl=this.playingMediaFile.mediaUrl,this.debugTracker.time("[VpaidWrapper"+this.wrapperIndex+"] video.src->onCanPlay"),this.playerDAST.set({vu:this.playingMediaFile.mediaUrl,vbr:this.playingMediaFile.bitrate,vwd:this.playingMediaFile.width,vht:this.playingMediaFile.height,ot:this.playingMediaFile.originalType,st:this.playingMediaFile.subType})))}},{key:"_createBindedCallback",value:function(){this._bindedOnCanPlay=this._onCanPlay.bind(this),this._bindedOnPause=this._onPause.bind(this),this._bindedOnComplete=this._onComplete.bind(this),this._bindedOnPlayerError=this._onPlayerError.bind(this),this._bindedOnVolumeChange=this._onVolumeChange.bind(this),this._bindedOnTimeUpdate=this._onTimeUpdate.bind(this),this._bindedOnTicking=this._onTicking.bind(this),this._bindedOnProgress=this._onProgress.bind(this),this._bindedOnDurationChange=this._onDurationChange.bind(this),this._bindedOnWaiting=this._onWaiting.bind(this),this._bindedOnPlay=this._onPlay.bind(this),this._bindedOnPlaying=this._onPlaying.bind(this),this._bindedOnClickThru=this._onClickThru.bind(this)}},{key:"_onCanPlay",value:function(){this.stopped||(this.videoLength=this.video.duration,v.logToBI(this.vpaidLog,"canplay",{videoCanPlay:!0}),this.logVideoBuffer("Canplay"),this.playerReady||(this.playerReady=!0,this.debugTracker.info("VideoVpaid -> onCanPlay() -> _fireAdLoaded()"),this._fireAdLoaded(),this.debugTracker.timeEnd("[VpaidWrapper"+this.wrapperIndex+"] video.src->onCanPlay"),this.adPaused||(this._fireAdImpression(),this.debugTracker.info("VideoVpaid -> onCanPlay() -> _fireAdImpression() because !adPaused"))))}},{key:"_onPlay",value:function(e,t){this.debugTracker.info("VideoVpaid -> onPlay()"),this.stopped||(this.adPaused?(this.adPaused=!1,e&&(this.debugTracker.info("VideoVpaid -> onPlay() -> before setTimeout(_fireAdImpression()) in "+t+" ms"),setTimeout(function(){this._fireAdImpression(),this.debugTracker.info("VideoVpaid -> onPlay() -> setTimeout(_fireAdImpression())")}.bind(this),t))):this._sendAdPlayingOnProgress=!0)}},{key:"_onPlaying",value:function(e){this._conditionalDispatchAdPlaying()}},{key:"_conditionalDispatchAdPlaying",value:function(){this._sendAdPlayingOnProgress&&(this.emit(this.vpaidEvents.AdPlaying),this._sendAdPlayingOnProgress=!1)}},{key:"_onPause",value:function(){this.stopped||(this.adPaused=!0,parseInt(this.video.currentTime)<parseInt(this.video.duration)&&this.emit(this.vpaidEvents.AdPaused))}},{key:"_onComplete",value:function(){this.stopped||(this.emit(this.vpaidEvents.AdVideoComplete),this.stayAlive||this.emit(this.vpaidEvents.AdStopped),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onComplete",this).call(this))}},{key:"_onPlayerError",value:function(){this.stopped||--this.video.relevantSources>0||this.emit(this.vpaidEvents.AdError)}},{key:"_onVolumeChange",value:function(){this.stopped||this.emit(this.vpaidEvents.AdVolumeChange,{eventData:{volume:this.video.volume}})}},{key:"_onTimeUpdate",value:function(){this.stopped||(this.videoLength=this.getAdDuration(),this.videoLength&&this._conditionalDispatchAdPlaying())}},{key:"_onTicking",value:function(e){this.emit(this.vpaidEvents.TimeUpdated,{eventData:e.data})}},{key:"_onDurationChange",value:function(){this.stopped||this.emit(this.vpaidEvents.AdDurationChange)}},{key:"_onWaiting",value:function(){v.logToBI(this.vpaidLog,"waiting",{videoCurrentTime:this.video.currentTime})}},{key:"_onClickThru",value:function(e){e?(this._sendAdPlayingOnProgress=!0,this.video.play()):(this.emit(this.vpaidEvents.AdClickThru,{eventData:{playerHandles:!0}}),this.video.pause())}},{key:"_registerToProgressEvent",value:function(){this.progressEvents&&this.video.registerProgressEvents(this.progressEvents)}},{key:"_registerToTickingEvent",value:function(){var e=this.tag.getValueByKey("vdtck")||0;e>0&&this.video.registerTickingEvents(e)}},{key:"_fireAdLoaded",value:function(){this.eventsToFire.adLoaded||this.emit(this.vpaidEvents.AdLoaded),this.eventsToFire.adLoaded=!0}},{key:"_fireAdImpression",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_fireAdImpression",this).call(this),this.stopped||this.eventsToFire.adImpression||(this.emit(this.vpaidEvents.AdVideoStart),this.emit(this.vpaidEvents.AdImpression),this.debugTracker.timeEnd("[VpaidWrapper"+this.wrapperIndex+"] startAd->impression"),this.eventsToFire.adImpression=!0,this.adPaused=!1,this._registerToProgressEvent(),this._registerToTickingEvent())}},{key:"_onProgress",value:function(e){"firstQuartile"===e.type?this.emit(this.vpaidEvents.AdVideoFirstQuartile):"midpoint"===e.type?this.emit(this.vpaidEvents.AdVideoMidpoint):"thirdQuartile"===e.type?this.emit(this.vpaidEvents.AdVideoThirdQuartile):"timeProgress"===e.type&&this._onTimeProgressEvent(e.data)}},{key:"_onTimeProgressEvent",value:function(e){for(var t=0;t<this.progressEvents.length;t++)if(!this.progressEvents[t].fired){var i=this.progressEvents[t].offset<=("time"===this.progressEvents[t].offsetType?e.time:e.pre);i&&(this.progressEvents[t].fired=!0,this.emit(this.vpaidEvents.Progress,{eventData:this.progressEvents[t]}),this.progressEvents.splice(t,1))}}},{key:"getDOMContainer",value:function(){return this.target}},{key:"getVideoUrl",value:function(){return this.stopped?"":this.video.getSrc()}},{key:"dontDie",value:function(){this.stayAlive=!0}},{key:"onAfterStop",value:function(){}},{key:"removeClickableTarget",value:function(){}},{key:"logVideoBuffer",value:function(e){void 0!==this.video.bufferSize&&v.logToBI(this.vpaidLog,"videoBuffer",{status:e,buffered:this.video.bufferSize},!1,!1)}},{key:"_getMediaUrl",value:function(){return this.mediaUrl}},{key:"_resizeAd",value:function(e,t,i,s){}},{key:"getActiveVideoElement",value:function(){return this.video}}]),t}(m.default);t.default=g},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(1),o=s(a),d=i(8),l=i(3),u=.03,h=50,c=function(){function e(t,i,s){n(this,e),l.mixin(this),this.watchVideoInterval=s.get("wtchvdointrvl"),this.unitPredictorsInterval=s.get("rprtvidsttsintrvl"),this.newCompletionByVideoProgress=s.get("q5byprgrss"),this.isMobile=s.get("isMobile")||!1,this.timeoutLengthToAdCompletion=t.tag.getValueByKey((this.isMobile?"mbl":"dsk")+"tmouttoadcmpltn"),this.newCompletionByVideoProgressFired=!1,this.isVForceActive=s.get("vForce"),this.reportWatchTimeInterval=t.tag.getValueByKey("wtchprgrssopp"),this.isDirectDemand=t.tag.isDirectDemand,this.bufferingEventsToReport=t.tag.getValueByKey("rprtbuffrng"),this.bufferingDetected=!1,this.lastPlayPos=0,this.bufferingCounter=0,this.wrapperIndex=t.wrapperIndex,this.debugTracker=t.debugTracker,this.stopped=!1,this.frameType=s.get("frameType")}return r(e,[{key:"prefetchVideo",value:function(e,t){"javascript"===e||"video"===e&&this.isIOS?this._prefetchOverTempVideo(t):(this.video.buffering=!0,this.playPromise=this.video.play(),void 0!=this.playPromise&&(this.playPromise=o.MakeQuerablePromise(this.playPromise),this.debugTracker.info("Vpaid.video.play()")))}},{key:"_prefetchOverTempVideo",value:function(e){var t=this;if(this.debugTracker.info("Vpaid._prefetchOverTempVideo()"),0===this.frameType||1===this.frameType){var i=o.getTopWindow();if(!i||!i.document||!i.document.body)return;this._createBufferingVideo(i,e),this.fakePlayPromise=this.bufferingVideo.play(),void 0!=this.fakePlayPromise&&(this.fakePlayPromise=o.MakeQuerablePromise(this.fakePlayPromise),this.fakePlayPromise.catch(function(e){t.stopped||t.debugTracker&&t.debugTracker.info("buffering video error:"+e)}))}}},{key:"_createBufferingVideo",value:function(e,t){this.bufferingVideo=e.document.createElement("video"),this.bufferingVideo.id="prefetchWrapper"+this.wrapperIndex,this.bufferingVideo.src=t?t:this.playingMediaFile.mediaUrl,this.bufferingVideo.muted=!0,this.bufferingVideo.setAttribute("muted",""),this.bufferingVideo.setAttribute("playsinline",""),o.addClass(this.bufferingVideo,"buff-vid"),this.bufferingVideo.style.top=1*this.wrapperIndex+"px",e.document.body.appendChild(this.bufferingVideo)}},{key:"pausePrefetchVideo",value:function(){this.bufferingVideo&&(this.bufferingVideo.pause(),this.debugTracker.info("Vpaid.pausePrefetchVideo()"))}},{key:"_destroyPrefetchVideo",value:function(){this.bufferingVideo&&this.bufferingVideo.parentElement&&(this.bufferingVideo.pause(),this.bufferingVideo.removeAttribute("src"),this.bufferingVideo.load(),this.bufferingVideo.parentElement.removeChild(this.bufferingVideo),this.debugTracker.info("Vpaid._destroyPrefetchVideo()"))}},{key:"resumeAd",value:function(){this.stopped||this.activeVideoElement&&this.watchVideoInterval&&this.activeVideoElement.duration&&(this.emit("activeAdCurrentTime",{currentTime:this.activeVideoElement.currentTime.toFixed(3),duration:this.activeVideoElement.duration.toFixed(3)}),this.watchActiveVideoElement())}},{key:"pauseAd",value:function(){this.activeVideoElement&&this.watchVideoInterval&&this.unwatchActiveVideoElement()}},{key:"stopAd",value:function(){this.stopped||(this.debugTracker.info("Vpaid -> stopAd()"),this.activeVideoElement&&this.watchVideoInterval&&this.unwatchActiveVideoElement(),this.bufferingVideo&&(this.debugTracker.info("Vpaid -> stopAd() -> _destroyPrefetchVideo()"),this._destroyPrefetchVideo()))}},{key:"_fireAdImpression",value:function(){this._onAdImpression()}},{key:"_onAdImpression",value:function(){this.stopped||(this.activeVideoElement=this.getActiveVideoElement(),!this.isVForceActive&&this.activeVideoElement&&this.watchVideoInterval&&this.watchActiveVideoElement())}},{key:"watchActiveVideoElement",value:function(){this._sampleVideoCurrentTimeIntervalId||(this._sampleVideoCurrentTimeIntervalId=setInterval(this._sampleVideoCurrentTimeHandler.bind(this),h))}},{key:"unwatchActiveVideoElement",value:function(){this._sampleVideoCurrentTimeIntervalId&&(clearInterval(this._sampleVideoCurrentTimeIntervalId),this._sampleVideoCurrentTimeIntervalId=void 0)}},{key:"_sampleVideoCurrentTimeHandler",value:function(){this.reportCurrentTimeToUnitPredictors(),this.testNewCompletion(),this.reportWatchTime(),this.checkBuffering()}},{key:"reportCurrentTimeToUnitPredictors",value:function(){if(this.unitPredictorsInterval&&this.activeVideoElement.currentTime&&this.activeVideoElement.duration){var e=Math.floor(1e3*this.activeVideoElement.currentTime/this.unitPredictorsInterval);e&&this._currentIntervalMultiplier!==e&&(this._currentIntervalMultiplier=e,this.emit("activeAdCurrentTime",{currentTime:this.activeVideoElement.currentTime.toFixed(3),duration:this.activeVideoElement.duration.toFixed(3)}))}}},{key:"testNewCompletion",value:function(){this.newCompletionByVideoProgress&&!this.newCompletionByVideoProgressFired&&1e3*this.activeVideoElement.currentTime>this.timeoutLengthToAdCompletion&&(this.emit(d.outer.NewCompletion),this.newCompletionByVideoProgressFired=!0)}},{key:"checkBuffering",value:function(){if(this.bufferingEventsToReport&&this.bufferingCounter<this.bufferingEventsToReport){var e=this.activeVideoElement.currentTime;this.bufferingDetected?e>this.lastPlayPos+u&&(this.bufferingDetected=!1,this.emit("bufferingEnded"),this.bufferingCounter++):e<this.lastPlayPos+u&&(this.bufferingDetected=!0,this.emit("buffering")),this.lastPlayPos=e}}},{key:"reportWatchTime",value:function(){if(this.reportWatchTimeInterval&&this.isDirectDemand){var e=Math.floor(this.activeVideoElement.currentTime);e>0&&this._currentTimeFloored!==e&&e%this.reportWatchTimeInterval===0&&(this._currentTimeFloored=e,this.emit("watchProgress",{currentTime:e}))}}},{key:"getActiveVideoElementDuration",value:function(){var e=this.activeVideoElement?this.activeVideoElement.duration:null;return e}},{key:"onComplete",value:function(){this._destroyPrefetchVideo()}},{key:"reportBufferToDebugTracker",value:function(){this.bufferingVideo&&this.video&&this.video.buffered&&this.video.buffered.length>0&&this.video.buffered.end(0)&&this.debugTracker.info("startAd() - video currentTime:"+this.video.currentTime+"; buffered:"+(this.video.buffered.length>0?this.video.buffered.end(0):0)+" sec")}}]),e}();t.default=c},function(e,t){"use strict";function i(e,t,i){}function s(e,t,i){Object.defineProperty(e,t,{writable:!1,configurable:!1,value:i})}var n=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"],r=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"],a=["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"],o=["setAdVolume"];
i.prototype.handshakeVersion=function(e,t){},i.prototype.initAd=function(e,t,i,s,n,r,a){},i.prototype.startAd=function(e){},i.prototype.stopAd=function(e){},i.prototype.skipAd=function(e){},i.prototype.resizeAd=function(e,t,i,s){},i.prototype.pauseAd=function(e){},i.prototype.resumeAd=function(e){},i.prototype.expandAd=function(e){},i.prototype.collapseAd=function(e){},i.prototype.subscribe=function(e,t,i){},i.prototype.unsubscribe=function(e,t){},i.prototype.getAdLinear=function(e){},i.prototype.getAdWidth=function(e){},i.prototype.getAdHeight=function(e){},i.prototype.getAdExpanded=function(e){},i.prototype.getAdSkippableState=function(e){},i.prototype.getAdRemainingTime=function(e){},i.prototype.getAdDuration=function(e){},i.prototype.getAdVolume=function(e){},i.prototype.getAdCompanions=function(e){},i.prototype.getAdIcons=function(e){},i.prototype.setAdVolume=function(e,t){},s(i,"METHODS",n),s(i,"GETTERS",a),s(i,"SETTERS",o),s(i,"EVENTS",r);var d=n.filter(function(e){return["skipAd"].indexOf(e)===-1});s(i,"checkVPAIDInterface",function(e){var t=d.every(function(t){return"function"==typeof e[t]});return t}),e.exports=i},function(e,t,i){"use strict";function s(e,t,i,s){this._isValid=u(e),this._isValid&&(this._creative=e,this._el=t,this._videoEl=i,this._iframe=s,this._subscribers=new l,h.setFullSizeStyle(t),n.call(this))}function n(){if(v.forEach(function(e){this._creative.subscribe(a.bind(this,e),e)}.bind(this)),this._creative.subscribe(r.bind(this),p),this._videoEl){var e=this._iframe.contentDocument.documentElement,t=this._videoEl;e.addEventListener("click",function(i){i.target===e&&t.click()})}}function r(e,t,i){this._subscribers.triggerSync(p,{url:e,id:t,playerHandles:i})}function a(e){this._subscribers.trigger(e,Array.prototype.slice.call(arguments).slice(1))}function o(e,t,i,s){e?e(i,s):i&&t.trigger(c,i)}var d=i(24),l=i(27),u=d.checkVPAIDInterface,h=i(11),c=(d.METHODS,"AdError"),p="AdClickThru",v=d.EVENTS.filter(function(e){return e!=p});s.prototype=Object.create(d.prototype),s.prototype.isValidVPAIDAd=function(){return this._isValid},d.METHODS.forEach(function(e){var t=["subscribe","unsubscribe","initAd"];t.indexOf(e)===-1&&(s.prototype[e]=function(){var t=d.prototype[e].length,i=Array.prototype.slice.call(arguments),s=t===i.length?i.pop():void 0;setTimeout(function(){var t,n=null;try{t=this._creative[e].apply(this._creative,i)}catch(e){n=e}o(s,this._subscribers,n,t)}.bind(this),0)})}),s.prototype.initAd=function(e,t,i,s,n,r,a){n=n||{},r=h.extend({slot:this._el,videoSlot:this._videoEl},r||{}),setTimeout(function(){var d;try{this._creative.initAd(e,t,i,s,n,r)}catch(e){d=e}o(a,this._subscribers,d)}.bind(this),0)},s.prototype.subscribe=function(e,t,i){this._subscribers.subscribe(t,e,i)},s.prototype.unsubscribe=function(e,t){this._subscribers.unsubscribe(t,e)},s.prototype.on=s.prototype.subscribe,s.prototype.off=s.prototype.unsubscribe,d.GETTERS.forEach(function(e){s.prototype[e]=function(t){setTimeout(function(){var i,s=null;try{i=this._creative[e]()}catch(e){s=e}o(t,this._subscribers,s,i)}.bind(this),0)}}),s.prototype.setAdVolume=function(e,t){setTimeout(function(){var i,s=null;try{this._creative.setAdVolume(e),i=this._creative.getAdVolume()}catch(e){}o(t,this._subscribers,s,i)}.bind(this),0)},s.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},e.exports=s},function(e,t,i){"use strict";function s(e,t,i,s,n){i=i||{},this._id=p(),this._destroyed=!1,this.store=n,this._frameContainer=c.createElementInEl(e,"div"),this._frameContainer.style.position="initial",this._videoEl=t,this._vpaidOptions=s||{timeout:1e4},this._templateConfig={template:i.template||f,extraOptions:i.extraOptions||{}}}function n(e){var t=this[e];t&&(t.remove&&t.remove(),delete this[e])}function r(){o.call(this),delete this._adUnit}function a(){o.call(this),l.call(this)}function o(){n.call(this,"_frame"),d.call(this)}function d(){this._onLoad&&(window.removeEventListener("message",this._onLoad),c.clearCallbackTimeout(this._onLoad),delete this._onLoad)}function l(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function u(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}function h(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}var c=i(11),p=c.unique("vpaidIframe"),v=i(25),f='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"></script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');setTimeout(function () {try { if (window.top.onTaboolaVpaidJSVpaidIframeLoaded) { window.top.onTaboolaVpaidJSVpaidIframeLoaded(\'{"data":{"event": "ready", "id": "{{iframeID}}"}, "origin": "{{origin}}"}\'); } } catch (e) {}}, 100);</script></body></html>',m="AdStopped";s.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,a.call(this))},s.prototype.isDestroyed=function(){return this._destroyed},s.prototype.loadAdUnit=function(e,t){function i(e){if(l&&"string"==typeof e&&(e=JSON.parse(e)),e.origin===h()){var i;if(l&&"string"!=typeof e)i=e.data;else try{i=JSON.parse(e.data)}catch(e){i={}}if(i.id===n.getID()){var s,a,o;if(n._frame.contentWindow?(o=n._frame.contentWindow.getVPAIDAd,a=c.validate("function"==typeof o,"the ad didn't return a function to create an ad")):a="the iframe is not anymore in the DOM tree",!a){var u=n._frame.contentWindow.document.querySelector(".ad-element");s=new v(o(),u,n._videoEl,n._frame),s.subscribe(m,r.bind(n)),a=c.validate(s.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")}n._adUnit=s,d.call(n),t(a,a?null:s);try{l&&(window.top.onTaboolaVpaidJSVpaidIframeLoaded=void 0)}catch(e){}return!0}}}function s(){t("timeout",null)}u.call(this),a.call(this);var n=this,o=c.createIframeWithContent(this._frameContainer,this._templateConfig.template,c.extend({iframeURL_JS:e,iframeID:this.getID(),origin:h()},this._templateConfig.extraOptions));this.store.get("msnifrmsrchk")&&(o._src=o.src,Object.defineProperty(o,"src",{get:function(){return o._src},set:function(e){}})),this._frame=o,this._onLoad=c.callbackTimeout(this._vpaidOptions.timeout,i.bind(this),s.bind(this));var l=this.store.get("istblvpd");if(l)try{window.top.onTaboolaVpaidJSVpaidIframeLoaded=this._onLoad}catch(e){}window.addEventListener("message",this._onLoad)},s.prototype.unloadAdUnit=function(){a.call(this)},s.prototype.getID=function(){return this._id},e.exports=s},function(e,t){"use strict";function i(){this._subscribers={}}function s(e,t){setTimeout(function(){e.handler.call(e.context,t)},0)}i.prototype.subscribe=function(e,t,i){this.isHandlerAttached(e,t)||this.get(t).push({handler:e,context:i,eventName:t})},i.prototype.unsubscribe=function(e,t){this._subscribers[t]=this.get(t).filter(function(t){return"*"!==e&&e!==t.handler})},i.prototype.unsubscribeAll=function(){this._subscribers={}},i.prototype.trigger=function(e,t){for(var i=this.get(e),n=0;n<i.length;n++)s(i[n],t)},i.prototype.triggerSync=function(e,t){var i=this.get(e);i.forEach(function(e){e.handler.call(e.context,t)})},i.prototype.get=function(e){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e]||[]},i.prototype.isHandlerAttached=function(e,t){return this.get(t).some(function(t){return e===t.handler})},e.exports=i},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(t){i(this,e),this.decodedData=atob(t),this.nextBits=0,this.numBitsRemaining=0,this.isEndOfStream=!1,this.pointerInDecodedData=0}return s(e,[{key:"getNextByte",value:function(){return this.pointerInDecodedData===this.decodedData.length?-1:this.decodedData.charCodeAt(this.pointerInDecodedData++)}},{key:"read",value:function(){if(this.isEndOfStream)return-1;if(0===this.numBitsRemaining){if(this.nextBits=this.getNextByte(),this.nextBits===-1)return this.isEndOfStream=!0,-1;this.numBitsRemaining=8}return this.numBitsRemaining--,this.nextBits>>7-this.numBitsRemaining&1}},{key:"isEof",value:function(){return this.isEndOfStream||0==this.numBitsRemaining&&this.pointerInDecodedData==this.decodedData.length}},{key:"readChar",value:function(){for(var e=0,t=0;t<7;t++){var i=this.read();e|=i<<t}return String.fromCharCode(e)}},{key:"readByte",value:function(){for(var e=0,t=0;t<8;t++){var i=this.read();e|=i<<t}return e}},{key:"read7bitString",value:function(e){for(var t="",i=0;i<e;i++)t+=this.readChar();return t}},{key:"read8bitString",value:function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readByte());return t}},{key:"readBytes",value:function(e){for(var t=new ArrayBuffer(e),i=0;i<e;i++)t[i]=this.readByte();return t}},{key:"readInt",value:function(e){if(void 0!==e){for(var t=0,i=0;i<e;i++){var s=this.read();t|=s<<i}return t}for(var n=0,i=3;i>=0;i--)n+=this.readByte(),i>0&&(n<<=8);return n}},{key:"readLong",value:function(){for(var e=0,t=7;t>=0;t--)e+=this.readByte(),t>0&&(e<<=8);return e}},{key:"readShort",value:function(){for(var e=0,t=1;t>=0;t--)e+=this.readByte(),t>0&&(e<<=8);return e}},{key:"readFloat",value:function(){for(var e=new ArrayBuffer(4),t=new DataView(e),i=0;i<4;i++)t.setUint8(i,this.readByte());var s=t.getFloat32(0);return s}},{key:"readDouble",value:function(){for(var e=new ArrayBuffer(8),t=new DataView(e),i=0;i<8;i++)t.setUint8(i,this.readByte());var s=t.getFloat64(0);return s}},{key:"readBool",value:function(){return this.read()>0}}]),e}();t.default=n},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(t){i(this,e),this.store=t,this.effectiveTypes={"slow-2g":1,"2g":2,"3g":3,"4g":4},this.types={bluetooth:1,cellular:2,ethernet:3,none:4,wifi:5,wimax:6,other:7,unknown:8},this.navigatorConnection={},this._detectConnectionType()}return s(e,[{key:"_detectConnectionType",value:function(){var e=this,t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(t){var i=function(){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,i=t.effectiveType||"",s=t.type||"";e.navigatorConnection={browserSupport:!0,downlink:t.downlink||0,effectiveType:i,type:s,effectiveTypeId:e.effectiveTypes.hasOwnProperty(i)?e.effectiveTypes[i]:0,typeId:e.types.hasOwnProperty(s)?e.types[s]:0,rtt:t.rtt||0,saveData:t.saveData||!1},e.store.set("navigatorConnection",e.navigatorConnection),e.store.emit("navigatorConnectionChange",e.navigatorConnection)};t.onchange=i,i()}else this.navigatorConnection={browserSupport:!1},this.store.set("navigatorConnection",this.navigatorConnection)}}]),e}();t.default=n},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(33),d=n(o),l=i(5),u=n(l),h=i(1),c=s(h),p=i(7),v=s(p),f=function(){function e(t,i){r(this,e),this._store=t,this._intervalDuration=this._store.get("kpitrvldrt"),this._numOfSamplesPerMeasurment=this._store.get("prfsmpmsnt"),this._durationOfSamplePerMeasurment=this._store.get("prfsmitrvpmsnt"),this._playerOpportunityManager=i,this.dataSaverUrl=this._store.get("dtsvrurl"),this._addListeners(),this._startLoopTimeInterval(),this._measure(),this._runFirstMeasurmentCycle()}return a(e,[{key:"_addListeners",value:function(){this._store.once("stop",this._onStop.bind(this)),this._store.once("beforeunload",this._onBeforeunload.bind(this))}},{key:"_startLoopTimeInterval",value:function(){var e=this._store.get("msrkpifctr")||100;if(e=Math.min(100,e),1===e||c.getRandomInt(0,e)===e){var t=c.normalizeMilliseconds(this._store.get("msrkpiintvl")||15);this._loopInterval=setInterval(this._sendLoopKpiPixel.bind(this),t)}}},{key:"_sendLoopKpiPixel",value:function(){var e=c.createPixelParams(v.KPI,this._store);e.kpipm=this._store.get("performance.performanceMeasurment"),e.kpinw=this._store.get("performance.wfRoundTripAverageDuration"),c.sendPixel(e,this._store)}},{key:"_measure",value:function(){var e=this;this._running=!0,this._runSampling("first_kpi"),this.intervalMeasureId=setInterval(function(){e._runSampling("last_kpi")},this._intervalDuration)}},{key:"_runSampling",value:function(e){var t=this,i=new d.default;i.runEventLoopSampling(this._numOfSamplesPerMeasurment,this._durationOfSamplePerMeasurment).then(function(s){t._store.set(e,s),t._saveData(s),i.cleanResources()}),this._measureDataSaverRoundtripDuration()}},{key:"_measureDataSaverRoundtripDuration",value:function(){var e=this;if(this.dataSaverUrl){var t=(new Date).getTime(),i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&e._store.set("performance.dtsvrRoundTripAverageDuration",(new Date).getTime()-t)},i.open("GET",this.dataSaverUrl,!0),i.send(null)}}},{key:"_sendOpp",value:function(e){this._playerOpportunityManager.send(e)}},{key:"_runFirstMeasurmentCycle",value:function(){var e=this,t=new d.default;t.runOneEventLoopSampling().then(function(t){e._saveData(t),e._sendOpp(u.default.firstWfMeasurment)})}},{key:"_saveData",value:function(e){this._store.set("performance.wfRoundTripAverageDuration",this._store.get("waterfall_data.average_duration")),this._store.set("performance.performanceMeasurment",Math.round(e))}},{key:"_onBeforeunload",value:function(){this._destroy()}},{key:"_onStop",value:function(){this._destroy()}},{key:"_destroy",value:function(){this._running&&(clearInterval(this.intervalMeasureId),clearInterval(this._loopInterval),this._running=!1,this._saveData(this._store.get("last_kpi")),this._sendOpp(u.default.playerClosedMeasurment))}}]),e}();t.default=f},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(t,s){i(this,e),this.parent=t,this.getAdSkippableRemainingTime=this.build_vpaid_get_controller(t,"getAdSkippableRemainingTime",-1),this.getAdLinear=this.build_vpaid_get_controller(t,"getAdLinear",!0),this.getAdWidth=this.build_vpaid_get_controller(t,"getAdWidth",0,"width"),this.getAdHeight=this.build_vpaid_get_controller(t,"getAdHeight",0,"height"),this.getAdExpanded=this.build_vpaid_get_controller(t,"getAdExpanded",!0),this.getAdSkippableState=this.build_vpaid_get_controller(t,"getAdSkippableState",!0),this.getAdRemainingTime=this.build_vpaid_get_controller(t,"getAdRemainingTime",-1),this.getAdDuration=this.build_vpaid_get_controller(t,"getAdDuration",-1),this.getAdCompanions=this.build_vpaid_get_controller(t,"getAdCompanions",[]),this.getAdIcons=this.build_vpaid_get_controller(t,"getAdIcons",[]),this.pauseAd=this.build_vpaid_set_controller(t,"pauseAd"),this.resumeAd=this.build_vpaid_set_controller(t,"resumeAd"),this.expandAd=this.build_vpaid_set_controller(t,"expandAd"),this.collapseAd=this.build_vpaid_set_controller(t,"collapseAd"),this.skipAd=this.build_vpaid_set_controller(t,"skipAd"),this.stopAd=this.build_vpaid_set_controller(t,"stopAd"),this.store=s,this.isMultiAdsActive=this.store.get("mltads")}return s(e,[{key:"startAd",value:function(){this.parent.vpaidHandler.startAd()}},{key:"getAdVolume",value:function(){if(!this.isMultiAdsActive){var e=this.parent.volume();return e}}},{key:"setAdVolume",value:function(e,t){this.isMultiAdsActive||this.store.get("forceMute")&&e>0||(this.parent.volume(e),this.parent.runningVpaid&&this.parent.runningVpaid.vpaid&&this.parent.runningVpaid.vpaid.setAdVolume(e))}},{key:"resizeAd",value:function(e,t,i){if(!this.isMultiAdsActive)return!!this.parent.runningVpaid&&this.parent.runningVpaid.resize(e,t,i)}},{key:"muteAd",value:function(){}},{key:"unmuteAd",value:function(){}},{key:"setParam",value:function(e,t){return this.store(e,t)}},{key:"getParam",value:function(e){return this.store(e)}},{key:"build_vpaid_set_controller",value:function(e,t){var i=function t(){return!!e.scheduleMaster.gotVpaid&&!!e.scheduleMaster.runningVpaid.vpaid[t.type]&&e.scheduleMaster.vpaid[t.type]()};return i.proxy=e,i.type=t,i}},{key:"build_vpaid_get_controller",value:function(e,t,i,s){var n=function t(){return e.scheduleMaster.gotVpaid?e.scheduleMaster.vpaid[t.type]():t.default_value_key&&void 0!=e.options[t.default_value_key]?e.options[t.default_value_key]:t.default_value};return n.proxy=e,n.default_value=i,s?n.default_value_key=s:n.default_value_key=void 0,n.type=t,n}},{key:"gotVpaid",get:function(){return!!(this.parent&&this.parent.scheduleMaster&&this.parent.scheduleMaster.gotVpaid)}},{key:"gotAd",get:function(){return!(!this.gotVpaid||!this.parent.scheduleMaster.runningVpaid.adPlaying)}}]),e}();t.default=n,n.prototype.getAdSkippableRemainingTime=n.prototype.build_vpaid_get_controller(parent,"getAdSkippableRemainingTime",-1)},function(t,i,s){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function a(t){function i(){if(this.isMobile){var e=this.store.get("forcecnvsmpg"),t=this.store.get("useapforcntnt");!e||t||this.fallbackToCanvasFired||this.playerOpportunityManager.send(E.default.fallBackCanvas)}}var s=this;this.overrideWindowMethods=function(){Object.assign=function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}};var n=L.parseUserAgent();this._reportToPlayerOptions=function(){var e=Object.assign({},this.store.data);k.deletePropsFromObj(e,this.store.get("rmplyroptns")),k.reportByIndex("player_options","ctor1",{type:"debug",message:"ctor1",options:e},this.store)};var r=void 0==Object.assign||!k.isNativeCode(Object.assign);r&&this.overrideWindowMethods(),this.status="loading",this.videoLength=0,this.ga_set=!1,this.video=void 0,this.repeatCount=0,this.schedule={},this.playerIsClosed=!1,this.options=(0,v.getDefaults)(t);var a=Object.assign((0,v.getUnitParams)(),t.dplayerSettings);this.options=Object.assign({},this.options,a);var o=new m.default(this.options,n);if(this.store=o,this.store.get("firedsplyimp")){var d=k.createPixelParams(R.playerDisplayImpression,this.store);k.sendPixel(d)}this.store.set("player_id",Date.now()+"_"+k.generateGuid(30)),this.store.set("fullPageUrl",window.location.href),this.store.set("forcePause",!1),this.store.set("forceMute",!1),this.store.set("dataSaverDetected",!1),this.store.set("conversionsCount",0),this.store.set("failsCount",0),this.store.set("getAdData.count",0),this.store.set("playerAspectRatio",this.options.aspect_ratio),this.store.set("noplrcntr",this.store.get("noplrcntr")&&this.store.get("isMultiVpaidUnit")),this.store.set("isAmp",window.TRC&&window.TRC.isAMP),F.init(this.store.data),F.get("video-element",this.store.get("vdelv"),function(e){s.store.set("videoElement",e)}),p.default.prototype.debugLevels=this.store.get("debugLevels")||"",this.logConnectionType=function(e){var t="unknown",i={1:"dialup",2:"wired",3:"wifi",4:"mobile",5:"satellite"};e&&(t=i.hasOwnProperty(e)?i[e]:e.toString()),this.store.set("connectionType",{type:t})},this._preventAutoplay=!this.store.get("isMobile")&&this.store.get("prvaupl")&&n&&n.browser&&n.browser.name&&"firefox"==n.browser.name.toLowerCase();var u=k.parseDast(t.auc_dast,function(){s.store.set("dastDecoderError",k.stringify(e))});u&&(u.sesid&&this.store.set("sessionId",u.sesid),this.logConnectionType(u.ct)),this.store.set("dast",u),u.hasOwnProperty("abt")&&(this.store.set("dast_AbTest",u.abt),this.store.set("abTest",this.store.get("abTest")?this.store.get("abTest")+"|"+u.abt:u.abt));var c=this.store.get("isMobile"),f=this.store.get("measureKPI");(c||f)&&(this.playerOpportunityManager=new V.default(this.store)),this.store.get("base_url")&&0!==this.store.get("base_url").length||(this.store.set("original_base_url","empty"),this.store.set("href",window.location.href),this.store.set("base_url","//www.cmbestsrv.com")),this.connectionTypeDetector=new D.default(this.store),this.store.get("dtctprvtbrwsng")&&(this.privateBrowsingDetector=new M.default(this.store)),this.store.set("queueLength",0),this.store.set("vpaidReadyCount",0),this.store.set("document.visible",!document.hidden),this._reportToPlayerOptions(),o.set("ads_playing",0),o.set("ads_started",0),o.set("total_impressions",0),this.dependenciesLoader=new x.default(this.store),f&&(this.KPIsRecorder=new T.default(this.store,this.playerOpportunityManager)),this.options.schedule&&this.options.schedule.length&&this.options.schedule[0].ad_parameters&&this.options.schedule[0].ad_parameters.length>2&&o.set("static_schedule",this.options.schedule),this.overrideNonNativeFunctions=function(){var e=this.store.get("ovrdnonntvfnclst");if(Object.keys(e).length>0){var t=document.createElement("iframe");t.style.width=0,t.style.height=0,t.style.visibility="hidden",t.style.display="none",document.body.appendChild(t);for(var i in e)k.isNativeCode(window[i])||(window[i]=e[i](t))}},this.overrideNonNativeFunctions(),this.isMobile=this.store.get("isMobile"),i.call(this),this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit");var g=this;window.addEventListener("beforeunload",function(e){s.store.emit("beforeunload")}),this.store.on("AdImpression",function(){g.killAfterXWithNoConversion()}),this.playerStatus="content",this.store.on("AdPlayerVisible",function(){if(!this.playerIsClosed){this.playerStatus="ad";var e={playerState:this.playerStatus,isVisible:!1};this.VideoControls&&(this.isMobile?this.VideoControls.setState(e):(this.wasContentPausedBeforeAd=this.VideoControls.getValueFromControlsState("isPaused"),e.isPaused=!1,this.VideoControls.setState(e),this.runningVpaid&&(this.runningVpaid.vpaid.vpaidHandler.setPaused(!1),this.runningVpaid.vpaid.vpaidHandler.volume(this.VideoControls.getValueFromControlsState("volume")))),this.store.emit("playerStatusChanged",this.playerStatus))}}.bind(this)),this.store.on("AdPlayerHidden",function(){if(!this.playerIsClosed){this.playerStatus="content";var e={playerState:this.playerStatus,isVisible:!0};this.VideoControls&&(this.isMobile?(this.volume(0),this.VideoControls.setState(e)):(e.isPaused=this.wasContentPausedBeforeAd,this.VideoControls.setState(e),this.volume(this.VideoControls.getValueFromControlsState("volume"))),this.store.emit("playerStatusChanged",this.playerStatus))}}.bind(this)),this.playContentAfterFirstAd=function(){this.playContentBeforeAds||(this.playContentBeforeAds=!0,this.video.autoplay=!1,this._appendCotnentMediaFiles(this.video),this.target.appendChild(this.video),!this.isMobile||this.hasAutoPlay&&!this.store.get("dataSaver")||this._switchToCanvas(!0),this._shouldUseVideoControls()&&this.addVideoControls())},this.store.once("playContentAfterFirstAd",this.playContentAfterFirstAd.bind(this)),this.debugTracker=new p.default("OvaMediaPlayer"),this.debugTracker.info("unit-version: "+this.store.get("unit_loader_version")+", player-version: "+this.store.get("player_version"),this.store,{color:"#D15EFF"}),this.debugTracker.info("userAgent: "+JSON.stringify(n)),this.seek=function(e){if(!this._isAdState()&&this.video.currentTime!==e)try{if(void 0==e)return this.video.currentTime;if(isNaN(parseFloat(e)))return;this.video.currentTime=parseFloat(e)}catch(e){return 0}},this.killAfterXWithNoConversion=function(){var e=this.store.get("kaxwnc");e&&(this.kaxwnc&&clearTimeout(this.kaxwnc),this.kaxwnc=setTimeout(function(){g.closeCleanPlayer("killAfterXWithNoConversion")},e))},this.killAfterXWithNoConversion(),this.play=function(){if(!this.store.get("forcePause"))return this._isAdState()?void this.vpaidHandler.vpaid.manager.play():void this.video.play()},this.pause=function(){return this._isAdState()?void this.vpaidHandler.vpaid.manager.pause():(this.store.emit("contentPaused"),void this.video.pause())},this.resume=function(){return this._isAdState()?void this.vpaidHandler.vpaid.manager.play():(this.store.emit("contentResumed"),void("paused"==this.status&&this.video.play()))},this.stop=function(){try{if("stopped"==this.status||this._isAdState())return;this.status="stopping",this.video.pause(),this.seek(0),this.status="stopped",this.options.onPlayerStop(this)}catch(e){}},this.resize=function(e,t,i){this.vpaidManager&&this.vpaidManager.resize(e,t);var s=0,n=0,r=0;try{(void 0==e||isNaN(parseInt(e)))&&(e=!1),(void 0==t||isNaN(parseInt(t)))&&(t=!1),e||t||(this.debugTracker.error("resize","No `height` or `width` specified!"),e=this.store.get("width"),t=this.store.get("height")),t&&e?(this.options.height=t+"",this.options.width=e+"",this.setVideoSize(this.options.width.search(/px$/g)>-1?this.options.width:this.options.width+"px",this.options.height.search(/px$/g)>-1?this.options.height:this.options.height+"px")):(i&&i.split(":").length>1&&(this.options.aspect_ratio=i),e?(this.options.height=!1,this.options.width=e+"",r=this.options.aspect_ratio.split(":")[1]/this.options.aspect_ratio.split(":")[0],s=this.options.width.search(/px$/g)>-1?this.options.width:parseFloat(this.options.width)+"px",n=Math.floor(parseFloat(s)*r)+"px",this.setVideoSize(s,n)):(this.options.width=!1,this.options.height=t+"",r=this.options.aspect_ratio.split(":")[0]/this.options.aspect_ratio.split(":")[1],n=this.options.height.search(/px$/g)>-1?this.options.height:parseFloat(this.options.height)+"px",s=Math.floor(parseFloat(n)*r)+"px",this.setVideoSize(s,n)))}catch(e){this.debugTracker.error("resize","Resizing component failed!")}},this.setVideoSize=function(e,t){this.isMultiVpaidUnit||(this.store.get("noplrcntr")||(this.target.style.width=e,this.target.style.height=t,this.target.setAttribute("width",parseInt(e)),this.target.setAttribute("height",parseInt(t))),this.video.style.width=e,this.video.style.height=t,this.video.setAttribute("width",parseInt(e)),this.video.setAttribute("height",parseInt(t))),this.scheduleMaster.runningVpaid&&!this.scheduleMaster.runningVpaid.finished&&this.scheduleMaster.runningVpaid.resize(parseInt(e),parseInt(t))},this.handleTarget=function(e){var t;return t=this.store.get("noplrcntr")?document.querySelector(e):"string"==typeof e?document.getElementById(e):e},this.stringToSeconds=function(e){for(var t=e.split(":"),i=[],s=0;s<t.length;s++)i.push(isNaN(parseInt(t[s]))?0:parseInt(t[s]));var n=0;switch(i.length){case 1:n=parseInt(e);break;case 2:n=60*parseInt(i[0])+parseInt(i[1]);break;case 3:n=3600*parseInt(i[1])+60*parseInt(i[1])+parseInt(i[2])}return n},this.secondsToString=function(e){e=Math.floor(e);var t=(e-e%3600)/3600;t=t<10?"0"+t:t,e-=3600*t;var i=(e-e%60)/60;return i=i<10?"0"+i:i,e-=60*i,e=e<10?"0"+e:e,(t>0?t+":":"")+i+":"+e},this.generateId=function(){for(var e="vpaid-"+Math.floor(65536*(1+Math.random()));document.getElementById(e);)e="vpaid-"+Math.floor(1e5*Math.random());return e},this.ova=new l.default(this,this.store),this.initVpaidManager=function(){this.vpaidManager=new b.default(this.store,this)},this.store.on("closePlayer",function(){s.closePlayer()}),this.initScheduleMaster=function(){this.scheduleMaster=new h.default(this,this.store),this.store.get("vForce")&&this.scheduleMaster.disable()},this.initScheduleMaster(),this.handlePlayerPause=function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":case"playing":this.status="paused",this.options.onPlayerPause(this);break;default:return}},this.handlePlayerPlay=function(){if(!this.playerIsClosed)switch(this.status){case"loading":this.status="loading-play";break;case"ended":this.status="playing",window.setTimeout(function(){!this.playerIsClosed&&this.options._onPlayerRepeat&&this.options._onPlayerRepeat()}.bind(this),0),window.setTimeout(function(){!this.playerIsClosed&&this.options._onPlayerRepeat&&this.options._onPlayerRepeat()}.bind(this),0),window.setTimeout(function(){!this.playerIsClosed&&this.options.onPlayerPlay&&this.options.onPlayerPlay()}.bind(this),0);break;case"loading-play":case"stopped":case"paused":this.status="playing",window.setTimeout(function(){!this.playerIsClosed&&this.options.onPlayerResume&&this.options.onPlayerResume()}.bind(this),0);break;default:return}},this._onPlayerRepeat=function(){this.repeatCount++},this.handleOnCanPlay=function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":this.status="playing",this.createSchedule(),window.setTimeout(function(){this.onPlayerReadyRun(),this.options.onPlayerReady()}.bind(this),0),window.setTimeout(function(){this.options.onPlayerPlay()}.bind(this),0);break;case"loading":this.createSchedule(),window.setTimeout(function(){this.onPlayerReadyRun(),this.options.onPlayerReady()}.bind(this),0);break;default:return}},this.handlePlayerEnd=function(){if(!this.playerIsClosed)switch(this.store.emit("contentChanged"),this.status){case"playing":window.setTimeout(function(){this.options.onPlayerPause()}.bind(this),0);case"paused":this.status="ended",this.options.repeat?window.setTimeout(function(e){e.play()}.bind(this,this.video),0):(this.options.onPlayerComplete(this),this.options.onPlayerStop(this));break;default:return}},this.handlePlayerSeeked=function(e){this.playerIsClosed||window.setTimeout(function(){this.options.onPlayerSeek()}.bind(this),0)},this.handlePlayerError=function(e){this.status="stopping",this.video.pause(),this.status="loading",this.options.onPlayerError(this,e)},this.handlePlayerVolume=function(){this.debugTracker.info("Event","Player Volume Was Changed!")},this.muteToggle=function(){this.options.mute?this.unMute():this.mute()},this.mute=function(){return this._isAdState()?void this.vpaidHandler.vpaid.manager.mute():(this.video.muted=this.options.mute=!0,this.vpaidManager&&this.vpaidManager.mute(),void this.volume(0))},this.unMute=function(){return this._isAdState()?void this.vpaidHandler.vpaid.manager.unmute():(this.video.muted=this.options.mute=!1,this.vpaidManager&&this.vpaidManager.unmute(this.options.volume>1?this.options.volume/100:this.options.volume),void this.volume(this.options.volumeBeforeMute))},this.volume=function(e){if("stopped"!=this.status&&!(this.store.get("forceMute")&&e>0)){if(this.vpaidManager&&this.vpaidManager.volume(e),void 0==e)return this._getCurrentVolume();if(!(this.options.videoControlsForceMute&&e>0))return 0===e&&0!=this.options.volume&&(this.options.volumeBeforeMute=this.options.volume),this.options.volume=e,e=e>1?e/100:e,0==e?(this.video.muted=this.options.mute=!0,this.video.volume=0):(this.video.muted=this.options.mute=!1,this.video.volume=e),g.store.set("volume",e),this.VideoControls&&this.VideoControls.setState({volume:e}),e}},this._getCurrentVolume=function(){return this._isAdState()?this.vpaidHandler.vpaid.manager.getCurrentWorkingVpaidVolume():this.options.volume},this.onPlayerReadyRun=function(){var e=this.onPlayerReadyActions.length;
if(0!=e){for(var t=0;t<e;t++)this.onPlayerReadyActions[t].apply(this,[]);this.onPlayerReadyActions=new Array}},this.onPlayerReadyActions=new Array,this.attachEventsToVideo=function(e){var t=this,i=this,s=function e(t){e.player.handlePlayerSeeked(t)};s.player=this,e.addEventListener("seeked",s,!0);var n=function e(){e.player.handleOnCanPlay()};n.player=this,e.addEventListener("canplay",n,!0);var r=function e(){e.player.handlePlayerPlay()};r.player=this,e.addEventListener("play",r,!0);var a=function e(){e.player.handlePlayerPause()};a.player=this,e.addEventListener("pause",a,!0);var o=function e(){e.player.handlePlayerEnd()};o.player=this,e.addEventListener("ended",o,!0);var d=function(e){i.isMobile||i.handlePlayerError(e)};d.player=this;var i=this;e.addEventListener("error",d,!0),e.addEventListener("click",function(){0===e.currentTime&&this.store.get("dataSaverDetected")&&(e.play(),i.VideoControls&&i.VideoControls.setState({isPaused:!1}))}),this.contentInterval=setInterval(function(){var e=i.video.currentTime,s=i.video.duration;t.store.set("contentTime",e),t.store.set("contentDuration",s)},5e3)},this._switchToCanvas=function(e){var t=this;if(this.fallbackToCanvasFired||this.playerOpportunityManager.send(E.default.fallBackCanvas),this._shouldPlayContent()){var i="";this.video.src?i=this.video.src:this.options.files.map(function(e){if(!i){if(/\.mpg$/.test(e.url)||/\.mpeg$/.test(e.url))return;i=e.url}}),this.video.addEventListener("canvasToVideo",this._onNewVidCreated.bind(this)),setTimeout(function(){t.video._vidSetAttr("src",""),setTimeout(function(){t.video.forceCanvas&&(t.video.setAttribute("src",i),t.video.style.display="none",e||t.handleOnCanPlay())},2e3)},2)}},this.createMediaPlayer=function(){var e=this;this.store.get("noplrcntr")||(this.target.className+=" vpaid-player-container",this.isMultiVpaidUnit&&k.addClass(this.target,"multi-vpaids"));var i=k.createVideoElement(this.store,{target:this.target,onCanvasUsage:function(){setTimeout(function(){e._switchToCanvas()})},additionalCss:{position:"absolute",zIndex:102}});if(this.playerTag=i,i.id=this.generateId(),i.className=this.options.video_class_name,this.isMultiVpaidUnit&&k.addClass(i,"multi-vpaids"),i.style.cssText="position: relative; z-index:99; cursor:pointer; display:block",this._preventAutoplay||i.setAttribute("autoplay",""),this.isMobile&&!i.forceCanvas&&"iOS"===n.os.name&&i.removeAttribute("autoplay",""),this.attachEventsToVideo(i),this.isMultiVpaidUnit)if(this.options.height||this.options.width)if(this.options.height&&this.options.width)i.style.height=this.options.height.search(/px$/g)>-1?this.options.height:this.options.height+"px",i.style.width=this.options.width.search(/px$/g)>-1?this.options.width:this.options.width+"px";else if(this.options.width){var s=this.options.aspect_ratio.split(":")[1]/this.options.aspect_ratio.split(":")[0];i.style.width=this.options.width.search(/px$/g)>-1?this.options.width:parseFloat(this.options.width)+"px",i.style.height=Math.floor(parseFloat(i.style.width)*s)+"px"}else{var r=this.options.aspect_ratio.split(":")[0]/this.options.aspect_ratio.split(":")[1];i.style.height=this.options.height.search(/px$/g)>-1?this.options.height:parseFloat(this.options.height)+"px",i.style.width=Math.floor(parseFloat(i.style.height)*r)+"px"}else this.debugTracker.error("createMediaPlayer","No `height` or `width` specified!");i.muted=!0,i.setAttribute("width",parseFloat(i.style.width)+""),i.setAttribute("height",parseFloat(i.style.height)+""),i.setAttribute("playsinline","");var a=this;setTimeout(function(){try{a.handleOnCanPlay()}catch(e){}},200),this.options.repeat&&(i.playerRepeat=!0),this.options.image&&i.setAttribute("poster",this.options.image),i=this._appendCotnentMediaFiles(i),this._shouldPlayContent()&&this.target.appendChild(i),this.video=i,this.store.get("noplrcntr")||(this.target.id="_cm-css-reset"),this.isMobile&&!this.hasAutoPlay||(i.volume=this.options.volume/100);var o=this._shouldUseVideoControls();this.store.set("useVideoControls",!0),o&&this._shouldPlayContent()&&this.addVideoControls(),this.volume(this.options.mute?0:this.options.volume),this.setVideoSize(t.width+"px",t.height+"px"),this.VideoControls&&this.VideoControls.setState({playerState:this.playerStatus})},this._shouldUseVideoControls=function(){return!this.isMobile&&(this.options.controls||this.store.get("ad_controls"))||this.isMobile&&this.options.controls},this._appendCotnentMediaFiles=function(e){try{if(this._shouldPlayContent())for(var t=0;t<this.options.files.length;t++){var i=this.options.files[t];if(!/\.mpg$/.test(i.url)&&!/\.mpeg$/.test(i.url))if(!this.isMobile||this.hasAutoPlay&&!this.store.get("dataSaver")){var s=document.createElement("source");s.setAttribute("type",i.type),s.src=i.url,e.name||(e.name=i.name?i.name:i.url),e.appendChild(s)}else e.src=i.url}}catch(e){this.debugTracker.error("createMediaPlayer","Files array supplied is corrupted or malformed!")}return e},this.playContentBeforeAds=this.store.get("plcntbfrads"),this._shouldPlayContent=function(){return this.store.get("vForce")?this.store.get("cntonvfrc"):this.playContentBeforeAds},this._onNewVidCreated=function(e){this.video.parentElement.removeChild(this.video),this.video=e.data.videoElement,this.VideoControls&&this.VideoControls.setVideo(this.video)},this.addVideoControls=function(){this.VideoControls=new y.default(this.video,this.store,this.target,"content"),this.store.on("videoControlsVolume",this._onVideoControlVolumeChanged.bind(this)),this.store.on("volumeBeforeMuteChanged",this._onVideoControlsVolumeBeforeMuteChanged.bind(this)),this.isMobile||(this.store.on("videoControlsMute",this._onVideoControlMuteChanged.bind(this)),this.store.on("videoControlsPause",this._onVideoControlPauseChanged.bind(this)),this.store.on("videoProgressBar",this._onVideoProgressBarChanged.bind(this)))},this._onVideoControlsVolumeBeforeMuteChanged=function(e){this.options.volumeBeforeMute=e},this._isAdState=function(){return"ad"===this.playerStatus},this._onVideoControlMuteChanged=function(e){this.options.videoControlsForceMute=e,this.store.set("forceMute",e),e?this.mute():this.unMute()},this._onVideoControlVolumeChanged=function(e){this.options.videoControlsForceMute=!1,this.store.set("forceMute",0===e),this.volume(e)},this._onVideoControlPauseChanged=function(e){this.store.set("forcePause",e),e?this.pause():this.video.currentTime===this.video.duration?this.play():this.resume()},this._onVideoProgressBarChanged=function(e){if(!this._isAdState()){var t=Math.floor(e*this.video.duration);this.store.emit("videoProgressBarTransition",this.video.duration,t),this.video.currentTime=t}},this.onVpaidCreated=function(e){this.runningVpaid=e,this.vpaidHandler=e}.bind(this),this.store.on("vpaidHandlerCreated",this.onVpaidCreated),this.ga={sendGaMessage:function(){}};var g=this;if(this.createGA=function(){},this.removeGA=function(){this.ga_set},this.convertPreMidPostToTime=function(e,t){var t=Math.round(t),i={},s=this.options.schedule_auto,n=void 0;if(n=e["pre-roll"].length>0?e["pre-roll"][0]:e["mid-roll"].length>0?e["mid-roll"][0]:e["post-roll"].length>0?e["post-roll"][0]:void 0,void 0==n)return this.debugTracker.error("PreMidPostToTime","Error creating automatic schedule!Pleace check the schedule preset!"),{};i["00:00"]=n;var r=[];e["mid-roll"].length>0?r=e["mid-roll"]:e["post-roll"].length>0?r=e["post-roll"]:r.push(n);var a=void 0;for(a=e["post-roll"].length>0?e["post-roll"][0]:r[0];s<t;){var o=this.secondsToString(s),d=r.shift();r.push(d),s+=this.options.schedule_auto,s>t&&(d=a),i[o]=d}return i},this.createSchedule=function(){if(!this.scheduleCreated&&!this.store.get("vForce")){this.scheduleCreated=!0,this.videoLength=this.video.duration,this.videoLength=this.videoLength||120;var e=this.options.schedule,t={},i=this.options.schedule_auto;0===this.options.schedule_auto&&(this.options.schedule_auto=1);for(var s=0;s<e.length;s++){var n=e[s];if(this.options.schedule_auto)t[n.roll_type]||(t[n.roll_type]=[]),t[n.roll_type].push(n);else for(var r=0;r<n.positions.length;r++)!t[n.positions[r]]&&this.videoLength-this.options.min_vpaid_run_time>this.stringToSeconds(n.positions[r])&&(t[n.positions[r]]=n)}this.options.schedule_auto&&(t["pre-roll"]||(t["pre-roll"]=[]),t["mid-roll"]||(t["mid-roll"]=[]),t["post-roll"]||(t["post-roll"]=[]),t=this.convertPreMidPostToTime(t,this.videoLength)),this.options.schedule_auto=i,this.scheduleMaster.schedule=t,this.store.set("contentSchedule",t),this.scheduleMaster.start()}},this.setVideoFile=function(e,t,i){for(;this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0]);t?this.video.setAttribute("poster",t):this.video.removeAttribute("poster"),i?(this.status="loading",this._preventAutoplay||this.video.setAttribute("autoplay","true")):this.video.removeAttribute("autoplay");try{this.video.removeAttribute("src");for(var s=0;s<e.length;s++){var n=e[s],r=document.createElement("source");r.setAttribute("type",n.type),r.src=n.url,this.video.name||(this.video.name=n.name?n.name:n.url),this.video.appendChild(r)}this.video.load()}catch(e){this.debugTracker.error("setVideoFile","Error creating video sources!")}},this._onVpaidClosed=function(){},this._pausePlayer=function(){this.scheduleMaster.stop(!0),this.seek(0),this.stop(),this.store.emit("pausePlayer")},this.closePlayer=function(){this._onVpaidClosed=this.closeCleanPlayer.bind(this,"_onVpaidClosed"),this.options.onPlayerClose(this),this.scheduleMaster.stop()},this.closeCleanPlayer=function(e){var t=this;this.store.set("playerClosed",!0),setTimeout(function(){if(e=e||"none",t.store.emit("stop","close:"+e),!t.playerIsClosed){if(clearInterval(t.contentInterval),t.vpaidManager&&t.vpaidManager.stop(),t.VideoControls&&t.VideoControls.destroy(),t.dependenciesLoader&&t.dependenciesLoader.destroy(),t.playerIsClosed=!0,t._onVpaidClosed=function(){},t.stop(),t.removeGA(),!t.store.get("noplrcntr"))for(;t.target.childNodes.length;)t.target.removeChild(t.target.childNodes[0]);t.competitionDetector&&t.competitionDetector.destroy(),t.onPlayerReadyActions=t.debugTracker=t.video=t.schedule=t.ova=t.ga=t.scheduleMaster=t.KPIsRecorder=t.VideoControls=void 0,t.options=t.target=void 0}},0)},this.target=this.handleTarget(t.target_id),!this.target||!this.target.appendChild)return void this.debugTracker.error("Constructor","No player target!Can't build player in ["+this.target+"]... aborting!");this.store.set("can_opt_out",this.store.get("can_opt_out")||null!==this.target.parentElement.querySelector("#_cm-opt-out-view")),this.options.htmlVideoSupport?this.createMediaPlayer():(this.debugTracker.error("Constructor","Browser does not support <video> Tag!Nothing to do, aborting..."),this.options.onPlayerLoadError(this)),this.store.get("base_url"),this.set=function(e,t){this.store.set(e,t)},this.get=function(e){return this.store.get(e)},this.on=function(e,t){this.store.on(e,t)},this.off=function(e,t){this.store.off(e,t)},this.getVpaidLogs=function(){return this.vpaidManager?this.vpaidManager.getVpaidLogs():this.scheduleMaster?this.scheduleMaster.getVpaidLogs():void 0},this.startWaterfall=function(){try{this.scheduleMaster.vpaid.waterfallManager.start()}catch(e){return!1}return!0},this.stopWaterfall=function(){try{this.scheduleMaster.vpaid.waterfallManager.stop()}catch(e){return!1}return!0},this.emit=function(e,t){e&&this.store.emit(e,t)};var _=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;_&&setTimeout(function(){g.handleOnCanPlay()},500),this.store.get("vForce")&&this.initVpaidManager(),this.getAd=function(e){if(this.vpaidManager)return this.vpaidManager.getAd(e)},this.startIdleMode=function(){this.store.set("isIdleMode",!0)},this.stopIdleMode=function(){this.store.set("isIdleMode",!1)},this.startWf=function(){this.store.emit("startWf")},this.getPlayerDAST=function(){return this._isAdState()?this.vpaidHandler.vpaid.manager.getPlayerDAST():""},this.dropAds=function(e){this.vpaidHandler.vpaid.manager.cleanQueue(this.store.get("queue_size")||10,e),this.vpaidHandler.vpaid.waterfallManager.dropAds(e)},this.setDebugData=function(e){this.store.set("debugStr",e)},this.setDebugDataFunc=function(e){this.store.set("debugDataFunc",e)},this.addWfParameter=function(e,t){this.vpaidHandler.vpaid.waterfallManager.addWfParameter(e,t)},this.updateWfParameter=function(e,t){this.vpaidHandler.vpaid.waterfallManager.updateWfParameter(e,t)},this.removeWfParameter=function(e){this.vpaidHandler.vpaid.waterfallManager.removeWfParameter(e)}}Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var o=s(85),d=(r(o),s(31)),l=r(d),u=s(34),h=r(u),c=s(2),p=r(c),v=s(42),f=s(35),m=r(f),g=s(14),y=r(g),_=s(36),b=r(_),w=s(1),k=n(w),A=s(30),T=r(A),C=s(5),E=r(C),P=s(57),V=r(P),I=s(41),x=r(I),S=s(29),D=r(S),O=s(43),M=r(O),B=s(7),R=n(B);s(80).polyfill();var F=s(10),L=(s(88),s(87));window.OvaMediaPlayer=a},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(13),o=s(a),d=function(){function e(){n(this,e),this._stopwatchs=[]}return r(e,[{key:"startSampling",value:function(){var e=new o.default;return this._stopwatchs.push(e),e.start(),this._stopwatchs.length-1}},{key:"stopSampling",value:function(e){this._stopwatchs[e].stop()}},{key:"getDuration",value:function(e){return this._stopwatchs[e].duration()}},{key:"runOneEventLoopSampling",value:function(){var e=this;return new Promise(function(t){var i=e.startSampling();setTimeout(function(){e.stopSampling(i),t(e.getDuration(i))},0)})}},{key:"runEventLoopSampling",value:function(e,t){var i=this;return new Promise(function(s){var n=[],r=0,a=setInterval(function(){r<e?(n.push(i.runOneEventLoopSampling()),r++):(clearInterval(a),Promise.all(n).then(function(e){var t=e.reduce(function(e,t){return Math.max(e,t)},0);s(t)}))},t)})}},{key:"cleanResources",value:function(){this._stopwatchs.length=0}}]),e}();t.default=d},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(15),o=s(a),d=i(2),l=(s(d),500),u=function(){function e(t,i){n(this,e),this.schedule={},this.parent=t,this.savedTime=-1,this.runningVpaid=!1,this.runningVpaidTagData={},this.runTimeId=0,this.bug_feature=t.options.bug_feature,this.vpaidCount=0,this._firstImpression=!1,this.minTimeBetweenRuns=5e3,this.store=i,this.lastEndedPlayedVpaid=-1e6,this.timeBetweenAds=this.store.get("schedule_auto"),this.store.on("stop",this.stop.bind(this)),this.useNewScheduler=this.store.get("evtbsschdl"),this.useNewScheduler&&(this._bindedLoop2=this._loop2.bind(this),this._bindedOnVpaidReady=this._onVpaidReady.bind(this),this._bindedOnVpaidEnded=this._onVpaidEnded.bind(this),this.loop2Ticker=setInterval(this._bindedLoop2,l))}return r(e,[{key:"stop",value:function(){this.stopped=!0,window.clearTimeout(this.runTimeId),this.runningVpaid&&!this.runningVpaid.finished?(this.runningVpaid.stop(),this.savedTime=-1,this.parent=void 0,this.runningVpaid=void 0,this.schedule=void 0):(this.parent,this.savedTime=-1,this.parent=void 0,this.runningVpaid=void 0,this.schedule=void 0),this.useNewScheduler&&(this.store.off("vpaidReady",this._bindedOnVpaidReady),this.store.off("vpaidEnded",this._bindedOnVpaidEnded),clearInterval(this.loop2Ticker))}},{key:"stopVpaid",value:function(){this.runningVpaid&&!this.runningVpaid.finished&&this.runningVpaid.stop()}},{key:"start",value:function(){window.clearTimeout(this.runTimeId),this.useNewScheduler?(this.vpaidToRun={vpaid:this.schedule["00:00"],time:"00:00"},this.store.on("vpaidReady",this._bindedOnVpaidReady),this.store.on("vpaidEnded",this._bindedOnVpaidEnded),this._bindedLoop2()):this._loop()}},{key:"disable",value:function(){this.isDisabled=!0}},{key:"_onVpaidReady",value:function(e){this._loop2()}},{key:"_onVpaidEnded",value:function(e){e.hadImpression&&(this.lastEndedPlayedVpaid=Date.now()),this._loop2()}},{key:"_loop2",value:function(){if(!this.stopped&&!this.store.get("playerClosed")&&!this.isDisabled&&0===this.store.get("ads_started")){var e=Date.now()-this.lastEndedPlayedVpaid;e>=1e3*this.timeBetweenAds&&this.runVpaid(this.vpaidToRun.vpaid,this.vpaidToRun.time)}}},{key:"_loop",value:function(){if(!this.isDisabled){window.clearTimeout(this.runTimeId);var e=this,t=Math.floor(this.parent.video.currentTime);if(this._isContentPaused()&&(t=NaN),1===this.timeBetweenAds||t!=this.savedTime&&!isNaN(t)&&"repeating"!=this.parent.status){this.savedTime>t&&(this.savedTime=-1);var i=(new Date).getTime();if(i-this.lastRun<this.minTimeBetweenRuns)return void(e.runTimeId=window.setTimeout(function(){e._loop()},1e3));isNaN(this.savedTime)&&(this.savedTime=0);var s=this.savedTime+1;s>t&&(s=t);for(var n={vpaid:!1,time:0};s<=t;){var r=this.parent.secondsToString(s);this.schedule[r]&&(n.vpaid=this.schedule[r],n.time=r),s++}if(n.vpaid){window.lastRun=Date.now();var a=this.runVpaid(n.vpaid,n.time);a&&(this.lastRun=i)}this.savedTime=t}e.runTimeId=window.setTimeout(function(t){e._loop()},700)}}},{key:"_isContentPaused",value:function(){return this.parent.video&&this.parent.video.paused}},{key:"runVpaid",value:function(e,t){return this.runningVpaidTagData=e,this.vpaidCount++,e.vpaidCount=this.vpaidCount,this.runningVpaid?this.runningVpaid.run():(this.runningVpaid=new o.default({isFirstImpression:this.isFirstImpression,vpaidTag:e,uid:t,parent:this.parent,isPreRoll:"00:00"===t&&0===this.vpaidCount},this.parent.options,this.store),!0)}},{key:"_checkFirstImpression",value:function(){var e=!this._firstImpression;return this._firstImpression=!0,e}},{key:"getTagData",value:function(){return!!this.gotVpaid&&this.runningVpaidTagData}},{key:"getVpaidLogs",value:function(){if(this.runningVpaid)return this.runningVpaid.getVpaidLogs()}},{key:"isFirstImpression",get:function(){return this._checkFirstImpression.bind(this)}},{key:"tagVolume",set:function(e){this.runningVpaidTagData.volume=e}},{key:"vpaid",get:function(){return this.gotVpaid?this.runningVpaid.vpaid:{}}},{key:"gotVpaid",get:function(){return!(!this.runningVpaid||this.runningVpaid.finished||!this.runningVpaid.vpaidCreated)}}]),e}();t.default=u},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(1),o=s(a),d=i(3),l=function(){function e(t,i){n(this,e),d.mixin(this),this._maxListeners=100,this.data={},Object.assign(this.data,t);var s="11.2.8";this.data.full_player_version=s,s=s.replace(/\./g,""),s=parseInt(s),this.data.debugLevels=t.debug?t.debug:"",this.data.debug=t.debug.indexOf("*")!=-1,this.data.player_version=s;var r="",a="",l="";try{a=t.unit_name,r=t.abTest,l=t.unit_main_version}catch(e){}this.data.ab_test=r,this.data.unit_type=a,this.data.unit_version=l,this.data.session_started=Date.now(),this.data.secured_protocol="https:"===(window&&window.location&&window.location.protocol),window.cmTag&&window.cmTag.config&&window.cmTag.config.contentClickUrl&&(this.data.contentClickUrl=window.cmTag.config.contentClickUrl),this.set("ua",i),o.setStore(this)}return r(e,[{key:"incr",value:function(e){u.exists(e,this.data)||u.set(e,0,this.data);var t=u.get(e,!0,this.data)||0;if("number"==typeof t)return u.set(e,t+1,this.data),u.get(e,!1,this.data)}},{key:"decr",value:function(e){var t=u.get(e,!1,this.data);if("number"==typeof t)return u.set(e,t-1,this.data),u.get(e,!1,this.data)}},{key:"get",value:function(e){return e=e.toString(),e.indexOf(".")===-1?this.data[e]:u.get(e,!1,this.data)}},{key:"getByTech",value:function(e,t){var i=this.get("dsm")||{};return i&&i.hasOwnProperty(t)&&i[t].hasOwnProperty(e)?i[t][e]:null}},{key:"getByAdInline",value:function(e){var t=this.get("dsm")||{},i=Object.keys(t);if(i.length>0)for(var s=new RegExp(Object.keys(t).join("|"),"gi"),n=0;n<e.length;n++){var r=e[n],a=r.as&&r.as.match(s)||r.at&&r.at.match(s);if(a&&a.length>0)return t[a[0].toLowerCase()]}return this.get("adstngs")}},{key:"getLatestVersion",value:function(e){e=e.toString();var t=e+"_latest",i=this.get(t);if(void 0!==i)return i;var s=new RegExp(e+"[v]*\\d+$"),n={value:void 0,version:0};for(var r in this.data)if(s.exec(r)){var a=parseInt(r.match(/\d+$/)[0]);(!n.value||n.version<a)&&this.data[r]&&(n.version=a,n.value=this.data[r])}else 0===n.version&&r===e&&(n.value=this.data[r]);return this.set(t,n),n}},{key:"set",value:function(e,t){e=e.toString(),u.set(e,t,this.data)}},{key:"getWfData",value:function(){var e=this.get("dsm")||{},t=[];for(var i in e)/^\d+$/.test(i)&&e[i]&&e[i].hasOwnProperty("ftchVst")&&t.push({id:i,fv:e[i].ftchVst});return t}}]),e}();t.default=l;var u=function(){var e=function(e,t,i){for(var s,n=i||data,r=0;n&&(s=e[r]);r++)n=s in n?n[s]:t?n[s]={}:void 0;return n};return{set:function(t,i,s){var n=t.split("."),r=n.pop(),a=e(n,!0,s);return a&&r?a[r]=i:void 0},get:function(t,i,s){return e(t.split("."),i,s)},exists:function(e,t){return void 0!==this.get(e,!1,t)}}}()},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(15),o=s(a),d=0,l=function(){function e(t,i){n(this,e),this.store=t,this.parent=i,this.initVpaid(),this.hadFirstImpression=!1}return r(e,[{key:"initVpaid",value:function(){var e=this.getVpaidTag(),t={"00:00":e,"00:01":e};this.store.set("contentSchedule",t),this.store.set("autoplay_on_pre_roll",!1),this.vpaidHandler=new o.default({isFirstImpression:this.isFirstImpression,vpaidTag:e,uid:d++,parent:this.parent},this.parent.options,this.store),this.vpaidHandler.runWaterfall("vforceInit")}},{key:"getVpaidTag",value:function(){var e=this.store.get("schedule"),t={};return e.forEach(function(e){e&&"pre-roll"===e.roll_type&&(t=e)}),t}},{key:"isFirstImpression",value:function(){return!this.hadFirstImpression&&(this.hadFirstImpression=!0,!0)}},{key:"getVpaidLogs",value:function(){if(this.vpaidHandler)return this.vpaidHandler.getVpaidLogs()}},{key:"getAd",value:function(e){return this.vpaidHandler.getAd(e)}},{key:"stop",value:function(){this.vpaidHandler&&!this.vpaidHandler.finished?this.vpaidHandler.stop():this.parent&&this.parent._onVpaidClosed(),this.vpaidHandler=void 0,this.schedule=void 0,this.parent=void 0,this.savedTime=-1}},{key:"pause",value:function(){this.vpaidHandler.pause()}},{key:"resume",value:function(){this.vpaidHandler.resume()}},{key:"volume",value:function(e){this.vpaidHandler.volume(e)}},{key:"mute",value:function(){this.volume(0)}},{key:"unmute",value:function(e){this.volume(e)}},{key:"resize",value:function(e,t,i){this.vpaidHandler.resize(e,t,i)}}]),e}();t.default=l},function(e,t){"use strict";var i=i||{};i.dSettings={wirewax:{adtnlscrpts:[{src:"//edge-player.wirewax.com/ww4release/javascripts/wirewax-iframe-api.js",clbk:function(){try{this.adUnit.unsubscribe(this.vpaidEvents.AdImpression,"*"),this.adUnit.unsubscribe(this.vpaidEvents.AdVideoComplete,"*");for(var e in this.adUnit._iframe.contentWindow.wirewax.events.listeners)this.adUnit._iframe.contentWindow.wirewax.addEventListener(this.adUnit._iframe.contentWindow.wirewax.events.listeners[e],this.onIframeEvent)}catch(e){}}}],ifrmevts:{playerReady:"AdImpression",videoEnd:"AdVideoComplete"},hdtrgt:!0,wtfradpsdbfrrsmad:!0,prvnterlyadimpopp:!0,onrsm:function(){this.adUnit._iframe.contentWindow.wirewax.playerId="wirewax-ad-iframe",this.adUnit._iframe.contentWindow.wirewax.triggerEvent(this.adUnit._iframe.contentWindow.wirewax.events.triggers.CLOSE_WIDGET)}},"the trade desk":{extwnprc:!0,wnprcfld:"wp"},dbm:{extwnprc:!0,wnprcfld:"pr"}},window.TRC=window.TRC||{},window.TRC.dsm=window.TRC.dsm||{},window.TRC.dsm[181]=i.dSettings},function(e,t){"use strict";var i='function startProtection(o){window.ReportHijackAttempt=window.ReportHijackAttempt||function(){};var e="%%%TEMP%%%",r=new RegExp(e.map(function(e){try{return atob(e)}catch(t){return e}}).join("|"),"i");function p(t){return e.length&&r.test(t)}function i(t,e){window.ReportHijackAttempt(t,e)}function n(e){var r=function(){try{e.removeEventListener("load",r);var t=e.contentWindow.document.createElement("script");t.type="text/javascript",e.contentWindow.hjkFunc=t.innerHTML=window.hjkFunc,e.contentWindow.document.head.appendChild(t)}catch(t){}};e.addEventListener("load",r)}function c(t){if(t.src)return t.src;if(t.childNodes.length)for(var e=0;e<t.childNodes.length;e++)if(t.childNodes[e]&&t.childNodes[e].src)return t.childNodes[e].src;return t.outerHTML}try{!function(){for(var t=document.scripts||[],e=0;e<t.length;e++)t[e].src&&p(t[e].src);var r=document.querySelectorAll("iframe")||[];for(e=0;e<r.length;e++)if(p(r[e].src)){i(r[e].src,!0);break}}(),HTMLIFrameElement.prototype.hasOwnProperty("_src")||(Object.defineProperty(HTMLIFrameElement.prototype,"_src",Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,"src")),Object.defineProperty(HTMLIFrameElement.prototype,"src",{get:function(){return this._src},set:function(t){p(t)?i(t,!1):(n(this),this._src=t)}})),HTMLIFrameElement.prototype.hasOwnProperty("_setAttribute")||(HTMLIFrameElement.prototype._setAttribute=HTMLIFrameElement.prototype.setAttribute,HTMLIFrameElement.prototype.setAttribute=function(t,e){"src"==t.toLowerCase()&&p(e)?i(e,!1):(n(this),this._setAttribute(t,e))}),HTMLElement.prototype.hasOwnProperty("_insertBefore")||(HTMLElement.prototype._insertBefore=HTMLElement.prototype.insertBefore,HTMLElement.prototype.insertBefore=function(t,e){if(!p(t.outerHTML))return this._insertBefore(t,e);i(c(t),!1)}),HTMLElement.prototype.hasOwnProperty("_appendChild")||(HTMLElement.prototype._appendChild=HTMLElement.prototype.appendChild,HTMLElement.prototype.appendChild=function(t){if(!p(t.outerHTML))return this._appendChild(t);i(c(t),!1)}),HTMLScriptElement.prototype.hasOwnProperty("_src")||(Object.defineProperty(HTMLScriptElement.prototype,"_src",Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src")),Object.defineProperty(HTMLScriptElement.prototype,"src",{get:function(){return this._src},set:function(t){p(t)?i(t,!1):this._src=t}})),HTMLScriptElement.prototype.hasOwnProperty("_setAttribute")||(HTMLScriptElement.prototype._setAttribute=HTMLScriptElement.prototype.setAttribute,HTMLScriptElement.prototype.setAttribute=function(t,e){"src"==t.toLowerCase()&&p(e)?i(e,!1):this._setAttribute(t,e)}),HTMLObjectElement.prototype._scrollIntoView=HTMLObjectElement.prototype.scrollIntoView,HTMLObjectElement.prototype.scrollIntoView=function(){return!1},HTMLDivElement.prototype._scrollIntoView=HTMLDivElement.prototype.scrollIntoView,HTMLDivElement.prototype.scrollIntoView=function(){return!1},XMLHttpRequest.prototype.hasOwnProperty("_open")||(XMLHttpRequest.prototype._open=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(t,e,r,o,n){p(e)?i(e,!1):this._open.apply(this,arguments)}),HTMLElement.prototype._click=HTMLElement.prototype.click,HTMLElement.prototype.click=function(){this.hasAttribute("download")||this._click()},o||(window.onerror=function(){return!0}),function(){if(!o){console=console||{};function t(){}for(var e=["debug","error","info","log","warn"],r=0;r<e.length;r++)console[e[r]]&&(console[e[r]]=t)}}()}catch(t){}}startProtection("%%%IS_DEBUG%%%");';try{HijackResponse(i)}catch(e){}window.TRC=window.TRC||{},window.TRC.hjk=window.TRC.hjk||{},window.TRC.hjk[226]=i},function(e,t){"use strict";var i="!function(){if((window.ignoreGetVpaidAd||'function'==typeof window.getVPAIDAd)&&function(){try{return window.self!==window.top}catch(e){return!0}}()){function e(){for(var e=document.scripts||[],t=[],r=0;r<e.length;r++)t.push(e[r].src);return t}function t(e){for(var t=document.querySelectorAll('iframe'),r=[],i=0;i<t.length;i++)r.push(t[i].src),t[i].src&&'undefined'===t[i].src.substr(0,9)&&e&&e(url);return r}function r(r,i,o){var n=window._vaThis||this;if(window._vaThis){var s=e(),a=t(n._onUndefinedRelativeIframeSrcError);n.scripts=n.scripts.concat(s),n.iframes=n.iframes.concat(a),n.firstCount+=a.length+s.length}else n.data={},n.XHRUrls=[],n.XHRResponses=[],n.iframes=t(n._onUndefinedRelativeIframeSrcError),n.scripts=e(),n.firstCount=n.iframes.length+n.scripts.length,n.timeoutLength=o.timeout||3e3,n.callback=i,n.adImpressionEvent='AdImpression',n.networkCallCounter=0,n.maxNetworkCalls=o.maxNetworkCalls||!1,n.networkCallsLimitExceeded=!1,n.latencies=[],n.iframesWeights={gen:8,ggl:4,pxls:2},n.isVideoUrlPublic=void 0,n.requestId=0,n.requestStartTimes={},Object.defineProperty(n,'AnalyticsData',{get:function(){return n.data},enumerable:!0,configurable:!1}),r&&n.subscribeToAdImpression(r);if(o&&(o.withXHR&&window.XMLHttpRequest&&this.createXMLHTTPHook(),o.withIframes&&void 0!==window.HTMLIFrameElement&&this.createIframesSrcHook(o),o.withScripts&&void 0!==window.HTMLScriptElement&&this.createScriptsSrcHook(),o.timeout&&(n.timeoutLength=o.timeout),o.iframesWeights))for(var c in o.iframesWeights)n.iframesWeights[c]=o.iframesWeights[c];window.destroyAnalyticsReporter=function(){n.data=n.XHRUrls=n.XHRResponses=n.iframes=n.scripts=n.timeoutLength=n.iframesWeights=n.requestStartTimes=void 0,window.getVpaidAnalyticsReport=window.destroyAnalyticsReporter=window.onNetworkCallsLimitExceeded=window.setIsVideoUrlPublic=void 0,window.AnalyticsReporter=void 0},window.getVpaidAnalyticsReport=function(){var t=window._vaThis||this,r=[],i={scripts:t.scripts.length>0?t.scripts.slice():e(),XHRUrls:t.XHRUrls.slice(),iframes:t.iframes.slice()};for(var o in i)r=r.concat(i[o]);i.totalRequests=r,i.totalRequestsCounter=r.length,i.firstCount=t.firstCount,i.latencies=t.latencies.slice();var n=i.latencies.reduce(function(e,t){return e+t},0);return i.averageLatency=i.latencies.length?n/i.latencies.length:0,i.averageIntLatency=parseInt(i.averageLatency),i}.bind(n),window.setIsVideoUrlPublic=function(e){(window._vaThis||this).isVideoUrlPublic=e}.bind(n)}r.prototype.subscribeToAdImpression=function(e){var t=window._vaThis||this;e.subscribe(function(){t.adImpFired=!0,setTimeout(function(){t.sendData()},t.timeoutLength)},t.adImpressionEvent,t)},r.prototype.sendData=function(){var e=window._vaThis||this;e.collectData(e.adImpressionEvent),e.callback(e.adImpressionEvent,e.AnalyticsData)},r.prototype.collectData=function(t){var r=window._vaThis||this,i={};i.eventName=t,i.scripts=r.scripts.length>0?r.scripts.slice():e(),i.XHRUrls=r.XHRUrls.slice(),i.XHRResponses=r.XHRResponses.slice(),i.iframes=r.iframes.slice(),r.data[t]=i},r.prototype.onUrlHooked=function(e,t,r){var i=window._vaThis||this;i[e].push(t),r._id=i.requestId++,i.requestStartTimes[r._id]=Date.now();var o=function(){i.requestStartTimes.hasOwnProperty(this._id)&&(i.latencies.push(Date.now()-i.requestStartTimes[this._id]),delete i.requestStartTimes[this._id]),this.removeEventListener('load',o)}.bind(r);r.addEventListener('load',o),'iframes'!==e||void 0===i.isVideoUrlPublic?i.networkCallCounter++:i.networkCallCounter+=i.getIframeWeight(t),i.isMaxNetworkCallsLimitExceeded()&&i.onNetworkCallsLimitExceeded()},r.prototype.getIframeWeight=function(e){var t=window._vaThis||this;return e.indexOf('imasdk')?t.iframesWeights.ggl:t.isVideoUrlPublic?t.iframesWeights.pxls:t.iframesWeights.gen},r.prototype.createXMLHTTPHook=function(){var e=window._vaThis||this;window.XMLHttpRequest.prototype._vaOpen=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=function(t,r,i,o,n){return e.onUrlHooked('XHRUrls',r,this),this.addEventListener('load',function(){e.XHRResponses.push('load: '+this.responseText)}),window.XMLHttpRequest.prototype._vaOpen.apply(this,arguments)}},r.prototype.createIframesSrcHook=function(e){var t=window._vaThis||this;Object.defineProperty(HTMLIFrameElement.prototype,'_vaSrc',Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,'src'));var r=function(r,i){if(t.onUrlHooked('iframes',r,i),r&&'undefined'===r.substr(0,9)&&t._onUndefinedRelativeIframeSrcError(r),e.deepIframes){var o=function(){try{i.removeEventListener('load',o),i.contentWindow.ignoreGetVpaidAd=!0,i.contentWindow._vaThis=t;var r=i.contentWindow.document.createElement('script');r.innerText=t.vpaidAnalyticsFunc,i.contentWindow.document.head.appendChild(r),new i.contentWindow.AnalyticsReporter(null,function(){},e)}catch(e){}};i.addEventListener('load',o)}};Object.defineProperty(HTMLIFrameElement.prototype,'src',{get:function(){return this._vaSrc},set:function(e){r(e,this),this._vaSrc=e}}),HTMLIFrameElement.prototype._vaSetAttribute=HTMLIFrameElement.prototype.setAttribute,HTMLIFrameElement.prototype.setAttribute=function(e,t){'src'===e&&r(t,this),this._vaSetAttribute(e,t)}},r.prototype.createScriptsSrcHook=function(){var e=window._vaThis||this;Object.defineProperty(HTMLScriptElement.prototype,'_vaSrc',Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,'src')),Object.defineProperty(HTMLScriptElement.prototype,'src',{get:function(){return this._vaSrc},set:function(t){e.onUrlHooked('scripts',t,this),this._vaSrc=t}}),HTMLScriptElement.prototype._vaSetAttribute=HTMLScriptElement.prototype.setAttribute,HTMLScriptElement.prototype.setAttribute=function(t,r){'src'===t&&e.onUrlHooked('scripts',r,this),this._vaSetAttribute(t,r)}},r.prototype.unHook=function(){var e=Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,'_vaSrc'),t=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,'_vaSrc');e&&(Object.defineProperty(HTMLIFrameElement.prototype,'src',e),HTMLIFrameElement.prototype.setAttribute=HTMLIFrameElement.prototype._vaSetAttribute),t&&(Object.defineProperty(HTMLIFrameElement.prototype,'src',t),HTMLScriptElement.prototype.setAttribute=HTMLScriptElement.prototype._vaSetAttribute),window.XMLHttpRequest.prototype._vaOpen&&(window.XMLHttpRequest.prototype.open=window.XMLHttpRequest.prototype._vaOpen)},r.prototype.onNetworkCallsLimitExceeded=function(){var e=window._vaThis||this;e.networkCallsLimitExceeded||(e.adImpFired||e.unHook(),e.networkCallsLimitExceeded=!0,e.sendData(),window.onNetworkCallsLimitExceeded())},r.prototype.isMaxNetworkCallsLimitExceeded=function(){var e=window._vaThis||this;return e.networkCallsLimitExceeded||e.maxNetworkCalls&&e.networkCallCounter>=e.maxNetworkCalls},window.AnalyticsReporter=r}}();";
try{VpaidAnalytics(i)}catch(e){}window.TRC=window.TRC||{},window.TRC.vpaidAnalytics=window.TRC.vpaidAnalytics||{},window.TRC.vpaidAnalytics[31]=i},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(28),o=s(a),d=1,l=2,u=3,h=4,c=5,p=6,v=7,f=8,m=9,g=10,y=function(){function e(t,i){if(n(this,e),this.results=null,t){var s=[];this.dastKeys={0:{name:"stid",type:l},1:{name:"extuid",type:u},2:{name:"excid",type:g},3:{name:"ciuid",type:u},4:{name:"ciuidst",type:u},5:{name:"ciums",type:l},6:{name:"szid",type:g},7:{name:"cirid",type:c},8:{name:"cisid",type:c},9:{name:"segid",type:c},10:{name:"pstn",type:c},11:{name:"plcmnt",type:c},12:{name:"RID",type:l},13:{name:"cirf",type:c},14:{name:"base64",type:l},15:{name:"crid",type:l},16:{name:"cibp",type:v},17:{name:"cisbp",type:v},18:{name:"ciprbp",type:v},19:{name:"cmbb",type:v},20:{name:"noaop",type:g},21:{name:"ciage",type:d},22:{name:"cigndr",type:g},23:{name:"invc",type:l},24:{name:"slid",type:l},25:{name:"oslid",type:l},26:{name:"cntry",type:f},27:{name:"rgn",type:c},28:{name:"cty",type:c},29:{name:"citbp",type:v},30:{name:"rcatid",type:c},31:{name:"brsr",type:l},32:{name:"osid",type:l},33:{name:"frimp",type:l},34:{name:"frclk",type:l},35:{name:"frcnv",type:l},36:{name:"pubid",type:l},37:{name:"subid",type:l},38:{name:"ltstmp",type:u},39:{name:"mtmdlid",type:u},40:{name:"mdlid",type:u},41:{name:"cu1",type:l},42:{name:"cu2",type:l},43:{name:"cu3",type:l},44:{name:"cu4",type:l},45:{name:"cu5",type:l},46:{name:"cu6",type:l},47:{name:"cu7",type:l},48:{name:"cu8",type:l},49:{name:"cipid",type:l},50:{name:"cicmp",type:l},51:{name:"impts",type:l},52:{name:"clcts",type:l},53:{name:"convts",type:l},54:{name:"adid",type:u},55:{name:"dcid",type:g},56:{name:"compid",type:l},58:{name:"siteid",type:l},59:{name:"pix",type:u},60:{name:"chan",type:u},61:{name:"bo",type:f},62:{name:"so",type:f},63:{name:"oid",type:g},64:{name:"csec",type:u},65:{name:"skw",type:l},66:{name:"alng",type:l},67:{name:"auc64",type:u},68:{name:"mid",type:f},69:{name:"wif",type:p},70:{name:"ciipd",type:u},71:{name:"sec",type:p},72:{name:"adt",type:l},73:{name:"nsl",type:p},74:{name:"pti",type:p},75:{name:"dncf",type:p},76:{name:"obp",type:v},77:{name:"tz",type:c},78:{name:"md",type:p},79:{name:"mmt",type:d},83:{name:"udc",type:p},84:{name:"umexcid",type:g},85:{name:"verticalId",type:l},86:{name:"mbr",type:g},87:{name:"ts",type:u},88:{name:"omni",type:l},89:{name:"rpm",type:v},90:{name:"abt",type:c},91:{name:"dspadid",type:c},92:{name:"dspbid",type:c},93:{name:"dspcid",type:c},94:{name:"dspcrid",type:c},95:{name:"dspid",type:l},96:{name:"dspseat",type:c},97:{name:"urlDepth",type:l},98:{name:"ordid",type:u},99:{name:"servingDomain",type:c},100:{name:"omniType",type:m},101:{name:"frmi",type:u},102:{name:"fmmt",type:d},103:{name:"cmt",type:d},104:{name:"lat",type:v},105:{name:"long",type:v},106:{name:"prrp",type:v},107:{name:"pfrp",type:v},108:{name:"pgtp",type:m},109:{name:"tblc",type:m},110:{name:"mcr",type:f},111:{name:"ct",type:g},112:{name:"platform",type:m},113:{name:"cncat",type:c},114:{name:"cisrf",type:c},115:{name:"sortOrderType",type:d},116:{name:"groupId",type:c},117:{name:"testId",type:c},118:{name:"prl",type:l},119:{name:"pfrl",type:l},120:{name:"rtd",type:u},121:{name:"rndmt",type:l},122:{name:"sesid",type:c},123:{name:"seshas",type:u},124:{name:"palfr",type:v},125:{name:"splcmt",type:c},126:{name:"wurflb",type:c},127:{name:"wurflbv",type:c},128:{name:"wurflo",type:c},129:{name:"wurflov",type:c},130:{name:"wurflbn",type:c},131:{name:"wurflff",type:c},132:{name:"wurflmn",type:c},133:{name:"difa",type:c},134:{name:"aid",type:c},135:{name:"extuidst",type:c},136:{name:"tbuidst",type:c},137:{name:"aname",type:c},138:{name:"abRTB",type:c},139:{name:"mda",type:c},140:{name:"audsegid",type:c},141:{name:"smdt",type:u},142:{name:"at",type:l},143:{name:"ip",type:c},144:{name:"bundid",type:c},145:{name:"sturl",type:c},146:{name:"asiid",type:c},147:{name:"sid",type:c},148:{name:"appver",type:c},149:{name:"floor",type:h},150:{name:"instl",type:p},151:{name:"blang",type:c},152:{name:"gdpr",type:p},153:{name:"uconsnt",type:p},154:{name:"pcat",type:c},155:{name:"sdepth",type:l},156:{name:"pubidstr",type:c},157:{name:"tagidstr",type:c},158:{name:"uconsntstr",type:c},159:{name:"burl",type:c},160:{name:"pwidth",type:l},161:{name:"pheight",type:l},162:{name:"ctcs",type:g},163:{name:"cetcs",type:g},164:{name:"dspcats",type:c},165:{name:"smidis",type:l},166:{name:"smivrtb",type:l},167:{name:"smiv",type:l},168:{name:"mfrn",type:c},169:{name:"mfri",type:l},170:{name:"mfrp",type:h},171:{name:"mfrpl",type:l},172:{name:"mvecpmn",type:c},173:{name:"mvecpmi",type:l},174:{name:"mvecpmp",type:h},175:{name:"mvecpmpl",type:l},176:{name:"mfrtbn",type:c},177:{name:"mfrtbi",type:l},178:{name:"mfrtbp",type:h},179:{name:"mfrtbpl",type:l},180:{name:"mdisn",type:c},181:{name:"mdisi",type:l},182:{name:"mdisp",type:h},183:{name:"mdispl",type:l},184:{name:"debug",type:c},185:{name:"tpubid",type:l},186:{name:"scp",type:h},187:{name:"sii",type:u},188:{name:"csiid",type:c},189:{name:"ft",type:l},190:{name:"mfril",type:u},191:{name:"mvecpmil",type:u},192:{name:"mfrtbil",type:u},193:{name:"mdisil",type:u},194:{name:"subu",type:l},195:{name:"rid",type:c},196:{name:"muid",type:c},197:{name:"gdprven",type:p},198:{name:"gdprpur",type:p},199:{name:"pubnm",type:c},200:{name:"mPre",type:h},201:{name:"dspuid",type:c},202:{name:"tnetid",type:l},203:{name:"oafp",type:h},204:{name:"oee",type:p},205:{name:"itn",type:p},206:{name:"matchSource",type:l},207:{name:"ccpa",type:c},208:{name:"rs",type:l},209:{name:"dspat",type:l},210:{name:"ds",type:l},211:{name:"sdkt",type:c},212:{name:"sdkv",type:c},213:{name:"sdkos",type:c},214:{name:"uis",type:l},215:{name:"umt",type:u},216:{name:"fagg",type:l},217:{name:"ut",type:p}},t=t.substring(2,t.length-1),t=t.replace(/_/g,"/"),t=t.replace(/-/g,"+"),this.bis=new o.default(t),this.bis.readInt(16);for(var r={};;){var a=this.bis.readInt(8);if(this.bis.isEof())break;if(this.dastKeys.hasOwnProperty(a)){var y,_=this.dastKeys[a];if(_.type==u&&(y=this.bis.readLong()),_.type==c){try{var b=this.decodeBerLength()}catch(e){s.push("key:"+a+",\n\t\t\t\t\t "+e);continue}if(y="",b==-1){var w=this.bis.readByte();0==w&&(y="ENTER_PLACEMENT_ID_HERE")}else y=this.bis.read7bitString(b)}_.type==l&&(y=this.bis.readInt()),_.type==m&&(y=this.bis.readInt(4)),_.type==h&&(y=this.bis.readDouble()),_.type==d&&(y=this.bis.readByte(),y>127&&(y-=256)),_.type==g&&(y=this.bis.readByte()),_.type==p&&(y=this.bis.readBool()),_.type==f&&(y=this.bis.readShort(),y>32767&&(y-=65536)),_.type==v&&(y=this.bis.readFloat()),r[_.name]=y}else s.push("missing key:"+a+" in dastDecoder")}this.results=r,s.length>0&&i.set("dastDecoderError",s)}}return r(e,[{key:"fetchResults",value:function(){return this.results}},{key:"decodeBerLength",value:function(){var e=this.bis.readByte();if(255==e)return-1;if(128==(128&e)){if(e&=127,0==e)throw"Indefinite length not supported";if(e>4)throw"Encoding too long";for(var t=0,i=0;i<e;i++)t=(t<<8)+(255&this.bis.readByte());return t>1e3&&(t=1e3),t}return e>1e3&&(e=1e3),e}}]),e}();t.default=y},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(51),d=n(o),l=i(1),u=s(l),h=i(37),c=(s(h),i(38)),p=(s(c),i(39)),v=(s(p),i(12)),f=n(v),m=i(10),g=function(){function e(t){r(this,e),this.ServiceLoader=m,this.ServiceLoader.init(t.data),this.store=t,this.baseUrl=this.store.get("base_url"),this.JSONPHandler=new d.default(this.baseUrl),this.dependenciesProperties=f.default,this._loadVpaidResources()}return a(e,[{key:"_loadResource",value:function(e,t,i){var s=this;if(!this.stopped){var n=function(i){s.stopped||(s.store.get(e.storeDataKey)||s.store.set(e.storeDataKey,i),t&&t(i))},r=function(){if(!s.stopped){var t=s.store.get(e.jsonpCallbackName);return t?void s.JSONPHandler.load(e.path,t,function(e){e?n(e):i&&i()}):void(i&&i())}};this.ServiceLoader.get(e.serviceKey,e.version,n,r)}}},{key:"_loadScript",value:function(e,t){if(!this.stopped){var i=document.createElement("script"),s=document.getElementsByTagName("script")[0];i.src=this.baseUrl+this.store.get(e.storePathKey),s.parentNode.insertBefore(i,s),i.onload=function(){t&&t()}}}},{key:"_loadHJK",value:function(e){var t=this;e=Object.assign(e,this.dependenciesProperties.hjk),this._loadResource(e,function(i){i=t._replaceResourcePlaceholders(i),t.store.set(e.storeDataKey,i)})}},{key:"_loadVpaidAnalytics",value:function(e){e=Object.assign(e,this.dependenciesProperties.vpaidAnalytics),this._loadResource(e)}},{key:"_loadVpaidCrawler",value:function(e){var t=this;e=Object.assign(e,this.dependenciesProperties.vpaidCrawler),this._loadResource(e,function(i){i=t._replaceResourcePlaceholders(i),t.store.set(e.storeDataKey,i)},this._loadHJKAndAnalytics.bind(this))}},{key:"_loadVpaidResources",value:function(){this.stopped||(this._loadVpaidCrawlerResources(),this._loadDSM())}},{key:"_loadVpaidCrawlerResources",value:function(){if(!this.stopped){var e=this._getCleanResourceVersionAndPath(this.dependenciesProperties.vpaidCrawler.storePathKey,this.dependenciesProperties.vpaidCrawler.versionRegex);this._canLoadResourceFromObj(e)?this._loadVpaidCrawler(e):this._loadHJKAndAnalytics()}}},{key:"_loadHJKAndAnalytics",value:function(){var e=this._getCleanResourceVersionAndPath(this.dependenciesProperties.hjk.storePathKey,this.dependenciesProperties.hjk.versionRegex);this._canLoadResourceFromObj(e)&&this._loadHJK(e);var t=this._getCleanResourceVersionAndPath(this.dependenciesProperties.vpaidAnalytics.storePathKey,this.dependenciesProperties.vpaidAnalytics.versionRegex);this._canLoadResourceFromObj(t)&&this._loadVpaidAnalytics(t)}},{key:"_loadDSM",value:function(){var e=this,t=this._getCleanResourceVersionAndPath(this.dependenciesProperties.dsm.storePathKey,this.dependenciesProperties.dsm.versionRegex);this._canLoadResourceFromObj(t)&&(t=Object.assign(t,this.dependenciesProperties.dsm),this._loadResource(t,null,this._loadScript.bind(this,t,function(){e.store.set(e.dependenciesProperties.dsm.storeDataKey,cmTag.dSettings)})))}},{key:"_canLoadResourceFromObj",value:function(e){return e&&e.version&&e.path}},{key:"_getCleanResourceVersionAndPath",value:function(e,t){var i=this._getVersionObj(e);return i?{version:this._extractResourceVersion(i,t),path:i.value}:null}},{key:"_getVersionObj",value:function(e){var t=this.store.getLatestVersion(e);return t&&t.value?t:""}},{key:"_extractResourceVersion",value:function(e,t){var i=e.value.match(t);return!i||i.length<2?"":i[1]}},{key:"_replaceResourcePlaceholders",value:function(e){if(!this.stopped){var t=this.store.get("hjkbldomsencdd");return t&&0!==t.length||(t=this.store.get("hjkbldoms")),e.replace('"%%%TEMP%%%"',u.stringify(t)).replace('"%%%IS_DEBUG%%%"',this.store.get("debug"))}}},{key:"destroy",value:function(){this.stopped||(this.stopped=!0,this.ServiceLoader=this.JSONPHandler=this.store=this.dependenciesProperties=void 0)}}]),e}();t.default=g},function(e,t){"use strict";function i(e){var t={domain:window.location.hostname,cirf:"",referrer:document.referrer?document.referrer.split("//")[1]:window.location.hostname,vertical:"default",auc_dast:"0",title:"",description:"",keywords:"",default_ad_parameters:"",files:[],image:!1,target_id:"",height:!1,width:!1,controls:!0,aspect_ratio:"16:9",repeat:!0,mute:!1,oid:0,default_ad_timeout:30,volume:0,video_class_name:"video-js vjs-default-skin",schedule:[],schedule_auto:1,min_vpaid_run_time:4,debug:[],htmlVideoSupport:function(){return!!document.createElement("video").canPlayType}(),ga_factor:1,fire99:!0,ad_controls:!1,time_between_waterfall:10,tmbtwfs:function(e,t,i,s){return i.get("time_between_waterfall")},mntmbtwfsf:function(e,t,i,s){return i.get("mintimwf")},mintimwf:5e3,mntmbtwfs:5,mxtmbtwfs:900,queue_size:6,max_ready_vpaid:3,waterfall_watermark:0,base_url:"//vidstat.taboola.com",wf_path:"VideoBidRequestHandlerServlet",run_wf_when_empty:!0,kaxwnc:18e5,pstflrs:!0,pvpd:"javascript",pvidtp:"",sncad:!1,blkflshjs:!0,altmot:6e4,adimptmot:0,prtctv2:"/vpaid/hjk.214.js",hjkclb:"HijackResponse",jsnoflshdtct:!1,qsrtscr:function(e,t){return 100*t.alfrox},psthdrs:"text/plain",rstmrai:!0,vstprxy:!1,pxyurl:"http://vid.mikysrv.com/fetch?url=",global_ad_timeout:18e4,mprdct:void 0,uscnvsmpg:!0,forcecnvsmpg:!1,gtvid2:"//mpg.taboola.com/getts?url",cnvsldrt:5,mpgclrslv:["gcdn.2mdn.net"],dsu:"/vpaid/ds/117/dsm.js",run_wf_on_init:!0,useapforcntnt:!1,wf_dynmc_ps:!0,sprssviderr:!1,vForce:!1,get_ad_timeout_seconds:10,wf_manual:!1,disctxt:"By Taboola",httpsOverride:!0,usscrtgurl:!1,evtbsschdl:!0,timbtopps:2e3,cmbopps:!0,anltcsurlv4:"",anltcsurlv5:"",anltcsclb:"VpaidAnalytics",anltcsOptions:{withXHR:!0,withIframes:!0,withScripts:!0,maxNetworkCalls:0,timeout:3e3,deepIframes:!0},moat:!1,measureKPI:!1,prfsmpmsnt:5,prfsmitrvpmsnt:1500,kpitrvldrt:15e3,msrkpifctr:0,msrkpiintvl:15,moatPartnerCode:"taboolajsvideo2446883476",sndvltopp:!0,novdtrm:!1,dcdvdurl:!1,firstWaterfallNoaop:0,mxlifls:0,kbnul:"//vidanalytics.taboola.com",frcmtfrms:!0,frcvlm:!1,pxlnotsmtp:!1,cntonvfrc:!0,mxemptwf:0,dtsvrurl:"//vidutils.taboola.com",mltads:!1,erlyai:!1,frcadvlmtrvl:1e3,dbncadvltm:50,stpfrcvlevnt:"AdVideoFirstQuartile",imapihok:!1,trmrdyvpaid:!0,dfltvlm:.4,usstrckisyn:!1,dlywf:!1,adto:3e5,vakll:3e5,ovrtgbydc:!1,strgprvdrttl:6048e5,frstlk:!1,pusvidprtctn:!1,encwfrs:!1,dsktmouttoadcmpltn:0,mbltmouttoadcmpltn:0,wfv:1,aderrbfradlddopactv:!0,isMultiVpaidUnit:!1,hdeadsplypusbtn:!0,isIdleMode:!1,mttst:"",mxntwrkclls:80,rplvpdactv:!1,rvfctr:0,dnapmxvl:0,usopsla:!0,opslavrsn:"1.3.8",mcrsrvcsnmspc:"trc",bllblevt:"1,25,21,22,23,24",ifrmswghts:{gen:15,ggl:6,pxls:30},dskVidMuted:!0,ovrdnonntvfnclst:{},fkadchcs:!1,istblvpd:!1,mtdhkactv:!1,addprld:!0,blckbrngtofrnt:!1,tglifrmcntndsplyactv:!1,cmpltonstpddmn:["innovid.com"],cmpltonstpdms:0,aduntldflbfruntld:!1,adwrprstoplrdst:!0,bckflldlyms:1e4,mxbckflldlyitms:0,bfprty:0,lgvpdtxtelmnts:!1,shwadmtebtn:!0,wtfradpsdbfrrsmad:!1,mtfctr:0,noplrcntr:!1,vpdcntrcstmcss:"",flbktovdo:!0,dsbgl:!0,cntdwnrgx:"",msnifrmsrchk:!0,prvaupl:!0,stpvpdonudfndsrc:!0,sprtnnvidvpd:!0,adxcrdgtadtmt:5e3,adtnladxsprtdszs:[],stpvpdonrltvsrc:!1,rvfrquesttsemttr:!0,cntgtad:!0,dftgprc:void 0,scrmf:!0,hjkbldoms:[],rtryonfl:!1,hjkbldomsencdd:[],cpcvcmpgntps:[14,17],cstmdltps:{tags:7,dCPM:9,externalCPCV:14,internalCPCV:17},dtctcmp:!1,dtctcmpfctr:0,comp:{},cmpdtctv:"1.0.0",vidautoplydtctv:"1.0.0",drpbletps:["singleAd","adjacencyAd"],vdelv:"2.2.12",rplcpxlmcrplchldr:!0,erronopp:!0,dtctprvtbrwsng:!0,plcntbfrads:!0,sndvptmrst:!1,frwferrpxls:0,hdtrgt:!1,spprtvrtclvd:!0,prvnterlyadimpopp:!1,untetrk:["viewability","viewable50precent1sec","fullyviewable1sec"],vdtck:0,htsptdflt:{pos:"bottom-left",txtclr:"white",mrgn:20,lbl:""},frwfpssbckrpxl:0,wtchvdointrvl:1e3,rprtvidsttsintrvl:1e3,q5byprgrss:!0,mnvlddrtn:.1,frgtadpxls:100,frmltplpxls:["AdPaused","AdClickThru","AdPlaying"],rprtbuffrng:0,wtchprgrssopp:0,mblmdiadrctdmnd:!1,plyngevnttmt:100,rmvwflg:["postData","response",new RegExp("tagResponse_.*"),"navigatorConnection"],rmplyroptns:["red_id","rmvwflg"],firstWfRes:void 0,blckngtgcnvrsncnt:5,fmli:void 0,fmpw:"",dlyimpnonmoatrv:void 0,updtcmpbfrwf:!0,rgxdcdd:[],firedsplyimp:!1,rprtwrpropntime:!1,addcdatavst:!0,wfgenv:"1.0.6",aduntladtmt:1e4,onPlayerReady:function(e){},onPlayerLoadError:function(e){},onPlayerError:function(e){},onPlayerPlay:function(e){},onPlayerStop:function(e){},onPlayerClose:function(e){},onPlayerPause:function(e){},onPlayerResume:function(e){},onPlayerSeek:function(e){},onPlayerRepeat:function(e){},onPlayerComplete:function(e){},onAdLoadError:function(e,t){},onAdError:function(e,t){},onAdStopped:function(e,t){},onAdImpression:function(e,t){},onAdVideoStart:function(e,t){},onAdVideoEnd:function(e,t){},onAdClick:function(e,t,i){}};for(var i in t)void 0==e[i]&&(e[i]=t[i]);e.description||(e.description=e.title),e.keywords||(e.keywords=e.title),parseFloat(e.width)||parseFloat(e.height)||(e.width="377",e.height="314");var s=parseInt(100*Math.random())+1<=e.ron_percent;return e.tagDefault={ad_controls:e.ad_controls,url:"",pubid:"",tagid:"",vidlength:"",video_url:e.files[0],title:e.title,cirf:e.cirf,description:e.description,keywords:e.keywords,ad_parameters:e.default_ad_parameters,muted:e.mute?1:0,auc_dast:e.auc_dast,referrer:e.referrer,domain:e.domain,vertical:e.vertical,roll_type:"mid-roll",oid:e.oid,ad_timeout:e.default_ad_timeout,rs:"1",st:"1",sts:"1",type:"wf",noaop:"10",sortOrderType:0,mfp:4,afbp:e.use_flash_bypass,isRon:s,isvideo:0,mindur:1,maxdur:e.default_ad_timeout,minbr:1,maxbr:1e4,plmd:0,defaultTagTimeout:30,totaltimeout:60,use_as_is:!1,skip_vast:!1},e}function s(){var e={};try{e=window.cmTag.config}catch(e){return{}}var t={};for(var i in e)if(0===i.indexOf("player.settings.")){var s=i.substr(16,i.length-16);t[s]=n(e[i])}return t}function n(e){var t=/^\d+$/.test(e);if(t)return parseInt(e);var i=/^true$|^false$/g.test(e);return i?"true"===e||e===!0:e}Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaults=i,t.getUnitParams=s},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(t){var s=this;i(this,e),this.store=t,this.ua=this.store.get("ua"),this.browser=this.ua.browser.name,this.browserMajorVersion=parseInt(this.ua.browser.major),this._detectPrivateMode(function(e){s.store.set("isPrivateBrowsing","undefined"==typeof e?"cannot detect":e?"private":"not private")})}return s(e,[{key:"_detectPrivateMode",value:function(e){var t;if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){t=!1},function(e){t=!0});else if(window.indexedDB&&"Firefox"===this.browser){var i;try{i=window.indexedDB.open("test")}catch(e){t=!0}"undefined"==typeof t&&this._retry(function(){return"done"===i.readyState},function(e){e||(t=!i.result)})}else if(this._isIE10OrLater()){t=!1;try{window.indexedDB||(t=!0)}catch(e){t=!0}}else if("Safari"===this.browser)if(this.browserMajorVersion<11)try{localStorage.length?t=!1:(localStorage.x=1,localStorage.removeItem("x"),t=!1)}catch(e){t=!!navigator.cookieEnabled}else try{window.openDatabase(null,null,null,null),t=!1}catch(e){t=!0}this._retry(function(){return"undefined"!=typeof t},function(i){e(t)})}},{key:"_isIE10OrLater",value:function(){return"IE"===this.browser&&this.browserMajorVersion>=10||"Edge"===this.browser}},{key:"_retry",value:function(e,t){var i=0,s=50,n=!1,r=window.setInterval(function(){e()&&(window.clearInterval(r),t(n)),i++>s&&(window.clearInterval(r),n=!0,t(n))},10)}}]),e}();t.default=n},function(e,t){"use strict";e.exports={DIRECT:3,PMP_DIRECT:4,OPEN_EXCHANGE_RTB_DSP:6,OPEN_EXCHANGE_RTB_SSP:8}},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(4),d=(s(o),i(52)),l=s(d),u=i(2),h=s(u),c=i(64),p=s(c),v=i(6),f=s(v),m=i(49),g=s(m),y=i(10),_=(i(82),0),b=i(3),w=function(){function e(t,i,s){n(this,e),b.mixin(this),this.vpaidHandler=i,this.store=s,this.vpaidCount=1,this.version="VPAID-1.0.0",this.VPAIDversion="1.1",this.debugTracker=new h.default(this.version),this.vpaidParameters=this._defaultVpaidParameters,this.config=this._defaultVpaidConfig;var r={};this._createIframesDetector(),this.store.get("mltads")&&this.store.on("resizeVpaidWrapper",this._onResizeAd.bind(this));for(var a in t)r[a.toUpperCase()]=t[a];this.config.creatives=Object.assign({},this._defaultVpaidParameters,r),this.store.get("cmbopps")&&this.store.get("usopsla")&&this._loadOppsula(),this.manager=!1,this._initWaterfall();for(var o in this.vpaidEvents)this.on(this.vpaidEvents[o],this._runEventFunction.bind(this));this.emit(this.vpaidEvents.AdLoaded,{eventData:""}),this.store.emit("mainVpaidCreated",this.config)}return a(e,[{key:"_createIframesDetector",value:function(){this.store.set("iframesDetector",new g.default(this.store.get("ifrmswghts")))}},{key:"setVpaidId",value:function(e){this.version="["+e.wfIndex+"_"+e.dp+"]"}},{key:"_loadOppsula",value:function(){var e=this;y.init(this.store.data),y.get("oppsula",this.store.get("opslavrsn"),function(t){e.store.set("ms_data",{opps_base_path:e.store.get("opps_base_path")||e.config.creatives.CM_DOMAIN});var i=new t(e.store.get("unit_model"),e.store);e.store.set("oppsula",i),e.store.emit("oppsulaCreated",i)},function(){e.debugTracker.error("Load Oppsula","Error while loading from service loader")})}},{key:"_onResizeAd",value:function(e){this.config&&(this.config.width=e.width,this.config.height=e.height)}},{key:"trigger",value:function(e,t){this.vpaidHandler.emit(e,t)}},{key:"runWaterfall",value:function(e){this.waterfallManager.runWaterfall(e)}},{key:"getVpaidReadyCount",value:function(){return this.manager.getVpaidReadyCount()}},{key:"_initWaterfall",value:function(){this.waterfallManager=new p.default(this.store),this.config.creativeData=this._getCreativeData(this.config),this.waterfallManager.init(this.config.creatives,this.config.creativeData.AdParameters),this.waterfallManager.SetWaterfallError(this._waterfallError.bind(this)),this.waterfallManager.SetWaterfallSuccess(this._waterfallSuccess.bind(this));var e=this;this.waterfallManager.SetShouldRun(function(){var t=this.store.get("max_ready_vpaid")||2,i=this.store.get("waterfall_watermark")||0;return!e.manager||e.manager.getVpaidReadyCount()+i<t})}},{key:"_getSlot",value:function(e){var t=!1;switch("undefined"==typeof e?"undefined":r(e)){case"string":document.getElementById(e)&&(t=document.getElementById(e));break;case"object":e.style&&e.tagName&&(t=e);break;default:this.debugTracker.error("initAd","Bad slot in 'environmentVars'")}return t}},{key:"_getCreativeData",value:function(e){var t=!1;switch("undefined"==typeof e?"undefined":r(e)){case"object":Object.keys(e).length>0&&(t=!0);break;case"string":if(e.length>0)try{e=new Function("return "+e+";")(),t=!0}catch(e){}}if(t){for(var i in this.config.creatives)(void 0==e[i]||this.config.protectedCreatives.indexOf(i)>-1)&&(e[i]=this.config.creatives[i]);e.AdParameters&&(e.AdParameters=this._handleAdParams(e.AdParameters))}return e}},{key:"_handleAdParams",value:function(e){var t={};switch("undefined"==typeof e?"undefined":r(e)){case"object":Object.keys(e).length>0&&(t=e);break;case"string":if(e.length>0)try{t=new Function("return "+e+";")()}catch(e){}}return t}},{key:"_dataFromUrl",value:function(e){var t=e.replace(/\?\?+/g,"?").replace(/&&+/g,"&").split(/\?(.+)?/gi,2);if(2!=t.length)return this.debugTracker.warn("dataFromUrl","Bad source parameter!"),this.vpaidParameters;var i=t[1].split(/\?|&/gi);for(var s in i)if(i[s]){var n=i[s].split(/=(.+)?/gi,2);if(2==n.length){var r=n[0].replace(/\-/gi,"_").toUpperCase();if(void 0!=this.vpaidParameters[r])switch(r){case"ISVIDEO":case"PLMD":case"MINDUR":case"MAXDUR":case"MINBR":case"MAXBR":case"VPD":case"VPTD":case"RS":case"ST":case"PLAYER_WIDTH":case"PLAYER_HEIGHT":case"PUBID":case"STS":case"MFP":case"ADTO":case"B2B":case"VMT":case"SORTORDERTYPE":case"TAGID":case"VIDLENGTH":case"DEFAULTTAGTIMEOUT":case"TOTALTIMEOUT":this.vpaidParameters[r]=isNaN(parseInt(n[1]))?0:parseInt(n[1]);break;case"MUTED":case"AFBP":case"DEBUG":case"PAUSE_ON_START":switch(n[1]){case"1":case"true":case"TRUE":this.vpaidParameters[r]=!0;break;case"0":case"false":case"FALSE":this.vpaidParameters[r]=!1}break;case"WP":case"SERVICE":case"PV":case"PT":case"SDID":break;default:this.vpaidParameters[r]=n[1]}else this.debugTracker.warn("dataFromUrl","Parameter '"+n[0]+"' is not supported!")}}return this.vpaidParameters}},{key:"_runEventFunction",value:function(e){this["on"+e.type]&&this["on"+e.type](e)}},{key:"_waterfallError",value:function(e){_||(_=!0)}},{key:"_waterfallSuccess",value:function(e,t){this.manager&&(this.config.waterfall=e,this.manager.fillSchedule(e,t))}},{key:"_onManagerStopped",value:function(){this.emit(this.vpaidEvents.AdStopped)}},{key:"getTime",value:function(){var e=new Date;return e.getTime()}},{key:"initAd",value:function(e,t,i,s,n,r){this.config.inited||(this.config.target=this._getSlot(r.slot),this.config.target&&(this.config.videoSlotControls=this.store.get("ad_controls"),this.config.videoSlotCanAutoPlay=!0,this.config.width=parseInt(e),this.config.height=parseInt(t),this.config.bitrate=s,this.config.viewMode=i,this.config.creatives.PLAYER_WIDTH=this.config.width,this.config.creatives.PLAYER_HEIGHT=this.config.height,this.config.creativeData=this._getCreativeData(n),this.config.inited=!0,this.manager||(this.manager=new l.default(this,this.store)),this.manager.onStop=this._onManagerStopped.bind(this),this.emit(this.vpaidEvents.AdLoaded,{eventData:""})))}},{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){if(this.vpaidEvents[t]){if(void 0==e)return;this.off(t,e)}}},{key:"handshakeVersion",value:function(e){return this.VPAIDversion}},{key:"startAd",value:function(e){this.manager.playFromQueue(e),this.config.started=!0}},{key:"fire99",value:function(e,t){this.manager&&this.manager.fire99({waterfallTagId:e,dast:t})}},{key:"resizeAd",value:function(e,t,i){this.config.width=e,this.config.height=t,this.config.viewMode=i,this.manager&&this.manager.resizeAd(e,t,i)}},{key:"stopAd",value:function(){this.manager?this.manager.stop():this.emit(this.vpaidEvents.AdStopped)}},{key:"setAdVolume",value:function(e){if(!this.store.get("isMobile"))return e=e>1?e/100:e,!isNaN(parseFloat(e))&&void(this.manager&&!this.store.get("isMobile")&&this.manager.setAdVolume(e))}},{key:"getAdVolume",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdVolume",[],0):0}},{key:"getAdLinear",value:function(){return!this.manager||this.manager.callWorkingVpaid("getAdLinear",[],!0)}},{key:"getAdWidth",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdWidth",[],this.config.width):this.config.width}},{key:"getAdHeight",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdHeight",[],this.config.height):this.config.height}},{key:"getAdExpanded",value:function(){return!this.manager||this.manager.callWorkingVpaid("getAdExpanded",[],!0)}},{key:"getAdSkippableState",value:function(){return!!this.manager&&this.manager.callWorkingVpaid("getAdSkippableState",[],!1)}},{key:"getAdSkippableRemainingTime",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdSkippableRemainingTime",[],-1):-1}},{key:"getAdRemainingTime",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdRemainingTime",[],-1):-1}},{key:"getAdDuration",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdDuration",[],-1):-1}},{key:"getAdCompanions",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdCompanions",[],[]):[]}},{key:"getAdIcons",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdIcons",[],[]):[]}},{key:"pauseAd",value:function(){this.manager&&this.manager.callWorkingVpaid("pauseAd",[],!0)}},{key:"resumeAd",value:function(){this.manager&&this.manager.callWorkingVpaid("resumeAd",[],!0)}},{key:"expandAd",value:function(){this.manager&&this.manager.callWorkingVpaid("expandAd",[],!0)}},{key:"collapseAd",value:function(){this.manager&&this.manager.callWorkingVpaid("collapseAd",[],!0)}},{key:"skipAd",value:function(){this.manager&&this.manager.callWorkingVpaid("skipAd",[],!0)}},{key:"getVpaidLogs",value:function(){if(this.manager)return this.manager.getVpaidLogs()}},{key:"getAd",value:function(e){if(this.manager)return this.manager.getAd(e)}},{key:"onAdLoaded",value:function(){}},{key:"onAdStarted",value:function(){}},{key:"onAdStopped",value:function(){}},{key:"onAdSkipped",value:function(){}},{key:"onAdSkippableStateChange",value:function(){}},{key:"onAdSizeChange",value:function(){}},{key:"onAdLinearChange",value:function(){}},{key:"onAdDurationChange",value:function(){}},{key:"onAdExpandedChange",value:function(){}},{key:"onAdVolumeChange",value:function(){}},{key:"onAdImpression",value:function(){}},{key:"onAdVideoStart",value:function(){}},{key:"onAdVideoFirstQuartile",value:function(){}},{key:"onAdVideoMidpoint",value:function(){}},{key:"onAdVideoThirdQuartile",value:function(){}},{key:"onAdVideoComplete",value:function(){}},{key:"onAdClickThru",value:function(){}},{key:"onAdInteraction",value:function(){}},{key:"onAdUserAcceptInvitation",value:function(){}},{key:"onAdUserMinimize",value:function(){}},{key:"onAdUserClose",value:function(){}},{key:"onAdPaused",value:function(){}},{key:"onAdPlaying",value:function(){}},{key:"onAdLog",value:function(){}},{key:"onAdError",value:function(){}},{key:"onVpaidSpecial",value:function(){}},{key:"onSonudViolation",value:function(){}},{key:"vpaidEvents",set:function(e){},get:function(){return f.default}},{key:"_defaultVpaidParameters",set:function(e){},get:function(){return{VIEW_MODE:"normal",REFERRER:"",VIDEO_URL:"",DOMAIN:"",PUBID:0,TAGID:0,VPD:0,VPTD:0,AUC_DAST:"",VIDLENGTH:0,KEY_WORDS:"",DESCRIPTION:"",SERVICE:"WhiteLabelBidRequestHandlerServlet",VERTICAL:"",SCHEMA:"vast2-vpaid",TYPE:"application/javascript",PV:this.version,RS:1,ST:1,WP:1,PT:5,CIRF:"",SDID:1,STS:0,CB:"",VOLUME:0,TAG:"",PAGE_URL:"",TIME_STAMP:"",TITLE:"",MFP:4,ISVIDEO:1,PLMD:2,MINDUR:1,MAXDUR:60,MINBR:1,MAXBR:512,AFBP:!1,ADTO:60,B2B:1,VMT:0,SORTORDERTYPE:0,DEFAULTTAGTIMEOUT:30,OID:"",NOAOP:"",TOTALTIMEOUT:60,CM_DOMAIN:"http://exchange.basebanner.com",OFFSET:0,MODE:"paralel",MUTED:!1,DEBUG:!1,PAUSE_ON_START:!1,PLAYER_WIDTH:0,PLAYER_HEIGHT:0}}},{key:"_defaultVpaidConfig",set:function(e){},get:function(){return{waterfall:{},source:this.src,videoSlotCanAutoPlay:!0,videoSlotControls:!1,vpaid_protect_path:!1,running:!1,inited:!1,stopped:!1,started:!1,target:!1,video:!1,bitrate:512,creatives:{},protectedCreatives:["WP","PV","PT","SDID","CM_DOMAIN","SERVICE"]}}}]),e}();t.default=w},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=null,r=function(){function e(t){if(i(this,e),!n){this.costModels={};var s=t.get("cpcvcmpgntps"),r=t.get("cstmdltps");for(var a in r){var o=r[a];
this.costModels[o]={costModel:o,type:a,isCPCV:s.indexOf(o)>-1}}n=this}return n}return s(e,[{key:"isCPCV",value:function(e){return this.costModels.hasOwnProperty(e)&&this.costModels[e].isCPCV}}]),e}();t.default=r},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(1),o=s(a),d=i(3),l=function(){function e(t,i,s){n(this,e),d.mixin(this),this.creativeExtensions=t,this.target=i,this.vpaidLog=s,this.stopped=!1}return r(e,[{key:"handleExternalScripts",value:function(){if(!this.stopped)for(var e=0;e<this.creativeExtensions.length;e++){var t=this.creativeExtensions[e].attributes.type?this.creativeExtensions[e].attributes.type.toLowerCase():null;t&&(t=t.toLowerCase(),o.logToBI(this.vpaidLog,"creativeExtensions",{type:t,src:this.creativeExtensions[e].element}),"gdn"===t||"ias"===t?this._appendExternalScripts(this.creativeExtensions[e].element):"moat"===t&&this._pushExternalMoatTracker(this.creativeExtensions[e].element))}}},{key:"_appendExternalScripts",value:function(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),i=t.getElementsByTagName("script"),s=0;s<i.length;s++)this.target.appendChild(this._generateScriptElement(i[s]))}},{key:"_generateScriptElement",value:function(e){for(var t=document.createElement("script"),i=0;i<e.attributes.length;i++)t.setAttribute(e.attributes[i].name,e.attributes[i].value);return t.innerHTML=e.innerHTML,t}},{key:"_pushExternalMoatTracker",value:function(e){this.emit("externalMoat",e)}},{key:"destroy",value:function(){this.stopped=!0,this.creativeExtensions=this.target=this.vpaidLog=void 0}}]),e}();t.default=l},function(e,t){"use strict";function i(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),r={FUNCTION:"function",PROP:"prop",TAG:"tag",OBJECT:"object"},a=function(){function e(t){var n,a=this;return s(this,e),this.interface={},this.vpaidWrapper=t,this.members=[{name:"dontDie",type:r.FUNCTION},{name:"restartAd",type:r.FUNCTION},{name:"emit",type:r.FUNCTION},{name:"getVpaidData",type:r.FUNCTION},{name:"setDebugData",type:r.FUNCTION},{name:"on",type:r.FUNCTION},{name:"off",type:r.FUNCTION},{name:"pauseAd",type:r.FUNCTION},{name:"resumeAd",type:r.FUNCTION},{name:"resizeAd",type:r.FUNCTION},{name:"mute",type:r.FUNCTION},{name:"unmute",type:r.FUNCTION},{name:"toggleIframeContentDisplay",type:r.FUNCTION},{name:"setDebugDataFunc",type:r.FUNCTION},{name:"skipAd",type:r.FUNCTION},{name:"nonVideoVpaid",type:r.PROP},{name:"isCPCV",type:r.PROP},{name:"adTarget",type:r.PROP},{name:"hadImpression",type:r.PROP},{name:"isBf",type:r.PROP},{name:"hasAdChoices",type:r.PROP},{name:"type",type:r.PROP},{name:"localTarget",type:r.PROP},{name:"pwov",type:r.PROP},{name:"clickThruUrl",type:r.PROP},{name:"adVolume",type:r.PROP},{name:"isReplayable",type:r.PROP},{name:"tag",type:r.TAG},{name:"playerDAST",type:r.OBJECT},{name:"vpaidLog",type:r.OBJECT}],this.memberConverter=(n={},i(n,r.FUNCTION,this._convertFunction.bind(this)),i(n,r.PROP,this._convertProp.bind(this)),i(n,r.TAG,this._convertTag.bind(this)),i(n,r.OBJECT,this._convertObject.bind(this)),n),this.vpaidWrapper.once("vpaidCleaned",function(){a._stop()}),this._appendMembersToInterface(),this.interface}return n(e,[{key:"_appendMembersToInterface",value:function(){var e=this;this.members.forEach(function(t){e.memberConverter[t.type](t.name)})}},{key:"_convertFunction",value:function(e){this.interface[e]=this.vpaidWrapper[e].bind(this.vpaidWrapper)}},{key:"_convertProp",value:function(e){var t=this;Object.defineProperty(this.interface,e,{get:function(){if(!t.stopped)return t.vpaidWrapper[e]}})}},{key:"_convertTag",value:function(e){var t=this;Object.defineProperty(this.interface,e,{get:function(){if(!t.stopped)return Object.assign(t.vpaidWrapper[e],t.vpaidWrapper[e].vpaidWrapperData)}})}},{key:"_convertObject",value:function(e){this.interface[e]=this.vpaidWrapper[e]}},{key:"_stop",value:function(){this.stopped=!0,this.vpaidWrapper=this.members=this.memberConverter=this.interface=void 0}}]),e}();t.default=a},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(t){i(this,e),this.iframesWeights=t}return s(e,[{key:"detect",value:function(e,t){var i=this,s={};return e.map(function(e){var n=i._detectIframeTypeFromUrl(e,t);s[n]=s[n]||{urls:[],counter:0},s[n].urls.push(e),s[n].counter++}),s}},{key:"_detectIframeTypeFromUrl",value:function(e,t){return e.indexOf("imasdk")>-1?"ggl":t?"pxls":"gen"}},{key:"calculateWeightsByIframeType",value:function(e){var t=0;for(var i in e)t+=this.iframesWeights[i]*e[i].counter;return t}}]),e}();t.default=n},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(1),o=s(a),d=function(){function e(t,i,s){n(this,e),this.iframe=t,this.channel=void 0,this.sid=void 0,this.store=i,this.vpaidLog=s,this.protocol=this.store.get("httpsOverride")?"https:":window.location.protocol||"http:"}return r(e,[{key:"listenToMessages",value:function(){this.iframe.contentWindow.addEventListener("message",this.onmessage.bind(this))}},{key:"removeMessagesListener",value:function(){this.iframe.contentWindow.removeEventListener("message",this.onmessage.bind(this))}},{key:"onmessage",value:function(e){if(e){var t={};try{t=JSON.parse(e.data.replace("ima://",""))}catch(e){return}"viewabilityMeasurement"!==t.type&&(void 0!==t.channel&&void 0===this.channel&&(this.channel=t.channel),void 0!==t.sid&&"*"!==t.sid&&void 0===this.sid&&(this.sid=t.sid)),void 0!==this.channel&&void 0!==this.sid&&this.removeMessagesListener()}}},{key:"callApi",value:function(e,t){if(this.channel&&this.sid&&this.iframe){var i={name:"adsManager",type:e.replace("Ad",""),sid:this.sid,channel:this.channel};"volume"==e&&(i.data={volume:t});var s="\n                    var ifrms = document.querySelectorAll('iframe');\n\n                    ifrms.forEach(ifrm => {\n                        if (ifrm.src.indexOf('imasdk.googleapis.com') > -1 && ifrm.src.indexOf('bridge') > -1 && (ifrm.src.indexOf('#"+this.sid+"') > -1 || ifrm.src.indexOf('#"+this.channel+"') > -1)) {\n                            ifrm.contentWindow.postMessage('ima://"+o.stringify(i)+"', '"+this.protocol+"//imasdk.googleapis.com');\n                        }\n                    });\n                ";o.injectResource(this.iframe.contentWindow,s)}}}]),e}();t.default=d},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(t){i(this,e),this.baseUrl=t}return s(e,[{key:"load",value:function(e,t,i){e&&e.length&&window.cmTag&&(this._setWindowLoaderObject(),this._registerOnLoaderResponse(t),this._loadScript(e,t,i))}},{key:"_setWindowLoaderObject",value:function(){window.cmTag.cmLoader||(window.cmTag.cmLoader={addLoaderCb:function(e,t){window.cmTag.cmLoader[e]=window.cmTag.cmLoader[e]||{callbacks:[]},window.cmTag.cmLoader[e].callbacks.push(t)}})}},{key:"_registerOnLoaderResponse",value:function(e){window[e]||(window[e]=function(t){window.cmTag.cmLoader[e].callbacks.map(function(e){try{e(t)}catch(e){}})})}},{key:"_loadScript",value:function(e,t,i){window.cmTag.cmLoader.addLoaderCb(t,i);var s=document.createElement("script");s.src=this.baseUrl+e,document.body.appendChild(s)}}]),e}();t.default=n},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(2),d=n(o),l=i(69),u=n(l),h=i(5),c=n(h),p=i(1),v=s(p),f=i(59),m=n(f),g=i(7),y=s(g),_=i(46),b=n(_),w=i(58),k=n(w),A=i(48),T=n(A),C=i(8),E=function(){function e(t,i){var s=this;r(this,e),this.mainVpaid=t,this.store=i,this.time=(new Date).getTime(),this.sequenceId=((new Date).getTime()+"").substring(3,11),this.loops=0,this.stopped=!1,this.started=!1,this.schedule=[],this.timedTimeout=0,this.waterfall={},this.adSlots=1,this.filledSlots=0,this.adIsPlaying=!1,this.debugTracker=new d.default("Manager"),this.supportNonVideoVpaid=this.store.get("sprtnnvidvpd")&&this.store.get("mltads"),this.droppableTypes=this.store.get("drpbletps")||[],this.shouldFireGetAdPixels=v.shouldFirePixels(this.store.get("frgtadpxls")),this.store.set("isFirstImpression",!0),this.oppsID=c.default,this.queueSize=this.store.get("queue_size")||10,this.isVforce=i.get("vForce"),this.store.on("stop",this.stop.bind(this)),this.store.on(C.outer.EmitQueueStatus,this._emitQueueStatus.bind(this,"queueStatus")),this.queueStatus=new m.default(this.store),this.supportNonVideoVpaid&&(this.nonVideoItem=null,this.store.on(C.inner.NonVideoItemInWaterfall,this._onNonVideoItemInWaterfall.bind(this))),this.store.get("debug")&&setInterval(function(){s._postMessageSchedule()},1e3),this.dontTrimMp4=this.store.get("novdtrm"),this.maxBackfillDelayItems=this.store.get("mxbckflldlyitms"),this.maxBackfillDelayItems&&(this.backfilldelayTime=this.store.get("bckflldlyms"),this.backfillPriority=this.store.get("bfprty")),this.continueGetAdFlow=this.store.get("cntgtad")}return a(e,[{key:"_postMessageSchedule",value:function(){if(window.cmPlayerDeubg){var e=this.schedule,t=this.store;try{window.cmPlayerDeubg({schedule:e,store:t})}catch(e){console.log(e)}}}},{key:"trigger",value:function(e,t,i){if(this._handleAllEvents({type:e,dispatcher:t}),this.store.emit(e,t),t.working||e===this.mainVpaid.vpaidEvents.AdImpression){var s={type:e,dispatcher:t};e===this.mainVpaid.vpaidEvents.AdImpression&&(s.tag=t.tag),s.vpaidReady=this.getVpaidReadyCount(),s.qsize=this.schedule.length,s.dp=t&&t.tag?t.tag.dp:"na",s.adImpMS=t?t.adImpInMS:0,s.readyInMS=t?t.readyInMS:0,s.loadToImpMS=t?t.adImpInMS-t.readyInMS:0,s.clickThru={url:i?i.url:"",playerHandles:i&&i.playerHandles!==!1},this.mainVpaid.trigger(e,s)}}},{key:"getVpaidReadyCount",value:function(){var e=0;return this.schedule.map(function(t){t&&t.vpaidWrapper&&"ready"===t.vpaidWrapper.status&&e++}),e}},{key:"subscribeToVpaid",value:function(e){this.stopped||e.subscribe(this._handleError.bind(this),this.mainVpaid.vpaidEvents.AdError)}},{key:"_handleAllEvents",value:function(e){var t=this;e.type!==this.mainVpaid.vpaidEvents.AdVideoStart&&e.type!==this.mainVpaid.vpaidEvents.AdImpression&&e.type!==this.mainVpaid.vpaidEvents.AdPlaying||!e.dispatcher.isPlaying||this.trigger("viewAdPlayer",e.dispatcher.tag),e.type===this.mainVpaid.vpaidEvents.AdLoaded&&this.shouldPlayWhenAvialable&&!this.store.get("evtbsschdl")&&(setTimeout(function(){t.playFromQueue(t.shouldPlayWhenAvialable)},2),e.dispatcher?e.dispatcher.tag:{},this.shouldPlayWhenAvialable=!1),e.type===this.mainVpaid.vpaidEvents.AdImpression&&(e.dispatcher.options&&e.dispatcher.options.getAdContext?(e.dispatcher.gotAd=!0,this.debugTracker.info("gotAd",e.dispatcher,{color:"#5EB9FF"}),v.logToBI(e.dispatcher.vpaidLog,"getAdContexIsEmpty",{empty:!1}),e.dispatcher.options.getAdContext.getAdCallback(new T.default(e.dispatcher))):e.dispatcher&&e.dispatcher.vpaidLog&&v.logToBI(e.dispatcher.vpaidLog,"getAdContexIsEmpty",{empty:!0}))}},{key:"_runNextAd",value:function(){}},{key:"_handleError",value:function(e){var t=e.dispatcher;this.adIsPlaying&&t&&t.isStarted&&!t.hadImpression&&!this.store.get("evtbsschdl")&&this.playFromQueue()}},{key:"initVpaidInQue",value:function(e){if(!this.stopped)for(var t=this.schedule,i={},s="",n=0;n<t.length;n++)i=t[n],s=n+"-"+i.waterfallTagId,i.vpaidWrapper||(this.maxBackfillDelayItems&&i.priority===this.backfillPriority?i.backfillDelay=setTimeout(this._createVpaidWrapper.bind(this,i,s,e),this.backfilldelayTime):this._createVpaidWrapper(i,s,e))}},{key:"_createVpaidWrapper",value:function(e,t,i){e.backfillDelay&&(e.backfillDelay=window.clearTimeout(e.backfillDelay),e.isBackfillDelayed=!0),e.sequenceId=e.wfIndex,this._updateCostModel(e);var s=this._createQueueItem(e,t,i),n=this;e.vpaidWrapper=s.vpaidWrapper,e.vpaidWrapper.on("vpaidCleaned",function(){n.cleanQueue(n.queueSize),n.continueGetAdFlow&&this.options&&this.adStarted&&!this.hadImpression&&n.getAdFromQueue(this.options),n.queueStatus.onScheduleChange(n.schedule,n.supportNonVideoVpaid&&null!==n.nonVideoItem)}),this.subscribeToVpaid(e.vpaidWrapper)}},{key:"_updateCostModel",value:function(e){var t=new b.default(this.store),i=e.getValueByKey("cstmdl");void 0===i&&(i=e.cstmdl),e.cstmdl=i,e.isCPCV=t.isCPCV(e.cstmdl)}},{key:"_createQueueItem",value:function(e,t,i){var s={tag:e,tagId:t,manager:this,store:this.store,mainVpaid:this.mainVpaid,wflog:i},n=new k.default(s);return n}},{key:"unsubscribeFromVpaid",value:function(e){this.stopped||(e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdError),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdFound),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdStopped),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSkipped),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdImpression),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSkippableStateChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSizeChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdLinearChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdDurationChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdExpandedChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVolumeChange),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoStart),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoFirstQuartile),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoMidpoint),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoThirdQuartile),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoComplete),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdClickThru),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdInteraction),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserAcceptInvitation),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserMinimize),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserClose),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdPaused),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdPlaying),e.unsubscribe(null,this.mainVpaid.vpaidEvents.AdLog))}},{key:"_shouldDropAd",value:function(e,t){return this.droppableTypes.indexOf(e)>-1&&t.hasOwnProperty(e)&&t[e]}},{key:"cleanQueue",value:function(e,t){var i=this;if(this.schedule.map(function(e,s){if(e&&e.vpaidWrapper&&!e.vpaidWrapper.working){var n=!1,r=null;if("error"===e.vpaidWrapper.status||"stopped"===e.vpaidWrapper.status){n=!0;var a="error"===e.vpaidWrapper.status;r=a?i.oppsID.vastError:i.oppsID.adError}else t&&i._shouldDropAd(t,e)&&!e.vpaidWrapper.hadImpression&&(n=!0,r=i.oppsID.adDropped);n&&(i.queueStatus.onItemRemovedFromQueue(e),e.vpaidWrapper._status=e.vpaidWrapper.status,i.unsubscribeFromVpaid(i.schedule[s].vpaidWrapper),i.schedule[s].vpaidWrapper.stop("cleanExpierd",r),i.schedule[s]&&(i.schedule[s].vpaidWrapper=null),i.schedule[s]=void 0)}}),this.schedule=this.schedule.filter(function(e){return e}),this.schedule=u.default.sort(this.schedule,this.store),this.schedule.length>e){var s=(this.mainVpaid.config.creatives,this.mainVpaid.config.creatives.ADTO||6e4),n=this.store.get("trmrdyvpaid");this.schedule.map(function(t,r){if(i.schedule[r]&&!t.vpaidWrapper.working&&(n||"ready"!==t.vpaidWrapper.status)){var a=Date.now()-i.schedule[r].vpaidWrapper.created;if(t&&(r<i.schedule.length-e||a>s)){i.queueStatus.onItemRemovedFromQueue(t),i.unsubscribeFromVpaid(i.schedule[r].vpaidWrapper);var o=a>s?"queueExpired":"queueTrimmed";if(!i._canTrim(o,t))return;i.schedule[r].vpaidWrapper.stop(o,i.oppsID[o]),i.schedule[r]=void 0}}})}this.schedule=this.schedule.filter(function(e){return e})}},{key:"_canTrim",value:function(e,t){return"queueTrimmed"!==e||!(t.vpaidWrapper&&"mp4"===t.vpaidWrapper.type&&this.dontTrimMp4)}},{key:"fillSchedule",value:function(e,t){this.schedule.length>this.queueSize&&this.cleanQueue(this.queueSize),this.started=!0,this.stopped=!1;var i={},s=0,n=this.mainVpaid.config.creatives;n.ADTO=parseInt(n.ADTO)>1?parseInt(n.ADTO):60,n.ADTO=n.ADTO<1e3?1e3*n.ADTO:n.ADTO,this.adSlots=parseInt(n.B2B)&&parseInt(n.B2B)>1?parseInt(n.B2B):1;var r=0,a=n.DEFAULTTAGTIMEOUT<1e3?1e3*n.DEFAULTTAGTIMEOUT:n.DEFAULTTAGTIMEOUT;for(s=0;s<e.tags.length;s++)this._shouldInsertToQueue(e.tags[s])?(i=e.tags[s],i.active=!1,i.adFound=!1,i.offset=r,i.tagStart=r,i.tagTimeout=a,i.queueNumber=0,i.ADTO=n.ADTO,i.vpaidWrapper=!1,i.tagEnd=1*i.tagStart+1*i.tagTimeout,i.wfStats=e.data,this.store.get("frstlk")&&this._updateItemFirstLook(i),this.schedule.push(i)):t.push("tagResponse_"+s+"_backfillThrown",!0);this._printQueue(this.schedule),this.mainVpaid.setVpaidId(i),this.time=(new Date).getTime(),this.initVpaidInQue(t),this.store.set("queueLength",this.schedule.length),this.store.set("vpaidReadyCount",this.getVpaidReadyCount()),this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem)}},{key:"_shouldInsertToQueue",value:function(e){return!this.maxBackfillDelayItems||e.priority!==this.backfillPriority||e.priority===this.backfillPriority&&this._getBackfillCount()<this.maxBackfillDelayItems}},{key:"_printQueue",value:function(e){var t=e.map(function(e){return{dp:e.dp,lineItem:e.lineItem,alfrox:e.alfrox,waterfallIndex:e.wfIndex,status:e.vpaidWrapper?e.vpaidWrapper.status:"",videoUrl:e.vpaidWrapper&&e.vpaidWrapper.hadImpression?e.vpaidWrapper.getVideoUrl():""}});this.debugTracker.table(t)}},{key:"_updateItemFirstLook",value:function(e){e.flad&&(this.store.get("first_look_ad_loaded")?(e.flad_delay=e.flad,delete e.flad):this._startFladTimeout(e.flad))}},{key:"_startFladTimeout",value:function(e){this.store.set("first_look_ad_loaded",e),this.fladTimeout=setTimeout(this._onFladTimeout.bind(this),1e3*e)}},{key:"_onFladTimeout",value:function(){for(var e=null,t=0;t<this.schedule.length;t++)if(e=this.schedule[t],e.flad_delay)return e.flad=e.flad_delay,delete e.flad_delay,void this._startFladTimeout(e.flad);this.store.set("first_look_ad_loaded",!1),this.store.emit("fladInactive")}},{key:"stop",value:function(){if(!this.stopped){this.stopped=!0,window.clearTimeout(this.timedTimeout);for(var e=0;e<this.schedule.length;e++)this.schedule[e].backfillDelay?window.clearTimeout(this.schedule[e].backfillDelay):this.schedule[e].vpaidWrapper.stop("playerClosed",this.oppsID.playerClosed);this.nonVideoItem=null}}},{key:"managerEnd",value:function(){}},{key:"playFromQueue",value:function(e){if(!this.store.get("isIdleMode")&&!this.stopped){var t=Date.now();this.store.set("playFromQueue",t);var i=this.getVpaidReadyCount();(0===i||e)&&(this.store.get("vForce")||(this.shouldPlayWhenAvialable=!0)),this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=u.default.sort(this.schedule,this.store));var s=this.mainVpaid.config.creatives.ADTO||6e4;s+=1e4;for(var n=!1,r=this._getItemScores(),a=(this._getItemDps(),this.schedule.length-1);a>=0;a--){var o=this.schedule[a];o&&(this._setItemScores(o,a,r),"ready"!==o.vpaidWrapper.status||o.vpaidWrapper.working||o.vpaidWrapper.isStarted||n||this.store.get("first_look_ad_loaded")&&!o.flad||(this.store.set("playFromQueueFound",t),o.vpaidWrapper.workingVpaid=!0,this.store.set("ad_controls",o.getValueByKey("ad_controls")!==!1),o.vpaidWrapper.working=!0,o.vpaidWrapper.isPlaying=!0,this.adIsPlaying=!0,n=!0,o.vpaidWrapper.startAd(),v.logToBI(o.vpaidWrapper.vpaidLog,"startFromQ",{score:o.score})))}var d=this.store.get("run_wf_when_empty");d&&0===i&&this.store.emit("playFromEmptyQueue")}}},{key:"bringVpaidToFront",value:function(){for(var e=this.schedule.length-1;e>=0;e--){var t=this.schedule[e];if(t&&t.vpaidWrapper.workingVpaid){t.vpaidWrapper.bringToFront();break}}}},{key:"_getItemScores",value:function(){for(var e=[],t=this.schedule.length-1;t>=0;t--){var i=this.schedule[t];i&&e.push(i.score)}return e}},{key:"_getItemDps",value:function(){for(var e=[],t=this.schedule.length-1;t>=0;t--){var i=this.schedule[t];i&&e.push(i.dp)}return e}},{key:"_setItemScores",value:function(e,t,i){e.vpaidWrapper&&e.vpaidWrapper.vpaidLog&&e.vpaidWrapper.vpaidLog.data&&(e.vpaidWrapper.vpaidLog.data.itemScore=e.score,i&&v.logToBI(e.vpaidWrapper.vpaidLog,"itemScores",{index:t,scores:i},!1,!1))}},{key:"resizeAd",value:function(e,t,i){if(!this.stopped){this.mainVpaid.config.creatives.PLAYER_WIDTH=this.mainVpaid.config.width=parseInt(e),this.mainVpaid.config.creatives.PLAYER_HEIGHT=this.mainVpaid.config.height=parseInt(t),this.mainVpaid.config.creatives.VIEW_MODE=this.mainVpaid.config.viewMode=i;for(var s=0;s<this.schedule.length;s++)this.schedule[s].vpaidWrapper&&!this.schedule[s].vpaidWrapper.stopped&&this.schedule[s].vpaidWrapper.callVpaidMethod("resizeAd",[e,t,i],0)}}},{key:"setAdVolume",value:function(e,t){if(!this.stopped){if(e=e>1?e/100:e,isNaN(parseFloat(e)))return!1;e=parseFloat(e),t||(this.mainVpaid.config.creatives.VOLUME=e),this.mainVpaid.config.creatives.MUTED=0==e;for(var i=0;i<this.schedule.length;i++)this.schedule[i].vpaidWrapper&&!this.schedule[i].vpaidWrapper.stopped&&this.schedule[i].vpaidWrapper.workingVpaid&&this.schedule[i].vpaidWrapper.setAdVolume(e)}}},{key:"callWorkingVpaid",value:function(e,t,i){if(!this.stopped)for(var s=0;s<this.schedule.length;s++){var n=this.schedule[s].vpaidWrapper;if(n&&n.workingVpaid)return n.callVpaidMethod(e,t,i)}}},{key:"getVpaidLogs",value:function(){for(var e=[],t=0;t<this.schedule.length;t++){var i=this.schedule[t];i&&i.vpaidWrapper&&i.vpaidWrapper.vpaidLog&&e.push(i.vpaidWrapper.vpaidLog)}return e}},{key:"getAd",value:function(e){var t=this;this.store.incr("getAdData.count");var i=this;this.debugTracker.info("getAd",e?e:"empty getAd",{color:"#5EB9FF"}),this.shouldFireGetAdPixels&&v.sendPixel(v.createPixelParams(y.getAd,this.store));var s=new Promise(function(t,s){e=e||{};var n={getAdCallback:t};e.getAdContext=n,e.getAdRetries=0,e.getAdContext.getAdTimeout=setTimeout(function(){e.getAdContext=void 0,s({name:"error",message:"couldn't find a suitable ad to play"})},1e3*(e.getAdTimeout||i.store.get("get_ad_timeout_seconds"))),i.getAdFromQueue(e)});return s.cancel=function(){t.cancelGetAd(e),t.debugTracker.info("getAd","getAd cancelled!",{color:"#5EB9FF"})},s}},{key:"cancelGetAd",value:function(e){this.store.decr("getAdData.count"),clearTimeout(e.getAdContext.getAdTimeout),e.getAdContext=void 0}},{key:"getAdFromQueue",value:function(e){if(!this.store.get("isIdleMode")&&!this.stopped&&(e=e||{},e&&e.getAdContext&&(!e.requiredViewability||!document.hidden))){this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=u.default.sort(this.schedule,this.store));for(var t=!1,i=this._getItemScores(),s=this.schedule.length-1;s>=0;s--){var n=this.schedule[s];if(this._updateStatusesOnGetAd(n,e),this._setItemScores(n,s,i),this.isViewabilityMatch(n,e)&&this.isAdPropertiesMatch(n,e.adProperties,e.excAdProperties)&&this._canPullItem(n)){this._pullItemFromQueue(n,e),t=!0;break}}var r=this.store.get("run_wf_when_empty");if(r&&0==this.getVpaidReadyCount()&&this.store.emit("playFromEmptyQueue"),!t){if(this._canPullAdxCard(e))return void this._pullAdxCard(e);this.nextAdFromQueue=setTimeout(this.getAdFromQueue.bind(this,e),1e3)}}}},{key:"_canPullItem",value:function(e){return"ready"===e.vpaidWrapper.status&&!e.vpaidWrapper.working&&!e.vpaidWrapper.isStarted&&(!this.store.get("first_look_ad_loaded")||e.flad)}},{key:"_pullAdxCard",value:function(e){this.nonVideoItem.adx=!0,this._pullItemFromQueue(this.nonVideoItem,e)}},{key:"_canPullAdxCard",value:function(e){return e.requiredViewability&&this.nonVideoItem&&this.nonVideoItem.vpaidWrapper&&this._canPullItem(this.nonVideoItem)}},{key:"_pullItemFromQueue",value:function(e,t){e.vpaidWrapper.working=!0,e.vpaidWrapper.isPlaying=!0,this.adIsPlaying=!0,e.vpaidWrapper.bringToFront(),"mp4"===e.vpaidWrapper.type&&e.vpaidWrapper.vpaidHandler.logVideoBuffer("StartFromQ"),e.vpaidWrapper.startAd(t),v.logToBI(e.vpaidWrapper.vpaidLog,"startFromQ",{score:e.score,adx:e.adx}),clearTimeout(t.getAdContext.getAdTimeout),t.getAdContext.getAdTimeout=void 0,t.getAdRetries++}},{key:"_updateStatusesOnGetAd",value:function(e,t){e.vpaidWrapper&&e.vpaidWrapper.vpaidLog&&!e.vpaidWrapper.gotAd&&e.vpaidWrapper.updateStatusesOnGetAd(t)}},{key:"isViewabilityMatch",value:function(e,t){return!(!e||!e.vpaidWrapper)&&("undefined"==typeof t.requiredViewability||(t.requiredViewability?e.requiredViewability:!e.requiredViewability))}},{key:"isAdPropertiesMatch",value:function(e,t,i){return this._isAdPropertiesMatch(t,e,!0)&&this._isAdPropertiesMatch(i,e,!1)}},{key:"_isAdPropertiesMatch",value:function(e,t,i){if(e)for(var s in e){var n=this._isPropertyMatch(s,e[s],t);if(n&&!i||!n&&i)return!1}return!0}},{key:"_isPropertyMatch",value:function(e,t,i){for(var s=0;s<t.length;s++)if(i[e]==t[s])return!0;return!1}},{key:"onStop",value:function(){}},{key:"isActivePausedAd",value:function(){for(var e=0;e<this.schedule.length;e++){var t=this.schedule[e];if(t&&t.vpaidWrapper&&t.vpaidWrapper.isPlaying&&!t.vpaidWrapper.isUnPaused)return!0}return!1}},{key:"isWorkingVpaidItem",value:function(e){var t=!1;return this.schedule.map(function(i){i&&i.vpaidWrapper&&i.vpaidWrapper==e&&i.vpaidWrapper.working&&(t=!0)}),t}},{key:"_saveCountersToStore",value:function(e,t,i){!t&&this.store&&i&&this.store.set(e,i)}},{key:"callAllWorkingVpaids",value:function(e){return this.schedule.map(function(t){if(t.vpaidWrapper&&!t.vpaidWrapper.stopped&&t.vpaidWrapper.workingVpaid)return e(t.vpaidWrapper)})}},{key:"mute",value:function(){this.callAllWorkingVpaids(function(e){return e.mute()})}},{key:"unmute",value:function(){this.callAllWorkingVpaids(function(e){return e.unmute()})}},{key:"play",value:function(){this.callAllWorkingVpaids(function(e){return e.resumeAd()})}},{key:"pause",value:function(){this.callAllWorkingVpaids(function(e){return e.pauseAd()})}},{key:"getCurrentWorkingVpaidVolume",value:function(){var e=null;return this.callAllWorkingVpaids(function(t){null===e&&(e=t.getCurrentVolume())}),e||0}},{key:"_emitQueueStatus",value:function(e){this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem,e)}},{key:"_getBackfillCount",value:function(){var e=this,t=0;return this.schedule.map(function(i){i&&i.priority===e.backfillPriority&&t++}),t}},{key:"_onNonVideoItemInWaterfall",value:function(e){this.stopped||this.nonVideoItem||(this.nonVideoItem=e.item,this.nonVideoItemWflog=e.wflog,this._createVpaidWrapper(this.nonVideoItem,"adx-"+this.nonVideoItem.waterfallTagId,this.nonVideoItemWflog))}},{key:"getPlayerDAST",value:function(){for(var e=this.callAllWorkingVpaids(function(e){return e.playerDAST.get()}),t=0;t<e.length;t++)if(e[t])return e[t];return""}}]),e}();t.default=E},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t,i,s,n){var r=document.createElement("script"),a=[];t={adData:{ids:t,duration:i,url:n},dispatchEvent:function(e){this.sendEvent?(a&&(a.push(e),e=a,a=!1),this.sendEvent(e)):a.push(e)}},i="_moatApi"+Math.floor(1e8*Math.random());var o,d;try{o=e.ownerDocument,d=o.defaultView||o.parentWindow}catch(e){o=document,d=window}return d[i]=t,r.type="text/javascript",e&&e.insertBefore(r,e.childNodes[0]||null),r.src="https://z.moatads.com/"+s+"/moatvideo.js#"+i,t}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),d=i(1),l=n(d),u=i(6),h=s(u),c=function(){function e(t){r(this,e),this.options=t,this.moatAbTest=this.options.tag.getValueByKey("mttst"),this.moatAbTest&&(this.moatAbTest+="_"),this.moatAbTest=""+this.moatAbTest+(this.options.store.get("unit_type")||"")+(this.options.store.get("isMobile")?"_Mobile":"");var i=this._createLevels(),s=this.options.moatTag?new Function(this.options.moatTag):a;this.moatApiReference=s(this.options.container||document.body,i,this.options.duration||0,this.options.moatPartnerCode,this.options.url),l.logToBI(this.options.vpaidLog,"moatTracker",{}),this.debugTracker=this.options.debugTracker,this.events=[h.default.AdLoaded,"startAd",h.default.AdStarted,h.default.AdImpression,h.default.AdVideoStart,h.default.AdClickThru,h.default.AdStopped,h.default.AdPlaying,h.default.AdPaused,h.default.AdVideoFirstQuartile,h.default.AdVideoMidpoint,h.default.AdVideoThirdQuartile,h.default.AdVideoComplete,h.default.AdVolumeChange],this.stopped=!1}return o(e,[{key:"_createLevels",value:function(){if(this.options.moatTag)return{};if(!this.options.tag)return{level1:"",level2:"",level3:"",level4:"",slicer1:"",slicer2:""};var e={level1:this.moatAbTest,level2:this.options.tag.advId,level3:this.options.tag.lineItemId,level4:this.options.store.get("domain")||"",slicer1:this.options.url,slicer2:this.options.tag.tagId,zMoataucdast:this.options.store.get("auc_dast"),zMoatdast:this.options.tag.vidDast,zMoatabt:this.options.store.get("ab_test"),zMoatpdast:this.options.playerDast,zMoatframetype:this.options.store.get("frameType"),zMoatsubunittypeid:this.options.store.get("subUnitType"),zMoatos:1*this.options.tag.waterfallTagId+1},t=this.options.store.get("dast");return t.hasOwnProperty("cisid")&&(e.zMoatimprid=t.cisid),e}},{key:"dispatch",value:function(e){this.stopped||this.events.indexOf(e.type)>-1&&(this.moatApiReference.dispatchEvent(e),this.debugTracker.info("Moat dispatching event:"+e.type,e))}},{key:"dispose",value:function(){this.stopped=!0,this.moatApiReference=this.events=this.options=void 0}}]),e}();
t.default=c},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(2),d=n(o),l=i(1),u=s(l),h=i(4),c=n(h),p=function(){function e(t,i){r(this,e),this.store=t,this.debugTracker=new d.default("OpportunityAggregator"),this.opps=[];var s=this.store.get("opps_base_path")||i.CM_DOMAIN;this.url=u.setUrlPrefix(s)+(/.*\/$/g.test(s)?"":"/")+"OpportunityServlet",this.postHeaders=this.store.get("psthdrs")||"application/json",this.onFail=this._onFail.bind(this),this.onSuccess=this._onSuccess.bind(this);var n=this._sendTicker.bind(this);setInterval(n,this.store.get("timbtopps")),this.store.on("sendOpps",n),this.store.on("beforeunload",n)}return a(e,[{key:"send",value:function(e){this.opps.push(e)}},{key:"_sendTicker",value:function(){this.opps.length>0&&(0,c.default)(this.url,u.stringify(this.opps),this.onSuccess,this.onFail,void 0,!1,!1,5e3,this.postHeaders,!1),this.opps=[]}},{key:"_onSuccess",value:function(e){}},{key:"_onFail",value:function(e){this.debugTracker.warn("Error Firing Opps",e)}}]),e}();t.default=p},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(2),d=(n(o),i(20)),l=s(d),u=i(1),h=s(u),c=i(6),p=n(c),v=function(){function e(t){r(this,e),this.trackingPixels=Object.assign({},l),this.pixelDataLoaded=!1,this.events=[],this.done=[],this.store=t,this.vpaidEvents=p.default,this.state="",this.clickThruUrl="",this._isPaused=!1,this.buildPixelsRestrictions(),this._isPaused=!1,this.replacePixelMacros=this.store.get("rplcpxlmcrplchldr"),this.fireMultiplePixels=this.store.get("frmltplpxls")||[]}return a(e,[{key:"getState",value:function(){return this.state}},{key:"buildPixelsRestrictions",value:function(){this.pixelsRestrictions={},this.pixelsRestrictions.baseState=this.vpaidEvents.AdVideoThirdQuartile,this.pixelsRestrictions[this.vpaidEvents.AdVideoComplete]=this.vpaidEvents.AdVideoThirdQuartile}},{key:"loadPixelData",value:function(e){this.pixelDataLoaded,this.pixelDataLoaded=!0,this.trackingPixels=e}},{key:"getClickThruUrl",value:function(){if(!this.clickThruUrl)for(var e=["adclickthrough","clickthrough","adclickthru","clickthru"],t=0;t<e.length;t++){var i=e[t];if(this.trackingPixels.hasOwnProperty(i)&&this.trackingPixels[i].length>0){this.clickThruUrl=this.trackingPixels[i][0].pixel;break}}return this.clickThruUrl}},{key:"firePixel",value:function(e,t,i){if(this._isPaused)return!1;if(!this.isValid(e,i))return!1;for(var s=this.getPixels(e,i),n=0;n<s.length;n++)this._sendPixel(s[n].pixel,s[n].method,e,t,i);return this.events.push(e),""===this.state&&e===this.pixelsRestrictions.baseState&&(this.state=this.pixelsRestrictions.baseState),!0}},{key:"_cleanPixelType",value:function(e){return e.toLowerCase().replace(/^advideo|^aduser|^ad/gi,"")}},{key:"_getAllLinkedPixelTypes",value:function(e){e=this._cleanPixelType(e);var t=[];return"clickthrough"===e||"clickthru"===e?t.push("adclicktracking","clicktracking"):("start"===e&&t.push("creativeview"),h.endsWith(e,"ed")&&this._pushLinkedPixelTypesEdEnding(e,t),this._pushLinkedPixelTypes(e,t)),t}},{key:"_pushLinkedPixelTypes",value:function(e,t){t.push(e,"aduser"+e,"advideo"+e,"ad"+e)}},{key:"_pushLinkedPixelTypesEdEnding",value:function(e,t){for(var i=e.charAt(e.length-3)===e.charAt(e.length-4)?3:2,s=0;s<i;s++)e=e.slice(0,-1),this._pushLinkedPixelTypes(e,t)}},{key:"getPixels",value:function(e,t){var i=[];if("progress"!==e.toLowerCase())for(var s=this._getAllLinkedPixelTypes(e),n=0;n<s.length;n++)this.trackingPixels.hasOwnProperty(s[n])&&(i=i.concat(this._checkConcatPixels(this.trackingPixels[s[n]])));else t&&t.hasOwnProperty("eventData")&&t.eventData.hasOwnProperty("pixel")&&t.eventData.pixel&&(i=i.concat(t.eventData));return i}},{key:"_removePixel",value:function(e,t){for(var i=this._getAllLinkedPixelTypes(e),s=0;s<i.length;s++)if(this.trackingPixels.hasOwnProperty(i[s])){var n=this.trackingPixels[i[s]].indexOf(t);n>-1&&this.trackingPixels[i[s]].splice(n,1)}}},{key:"isValid",value:function(e,t){if(!this.pixelsRestrictions.hasOwnProperty(e))return!0;if(e===this.vpaidEvents.AdVideoComplete&&t&&t.newCompletion===!0)return!0;var i=this.pixelsRestrictions[e];return i===this.state&&(this.state=e,!0)}},{key:"destroy",value:function(){this.trackingPixels=this.done=this.events=this.vpaidEvents=this.pixelsRestrictions=this.state=this.clickThruUrl=void 0}},{key:"_checkConcatPixels",value:function(e){return e&&e.length?e:[]}},{key:"_sendPixel",value:function(e,t,i,s,n){if("about:blank"!==e&&(s?s.data:null,this.done.indexOf(e)===-1)){var r=s&&s.tag?s.tag.advId:null;this.fireMultiplePixels.indexOf(i)===-1&&this.done.push(e);try{return e=this._replaceMacros(e,n),r&&(s.tag.getValueByKey("pxlnotsmtp")||(e+=(e.search(/\?/)>-1?"&":"?")+(new Date).getTime())),"img"===t?(new Image).src=e:"js"===t&&this._sendJSPixel(e),!0}catch(e){return!1}}}},{key:"_sendJSPixel",value:function(e){var t=document.createElement("script");t.src=e,t.type="text/javascript",t.async=!0,document.body.appendChild(t)}},{key:"_replaceMacros",value:function(e,t){return e=h.replaceMacros(e,this.store),e=this._replaceCachebustingMacro(e),this.replacePixelMacros&&(e=this._replaceErrorMacro(e,t),e=this._replaceTimestampMacro(e),e=this._replaceVideoMacro(e,t),e=this._replaceVideoCurrentTimeMacro(e,t)),e}},{key:"_replaceCachebustingMacro",value:function(e){var t=Date.now().toString(),i=t.substring(5);return e.replace("[CACHEBUSTING]",i)}},{key:"_replaceVideoMacro",value:function(e,t){return e.indexOf("[ASSETURI]")>-1?t&&t.dispatcher&&t.dispatcher.getVideoUrl?e.replace("[ASSETURI]",t.dispatcher.getVideoUrl()):e.replace("[ASSETURI]",""):e}},{key:"_replaceTimestampMacro",value:function(e){return e.indexOf("[TIMESTAMP]")>-1?e.replace("[TIMESTAMP]",(new Date).toISOString()):e}},{key:"_replaceVideoCurrentTimeMacro",value:function(e,t){if(e.indexOf("[CONTENTPLAYHEAD]")>-1)try{if(t&&t.dispatcher&&t.dispatcher.video){var i=t.dispatcher.video.currentTime,s=Math.floor(i/60);s=s>=10?s:"0"+s;var n=Math.floor(i%60);n=n>=10?n:"0"+n;var r=i.toFixed(3).split(".")[1];return e.replace("[CONTENTPLAYHEAD]","00:"+s+":"+n+"."+r)}}catch(t){return e.replace("[CONTENTPLAYHEAD]","")}return e}},{key:"_replaceErrorMacro",value:function(e,t){return e.indexOf("[ERRORCODE]")===-1?e:e.replace("[ERRORCODE]",h.getIABErrorCode(t))}},{key:"pause",value:function(){this._isPaused=!0}},{key:"extractWinningPrice",value:function(e,t){var i=this.getPixels(this.vpaidEvents.AdImpression),s=void 0;if(i.length>0)for(var n=new RegExp(e+"=(.*?)(&|$)","gi"),r=0;r<i.length;r++){var a=n.exec(i[r].pixel);a&&(a.length>1&&a[1]?s={found:!0,price:a[1]}:(s||(s={found:!1}),t&&this._removePixel(this.vpaidEvents.AdImpression,i[r].pixel)))}return s}}]),e}();t.default=v},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.DASTKEYSMAP=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(1),o=s(a),d=t.DASTKEYSMAP={vastDuration:"vdr",videoElementDuration:"edr",vastWidth:"vwd",videoElementWidth:"ewd",vastHeight:"vht",videoElementHeight:"eht",vastBitrate:"vbr",videoElementUrl:"vu",videoElementType:"vt",vastOriginalType:"ot",vastSubType:"st",effectiveConnectionType:"ect",connectionType:"ct",vasts:"vst",canvas:"cnv",canvasToVideo:"ctv",videoUrlChanged:"vuc",winningPrice:"wp"},l=function(){function e(t){n(this,e),this.store=t,this.hadImpression=!1,this.onNavigatorConnectionChange=this._onNavigatorConnectionChange.bind(this),this.store.on("navigatorConnectionChange",this.onNavigatorConnectionChange);var i=this.store.get("navigatorConnection")||{};this.dast={vdr:void 0,edr:void 0,vwd:void 0,ewd:void 0,vht:void 0,eht:void 0,vbr:void 0,vu:void 0,vt:void 0,ot:void 0,st:void 0,ect:i.effectiveTypeId,ct:i.typeId,vst:[],cnv:!1,ctv:!1,vuc:!1,wp:void 0}}return r(e,[{key:"set",value:function(e){this.stopped||(e.hasOwnProperty("vu")&&""!==e.vu&&(e.vt=this._getVideoTypeFromUrl(e.vu),this.hadImpression&&e.vu!==this.dast.vu&&(this.dast.vuc=!0)),this.dast=Object.assign(this.dast,e))}},{key:"_getVideoTypeFromUrl",value:function(e){var t=void 0,i=e.match(/\.([^\/#?]+)([#?][^\/]*)?$/);return i&&i.length>1&&(t=i[1]),t}},{key:"addWrapper",value:function(e){this.stopped||(e.hasOwnProperty("wu")&&""!==e.wu&&(e.wu=this._getHostnameFromWrapperUrl(e.wu)),this.dast.vst.push(e))}},{key:"_getHostnameFromWrapperUrl",value:function(e){var t=document.createElement("a"),i="";return t.href=e,i=t.hostname,t=null,i}},{key:"_onNavigatorConnectionChange",value:function(e){this.stopped||(this.dast.ect=e.effectiveTypeId,this.dast.ct=e.typeId)}},{key:"get",value:function(){if(!this.stopped)return o.encodeData(this.dast)}},{key:"getByKey",value:function(e){var t=d[e]||e;return this.dast[t]}},{key:"destroy",value:function(){this.stopped=!0,this.store.off("navigatorConnectionChange",this.onNavigatorConnectionChange),this.store=this.onNavigatorConnectionChange=this.dast=void 0}},{key:"onImpression",value:function(){this.hadImpression=!0}},{key:"getWrappers",value:function(){return this.dast.vst}}]),e}();t.default=l},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(17),o=s(a),d=function(){function e(t){n(this,e),this.store=t,this.data=[],this.useOppsula=this.store.get("usopsla")&&this.store.get("cmbopps"),this.oppsula=this.store.get("oppsula"),this.useOppsula&&!this.oppsula&&this.store.once("oppsulaCreated",this._onOppsulaCreated.bind(this)),this.store.once("waterfallData",this._onWaterfallData.bind(this)),this.store.once("mainVpaidCreated",this._onMainVpaidCreated.bind(this))}return r(e,[{key:"send",value:function(e){this.opportunityManager?this.opportunityManager.send(this._fixedItem,e):this.data.push(e)}},{key:"_sendData",value:function(){var e=this;this.data.forEach(function(t){e.send(t)}),this.data=[]}},{key:"_onWaterfallData",value:function(e){this._fixedItem||(this._fixedItem=e.tags[0],this._createNewPom())}},{key:"_onOppsulaCreated",value:function(e){this.oppsula=e,this._createNewPom()}},{key:"_createNewPom",value:function(){this._fixedItem&&this.config&&(this.useOppsula&&!this.oppsula||this._fixedItem&&this.config&&(this.opportunityManager=new o.default({CM_DOMAIN:this.config.creatives.CM_DOMAIN,AUC_DAST:this.config.creatives.AUC_DAST,sequenceId:this._fixedItem.sequenceId,ST:this.config.creatives.ST,STS:this.config.creatives.STS,SDID:this.config.creatives.SDID,PT:this.config.creatives.PT,PV:this.config.creatives.PV,WP:this.config.creatives.WP,VPD:this.config.creatives.PUBID,VPTD:this.config.creatives.TAGID,VMT:this.config.creatives.VMT},this.store),this._sendData()))}},{key:"_onMainVpaidCreated",value:function(e){this.config=e}}]),e}();t.default=d},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(63),o=s(a),d=i(19),l=s(d),u=i(17),h=s(u),c=i(55),p=s(c),v=i(60),f=s(v),m=function(){function e(t){n(this,e),this.tag=t.tag,this.tagId=t.tagId,this.manager=t.manager,this.store=t.store,this.mainVpaid=t.mainVpaid,this.opportunityManager=t.opportunityManager,this.vpaidLog=t.vpaidLog,this.wflog=t.wflog,this.vpaidLog=this._createVpaidLog(),this.opportunityManager=this._createOpportunityManager(),this.pixelManager=new p.default(this.store),this.vastParser=this._createVastParser(),this.vpaidWrapper=this._createVpaidWrapper()}return r(e,[{key:"_createVpaidWrapper",value:function(){return new o.default({tag:this.tag,creatives:this.mainVpaid.config.creatives,vpaidEvents:this.mainVpaid.vpaidEvents,config:this.mainVpaid.config,tagid:this.tagId,manager:this.manager,wfStats:this.tag.wfStats,mainVpaid:this.mainVpaid,store:this.store,wflog:this.wflog,vpaidLog:this.vpaidLog,opportunityManager:this.opportunityManager,pixelManager:this.pixelManager,vastParser:this.vastParser})}},{key:"_createVpaidLog",value:function(){var e={auctionId:this.tag.auctionId,advId:this.tag.advId,dast:this.tag.dast,price:this.tag.price,queueNumber:this.tag.queueNumber,cpmFloor:this.tag.cpmFloor,dp:this.tag.dp,rollType:this.tag.rollType,lineItem:this.tag.lineItem,unitType:this.store.get("unit_type"),unitVersion:this.store.get("unit_version"),isMobile:this.store.get("isMobile")||!1,rpox:this.tag.rpox,alfrox:this.tag.alfrox,frox:this.tag.frox,waterfallIndex:this.tag.wfIndex,itemType:this.tag.itemType,requiredViewability:this.tag.requiredViewability,requiredViewabilityDrawn:this.tag.requiredViewabilityDrawn,flad:this.tag.flad||this.tag.flad_delay||0,brand:this.tag.brand,priority:this.tag.priority,isCPCV:this.tag.isCPCV,backfillDelayed:!!this.tag.isBackfillDelayed,moatSampling:this.tag.moatSampling,getValueByKey:this.tag.getValueByKey};if(this.tag.crId){var t={stId:this.tag.stId,cmpgnId:this.tag.cmpgnId,itemType:this.tag.itemType};e=Object.assign(e,t)}return new l.default(e,this.store)}},{key:"_createOpportunityManager",value:function(){var e=this.mainVpaid.config.creatives;return new h.default({CM_DOMAIN:e.CM_DOMAIN,AUC_DAST:e.AUC_DAST,sequenceId:this.tag.sequenceId,ST:e.ST,STS:e.STS,SDID:e.SDID,PT:e.PT,PV:e.PV,WP:e.WP,VPD:e.PUBID,VPTD:e.TAGID,VMT:e.VMT},this.store,this.vpaidLog)}},{key:"_createVastParser",value:function(){var e=this.mainVpaid.config;return new f.default({vpaidLog:this.vpaidLog,width:e.width,height:e.height,bitrate:e.bitrate,internalPixel:this.tag.pixel,tag:this.tag},this.store)}}]),e}();t.default=m},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(t){i(this,e),this.store=t,this.event="queueStatusChanged",this.backfillPriority=this.store.get("mxbckflldlyitms")?this.store.get("bfprty"):void 0,this.previousQueue=[],this._initQueueStatus()}return s(e,[{key:"_initQueueStatus",value:function(){this.queueStatus={requiredViewabilityCount:0,nonRVCount:0,adLoadedCount:0,adxCard:!1,size:0,singleAd:!1,items:[],previousQueue:[]}}},{key:"onItemRemovedFromQueue",value:function(e){var t=this._getItemFromQueue(e);t&&(t=Object.assign({},t),t.vw=e.vpaidWrapper?e.vpaidWrapper.getVpaidStatus():{},this.previousQueue.push(Object.assign({},t)))}},{key:"_getItemFromQueue",value:function(e){for(var t=0;t<this.queueStatus.items.length;t++){var i=this.queueStatus.items[t];if(e.wfIndex===i.seq&&parseInt(e.waterfallTagId)===i.wti)return i}return!1}},{key:"onScheduleChange",value:function(e,t,i){this._initQueueStatus(),this.queueStatus.size=e.length,this.queueStatus.adxCard=t,this.queueStatus.previousQueue=this.previousQueue;for(var s=0;s<e.length;s++){var n=e[s];n.requiredViewability?this.queueStatus.requiredViewabilityCount++:this.queueStatus.nonRVCount++,n.vpaidWrapper.adLoadedFired&&this.queueStatus.adLoadedCount++,n.singleAd&&(this.queueStatus.singleAd=!0),this.queueStatus.items.push(this._getItemStatus(n))}this.emit(i)}},{key:"_getItemStatus",value:function(e){return{aid:e.advId,bf:e.priority===this.backfillPriority,br:e.brand,cmpid:e.campaignId,crid:e.creativeId,cstmdl:e.cstmdl,dp:e.dp,t:e.itemType,li:e.lineItemId,pid:e.pubId,rv:e.requiredViewability,pr:e.vpaidWrapper?e.vpaidWrapper.getPrice(!0):"",sa:e.singleAd,seq:e.wfIndex,wti:parseInt(e.waterfallTagId),vw:e.vpaidWrapper?e.vpaidWrapper.getVpaidStatus():{},mt:e.vpaidWrapper?e.vpaidWrapper.type:"",ves:e.vpaidWrapper?e.vpaidWrapper.earlySrcVPAID:void 0}}},{key:"emit",value:function(e){this.store.emit(e||this.event,this.queueStatus)}}]),e}();t.default=n},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(2),d=n(o),l=i(1),u=s(l),h=i(20),c=n(h),p=i(5),v=n(p),f=i(4),m=n(f),g=i(68),y=n(g),_=i(18),b=n(_),w=i(13),k=n(w),A=i(3);window.vpaidId=Date.now()+"-"+parseInt(1e4*Math.random());var T=0,C=0,E=function(){function e(t,i){r(this,e),A.mixin(this),this.trackingPixels=(0,c.default)(),this._addExternalEventTrackers(t),this.store=i,this.preferdVpaid=this.store.get("pvpd")||"javascript",this.tag=t.tag,this.preferdVpaid=this.tag.getValueByKey("pvpd")||this.preferdVpaid,this.pvidtp=this.tag.getValueByKey("pvidtp"),this.vpaidLog=t.vpaidLog,this.stopped=!1,this.destroyed=!1,this.debugTracker=new d.default("VastParser"),this.width=parseInt(t.width||this.store.get("width")),this.height=parseInt(t.height||this.store.get("height")),this.bitrate=parseInt(t.bitrate),this.redirCount=0,this.isMobile=this.store.get("isMobile"),this.secureWrapperUrls=u.shouldSecureWrapperAndMediaFile(i),this.fileTypes=["flv","wmv","mp4","webm","ogg","mov"],this.vastUrls=[],this.wrappersCount=0,this.addWrappersToPlayerDAST=this.store.get("adwrprstoplrdst"),this.creativeExtensions=[],this.index=++T,this.isReportWrappersOpenTime=this.store.get("rprtwrpropntime")}return a(e,[{key:"_addExternalEventTrackers",value:function(e){var t=this;this._addEventPixel("adimpression",e.internalPixel,void 0,void 0);for(var i=0;i<e.tag.conversionPixels.length;i++)this._addEventPixel("adimpression",e.tag.conversionPixels[i],void 0,void 0);for(var s in e.tag.eventTrackers)(e.tag.eventTrackers[s]||[]).forEach(function(e){t._addEventPixel(s,e.url,void 0,void 0,e.type)})}},{key:"_fetch",value:function(e,t,i,s){var n=this,r=cmTag.$||r;r.ajax({url:e,beforeSend:function(e){i&&(e.withCredentials=!0)},timeout:1e4,complete:function(e,i,s){e.responseText&&t(null,e.responseText)},error:function(i,r,a){return s?t(r):void n._fetch(e,t,!1,!0)}})}},{key:"parseVastFromUrl",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e&&(e=u.trim(e)),e=this._replaceMacros(e),u.logToBI(this.vpaidLog,"parseVastFromUrl",{url:e},!1,!1),this.vastUrls.push(e);var t=this.store.get("vstprxy");return t?this._fetchVastByProxy(e):void this._fetchVastXhr(e)}},{key:"_fetchVastByProxy",value:function(e){var t=this.store.get("pxyurl"),i=t+e;this._fetchVastXhr(i)}},{key:"_fetchVastXhr",value:function(e){var t=this;(0,m.default)(e,"",this._onTagResponse.bind(this),function(){t._onTagResponseError("vastxhrerror_noflash",e)})}},{key:"parseVastFromString",value:function(e){u.logToBI(this.vpaidLog,"parseVastFromString",{xml:e},!1,!1),this._onTagResponse(e)}},{key:"stop",value:function(){this.stopped=!0,this.vpaidLog=null,this.debugTracker=this.trackingPixels=void 0}},{key:"_extractDuration",value:function(e){var t=this._extractTag("duration",e),i=30;return t&&t.length&&t[0].textContent&&(i=parseInt(t[0].textContent.replace("00:00:",""))),i}},{key:"_extractMediaFile",value:function(e,t,i){if(!this.stopped){for(var s=!1,n=!1,r=this._getFilesTemplate(),a={},o=[],d=0;d<e.length;d++){var l=this._getMediaFileType(e[d]);if(l&&l.url){if((0,y.default)(l.url,this.store)){u.logToBI(this.vpaidLog,"badMediaFile",{url:l.url});continue}o.push(l.url)}switch(l.type){case"vpaid":"javascript"==l.subType&&(s&&"javascript"!=s?n=!0:s="javascript",a.javascript=1,r.vpaid.javascript.push(l));break;case"video":s&&"video"!=s?n=!0:s="video",a.video=1,r.videoFiles[l.subType].push(l);break;default:n=!0,r.mixed.push(l)}}var h={flag:n,vpaid:1===a.javascript,video:1===a.video,mixed:r.mixed.length>0};n&&(this.mixedFilesFlag=h.vpaid&&h.video),n&&this.preferdVpaid&&a.hasOwnProperty(this.preferdVpaid)&&(s=this.preferdVpaid),"video"===s&&(r=this.onVideoWrapperMode(r)),o.length&&u.logToBI(this.vpaidLog,"vastMediaFiles",{urls:o},!1,!1),this.storedMediaFiles=r,this.publishParseTagResults(s,r,t,i)}}},{key:"onVideoWrapperMode",value:function(e){for(var t=null,i=0;i<this.fileTypes.length;i++){var s=e.videoFiles[this.fileTypes[i]];t||s.length>0&&s[0].url&&(t=s[0]);var n=this._chooseBestVideoFile(s,this.bitrate,this.width,this.height);n&&n.url&&e.video.push(n)}return 0===e.video.length&&null!==t&&e.video.push(t),this._sortVideos(e.video),e}},{key:"_sortVideos",value:function(e){var t=this;e.length&&this.pvidtp&&(e=e.sort(function(e,i){return e.url.indexOf(t.pvidtp)!=-1?-1:i.url.indexOf(t.pvidtp)!=-1?1:0}))}},{key:"publishParseTagResults",value:function(e,t,i,s){if(!this.stopped){var n=!1;switch(e){case"javascript":t.vpaid.javascript.length>0&&(n=!0);break;case"video":t.video.length>0&&(n=!0)}n?this._onWrapperFound(e,t,i):(this._onVastError("NoMediaFileAfterSort",s,v.default.mediaFileNotSupported),u.logToBI(this.vpaidLog,"noMediaFileAfterSort",{}))}}},{key:"_onWrapperFound",value:function(e,t,i){u.logToBI(this.vpaidLog,"vpiadWrapperFound",{wrapperMode:e},!1,!1);var s={adParams:i,vpaidFiles:t,extra:{duration:this.duration},trackingPixels:this.trackingPixels},n={price:this.price,icons:this.icons,analysis:this.analysis,creativeExtensions:this.creativeExtensions},r={type:e,handlerOptions:s,vastOptions:n};this.emit(b.default.VastData,r)}},{key:"_chooseBestVideoFile",value:function(e,t,i,s){if(this.stopped)return!1;var n=!1,r=this.store.get("isMobile");if(r&&this.tag.isDirectDemand&&this.store.get("mblmdiadrctdmnd")){var a=e.filter(function(e){return e.url.indexOf("MOBILE")>-1});a.length>0&&(e=a)}for(var o=s/i,d=99999999,l=0;l<e.length;l++)e[l].ratioFactor=Math.abs(o-e[l].ratio),e[l].sizeFactor=Math.abs(i-e[l].width)+Math.abs(s-e[l].height),e[l].rateFactor=Math.abs(t-e[l].bitrate),e[l].weight=0,r&&(e[l].rateFactor*=-1,this._isRtmp(e[l].url)&&(e[l].weight=1e6)),e[l].score=100*e[l].ratioFactor+1*e[l].sizeFactor+e[l].rateFactor+e[l].weight,d>e[l].score&&(d=e[l].score,n=e[l]);return n}},{key:"_isRtmp",value:function(e){return 0===e.indexOf("rtmp://")}},{key:"_getFilesTemplate",value:function(){for(var e={video:[],videoFiles:{},vpaid:{flash:[],javascript:[]},mixed:[]},t=0;t<this.fileTypes.length;t++)e.videoFiles[this.fileTypes[t]]=[];return e}},{key:"_getMediaFileType",value:function(e){if(this.stopped)return{};var t={};t.url=e.textContent,t.url&&(t.url=t.url.trim());var i=parseInt(e.getAttribute("bitrate"));t.bitrate=i?i:0;var s=parseInt(e.getAttribute("width"));t.width=s?s:0;var n=parseInt(e.getAttribute("height"));switch(t.height=n?n:0,t.originalType=e.getAttribute("type"),t.originalType){case"video/x-flv":t.type="video",t.subType="flv";break;case"video/x-ms-wmv":t.type="video",t.subType="wmv";break;case"video/mp4":t.type="video",t.subType="mp4";break;case"video/webm":t.type="video",t.subType="webm";break;case"video/ogg":t.type="video",t.subType="ogg";break;case"video/quicktime":var r=this.store.get("ua");"Safari"!==r.browser.name?(t.originalType="video/mp4",t.type="video",t.subType="mp4"):(t.type="video",t.subType="mov");break;case"application/javascript":case"application/x-javascript":case"text/javascript":t.type="vpaid",t.subType="javascript";break;case"application/x-shockwave-flash":t.type="vpaid",t.subType="flash";break;default:u.logToBI(this.vpaidLog,"unknownMediaFileType",{type:t.originalType}),t.type="unknown",t.subType="unknown"}return t.width&&t.height?t.ratio=t.height/t.width:t.ratio="1:1",t}},{key:"_extractTrackingEvents",value:function(e){if(!this.stopped){this._checkForSpecificEvent("impression",e),this._checkForSpecificEvent("error",e),this._checkForSpecificEvent("clickthru",e),this._checkForSpecificEvent("clickthrough",e),this._checkForSpecificEvent("clicktracking",e);var t=this._extractTag("trackingevents",e);if(t.length>0)for(var i=this._extractTag("tracking",t[0]),s=0;s<i.length;s++){var n=i[s].getAttribute("event");if(n)if("progress"===n.toLowerCase()){var r,a=i[s].getAttribute("offset");a&&(r=a.indexOf("%")===-1?"time":"precentage"),this._addEventPixel(n.toLowerCase(),this._extractTagUrl(i[s]),a,r)}else this._addEventPixel(n.toLowerCase(),this._extractTagUrl(i[s]))}}}},{key:"_extractTagUrl",value:function(e){if(!this.stopped){var t=this._extractTag("url",e),i="";return i=t.length>0?t[0].textContent:e.textContent}}},{key:"_extractTag",value:function(e,t){if(!this.stopped){for(var i=t.childNodes,s=[],n=Array.isArray(e),r=0;r<i.length;r++)if(i[r].tagName){var a=i[r].tagName.toLowerCase(),o=n?e.indexOf(a)>-1:a==e;o?s.push(i[r]):s=s.concat(this._extractTag(e,i[r]))}return s}}},{key:"_extractTagArttibute",value:function(e,t,i){if(!this.stopped){for(var s=t.childNodes,n=[],r=0;r<s.length;r++)if(s[r].tagName){var a=s[r].tagName.toLowerCase();if(a==e){var o=s[r].getAttribute(i);n.push(o)}else n=n.concat(this._extractTagArttibute(e,s[r],i))}return n}}},{key:"_filterVastByRegex",value:function(e){var t=!0,i=this.tag.getValueByKey("rgxdcdd");if(i&&0!==i.length||(i=this.tag.getValueByKey("regx"),t=!1),!i)return!1;var s=new RegExp(t?i.map(function(e){try{return atob(e)}catch(t){return e}}).join("|"):i,"i"),n=s.exec(e);return!(!n||!n.length)}},{key:"_onTagResponse",value:function(e,t){if(!this.stopped){if(this.tagResponsesCounter=++C,this.debugTracker.info("Vast was loaded",{vast:e}),u.logToBI(this.vpaidLog,"tagResponse",{response:e,xhrErrors:t},!0,!1),this._filterVastByRegex(e))return u.logToBI(this.vpaidLog,"vastFilterdByRegex",{regex:this.tag.getValueByKey("regx")}),void this._onVastFilterdByRegexError("VastFilterdByRegex",e,v.default.filterVastByRegex);e=u.replaceMacros(e,this.store);var i=this._parseXml(e);if(this.store.get("addcdatavst")&&i&&i.getElementsByTagName("parsererror").length>0&&(e=u.addCdataSections(e),i=this._parseXml(e)),null==i||this._extractTag(["parsererror"],i).length)return void this._onVastError("ParsingError",e,v.default.vastError);this.vastVersion=this._extractTagArttibute("vast",i,"version").shift()||"1.1",u.logToBI(this.vpaidLog,"vastVersion",{version:this.vastVersion},!1,!1),this.price=this._getPrice(i),this.icons||(this.icons=this._getIcons(i)),this.creativeExtensions=this.creativeExtensions.concat(this._getCreativeExtensions(i)),this.duration=this._extractDuration(i);var s=this._extractTag("mediafiles",i);if(s&&1==s.length&&s[0].childNodes.length){var n=this._extractTag("mediafile",s[0]);0==n.length?(this.debugTracker.error("Vast","No media files!"),this._reportWrappersData(!1),this._onVastError("ParsingError",e,v.default.vastError,"noMediaFile")):(this._extractMediaFileAnalysisToPlayerDAST(i),this._extractTrackingEvents(i),this._extractMediaFile(n,this._getAdParameters(i),e),this._reportWrappersData(!0))}else{var r=this._extractTag("wrapper",i);1==r.length?(1===this.tagResponsesCounter&&this.isReportWrappersOpenTime&&(this.stopper=new k.default,this.stopper.start()),this._extractTrackingEvents(i),this._onWrapper(r[0],e,i)):(this._reportWrappersData(!1),this._onVastError("NoMediaFiles",e,v.default.emptyVast,"noMediaFilesAndWrapper"))}}}},{key:"_reportWrappersData",value:function(e){this.wrappersCount>0&&this.isReportWrappersOpenTime&&this.stopper&&(this.stopper.stop(),this.debugTracker.info("VastParser.js -> vpaidWrapper#"+this.index+" -> _onTagResponse() -> "+(e?"extracting media":"error")+" after "+this.wrappersCount+" wrappers, process took:"+this.stopper.duration()+"ms"),this.emit(b.default.WrappersData,{debugData:"now:"+this.wrappersCount+"!wot:"+this.stopper.duration()+"!scs:"+e+"!"}))}},{key:"_extractMediaFileAnalysisToPlayerDAST",value:function(e,t){this.analysis={vr:this.vastVersion};var i=this._extractTag("ad",e).shift();i&&(this.analysis.aid=this._extractAttributeFromTag(i,"id"));var s=this._extractTag("adsystem",e).shift();s&&(this.analysis.as=this._extractTextFromTag(s),u.logToBI(this.vpaidLog,"adSystem",{system:this.analysis.as},!1,!1));var n=this._extractTag("adtitle",e).shift();n&&(this.analysis.at=this._extractTextFromTag(n)),t&&(this.analysis.wu=t)}},{key:"_extractAttributeFromTag",value:function(e,t){return e.getAttribute(t)||""}},{key:"_extractTextFromTag",value:function(e){return e.textContent||""}},{key:"_getPrice",value:function(e){var t=this._extractTag(["price","pricing"],e).shift(),i=0;if(t){var s=t.textContent;try{isNaN(Number(s))&&s.indexOf("DATA")!=-1&&(i=s.replace(/[^0-9.]/g,"")),i=Number(s),i=i.toFixed(3),i=Number(i)}catch(e){i=0}}return i}},{key:"_decodeType",value:function(e){var t=e.attributes,i={};for(var s in t)t[s].value?i[t[s].name]=t[s].value.toLowerCase():null;return i}},{key:"_getCreativeExtensions",value:function(e){for(var t=[],i=this._extractTag(["creativeextension"],e),s=0;s<i.length;s++){var n={};n.element=i[s].textContent.trim(),n.attributes=this._decodeType(i[s]),t.push(n)}return t}},{key:"_getIcons",value:function(e){for(var t=[],i=this._extractTag(["icon"],e),s=0;s<i.length;s++){var n={},r=this._isIconClicksExists(i[s]);r&&(n.clickThroughUrl=this._decodeIconData(i[s],"iconclickthrough").shift()),n.staticresource=this._decodeIconData(i[s],"staticresource").shift(),n.staticresource||(n.htmlresource=this._decodeIconData(i[s],"htmlresource").shift()),!n.htmlresource&&!n.staticresource||r&&!n.clickThroughUrl||(n.iconViewTracking=this._decodeIconData(i[s],"iconviewtracking"),n.clickTracking=this._decodeIconData(i[s],"iconclicktracking"),n.attributes=this._decodeIconAttributes(i[s]),t.push(n))}return t}},{key:"_isIconClicksExists",value:function(e){var t=this._extractTag(["iconclicks"],e).shift(),i=!!t;return i}},{key:"_decodeIconAttributes",value:function(e){var t=e.attributes,i={};for(var s in t)t[s].value?i[t[s].name]=t[s].value.toLowerCase():null,"width"===t[s].name||"height"===t[s].name?i[t[s].name]+="px":null;return i}},{key:"_decodeIconData",value:function(e,t){try{var i=this._extractTag([t],e),s=i.map(function(e){return e.textContent.trim()});return s}catch(e){return this.debugTracker.warn("Vast","decode Icon "+t,e),""}}},{key:"_onWrapper",value:function(e,t,i){if(!this.stopped){
this.wrappersCount++;var s=this._extractTag("vastadtagurl",e);if(0==s.length&&(s=this._extractTag("vastadtaguri",e),0==s.length))return this._onVastError("WrapperError",t,v.default.vastWrapperError,"EmptyWrapper");var n=this._extractTagUrl(s[0]);if(!n)return this._onVastError("WrapperError",t,v.default.vastWrapperError,"NoUrl");n=u.replaceMacros(n,this.store),0===n.indexOf("http:")?u.reportToSecurePlayerIndex("absolute_vpaid_wrpper",{url:n}):0!==n.indexOf("//")||this.store.get("secured_protocol")||u.reportToSecurePlayerIndex("relative_vpaid_wrpper",{url:n}),this.secureWrapperUrls&&(n=n.replace("http:","https:")),0===this.redirCount&&u.logToBI(this.vpaidLog,"VastWrapper",{type:"wrapper"}),this.redirCount++,this.addWrappersToPlayerDAST&&this._extractMediaFileAnalysisToPlayerDAST(i,n),this.parseVastFromUrl(n)}}},{key:"_getAdParameters",value:function(e){if(!this.stopped){var t="",i=this._extractTag("adparameters",e);return i.length>0&&i[0].textContent&&(t=i[0].textContent),t}}},{key:"_checkForSpecificEvent",value:function(e,t){if(!this.stopped)for(var i=this._extractTag(e,t),s=0;s<i.length;s++)this._addEventPixel(e,this._extractTagUrl(i[s]))}},{key:"_addEventPixel",value:function(e,t,i,s){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"img";this.stopped||void 0!=this.trackingPixels[e]&&t&&(n=n.toLowerCase(),"progress"===e?i&&s&&this._addProgressPixel(t,i,s,n):this.trackingPixels[e].push({pixel:t,method:n}))}},{key:"_addProgressPixel",value:function(e,t,i,s){try{this.trackingPixels.progress.push({pixel:e,offset:"time"===i?u.hmsmToSecondsOnly(t):parseInt(t.replace("%",""))/100,offsetType:i,fired:!1,method:s})}catch(e){}}},{key:"_parseXml",value:function(e){if(this.stopped)return null;var t=null;if(window.DOMParser)try{t=(new DOMParser).parseFromString(e,"text/xml")}catch(e){t=null}else if(window.ActiveXObject)try{t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e)||(t=null)}catch(e){t=null}return t}},{key:"_onTagResponseError",value:function(e,t){this.stopped||(this.debugTracker.error("Vast","Vast url was not loaded!aborting..."),this.emit(b.default.NetworkFail,{type:e}))}},{key:"_onVastError",value:function(e,t,i,s){this.stopped||(this.debugTracker.error("VAST-ERROR",e),u.logToBI(this.vpaidLog,"vastParseError",{reason:s}),this.emit(b.default.ParserError,{type:e,oppsId:i}))}},{key:"_onVastFilterdByRegexError",value:function(e,t,i){this.stopped||(this.debugTracker.error("VAST-ERROR",e),this.emit(b.default.ParserError,{type:e,oppsId:i}))}},{key:"_sampleVastXml",value:function(e){this.stopped}},{key:"destroy",value:function(){this.stopped=!0,this.destroyed=!0,this.vpaidLog=null,this.vastUrls=null,this.tag=null,this.trackingPixels=this.debugTracker=this.fileTypes=void 0,this._onTagResponse=this._onTagResponseError=function(){},this.stopper=null}},{key:"_replaceMacros",value:function(e){return e=e.replace(/\[CACHEBUSTER\]/,Date.now())}},{key:"hasMixedFiles",value:function(){return this.mixedFilesFlag===!0}}]),e}();t.default=E},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(12),d=n(o),l=i(1),u=s(l),h=i(3),c=function(){function e(t,i,s){r(this,e),h.mixin(this),this.store=t,this.tag=i,this.vpaidLog=s,this.vpaidCrawler=t.get(d.default.vpaidCrawler.storeDataKey),this.vpaidCrawler||(this.hjk=t.get(d.default.hjk.storeDataKey),this.vpaidAnalytics=t.get(d.default.vpaidAnalytics.storeDataKey)),this.onVpaidResourceEvent=this._onVpaidResourceEvent.bind(this)}return a(e,[{key:"inject",value:function(e,t){e&&(this.vpaidCrawler?this._injectVpaidCrawler(e):(u.logToBI(this.vpaidLog,"injectResource",{vpaidCrawler:!1}),this._injectHJK(e),this._injectVpaidAnalytics(e,t)))}},{key:"_injectVpaidCrawler",value:function(e){var t=this._getVpaidAnalyticsOptions();this.vpaidCrawler=this.vpaidCrawler.replace('"%%%ANALYTICS_OPTIONS%%%"',u.stringify(t)),t.deepIframes&&(e.contentWindow.vpaidCrawlerFunc=this.vpaidCrawler),this.onResourceMessage=this._onResourceMessage.bind(this),window.addEventListener("message",this.onResourceMessage),u.injectResource(e.contentWindow,this.vpaidCrawler),this.vpaidLog.getVpaidAnalyticsReport=e.contentWindow.analyticsReporter.getReport,this.setVpaidAnalyticsIsVideoUrlPublic=function(t){e.contentWindow.analyticsReporter.isVideoUrlPublic=t}}},{key:"_onResourceMessage",value:function(e){if(!this.stopped&&e.data&&"resourceEvent"===e.data.type){u.logToBI(this.vpaidLog,"resourceEvent",e.data.eventData,!1,!1);var t=e.data.eventData.event;t.indexOf("malicious")>-1?this._onCrawlerHijackAttempt(t,e.data.eventData):"undefinedIframeSrc"===t?this._onUndefinedRelativeIframeSrcError(e.data.eventData.url):"maxNetworkCalls"===t&&this._onNetworkCallsLimitExceeded()}}},{key:"_injectHJK",value:function(e){return this.hjk?(e.contentWindow.hjkFunc=this.hjk,e.contentWindow.ReportHijackAttempt=this._onHijackAttempt.bind(this),void u.injectResource(e.contentWindow,this.hjk)):void u.logToBI(this.vpaidLog,"injectResource",{hjk:!1})}},{key:"_injectVpaidAnalytics",value:function(e,t){if(!this.vpaidAnalytics)return void u.logToBI(this.vpaidLog,"injectResource",{vpaidAnalytics:!1});var i=this._getVpaidAnalyticsOptions();u.injectResource(e.contentWindow,this.vpaidAnalytics),i.deepIframes&&(e.contentWindow.AnalyticsReporter.prototype.vpaidAnalyticsFunc=this.vpaidAnalytics),e.contentWindow.AnalyticsReporter.prototype._onUndefinedRelativeIframeSrcError=this._onUndefinedRelativeIframeSrcError.bind(this),e.contentWindow.onNetworkCallsLimitExceeded=this._onNetworkCallsLimitExceeded.bind(this),new e.contentWindow.AnalyticsReporter(t,function(){},i),this.vpaidLog.getVpaidAnalyticsReport=e.contentWindow.getVpaidAnalyticsReport,e.contentWindow.setIsVideoUrlPublic&&(this.setVpaidAnalyticsIsVideoUrlPublic=e.contentWindow.setIsVideoUrlPublic)}},{key:"_getVpaidAnalyticsOptions",value:function(){var e=this.store.get("anltcsOptions"),t=this.tag.getValueByKey("mxntwrkclls")||0,i=this.store.get("ifrmswghts");return t&&(e.maxNetworkCalls=t),i&&(e.iframesWeights=i),e}},{key:"_onHijackAttempt",value:function(e,t){this._onCrawlerHijackAttempt("maliciousUrl",{url:e,isEarly:t})}},{key:"_onVpaidResourceEvent",value:function(e,t){this.emit("vpaidResourceEvent",{event:e,data:t})}},{key:"_onCrawlerHijackAttempt",value:function(e,t){this._onVpaidResourceEvent("hijackAttempt",{type:e,data:t})}},{key:"_onUndefinedRelativeIframeSrcError",value:function(e){this._onVpaidResourceEvent("undefinedIframeSrc",{url:e})}},{key:"_onNetworkCallsLimitExceeded",value:function(){this._onVpaidResourceEvent("maxNetworkCalls",{maxNetworkCalls:this.tag.getValueByKey("mxntwrkclls")})}},{key:"destroy",value:function(e){this.stopped||(this.stopped=!0,e&&e.contentWindow&&(this.vpaidCrawler?this._destroyVpaidCrawler(e):this._destroyHJKAndAnalytics(e)))}},{key:"_destroyVpaidCrawler",value:function(e){window.removeEventListener("message",this.onResourceMessage),e.contentWindow.analyticsReporter.destroy(),e.contentWindow.destroyCrawler(),this.vpaidLog.getVpaidAnalyticsReport=null}},{key:"_destroyHJKAndAnalytics",value:function(e){e.contentWindow.ReportHijackAttempt=null,e.contentWindow.destroyAnalyticsReporter&&e.contentWindow.destroyAnalyticsReporter()}}]),e}();t.default=c},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n={new:{id:0,name:"new"},adLoaded:{id:1,name:"adLoaded",timeKey:"ldd"},startAd:{id:2,name:"startAd",timeKey:"st"},adImpression:{id:3,name:"adImpression",timeKey:"imp"},adPlay:{id:4,name:"adPlay",timeKey:"pl"},adError:{id:5,name:"adError",timeKey:"err"},adComplete:{id:6,name:"adComplete",timeKey:"cmp"}},r=function(){function e(){i(this,e),this.statuses=n,this.status=this.statuses.new.id,this.timeBetweenStatuses={},this._startTimer()}return s(e,[{key:"setStatus",value:function(e){this.timeBetweenStatuses[e.name]=this._getTime(),this.status=e.id,this._startTimer()}},{key:"get",value:function(){var e={cs:this._getTime()};for(var t in this.timeBetweenStatuses)e[this.statuses[t].timeKey]=this.timeBetweenStatuses[t];return{st:this.status,ts:e}}},{key:"_startTimer",value:function(){this.time=Date.now()}},{key:"_getTime",value:function(){return Date.now()-this.time}}]),e}();e.exports={Statuses:n,VpaidStatus:r}},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(2),d=n(o),l=i(1),u=s(l),h=i(8),c=i(5),p=n(c),v=i(53),f=n(v),m=i(77),g=n(m),y=i(14),_=n(y),b=i(56),w=n(b),k=i(62),A=n(k),T=i(74),C=n(T),E=i(67),P=n(E),V=i(47),I=n(V),x=i(16),S=n(x),D=i(61),O=n(D),M=i(18),B=n(M),R=i(9),F=n(R),L=i(3),W=i(81),j=0,U=0,N=function(){function e(t){var i=this;r(this,e),L.mixin(this),this.mainVpaid=t.mainVpaid,this.store=t.store,this.wflog=t.wflog,this.wflog&&this.wflog.increaseNumberOfConnectedVpaids(),this.isVForceActive=this.store.get("vForce"),this.created=Date.now(),this.loadedEvent="",this.manager=t.manager,this.clickThoughHandler=new P.default(this.store,this.manager.mainVpaid.vpaidHandler.parent),this.index=++j,this.vpaidWrapperIndex="VpaidWrapper"+this.index,this.tagid=t.tagid,this.tag=Object.assign({},t.tag),this.tag.vpaidWrapperData={},this.error="",this.readyInMS=0,this.isMultiAdsActive=this.store.get("mltads"),this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit"),this.isAdErrorBeforeAdLoadedActive=this.store.get("aderrbfradlddopactv"),this.adLoadedFired=!1,this.hijackFired=!1,this.blockBringToFront=this.isMultiVpaidUnit&&this.store.get("blckbrngtofrnt"),this.toggleIframeContentDisplayActive=this.store.get("tglifrmcntndsplyactv"),this.waitForAdPausedBeforeResumeAd=this.store.get("wtfradpsdbfrrsmad");for(var s in F.default)this.tag.itemType===F.default[s].id&&(this.nonVideoVpaid=!0,this.nonVideoVpaidType=F.default[s].type);if(this.defaultTagPrice=this.store.get("dftgprc"),this.moatTrackers=[],this.bfPriority=this.store.get("bfprty"),this.isVerticalVideoSupported=this.tag.getValueByKey("spprtvrtclvd"),this.playerDAST=new w.default(this.store),this.vpaidStatuses=A.default.Statuses,this.vpaidStatus=new A.default.VpaidStatus,this.creatives={},this.stayAlive=!1,this.oldStatus="",this.stopReason="",this.config={},this.vast=[],this.iconsPrograms=[],this.isMobile=this.store.get("isMobile")||!1,this.isIOS=!1,this.isMobile){var n=this.store.get("ua");this.isIOS="iOS"===n.os.name}this.timeoutLengthToAdCompletion=this.tag.getValueByKey((this.isMobile?"mbl":"dsk")+"tmouttoadcmpltn"),this.newCompletionByVideoProgress=this.store.get("q5byprgrss"),this.fireNewCompletionPixel=this.timeoutLengthToAdCompletion>0,this.fireNewCompletionPixel&&(this.timeoutLengthToAdCompletion=u.normalizeMilliseconds(this.timeoutLengthToAdCompletion)),this.timeoutToAdCompletion=null,this.timeoutToAdCompletionStartTime=0,this.newCompletionEventFired=!1,this.globalAdTimeout=null,this.globalAdTimeoutStartTime=0,this.globalAdTimeoutLength=this.tag.getValueByKey("global_ad_timeout"),this.globalAdTimeoutLength&&this.globalAdTimeoutLength>0&&(this.globalAdTimeoutLength=u.normalizeMilliseconds(this.globalAdTimeoutLength)),this.store.get("dbncadvltm")?this.setAdVolume=W(this._setAdVolume,this.store.get("dbncadvltm")):this.setAdVolume=this._setAdVolume,this.tag.advId&&this._pushUniqueAdvIdsToWaterfallLog(),this.tag.moatSampling=this._decideMoat(),this.tag.moatSampling||(this.delayVideoVpaidImpressionForNonMoatRV=this.tag.getValueByKey("dlyimpnonmoatrv")),this.pwov=this.tag.pwov,this.vpaidLog=t.vpaidLog,u.logToBI(this.vpaidLog,"firstWaterfall",{isFromTb:!!this.wflog.get("firstWfFromTb")}),this._copyFromStoreToBi("connectionType",!1);var a=this.store.get("navigatorConnection");if(u.logToBI(this.vpaidLog,"navigatorConnection",{effectiveTypeId:a.effectiveTypeId,typeId:a.typeId},!1,!1),this._wfStats=t.wfStats,this._wfStats.increaseVpaidsCount(),this.oppsID=p.default,this.shouldMuteVid=this.store.get("dskVidMuted")&&!this.store.get("isMobile"),this.opportunityManager=t.opportunityManager,this.vpaidEventToPixelId={},this.vpaidEventToPixelId[this.mainVpaid.vpaidEvents.AdVideoFirstQuartile]=this.oppsID.videoFirstQuartile,this.vpaidEventToPixelId[this.mainVpaid.vpaidEvents.AdVideoMidpoint]=this.oppsID.videoMidpoint,this.vpaidEventToPixelId[this.mainVpaid.vpaidEvents.AdVideoThirdQuartile]=this.oppsID.videoThirdQuartile,this.vpaidEventToPixelId[this.mainVpaid.vpaidEvents.AdVideoComplete]=this.oppsID.videoComplete,this._sendOpp(this.oppsID.tagStarted),this.unloadCallback=function(e){i._sendOpp(i.oppsID.unloadPage)},this.opportunityManager.isRegisterAvailable("unloadCallbacks",this.unloadCallback,!0),this.debugTracker=new d.default(this.vpaidWrapperIndex),this.pixelManager=t.pixelManager,this.vpaidResourcesHandler=new O.default(this.store,this.tag,this.vpaidLog),this.onVpaidResourceEvent=this._onVpaidResourceEvent.bind(this),this.vpaidResourcesHandler.on("vpaidResourceEvent",this.onVpaidResourceEvent),t.creatives)for(var o in t.creatives)this.creatives[o]=t.creatives[o];if(t.config)for(var o in t.config)this.config[o]=t.config[o];return this.adVolume=u.normalizeVolume(parseInt(this.config.VOLUME)?parseInt(this.config.VOLUME):0),this.vpaidEvents=t.vpaidEvents,this.localTarget=this._createLocalTarget(this.config.target),this.vpaidHandlersFactory=new C.default(this.vpaidLog,this.store),this.handlerOptions={applyBypass:!!this.creatives.AFBP,slot:this.localTarget,videoSlotControls:!!this.config.videoSlotControls,videoSlotCanAutoPlay:!!this.config.videoSlotCanAutoPlay,protection:this.config.vpaid_protect_path,tag:this.tag,onReady:this._onHandlerCreated.bind(this),onError:this._onHandlerError.bind(this),playerDAST:this.playerDAST,vpaidResourcesHandler:this.vpaidResourcesHandler,wrapperIndex:this.index,debugTracker:this.debugTracker,extra:{}},this.nonVideoVpaid?void this._createNonVideoVpaid():(this.store.get("vpdcntrcstmcss")&&((this.adTarget||this.localTarget).style.cssText+=this.store.get("vpdcntrcstmcss")),this.isIOS&&(this.clickableTarget=this._createClickableTarget(this.localTarget)),this.localVideo=this._createLocalVideo(this.localTarget),this.handlerOptions.videoSlot=this.localVideo,this.handlerOptions.clickableTarget=this.clickableTarget||null,this.parser=t.vastParser,this.isReportWrappersOpenTime=this.store.get("rprtwrpropntime"),this._createBindedFuncitons(),this._registerToVastParserEvents(),this.adFoundDispatched=!1,this.vpaidHandler=!1,this.stopped=!1,this._startParser(),this.isVForceActive=this.store.get("vForce")||!1,u.logToBI(this.vpaidLog,"vForce",{vForceIsActive:this.isVForceActive},!1,!1),this.reportVideoStatusToUnitInterval=this.store.get("rprtvidsttsintrvl"),this._initTimers(),this.store.get("useVideoControls")&&this.tag.getValueByKey("ad_controls")!==!1&&(this.VideoControls=new _.default(this.localVideo,this.store,this.localTarget,"ad",this),this.VideoControls.setVpaidHandler(this),this.VideoControls.setOnSoundChangeCallback(this._onSoundChange.bind(this)),this.VideoControls.once("unmuteClicked",this._sendFirstUnmuteOpp.bind(this))),this.handelsEarlyAI=this.store.get("erlyai"),this.store.get("debug")&&this._addCopyToClipboardBtn(),this.isReplayable=!1,this._onGotAdIconsBinded=this._onGotAdIcons.bind(this),this._appendVpaidCSS(),this._sendTimeupdateToWrapper=this.tag.getValueByKey("sndvptmrst"),this._reportBuffering=this.tag.getValueByKey("rprtbuffrng"),void(this.delayedQuartilesOpps=[]))}return a(e,[{key:"_createBindedFuncitons",value:function(){this.bindedCreateHandler=this._createHandler.bind(this),this.bindedOnParserError=this._onParserError.bind(this),this.bindedOnNetworkError=this._onNetworkError.bind(this),this.bindedOnBuffering=this._onBuffering.bind(this),this.bindedOnBufferingEnd=this._onBufferingEnd.bind(this)}},{key:"_registerToVastParserEvents",value:function(){this.parser.on(B.default.VastData,this.bindedCreateHandler),this.parser.on(B.default.ParserError,this.bindedOnParserError),this.parser.on(B.default.NetworkFail,this.bindedOnNetworkError),this._registerToVastParserWrapperDataEvent()}},{key:"_unregisterToVastParserEvents",value:function(){this.parser.off(B.default.VastData,this.bindedCreateHandler),this.parser.off(B.default.ParserError,this.bindedOnParserError),this.parser.off(B.default.NetworkFail,this.bindedOnNetworkError),this.isReportWrappersOpenTime&&this.parser.off(B.default.WrappersData,this.bindedOnWrappersData)}},{key:"_registerToVastParserWrapperDataEvent",value:function(){this.isReportWrappersOpenTime&&(this.bindedOnWrappersData=this._onWrappersData.bind(this),this.parser.on(B.default.WrappersData,this.bindedOnWrappersData))}},{key:"_decideMoat",value:function(){if(this.store.get("isInApp")||!this.tag.getValueByKey("moat"))return!1;if(this.store.get("moat"))return!0;var e=this.tag.getValueByKey("mtfctr");return void 0===e||u.getRandomInt(0,100)<=e}},{key:"_createNonVideoVpaid",value:function(){this.vpaidHandler=!1,this.stopped=!1,this.isVForceActive=this.store.get("vForce")||!1,this.isReplayable=!1,this._createHandler({type:this.nonVideoVpaidType,handlerOptions:this.handlerOptions,vastOptions:{}})}},{key:"_addCopyToClipboardBtn",value:function(){var e=this,t=document.createElement("div");t.className="playerSaveButton",t.style.zIndex=U+10,t.innerHTML="SAVE",this.localVideo.parentElement.appendChild(t),t.addEventListener("click",function(){(0,g.default)(e.vpaidLog.toString())})}},{key:"_startParser",value:function(){this.parser.stopped||(this.tag.vast?this.parser.parseVastFromString(this.tag.vast):this.parser.parseVastFromUrl(this.tag.url))}},{key:"_initTimers",value:function(){this._waitForEvent(this.vpaidEvents.AdLoaded,this.tag.getValueByKey("altmot")||this.tag.ADTO,this._onAdLoadedEvent.bind(this),this._onAdLoadedTimeout.bind(this)),this._setTimers()}},{key:"_setTimers",value:function(){var e=this._initTimersStart?Date.now()-this._initTimersStart:0;this._initTimersStart=Date.now(),this._initTillAdstartTimeout(e),this._initAutoKillTimeOut(e)}},{key:"_initTillAdstartTimeout",value:function(e){var t=this;this.tillAdstartTimeout&&clearTimeout(this.tillAdstartTimeout);var i=this.type&&this.store.getByTech("adto",this.type)||this.tag.getValueByKey("adto")||this.tag.ADTO;i-=e,i>0&&(this.tillAdstartTimeout=setTimeout(function(){u.logToBI(t.vpaidLog,"AdStopADTO",{}),t.error="adto",t._firePixel("AdError",{eventData:{iabErrorCode:S.default.timeout}}),t.stop(t.error,t.oppsID.adtoTimeout)},i))}},{key:"_initAutoKillTimeOut",value:function(e){var t=this;this.autoKill&&clearTimeout(this.autoKill);var i=this.type&&this.store.getByTech("vakll",this.type)||this.tag.getValueByKey("vakll")||9e4;i-=e,i>0&&(this.autoKill=setTimeout(function(){u.logToBI(t.vpaidLog,"AutoKill",{timeout:i}),t.error="autoKill",t.emit(t.vpaidEvents.AdVideoComplete,{eventData:t}),t._firePixel("AdError",{eventData:{iabErrorCode:S.default.timeout}}),t.stop(t.error,t.oppsID.globalTimeout)},i))}},{key:"_killTimers",value:function(){if(clearTimeout(this.autoKill),clearTimeout(this.tillAdstartTimeout),clearTimeout(this.adloadedTimeout),this.pendingEvents)for(var e in this.pendingEvents)this.pendingEvents[e].timeoutId!=-1&&clearTimeout(this.pendingEvents[e].timeoutId);this.pendingEvents={}}},{key:"_createClickableTarget",value:function(e){if(!this.stopped){var t=document.createElement("div"),i=this.store.get("width"),s=this.store.get("height");return t.className="cm-ad-click-target",t.style.cssText="width: "+i+"px; height: "+s+"px; cursor: pointer; position: absolute; top: 0px; left: 0px;",t.style.display="",t.setAttribute("width",i),t.setAttribute("height",s),e.appendChild(t),t}}},{key:"_createLocalVideo",value:function(e){var t=this;if(!this.stopped){var i=this.store.get("width"),s=this.store.get("height"),n=this._createVideoElement(e);if(n.className="cm-ad-player",n.style.cssText="width: "+i+"px; height: "+s+"px;",n.style.display="",this.tag.getValueByKey("strch")===!1)n.style.objectFit="contain";else{var r=this.store.get("ua");r&&r.browser&&"IE"===r.browser.name&&u.addClass(n,"ie-black-edges")}return n.volume=0,this.shouldMuteVid&&(n.muted=!0),n.setAttribute("width",i),n.setAttribute("height",s),n.addEventListener("timeupdate",function(e){t._onTimeupdate(n)}),this.config.videoSlotControls&&n.removeAttribute("controls"),this.store.get("addprld")&&n.setAttribute("preload","auto"),e.appendChild(n),n}}},{key:"_createVideoElement",value:function(e){var t=this;return u.createVideoElement(this.store,{target:e,onCanvasUsage:function(){t.playerDAST.set({cnv:!0})}},"ad",u.logToBI.bind(this,this.vpaidLog))}},{key:"_createLocalTarget",value:function(e){if(!this.stopped){var t=document.createElement("div");return this.store.get("noplrcntr")&&(t.id="_cm-css-reset"),t=this._styleElement(t,e),this._createAdTargetElement(t),e.appendChild(this.adTarget?this.adTarget:t),t}}},{key:"_styleElement",value:function(e,t){return this.store.get("noplrcntr")||(e.style.cssText=t.style.cssText),e.style.position="absolute",e.style.overflow="hidden",e.style.top="0",e.style.height="0",e.style.left="0",e.style.zIndex="1",e.style.background="transparent",this.store.get("noplrcntr")?e.className=this.vpaidWrapperIndex:e.className=(t.className?t.className:"")+" "+this.vpaidWrapperIndex,this.isMultiAdsActive&&e.className.indexOf("_cm-video-ad")<0&&(e.className="_cm-video-ad "+e.className),e}},{key:"_createAdTargetElement",value:function(e){(this.isMultiVpaidUnit||this.isMultiAdsActive)&&(u.removeClass(e,"multi-vpaids"),this.adTarget=document.createElement("div"),this.adTarget.className="_cm-ad",this.adTarget.id="_cm-css-reset",this.adTarget.appendChild(e))}},{key:"_onHandlerError",value:function(e,t){u.logToBI(this.vpaidLog,"earlyError",{errMsg:e}),this.loadedEvent||(this.status="error",this.stopped||(this.emit(this.vpaidEvents.AdError,{eventData:e}),"adUnitLoadFailed"===t&&(u.logToBI(this.vpaidLog,"adUnitLoadFailed",{errMsg:e}),this._firePixel("AdError",{eventData:{iabErrorCode:S.default.timeout}}),this.stop("adUnitLoadFailed",p.default.adUnitLoadFailed))))}},{key:"_onHandlerCreated",value:function(){this.stopped||(u.logToBI(this.vpaidLog,"createdVpaidHandler",{}),this._connectToVpaidHandler(),this.vpaidHandler.handshakeVersion("2.0"),u.logToBI(this.vpaidLog,"initAd",{}),this.vpaidHandler.initAd(this.config.width,this.config.height,this.config.viewMode,this.config.bitrate,{AdParameters:this.creatives.AdParameters},{slot:this.localTarget,videoSlot:this.localVideo,videoSlotControls:!!this.config.videoSlotControls,videoSlotCanAutoPlay:!!this.config.videoSlotCanAutoPlay}))}},{key:"_connectToVpaidHandler",value:function(){if(!this.stopped)for(var e in this.vpaidEvents)this.vpaidHandler.subscribe(this._handleVpaidEvents.bind(this,this.vpaidEvents[e]),this.vpaidEvents[e])}},{key:"_adLoadedHandler",value:function(e){var t=this;if(!this.stopped){if(this.adLoadedFired=!0,this.debugTracker.time("[VpaidWrapper"+this.index+"] adLoaded->startAd()"),this.debugTracker.info("RequiredViewability:"+this.tag.requiredViewability),this.loadedEvent=this.loadedEvent+" "+e,this.readyInMS=Date.now()-this.created,this.debugTracker.info("Ad loaded now => pause it srcEvent",e),this._sendOpp(p.default.adLoaded),this.vpaidStatus.setStatus(this.vpaidStatuses.adLoaded),this.status="ready",this.isUnPaused=!0,this.store.emit("vpaidReady",this),this.asyncAdimpression=this.tag.getValueByKey("asyncAdimpression"),this.asyncAdimpression){var i=this.tag.getValueByKey("aaViewability")?"unit::viewability":"unit::conversion";u.logToBI(this.vpaidLog,"asyncAdimpression",{event:i}),this.on(i,function(){u.logToBI(t.vpaidLog,"asyncAdimpressionEvent",{event:i}),t.onAsyncAdmpression()})}if(this.setAdVolume(this.adVolume),this.adFoundDispatched=!0,this.vpaidHandler.checkUnfriendlyIframe&&(this.isUnfriendlyIframe=this.vpaidHandler.checkUnfriendlyIframe()),this.type&&"javascript"==this.type){this.logVpaidFamily(),this.earlySrcVPAID=!1;var s=this._isVideoSrcExist();s&&(this._sendOpp(this.oppsID.VpaidVideoSrcOnAdLoaded),this.earlySrcVPAID=!0,this.isMobile&&this.vpaidHandler.prefetchVideo&&(this.vpaidHandler.prefetchVideo("javascript",s),this.debugTracker.info("_adLoadedHandler() -> javascript vpaidHandler.prefetchVideo() src:"+s)))}this.vpaidResourcesHandler&&this.vpaidResourcesHandler.setVpaidAnalyticsIsVideoUrlPublic&&this.vpaidResourcesHandler.setVpaidAnalyticsIsVideoUrlPublic(""!==this.getVideoUrl());var n=this.store.get("rvfrquesttsemttr");"any"!==n&&this.tag.requiredViewability!==n||this.store.emit(h.outer.EmitQueueStatus)}}},{key:"startAd",value:function(e){var t=this;this.adStarted=!0,this.debugTracker.timeEnd("[VpaidWrapper"+this.index+"] adLoaded->startAd()"),this.setAdVolume(this.adVolume),this._startForceAdVolumeInterval(),this.options=Object.assign(e||{},this.store.get("getAdData")),this.isStarted=!0,this.store.incr("ads_started"),this._sendOpp(this.oppsID.startAd),this.vpaidStatus.setStatus(this.vpaidStatuses.startAd),this._dispatchToMoat("startAd"),u.logToBI(this.vpaidLog,"adOptions",{count:this.options.count,getAdRetries:this.options.getAdRetries,requiredViewability:this.options.requiredViewability},!1,!1),u.logToBI(this.vpaidLog,"startAd",{}),this.earlyAdImpression||this._waitForEvent(this.vpaidEvents.AdImpression,this.store.get("adimptmot"),this._onAdImpressionEvent.bind(this),this._onAdImpressionTimeout.bind(this)),this.isUnPaused?(this.debugTracker.info("startAd()"),this.vpaidHandler.startAd()):(this.debugTracker.info("resumeAd() from startAd()"),this.vpaidHandler.resumeAd()),clearTimeout(this.tillAdstartTimeout),this.working=!0,this.earlyAdImpression&&setTimeout(function(){t._onAdImpression()},500),this.nonVideoVpaid||(this.vpaidHandler.on("activeAdCurrentTime",function(e){t.emit("activeAdCurrentTime",e)}),this.newCompletionByVideoProgress&&this.vpaidHandler.on(h.outer.NewCompletion,function(){t._newCompletionHandler("timerEnded")}),this.tag.getValueByKey("wtchprgrssopp")&&this.tag.isDirectDemand&&this.vpaidHandler.on("watchProgress",function(e){t._onVpaidTimeupdated(e.currentTime)}),this._reportBuffering&&(this.vpaidHandler.on("buffering",this.bindedOnBuffering),this.vpaidHandler.on("bufferingEnded",this.bindedOnBufferingEnd)))}},{key:"_startForceAdVolumeInterval",value:function(){var e=this;if(!this.isMobile&&!this.nonVideoVpaid){var t=this.store.get("frcadvlmtrvl");if(!this.setAdVolumeInterval&&t>0){var i=this.store.get("stpfrcvlevnt")||this.vpaidEvents.AdVideoFirstQuartile;this.vpaidHandler.subscribe(function(){e._stopForceAdVolumeInterval()},i),this.setAdVolumeInterval=setInterval(function(){e.vpaidHandler&&!e.vpaidHandler.stopped?e.setAdVolume(e.adVolume):clearInterval(e.setAdVolumeInterval)},t)}}}},{key:"_stopForceAdVolumeInterval",value:function(){this.isMobile||(clearInterval(this.setAdVolumeInterval),this.setAdVolumeInterval=0)}},{key:"restartAd",value:function(){var e=this;this.isReplayable&&(this.opportunityManager.unpause(),this._sendOpp(this.oppsID.replayAd),this.opportunityManager.pause(),this.pixelManager.pause(),this.working=this.isStarted=this.adStarted=!0,this.store.incr("ads_started"),this._setClickThroughData(),this.vpaidHandler.restartAd(this.getVideoUrl(),this.clickThruUrl),setTimeout(function(){e.bringToFront()}))}},{key:"isReplayableVpaid",value:function(){return this.isVForceActive&&this.tag.getValueByKey("rplvpdactv")&&this.vpaidHandler&&this.vpaidHandler.isReplayable()}},{key:"dontDie",value:function(){this.stayAlive=!0,this.vpaidHandler&&this.vpaidHandler.dontDie&&this.vpaidHandler.dontDie(),this._killTimers()}},{key:"_handleStopped",value:function(e){this.moveToBack(),this.stop(e.type,e.oppType),this.working=!1}},{key:"pauseAd",value:function(){!this.stopped&&this.isUnPaused&&(this.waitForAdPausedBeforeResumeAd&&(this.isUnPaused&&(this.adPausedFired=!1),this.resumeOnAdPaused&&(this.resumeOnAdPaused=!1)),this.pauseAdStartTime=Date.now(),this.working=!1,this.vpaidHandler.pauseAd(),this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout())}},{key:"resumeAd",value:function(){if(!this.stopped&&(this.isMultiAdsActive||!this.store.get("forcePause"))){if(this.waitForAdPausedBeforeResumeAd&&!this.adPausedFired)return void(this.resumeOnAdPaused=!0);this.resumeOnAdPaused=!1,this.working=!0,this.vpaidHandler.resumeAd(),u.addClass(this.localVideo,"cm-ad-player-active"),this.workingVpaid||(this._isDelayedVideoVpaidImpression()&&(this._fireNetworkAdImpression(),this.pixelManager.firePixel("AdVideoStart",this.vpaidLog,null)),this.tag.moatSampling&&this.isVForceActive&&(this._dispatchToMoat("AdImpression",!0,!0),this._dispatchToMoat("AdVideoStart",!0,!0))),this.isMultiVpaidUnit&&(this.isVerticalVideoSupported&&this.isVertical||this.resizeAd(this.store.get("width"),this.store.get("height"))),this.VideoControls&&!this.workingVpaid&&(this.VideoControls.resetAdControls(),this.isMobile&&this.store.emit("playerStatusChanged","ad")),this.store.set("ad_controls",this.tag.getValueByKey("ad_controls")!==!1),this.workingVpaid=!0,this.isVForceActive&&!this.nonVideoVpaid&&(this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this.vpaidHandler&&this.vpaidHandler.handleVpaidContent&&this.vpaidHandler.handleVpaidContent()),this._reportVideoProgress()}}},{key:"_reportVideoProgress",value:function(){var e=this;this.isVideoProgressingInterval||(this.videoProgressing=!0,this.isVideoProgressingInterval=setInterval(function(){e.vpaidHandler.getAdRemainingTime(function(t,i){if(e.isUnPaused){var s=!1;i=parseInt(i),!e.lastRemainingTime||i<e.lastRemainingTime?(e.lastRemainingTime=i,s=!e.videoProgressing):s=e.videoProgressing,s&&(e.videoProgressing=!e.videoProgressing,u.logToBI(e.vpaidLog,"videoProgress",{progress:e.videoProgressing,reaminingTime:i},!1,!1))}})},1e3))}},{key:"_setGlobalAdTimeout",value:function(){var e=this;this.globalAdTimeoutLength&&this.globalAdTimeoutLength>0&&!this.globalAdTimeout&&(this.globalAdTimeoutStartTime=Date.now(),this.globalAdTimeout=setTimeout(function(){e.stopped||e.stop("global_ad_timeout",e.oppsID.globalAdTimeout)},this.globalAdTimeoutLength))}},{key:"_pauseGlobalAdTimeout",value:function(){this.globalAdTimeout&&(this.globalAdTimeout=clearTimeout(this.globalAdTimeout),this.globalAdTimeoutLength-=Date.now()-this.globalAdTimeoutStartTime)}},{key:"_setTimeoutToAdCompletion",value:function(){var e=this,t=this.newCompletionByVideoProgress&&null!=this.vpaidHandler.activeVideoElement;!this.timeoutToAdCompletion&&this.timeoutLengthToAdCompletion>0&&!this.newCompletionEventFired&&!t&&(this.timeoutToAdCompletionStartTime=Date.now(),this.timeoutToAdCompletion=setTimeout(function(){e.stopped||e._newCompletionHandler("timerEnded")},this.timeoutLengthToAdCompletion))}},{key:"_pauseAdTimeoutToCompletion",value:function(){this.timeoutToAdCompletion&&(this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion),this.timeoutLengthToAdCompletion-=Date.now()-this.timeoutToAdCompletionStartTime)}},{key:"_fireNewCompletionEvent",value:function(){this.newCompletionEventFired||(this._sendOpp(this.oppsID.newCompletion),
this.vpaidStatus.setStatus(this.vpaidStatuses.adComplete),this.newCompletionEventFired=!0,this.emit(h.outer.NewCompletion))}},{key:"getVideoUrl",value:function(){return this.videoUrl||(this.videoUrl=this.vpaidHandler.getVideoUrl?this.vpaidHandler.getVideoUrl():""),this.videoUrl}},{key:"_setVideoDataToPlayerDAST",value:function(){var e={vu:this.getVideoUrl()},t=this.localVideo;this.vpaidHandler&&this.vpaidHandler.getVPAIDVideoElement&&(t=this.vpaidHandler.getVPAIDVideoElement()||t),t&&(e.edr=t.duration,e.ewd=parseInt(t.videoWidth),e.eht=parseInt(t.videoHeight)),this.playerDAST.set(e)}},{key:"_logVideoUrlCounter",value:function(){var e=this.getVideoUrl();e||(e="na");var t=this.store.get("videoUrlsCounter")||{};t[e]=t.hasOwnProperty(e)?++t[e]:1,u.logToBI(this.vpaidLog,"videoUrlCounter",{videoUrl:e,counter:t[e]},!1,!1);var i=Object.keys(t);u.logToBI(this.vpaidLog,"sessionUniqueVideoUrls",{counter:i.length,urls:i},!0,!1),this.store.set("videoUrlsCounter",t)}},{key:"_dispatchToMoat",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t!==!1){if(this.isVForceActive){if(("AdImpression"===e||"AdVideoStart"===e)&&!i)return;if("AdPaused"===e&&!this.isFirstAdPaused)return void(this.isFirstAdPaused=!0)}for(var s=0;s<this.moatTrackers.length;s++)this.moatTrackers[s].dispatch({type:e,adVolume:this.adVolume})}}},{key:"_handleVpaidEvents",value:function(e,t){var i=this;if(this.vpaidEvents){if("javascript"===this.type&&(this.tag.getValueByKey("cmpltonstpd")||this._getAdSettingValue("cmpltonstpd")||this.vpaidHandler.completeOnAdStop)){if(e===this.vpaidEvents.AdVideoComplete)return void(this.vpaidHandler&&this.vpaidHandler.setCompletionOnAdStoppedTimeout&&this.vpaidHandler.setCompletionOnAdStoppedTimeout());e===this.vpaidEvents.AdStopped&&(e=this.vpaidEvents.AdVideoComplete)}!this.isFirstVpaidEvent&&this.vpaidHandler._getMediaUrl()&&(this.isFirstVpaidEvent=!0,u.logToBI(this.vpaidLog,"mediaUrl",{url:this.vpaidHandler._getMediaUrl()},!1,!1),this._checkIfGoogle());var s=!0;if(!this.stopped){var n=this._firePixel(e,t);switch(e!==this.vpaidEvents.TimeUpdated&&this.debugTracker.info("VpaidHandler-event",e),this._dispatchToMoat(e,n),this._onEvent(e),e){case this.vpaidEvents.AdLoaded:if(this._adLoadedHandler(e),this.vpaidLog.getVpaidAnalyticsReport){var r=this.vpaidLog.getVpaidAnalyticsReport();u.logToBI(this.vpaidLog,"vpaidAnalyticsUntilAdloaded",r)}this.vpaidHandler.getAdIcons&&this.vpaidHandler.getAdIcons(this._onGotAdIconsBinded);break;case this.vpaidEvents.AdImpression:if(this.store.emit("playContentAfterFirstAd"),this._setVideoDataToPlayerDAST(),s=this._onAdImpression(e),this._pushConversionDataToWaterfallLog(),this._logVideoUrlCounter(),this._handleVerticalAd(parseInt(this.store.get("width")),parseInt(this.store.get("height"))),this.earlyAdImpression)return;this.isVForceActive||(this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this.vpaidHandler&&this.vpaidHandler.handleVpaidContent&&this.vpaidHandler.handleVpaidContent());break;case this.vpaidEvents.AdVideoStart:this.setAdVolume(this.adVolume),this.adFoundDispatched||(this.adFoundDispatched=!0,this.emit(this.vpaidEvents.AdFound)),this.isUnPaused=!0,this.debugTracker.info("_handleVpaidEvents() -> AdStarted || AdVideoStart -> this.isUnPaused = false");break;case this.vpaidEvents.AdSkipped:this._handleStopped({type:e,oppType:this.oppsID.adSkiped}),this.adStoppedHandler(e);break;case this.vpaidEvents.AdStopped:this.adStoppedHandler(e),this._handleStopped({type:e});break;case this.vpaidEvents.AdLog:this.debugTracker.info("VpaidHandler-Log",arguments);break;case this.vpaidEvents.AdError:this.vpaidStatus.setStatus(this.vpaidStatuses.adError);var a=this.oppsID.adError;this.isAdErrorBeforeAdLoadedActive&&!this.adLoadedFired&&(a=this.oppsID.adErrorBeforeLoad),"video"===this.type?this.stop("Mp4AdError",a):this.stop("AdError",a,t);break;case this.vpaidEvents.SoundViolation:this.store.get("sndvltopp")&&!this.alreadySentSoundViolation&&(this.alreadySentSoundViolation=!0,this._sendOpp(this.oppsID.soundViolation));break;case this.vpaidEvents.AdPaused:this.pauseAdStartTime=void 0,this.adPausedFired=!0,this.waitForAdPausedBeforeResumeAd&&this.resumeOnAdPaused&&this.resumeAd(),this.isUnPaused=!1,this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout();break;case this.vpaidEvents.AdClickThru:t=this._adClickThroughData(t),this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout();break;case this.vpaidEvents.AdPlaying:this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this._fireAdPlaying();case this.vpaidEvents.AdStarted:this.isUnPaused=!0;break;case this.vpaidEvents.AdVolumeChange:t&&t.eventData&&t.eventData.volume&&(this.adVolume=u.normalizeVolume(t.eventData.volume),this._dispatchToMoat(e,this.hadImpression===!0));break;case this.vpaidEvents.TimeUpdated:u.logToBI(this.vpaidLog,"videoTicking",{time:t.eventData.time}),this._onVpaidTimeupdated(t.eventData.time);break;case this.vpaidEvents.BlockingTagPassback:this._sendOpp(this.oppsID.blockingTagPassback);break;case this.vpaidEvents.SlowConnection:this._sendOpp(this.oppsID.slowConnection)}this.emit(e,{type:e,data:t});var o=this.nonVideoVpaid?0:this.localVideo.currentTime,d=["AdDurationChange","AdSizeChange","AdLinearChange","AdLog","AdSkippableStateChange","AdExpandedChange","AdInteraction","AdUserClose","AdSkipped","Progress","AdVolumeChange"];if(d.indexOf(e)===-1&&u.logToBI(this.vpaidLog,"event_"+e,{isViewable:!document.hidden,vidCurrentime:o,eventDataStr:t?u.stringify(t.eventData):null}),n&&this.vpaidEventToPixelId.hasOwnProperty(e)&&(this.hadImpression?this._sendOpp(this.vpaidEventToPixelId[e]):this.delayedQuartilesOpps.push(this.vpaidEventToPixelId[e])),this.vpaidEvents)if(e===this.vpaidEvents.AdClickThru)this.clickThruUrl=t&&t.eventData?t.eventData.url:"",this.clickThoughHandler.invokeClick(t.eventData);else if(e==this.vpaidEvents.AdVideoComplete){if(this.adCompleted=!0,this._newCompletionHandler(this.vpaidEvents.AdVideoComplete,n),this.tag.singleAd&&!this.isVForceActive&&this.store.emit("closePlayer"),this.stayAlive)return this.globalAdTimeout&&(this.globalAdTimeout=clearTimeout(this.globalAdTimeout)),void this.emit("end");this.vpaidHandler.stopAd(),setTimeout(function(){i.working=!1,i.workingVpaid=!1,i.stop("AdVideoComplete"),i.status="stopped"},2)}this.manager&&s&&this.manager.trigger(e,this,t?t.eventData:null)}}}},{key:"_onVpaidTimeupdated",value:function(e){this._sendOpp(this.oppsID.vpaidProgress,{sdid:e})}},{key:"_onGotAdIcons",value:function(e,t){u.logToBI(this.vpaidLog,"ad_choices",{vpaid:{error:e,result:t}},!1,!1)}},{key:"_newCompletionHandler",value:function(e,t){if(!this.newCompletionEventFired&&(this.timeoutToAdCompletion||this.fireNewCompletionPixel||this.newCompletionByVideoProgress)){if(this.timeoutToAdCompletion&&(this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion)),this._validateNewCompletionFiring(e,t))return void this._fireNewCompletionEvent();u.logToBI(this.vpaidLog,"fireNewCompletionPrevented",{reason:e},!1,!1)}}},{key:"_validateNewCompletionFiring",value:function(e,t){return e===this.vpaidEvents.AdVideoComplete?t&&this.opportunityManager.alreadySent(this.tag,this.oppsID.videoComplete):"timerEnded"===e}},{key:"_setClickThroughData",value:function(){this.clickThruUrl=this.clickThruUrl||this.pixelManager.getClickThruUrl()}},{key:"_adClickThroughData",value:function(e){if(e&&e.eventData&&e.eventData.url)return e;var t=this.pixelManager.getClickThruUrl();if(t){var i={url:t};e?e.eventData=Object.assign(e.eventData||{},i):e={eventData:i}}return e}},{key:"_checkIfGoogle",value:function(){var e=this.localTarget.querySelector("iframe");if(e){var t=u.domIframeIterator(e,this.store.get("debug"));for(this.isGoogleIframe=!1;!this.isGoogleIframe&&t.hasNext();)this._isGoogleIframe(t.current)&&(this.isGoogleIframe=!0)}}},{key:"_isGoogleIframe",value:function(e){return e&&e.src.indexOf("imasdk.googleapis.com")>-1&&e.src.indexOf("bridge")>-1}},{key:"_onAdImpression",value:function(){var e=!0,t=this.store.get("rstmrai");if(this.fireViewTracking&&this.fireViewTracking(),t&&this._killTimers(),!this.adStarted&&this.handelsEarlyAI)return this.earlyAdImpression=!0,this.isVForceActive&&this.pauseAd(),this.isUnPaused=!1,u.logToBI(this.vpaidLog,"earlyAdImpression",{early:!0}),clearTimeout(this.tillAdstartTimeout),!(this.tag.getValueByKey("prvnterlyadimpopp")||this.adSettings&&this.adSettings.prvnterlyadimpopp||(this._fireAdImpression(),1));if(this.hadImpression)e=!1;else{var i=this.store.get("conversionsCount")+1;this.store.set("conversionsCount",i),u.logToBI(this.vpaidLog,"success",{count:i},!0,!1),this.setAdVolume(this.adVolume),this.emit(this.vpaidEvents.AdImpression),this._fireAdImpression(),this.adImpInMS=Date.now()-this.created,this.hadImpression=!0,this._wfStats.increaseSuccess(),this.vpaidHandler&&this.vpaidHandler.logVideoUrl&&this.vpaidHandler.logVideoUrl(),this.vpaidHandler&&!this.vpaidHandler.activeVideoElement&&this._sendOpp(this.oppsID.unfriendlyVideo),this.isReplayable=this.isReplayableVpaid(),u.logToBI(this.vpaidLog,"restartAd",{isReplayable:this.isReplayable},!1,!1),this.playerDAST.onImpression()}return this.earlyAdImpression&&this.manager&&this.manager.trigger("AdImpression",this,null),e}},{key:"_firePixel",value:function(e,t){if("AdVideoComplete"===e&&!this.hadImpression||e===this.vpaidEvents.AdImpression&&this.hadImpression||this.asyncAdimpression)return!0;if(this._isDelayedVideoVpaidImpression()){if("AdImpression"===e||"AdVideoStart"===e)return!1;if("AdPaused"===e&&!this.ignoredFirstAdPausedPixel)return this.ignoredFirstAdPausedPixel=!0,!0}return this.pixelManager.firePixel(e,this.vpaidLog,t)}},{key:"_fireAdImpression",value:function(e){if(!this.adimpFired){if(this._isDelayedVideoVpaidImpression())return void this.vpaidStatus.setStatus(this.vpaidStatuses.adImpression);this.asyncAdimpression&&!e||(u.logToBI(this.vpaidLog,"fireAsyncAdimpression",{end:!0}),this._fireNetworkAdImpression()),this.vpaidStatus.setStatus(this.vpaidStatuses.adImpression)}}},{key:"_isDelayedVideoVpaidImpression",value:function(){return!("video"!==this.type||!this.isVForceActive||!this.tag.moatSampling&&"any"!==this.delayVideoVpaidImpressionForNonMoatRV&&this.tag.requiredViewability!=this.delayVideoVpaidImpressionForNonMoatRV)}},{key:"_fireNetworkAdImpression",value:function(){for(this._sendOpp(this.oppsID.tagImpression),this.pixelManager.firePixel(this.vpaidEvents.AdImpression,this.vpaidLog),this.adimpFired=!0,this.store.get("isFirstImpression")&&(this.store.set("isFirstImpression",!1),this.fire99());this.delayedQuartilesOpps&&this.delayedQuartilesOpps.length;)this._sendOpp(this.delayedQuartilesOpps.shift())}},{key:"_fireAdPlaying",value:function(){!this.adPlayingFired&&this.hadImpression&&this.workingVpaid&&(this.adPlayingFired=!0,this._sendOpp(this.oppsID.adPlaying),this.vpaidStatus.setStatus(this.vpaidStatuses.adPlay))}},{key:"onAsyncAdmpression",value:function(){u.logToBI(this.vpaidLog,"fireAsyncAdimpression",{start:!0}),this._fireAdImpression(!0)}},{key:"adStoppedHandler",value:function(e){var t=this;this.stop(),setTimeout(function(){t._cleanVpaid()},1e4)}},{key:"_setAdVolume",value:function(e,t){this.stopped||this.nonVideoVpaid||(e=u.normalizeVolume(e),this.adVolume=e,this.shouldMuteVid&&(this.localVideo.volume=e,this.localVideo.muted=0===e),this.adVolume>0&&this.setAdVolumeInterval&&this._stopForceAdVolumeInterval(),this.store.get("frcmtfrms")&&this._setVolumeInIframes(this.localTarget.getElementsByTagName("iframe"),e),this.vpaidHandler&&(this.vpaidHandler.setAdVolume(e,t),this.vpaidHandler.callIMAApi&&this.vpaidHandler.callIMAApi("volume",e)))}},{key:"_setVolumeInIframes",value:function(e,t){var i=this;u.DOMIterator(e[0],"iframe",function(e){e.forEach(function(e){i._overideVolumeInIframe(e),e.setAttribute("tbvol",t),e.volume=t,i.shouldMuteVid&&(e.muted=0===t)})},"video",this.store.get("debug"))}},{key:"_overideVolumeInIframe",value:function(e){if(!e||!e.sv){var t=this;e.sv=!0,e.addEventListener("volumechange",function(){e.volume!==parseFloat(this.getAttribute("tbvol"))?(e.volume=0,t.emit(t.vpaidEvents.SoundViolation,{})):e.volume=t.adVolume})}}},{key:"_onParserError",value:function(e){this.stopped||(this.status="error",this.error=e.type||"",this.isPlaying=!1,u.logToBI(this.vpaidLog,"AdError",{errType:e.type,handlerType:e.handlerType,isPraserError:!0}),this.parser&&this.parser.trackingPixels&&this.pixelManager.loadPixelData(this.parser.trackingPixels),this.stop(this.error,e.oppsId))}},{key:"_onNetworkError",value:function(e){this.stopped||(this.status="error",this.error=e?"xhrStatuses_"+e:"",this.isPlaying=!1,this.stop(this.error,p.default.networkError))}},{key:"_updateAdVideoDurationOnVideoControls",value:function(e){this.VideoControls&&this.VideoControls.setState({vidDuration:e,vidCurrentTime:0})}},{key:"_getMediaType",value:function(){return"video"===this.type?1:"javascript"===this.type?2:"adx"===this.type?5:void 0}},{key:"_createHandler",value:function(e){if(!this.stopped)return this.setVastPrice(e.vastOptions.price),this.setVastIcons(e.vastOptions.icons||[]),this.setExternalScripts(e.vastOptions.creativeExtensions||[]),this.playerDAST.set({vdr:e.handlerOptions.extra.duration}),this.playerDAST.addWrapper(e.vastOptions.analysis||[]),this.handlerOptions.adParams=e.handlerOptions.adParams,this.handlerOptions.vpaidFiles=e.handlerOptions.vpaidFiles,this.handlerOptions.extra.duration=e.handlerOptions.extra.duration,this.handlerOptions.trackingPixels=e.handlerOptions.trackingPixels,this.nonVideoVpaid||(this.vpaidLog.setVastWrapperCount(this.parser.wrappersCount),this._setTimers(),this.creatives.AdParameters=this.handlerOptions.adParams,this.handlerOptions.adSettings=this._getAdSettings(),this.adSettings&&this.adSettings.hasOwnProperty("wtfradpsdbfrrsmad")&&this.adSettings.wtfradpsdbfrrsmad===!0&&(this.waitForAdPausedBeforeResumeAd=!0)),this.vpaidHandler=this.vpaidHandlersFactory.create(e.type,this.handlerOptions),this.vpaidHandler?void(this.nonVideoVpaid||(this.type=e.type,this.store.emit(h.outer.EmitQueueStatus),this.tag.vpaidWrapperData.mediatype=this._getMediaType(),this.debugTracker.info("ParserResponded["+this.type+"-"+(this.isMobile?"mob":"desk")+"]",this.handlerOptions.vpaidFiles),this.pixelManager.loadPixelData(this.handlerOptions.trackingPixels),this._setClickThroughData(),this._updateAdVideoDurationOnVideoControls(this.handlerOptions.extra.duration),this.vpaidHandler.removeClickableTarget(),this._createMoatTracker())):void this._onParserError({type:"handlerCreatingFail",handlerType:e.type,oppsId:this.oppsID.mediaFileNotSupported})}},{key:"_createMoatTracker",value:function(e){var t=this.moatTrackersCreativeExtensions||[];this.tag.moatSampling&&t.push(void 0);for(var i=0;i<t.length;i++)this.moatTrackers.push(new f.default({moatTag:t[i],container:this.vpaidHandler.getDOMContainer(),tag:this.tag,moatPartnerCode:this.tag.getValueByKey("moatPartnerCode"),duration:this.vpaidHandler.getAdDuration(),url:this.vpaidHandler.mediaFiles[0].url,store:this.store,vpaidLog:this.vpaidLog,playerDast:this.playerDAST.get(),debugTracker:this.debugTracker}));this._extractWinningPrice()}},{key:"_getAdSettings",value:function(e){return this.adSettings=this.store.getByAdInline(this.playerDAST.getWrappers())||{},Object.keys(this.adSettings).length>0&&u.logToBI(this.vpaidLog,"adSettings",this.adSettings,!0,!1),this.adSettings}},{key:"_cleanIframe",value:function(){var e=this.localTarget.querySelectorAll("iframe");this._clearIframe(e&&e.length?e[0]:null)}},{key:"_cleanVpaid",value:function(){if(!(this.clean||this.stayAlive&&this.isReplayable)){this.clean=!0,this.vpaidLog&&(this.vpaidLog.saveToDb(),this.vpaidLog.getVpaidAnalyticsReport=void 0),this.wflog&&(this.wflog.complete(),this.wflog=void 0),this.pixelManager&&this.pixelManager.destroy(),this.localTarget&&(this.localVideo&&this.localVideo.parentElement&&this.localTarget.removeChild(this.localVideo),this._cleanIframe(),this.localTarget.parentNode.removeChild(this.localTarget)),this.adTarget&&this.adTarget.parentNode&&this.adTarget.parentNode.removeChild(this.adTarget),this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion),this.globalAdTimeout=clearTimeout(this.globalAdTimeout),this._killTimers(),this.nonVideoVpaid||(this._unregisterToVastParserEvents(),this.parser.destroy()),this._reportBuffering&&this.vpaidHandler&&(this.vpaidHandler.off("buffering",this.bindedOnBuffering),this.vpaidHandler.off("bufferingEnded",this.bindedOnBufferingEnd));for(var e=0;e<this.moatTrackers.length;e++)this.moatTrackers[e].dispose();this.creativeExtensionsHandler&&(this.creativeExtensionsHandler.off("externalMoat",this.pushExternalMoatTracker),this.creativeExtensionsHandler.destroy()),this.status="stopped",this.working=!1,this.VideoControls&&this.VideoControls.destroy(),this.playerDAST&&this.playerDAST.destroy(),this.vpaidHandlersFactory&&this.vpaidHandlersFactory.destroy(),this.store&&(this._bindedOnAdLoadVideoThrottleDelayEnd&&(this.store.off(this.onThrottleEndEventName,this._bindedOnAdLoadVideoThrottleDelayEnd),this._bindedOnAdLoadVideoThrottleDelayEnd=void 0),this._bindedOnRemovedFromVideoThrottleListeners&&(this.store.off(this.onRemovedFromThrottleListenersEventName,this._bindedOnRemovedFromVideoThrottleListeners),this._bindedOnRemovedFromVideoThrottleListeners=void 0)),this.isVideoProgressingInterval&&(this.isVideoProgressingInterval=clearInterval(this.isVideoProgressingInterval)),this.creatives=this.vpaidLog=this.parser=this.debugTracker=this.manager=this.tag=this.vast=this.pixelManager=this.config=this.vpaidEvents=this.localTarget=this.vpaidHandler=this.store=this._wfStats=this.localVideo=this.VideoControls=this.adSettings=this.creativeExtensionsHandler=this.moatTrackers=this.moatTrackersCreativeExtensions=void 0,this.isPlaying=!1,window.setTimeout(this.onAfterStop,0),this.emit("vpaidCleaned")}}},{key:"_clearIframe",value:function(e){e&&(u.DOMIterator(e,"iframe",function(e){var t=cmTag.$;e.forEach(function(e){t(e).remove()})},"*",this.store.get("debug")),e&&e.parentNode.removeChild(e))}},{key:"bringToFront",value:function(){if(this.localTarget&&!this.blockBringToFront){var e=this.store.get("height");this.localTarget.style.display="block",this.localTarget.style.height=e+"px";var t=U++ +99;this.localTarget.style.zIndex=t,this.clickableTarget&&(this.clickableTarget.style.zIndex=t),this.vpaidHandler&&(this.vpaidHandler.zIndex=t),this.VideoControls&&this.VideoControls.setState({isVisible:!0}),this.toggleIframeContentDisplay("hide")}}},{key:"moveToBack",value:function(){this.localTarget&&(this.localTarget.style.zIndex=0,this.clickableTarget&&(this.clickableTarget.style.zIndex=0))}},{key:"subscribe",value:function(e,t){this.stopped||this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){this.vpaidEvents&&this.vpaidEvents[t]&&(e?this.off(t,e):this.off(t))}},{key:"stop",value:function(e,t,i){var s=this;if(!e&&this.pixelManager.getState()===this.vpaidEvents.AdVideoThirdQuartile&&!this.adCompleted)return u.logToBI(this.vpaidLog,"earlyAdStopped",{early:!0},!0,!1),void this._handleVpaidEvents(this.vpaidEvents.AdVideoComplete,{});if(!("global_ad_timeout"!==e&&"undefinedIframeSrc"!==e&&this.stayAlive&&this.isReplayable||this.stopped)){if(this.opportunityManager.isRegisterAvailable("unloadCallbacks",this.unloadCallback,!1),e&&"hijackAttempt"!==e&&(i&&i.eventData?u.logToBI(this.vpaidLog,e,{eventDataStr:u.stringify(i.eventData),status:this.status}):u.logToBI(this.vpaidLog,e,{status:this.status})),this._stopForceAdVolumeInterval(),!this.hadImpression){var n=this.store.get("failsCount")+1;this.store.set("failsCount",n),u.logToBI(this.vpaidLog,"fails",{count:n},!0,!1)}this._wfStats&&(this.hadImpression||this._wfStats.increaseFailure(),u.logToBI(this.vpaidLog,"wfStats",{data:this._wfStats.getData()},!1,!1)),this.isStarted&&this.store.decr("ads_started"),this.stopReason=e,this.oldStatus+=this.status,this.isPlaying=!1,void 0!==t&&this._sendOpp(t,i),"NoMediaFileAfterSort"===e&&t===this.oppsID.mediaFileNotSupported&&this._firePixel("AdError",{eventData:{iabErrorCode:S.default.mediaFileNotSupported}}),"playerClosed"===e&&this.hadImpression&&this.pixelManager.firePixel("close",this.vpaidLog,{}),this.stopped=!0,this.vpaidHandler&&(this.vpaidHandler.onAfterStop=this._cleanVpaid.bind(this),this.vpaidHandler.stopAd()),this.emit("end"),this.store.emit("vpaidEnded",this),setTimeout(function(){s._cleanVpaid()},2),"global_ad_timeout"===e&&(this.isReplayable=!1,this.isVForceActive||this.store.emit("hideAdPlayer"))}}},{key:"callVpaidMethod",value:function(e,t,i){if(!this.stopped){if(this.vpaidHandler&&this.vpaidHandler.callIMAApi&&("pauseAd"!=e&&"resumeAd"!=e||this.vpaidHandler.callIMAApi(e)),"resizeAd"!==e&&u.logToBI(this.vpaidLog,"vpaidApi_"+e,{}),"setAdVolume"==e&&(this.adVolume=u.normalizeVolume(t[0])),"pauseAd"==e&&(this.isUnPaused=!1),"resizeAd"!=e||this.nonVideoVpaid||this._resizeContainers(t[0],t[1],t[2]),!this.vpaidHandler||!this.vpaidHandler[e])return i;try{return this.vpaidHandler[e].apply(this.vpaidHandler,t)}catch(e){return i}}}},{key:"_resizeContainers",value:function(e,t,i){this.localVideo.style.width=e+"px",this.localVideo.style.height=t+"px",this.localVideo.setAttribute("width",e),this.localVideo.setAttribute("height",t),this.localTarget.style.width=e+"px",this.localTarget.style.height=t+"px",this.localTarget.setAttribute("width",e),this.localTarget.setAttribute("height",t)}},{key:"onAfterStop",value:function(){}},{key:"_hijackAttempt",value:function(e,t){if("maliciousUrl"===e){if(!this.hijackFired){this.hijackFired=!0,u.logToBI(this.vpaidLog,"hijackAttempt",{type:"url",badUrl:t.url,earlyHijack:!!t.isEarly&&t.isEarly},!1,!1);var i=this.store.get("hjkstp")!==!1;i&&this.stop("hijackAttempt",p.default.hijackAttempt)}}else"maliciousAction"===e&&(this._sendOpp(this.oppsID.blockedActionByHijack),u.logToBI(this.vpaidLog,"hijackAttempt",{type:"action",action:t.action}))}},{key:"_onVpaidResourceEvent",value:function(e){"hijackAttempt"===e.event?this._hijackAttempt(e.data.type,e.data.data):"undefinedIframeSrc"===e.event?(u.logToBI(this.vpaidLog,"undefinedRelativeIframeSrcError",{url:e.data.url}),this.store.get("stpvpdonudfndsrc")&&this.stop("undefinedIframeSrc",p.default.networkError)):"maxNetworkCalls"===e.event&&(u.logToBI(this.vpaidLog,"vpaidAnalyticsCallLimit",{adImpression:this.adimpFired,limitExceeded:!0,maxNetworkCalls:e.data.maxNetworkCalls}),this.adimpFired||this.stop("networkCallsLimitExceeded",p.default.maxNetworkCalls))}},{key:"fire99",value:function(){this._sendOpp(this.oppsID.firstImpression)}},{key:"_onEvent",value:function(e,t){if(this.pendingEvents&&this.pendingEvents.hasOwnProperty(e)){var i=this.pendingEvents[e];i.timeoutId!=-1&&clearTimeout(i.timeoutId),i.cb&&"function"==typeof i.cb&&i.cb(t),delete this.pendingEvents[e]}}},{key:"_waitForEvent",value:function(e,t,i,s){var n=function(){},r=-1,a=this;t>0&&s&&"function"==typeof s&&(r=setTimeout(function(){u.logToBI(this.vpaidLog,"vpaidTimeout_"+e,{}),s(),delete a.pendingEvents[e],r=null,i=n,s=n}.bind(this),t)),this.pendingEvents||(this.pendingEvents={}),this.pendingEvents[e]={cb:i,timeoutId:r}}},{key:"_onAdLoadedTimeout",value:function(){this.error="adloadedTimeout",this._firePixel("AdError",{eventData:{iabErrorCode:S.default.timeout}}),this.stop(this.error,this.oppsID.adloadedTimeout)}},{key:"_onAdLoadedEvent",value:function(){}},{key:"_onAdImpressionTimeout",value:function(){this.error="adImpressionTimeout",this.stop(this.error)}},{key:"_onAdImpressionEvent",value:function(){}},{key:"setVastPrice",value:function(e){this.tag.vpaidWrapperData.vastPrice=e,e>0&&u.logToBI(this.vpaidLog,"vastPrice",{value:e})}},{key:"setExternalScripts",value:function(e){0!==e.length&&(this.pushExternalMoatTracker=this._pushExternalMoatTracker.bind(this),this.creativeExtensionsHandler=new I.default(e,this.localTarget,this.vpaidLog),this.creativeExtensionsHandler.on("externalMoat",this.pushExternalMoatTracker),this.creativeExtensionsHandler.handleExternalScripts())}},{key:"_pushExternalMoatTracker",value:function(e){this.moatTrackersCreativeExtensions=this.moatTrackersCreativeExtensions||[],this.moatTrackersCreativeExtensions.push(e)}},{key:"setVastIcons",value:function(e){var t=this.tag.getValueByKey("fkadchcs");t?(this.hasAdChoices=!0,u.logToBI(this.vpaidLog,"ad_choices",{fakeAdChoices:!0})):(this.tag.vpaidWrapperData.icons=e,this.hasAdChoices=e.length,this.hasAdChoices&&this._addAdChoiceDiv(e))}},{key:"_addAdChoiceDiv",value:function(e){u.logToBI(this.vpaidLog,"ad_choices",{vast:!0});var t=!0,i=!1,s=void 0;try{for(var n,r=e[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var a=n.value;if(a.attributes.program&&this.iconsPrograms.indexOf(a.attributes.program)===-1){this.iconsPrograms.push(a.attributes.program);var o=document.createElement("div");o.className="_cm-ad-choices-player",o.style.zIndex=1,a.attributes.xPosition&&(o.style.left="initial",o.style[a.attributes.xPosition]="13px"),a.attributes.yPosition&&(o.style.top="initial",o.style[a.attributes.yPosition]="16px");var d=document.createElement("a");if(a.clickThroughUrl&&(d.href=a.clickThroughUrl),d.onclick=this._appendOnClick(a),d.target="_blank",d.className="_cm-ad-choices-player-anchor",d.style.width=a.attributes.width||"19px",d.style.height=a.attributes.height||"15px",a.staticresource?d.style.background="#fff url("+a.staticresource+") no-repeat center center":a.htmlresource&&(d.innerHTML+=a.htmlresource),a.iconViewTracking.length){var l=a.iconViewTracking;this.fireViewTracking=function(){setTimeout(function(e){var t=!0,i=!1,s=void 0;try{for(var n,r=e[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var a=n.value;(new Image).src=a}}catch(e){i=!0,s=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw s}}},5e3,l)}}o.appendChild(d),this.localVideo.parentElement.appendChild(o)}}}catch(e){i=!0,s=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw s}}}},{key:"_appendOnClick",value:function(e){return function(){var t=!0,i=!1,s=void 0;try{for(var n,r=e.clickTracking[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var a=n.value;(new Image).src=a}}catch(e){i=!0,s=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw s}}}}},{key:"_copyFromStoreToBi",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.store.get(e)&&u.logToBI(this.vpaidLog,e,this.store.get(e),!1,t)}},{key:"mute",value:function(){this.stopped||(this.vpaidHandler.video&&this.vpaidHandler.video.muteButtonClicked&&this.adVolume>0&&this.vpaidHandler.video.muteButtonClicked(),this.adVolume=0,this.VideoControls&&this.VideoControls.setState({isMuted:!0}))}},{key:"unmute",value:function(){if(!this.stopped&&(this.vpaidHandler.video&&this.vpaidHandler.video.muteButtonClicked&&0===this.adVolume&&this.vpaidHandler.video.muteButtonClicked(),this.adVolume=u.normalizeVolume(this.store.get("dfltvlm")),this.VideoControls)){if(this.store.get("forceMute"))return void(this.adVolume=0);this.VideoControls.setState({isMuted:!1}),this.adVolume=u.normalizeVolume(this.VideoControls.getValueFromControlsState("volume"))}}},{key:"updateStatusesOnGetAd",value:function(e){u.logToBI(this.vpaidLog,"statusesOnGetAd",{status:this.status,hadImpression:!!this.hadImpression,isStarted:!!this.isStarted,requiredViewability:e.requiredViewability})}},{key:"logVpaidFamily",value:function(){var e=[],t=[];if(this.vpaidHandler.adUnit._iframe&&this.vpaidHandler.adUnit._iframe.contentWindow)for(var i=this.vpaidHandler.adUnit._iframe.contentWindow.document.scripts,s=0;s<i.length;s++)if(i[s].src.indexOf("z.moatads.com")>-1&&i[s].src.split("/").length>4&&e.push(i[s].src.split("/")[3]),i[s].src.indexOf("sc.iasds01.com")>-1){var n=i[s].src.match(/EntityId=([^&]*)/);2===n.length&&t.push("ias-"+n[1])}var r=""+this.tag.dp+(e.length>0?e.join("_"):"")+(t.length>0?t.join("_"):"")+(this.isGoogleIframe?"_ggl":"")+(this.isUnfriendlyIframe?"_ui":"");r!==this.tag.dp&&u.logToBI(this.vpaidLog,"vpaidFamily",{family:r})}},{key:"resizeAd",value:function(e,t,i){if(!this.stopped)try{(void 0==e||isNaN(parseInt(e)))&&(e=!1),(void 0==t||isNaN(parseInt(t)))&&(t=!1);var s=0,n=0;if(!e&&!t)return void this.debugTracker.error("resize","No `height` or `width` specified!");if(t&&e)n=this._convertSizeFromNumberToPixels(t),s=this._convertSizeFromNumberToPixels(e);else{var r;i=i&&i.split(":").length>1?i:this.store.get("playerAspectRatio");var a=i.split(":");e?(r=parseInt(a[1])/parseInt(a[0]),s=this._convertSizeFromNumberToPixels(e),n=this._convertSizeFromNumberToPixels(Math.floor(parseFloat(s)*r))):(r=parseInt(a[0])/parseInt(a[1]),n=this._convertSizeFromNumberToPixels(t),s=this._convertSizeFromNumberToPixels(Math.floor(parseFloat(n)*r)))}if(s&&n){var o=parseFloat(s),d=parseFloat(n);this.localTarget.style.width=s,this.localTarget.style.height=n,this.localTarget.setAttribute("width",o),this.localTarget.setAttribute("height",d),this.nonVideoVpaid||(this.localVideo.style.width=s,this.localVideo.style.height=n,this.localVideo.setAttribute("width",o),this.localVideo.setAttribute("height",d)),this.clickableTarget&&(this.clickableTarget.style.width=s,this.clickableTarget.style.height=n,this.clickableTarget.setAttribute("width",o),this.clickableTarget.setAttribute("height",d)),this.isMultiAdsActive&&(!this.isVerticalVideoSupported||d<o?(this.store.set("width",o.toString()),this.store.set("height",d.toString()),this.store.emit("resizeVpaidWrapper",{width:o,height:d})):this.isVertical=!0),this._handleVerticalAd(o,d,i),this.isVForceActive&&this.vpaidHandler.resizeAd(o,d,this.config.viewMode||"normal",i)}this.blockBringToFront&&(this.blockBringToFront=!1,this.bringToFront())}catch(e){this.debugTracker.error("resize","Resizing component failed!")}}},{key:"_handleVerticalAd",value:function(e,t,i){this.localVideo&&this._isVerticalAd(e,t,i)&&(u.addClass(this.localVideo,"vertical-video"),u.removeClass(this.localVideo,"ie-black-edges"))}},{key:"_isVerticalAd",value:function(e,t,i){return!!this.isVerticalVideoSupported&&(t>=e||(i&&i.indexOf(":")>-1?(i=i.split(":"),parseInt(i[1])>=parseInt(i[0])):!(!this.localVideo.videoWidth||!this.localVideo.videoHeight)&&this.localVideo.videoHeight>=this.localVideo.videoWidth))}},{key:"_convertSizeFromNumberToPixels",value:function(e){var t=e+"";return t.search(/px$/g)<0&&(t+="px"),t}},{key:"getCurrentVolume",value:function(){return this.VideoControls?this.VideoControls.getValueFromControlsState("volume"):this.adVolume}},{key:"_onSoundChange",value:function(e){this.vpaidHandler&&this.vpaidHandler.onMuteChanged&&this.vpaidHandler.onMuteChanged(e)}},{key:"_pushConversionDataToWaterfallLog",value:function(){if(this.wflog){var e=this.getVideoUrl();if(e){var t=this.store.get("wfLogUniqueVideoUrls_"+this.wflog.index)||[];t.indexOf(e)<0&&(t.push(e),this.wflog.push("uniqueVideoUrlsCounter",t.length),this.store.set("wfLogUniqueVideoUrls_"+this.wflog.index,t))}this.wflog.push("wfConversionsCounter",this.wflog.get("wfConversionsCounter",0)+1),this.wflog.sendDataOnConversion()}}},{key:"_pushUniqueAdvIdsToWaterfallLog",value:function(){if(this.wflog){var e=this.store.get("wfLogUniqueAdvIds_"+this.wflog.index)||[];e.indexOf(this.tag.advId)<0&&(e.push(this.tag.advId),this.wflog.push("uniqueAdvIdsCounter",e.length),this.store.set("wfLogUniqueAdvIds_"+this.wflog.index,e))}}},{key:"_appendVpaidCSS",value:function(){var e=this.tag.getValueByKey("vpdcss"),t=[];if(void 0!==e){for(var i in e){var s=null;if(s=this.localTarget.className.indexOf(i)>-1?this.localTarget:this.localTarget.querySelectorAll(i)[0])for(var n in e[i])s.style[n]=e[i][n];else t.push("No element matching "+i)}u.logToBI(this.vpaidLog,"appendVpaidCSS",{success:0===t.length,style:u.stringify(e),errors:t.join(",")})}}},{key:"toggleIframeContentDisplay",value:function(e){!this.stopped&&this.isMultiVpaidUnit&&this.toggleIframeContentDisplayActive&&this.vpaidHandler.toggleIframeContentDisplay&&this.vpaidHandler.toggleIframeContentDisplay(e)}},{key:"_sendOpp",value:function(e,t){if(!this.stopped&&this.opportunityManager){var i={};if(this.store.get("erronopp"))switch(e){case this.oppsID.adError:case this.oppsID.adErrorBeforeLoad:i.sdid=u.getIABErrorCode(t);
break;case this.oppsID.adUnitLoadFailed:case this.oppsID.adloadedTimeout:case this.oppsID.adtoTimeout:case this.oppsID.globalTimeout:i.sdid=S.default.timeout;break;case this.oppsID.emptyVast:i.sdid=S.default.schemaValidationError;break;case this.oppsID.mediaFileNotSupported:i.sdid=S.default.mediaFileNotSupported;break;case this.oppsID.wrappersData:i.debugData=t&&t.debugData||""}e===this.oppsID.vpaidProgress&&(i.sdid=t.sdid),e===this.oppsID.tagImpression&&this._isVideoSrcExist()&&this._addBufferingData(i),i.vidCurrentTime=this.localVideo?this.localVideo.currentTime:void 0,this.opportunityManager.send(this.tag,e,this.playerDAST.get(),i)}}},{key:"_addBufferingData",value:function(e){this.localVideo.buffered&&this.localVideo.buffered.length>0&&this.localVideo.buffered.end(0)&&(e.bis=this.localVideo.buffered.end(0))}},{key:"_isVideoSrcExist",value:function(){return this.localVideo&&!this.localVideo.forceCanvas&&this.localVideo.getSrc&&this.localVideo.getSrc()}},{key:"getAdDuration",value:function(){var e=this;isNaN(this.localVideo.duration)?this.vpaidHandler&&this.vpaidHandler.getAdDuration(function(t,i){e._setVideoControlsDuration(i)}):this._setVideoControlsDuration(this.localVideo.duration)}},{key:"_setVideoControlsDuration",value:function(e){this.VideoControls&&this.VideoControls.setState({vidDuration:e})}},{key:"registerToVPAIDVideoTimeupdateEvent",value:function(){var e=this;if(this.vpaidHandler&&this.vpaidHandler.getVPAIDVideoElement){var t=this.vpaidHandler.getVPAIDVideoElement();null!==t&&t.addEventListener("timeupdate",function(i){e._onTimeupdate(t)})}}},{key:"_onTimeupdate",value:function(e){this.workingVpaid&&e.currentTime>0&&this.VideoControls&&this.VideoControls.setState({preventAdTicker:!0,vidDuration:e.duration,vidCurrentTime:e.currentTime})}},{key:"getVpaidStatus",value:function(){return this.vpaidStatus.get()}},{key:"_sendFirstUnmuteOpp",value:function(){this._sendOpp(this.oppsID.adUnmuted)}},{key:"getPrice",value:function(e){var t=this.tag.vpaidWrapperData&&this.tag.vpaidWrapperData.vastPrice?this.tag.vpaidWrapperData.vastPrice:this.tag.price;return t||void 0!==this.defaultTagPrice?e?u.encodeText(t):t:""}},{key:"_getAdSettingValue",value:function(e){return this.adSettings&&this.adSettings.hasOwnProperty(e)?this.adSettings[e]:void 0}},{key:"_extractWinningPrice",value:function(){if(this._getAdSettingValue("extwnprc")){var e=this._getAdSettingValue("wnprcfld"),t=this._getAdSettingValue("blkemptywp"),i=this.pixelManager.extractWinningPrice(e,t);i&&(u.logToBI(this.vpaidLog,"winningPrice",i,!1,!1),this.playerDAST.set({wp:i}))}}},{key:"getVpaidData",value:function(e){if(this.stopped)return{};this.tag.nas&&(this.tag.nas.isClickable=void 0!==this.tag.nas.isClickable?this.tag.nas.isClickable:this._isNativeAdSettingsClickable());var t=this.vpaidHandler.getAdWidth()||this.playerDAST.getByKey(b.DASTKEYSMAP.vastWidth),i=this.vpaidHandler.getAdHeight()||this.playerDAST.getByKey(b.DASTKEYSMAP.vastHeight);return{adjacency:this.tag.adjacencyAd,advId:this.tag.advId,backfill:this.tag.priority===this.bfPriority,brand:this.tag.brand,campaignId:this.tag.campaignId,costModel:this.tag.cstmdl,cpcv:this.tag.isCPCV,creativeId:this.tag.creativeId,dp:this.tag.dp,itemType:this.tag.itemType,lineItem:this.tag.lineItemId,nonVideoVpaid:this.nonVideoVpaid,price:this.getPrice(e),pubId:this.tag.pubId,replayable:this.isReplayable,rv:this.tag.requiredViewability,singleAd:this.tag.singleAd,vpaidStatus:this.vpaidStatus.get(),wfSequence:this.tag.sequenceId,wfTagId:this.tag.wfIndex,adNativeSettings:this.tag.nas,adWidth:t||0,adHeight:i||0,supportVerticalVideo:this.isVerticalVideoSupported,vastClickThruLink:this.clickThruUrl,eventTrackers:this._getUnitEventTrackers(),supportVideoCurrentTimeEvents:!(!this.vpaidHandler||!this.vpaidHandler.activeVideoElement),duration:this.vpaidHandler&&this.vpaidHandler.activeVideoElement?this.vpaidHandler.getActiveVideoElementDuration():null,earlySrcVPAID:this.earlySrcVPAID}}},{key:"_isNativeAdSettingsClickable",value:function(){var e=this.tag.nas.link||this.clickThruUrl;return void 0!==e&&""!==e}},{key:"_getUnitEventTrackers",value:function(){var e=this,t=this.store.get("untetrk")||[],i={};return t.forEach(function(t){var s=e.pixelManager.getPixels(t);s.length>0&&(i[t]=s)}),i}},{key:"setDebugData",value:function(e){this.stopped||(this.tag.vpaidWrapperData.debugData=e)}},{key:"setDebugDataFunc",value:function(e){this.stopped||(this.tag.setDebugDataFunc=e)}},{key:"_onBuffering",value:function(){this.emit("buffering"),this._sendOpp(this.oppsID.buffering)}},{key:"_onBufferingEnd",value:function(){this.emit("bufferingEnded"),this._sendOpp(this.oppsID.bufferingEnded)}},{key:"_onWrappersData",value:function(e){this._sendOpp(this.oppsID.wrappersData,e)}},{key:"skipAd",value:function(){this.stopped||this.vpaidHandler.skipAd()}}]),e}();t.default=N},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),d=i(2),l=n(d),u=i(4),h=(n(u),i(1)),c=s(h),p=i(19),v=(n(p),i(66)),f=n(v),m=i(65),g=n(m),y=i(7),_=s(y),b=i(9),w=(n(b),i(8),i(44)),k=s(w),A=i(10),T=(i(89),-1),C=function(){function e(t){var i=this;a(this,e),this.store=t;var s=this.store.get("waterfallFailsInARow");this.store.set("waterfallFailsInARow",s||0),this.store.set("waterfallSuccessesInARow",0),this.encryptWaterfallResponse=this.store.get("encwfrs"),this.wfv=this.store.get("wfv"),this.requiredViewabilityFactor=this.store.get("rvfctr"),this.defaultTagPrice=this.store.get("dftgprc"),this.fireWaterfallErrorPixels=c.shouldFirePixels(parseInt(this.store.get("frwferrpxls"))),this.fireEmptyWaterfallPassbackPixel=parseInt(this.store.get("frwfpssbckrpxl")),this.updateCMPData=this.store.get("updtcmpbfrwf"),this.lastRun=this.store.get("ltuntwflstrn");var n=this.store.get("drpbletps")||[],r=this.store.get("adTypesToDrop")||[];this.adsToDrop={};for(var o=0;o<n.length;o++)this.adsToDrop[n[o]]=r.indexOf(n[o])>-1;this.creatives={},this.debugTracker=new l.default("WaterfallManager"),this.cachedTags=!1,this.cacheAge=0,this.staticWf=this.store.get("static_schedule"),this.shouldRun=function(){return!i._tbWfResponseExists()},this._runBindedWaterfallTicker=this._runWaterfallTicker.bind(this),this._roundTripAverageDuration=0,this._roundTripsCount=0,this._initDynamicWfsValues(),this.store.get("wf_manual")||this.startNextWfTimeout(),this.store.on("stop",this._stop.bind(this)),this.store.on("pausePlayer",this._stop.bind(this)),this.store.on("queueStatusChanged",this._onQueueStatusChanged.bind(this));var d=this.store.get("wf_dynmc_ps");d&&(this.store.on("contentPaused",this._stop.bind(this)),this.store.on("contentResumed",this.startNextWfTimeout.bind(this))),this.isFirstRun=!0,this.igonreWfWhenHidden=this.store.get("ignrwfhdn"),this.lineitemMaxFails=this.store.get("mxlifls"),this._registerQueueEvent(),this.maxAllowedEmptyWaterfalls=this.store.get("mxemptwf");var u=this.store.get("emptyWaterfallsInARow");this.store.set("emptyWaterfallsInARow",u||0),this.supportNonVideoVpaid=this.store.get("sprtnnvidvpd")&&this.store.get("mltads"),this.store.on("startWf",function(){i.store.set("dlywf",!1),i.runWaterfall("startWf")}),this.wfParamsFromUnit={}}return o(e,[{key:"_shouldDelayWaterfall",value:function(){return this.store.get("dlywf")}},{key:"startNextWfTimeout",value:function(){var e=this;this.wfInterval&&clearTimeout(this.wfInterval),this._calcDynamicWfsValues(),this._delayBetweenWfs>0?this.wfInterval=setTimeout(function(){e._runBindedWaterfallTicker()},this._delayBetweenWfs):this.store.emit("closePlayer")}},{key:"_initDynamicWfsValues",value:function(){this.maxTimeBetweenWaterfalls=this.store.get("mxtmbtwfs"),this.minTimeBetweenWaterfalls=this.store.get("mntmbtwfs"),this.defaultTimeBetweenWaterfalls=this.store.get("time_between_waterfall"),this.timeBetweenWfFunc=this.store.get("tmbtwfs"),"function"!=typeof this.timeBetweenWfFunc&&(this.timeBetweenWfFunc=void 0),this.minTimeBetweenWfFunc=this.store.get("mntmbtwfsf"),"function"!=typeof this.minTimeBetweenWfFunc&&(this.minTimeBetweenWfFunc=void 0),this.defaultMinTimeBetweenWf=this.store.get("mintimwf")||5e3,this.store.set("dynamicWf.lastDelayBetweenWfs",-1),this.store.set("dynamicWf.currentDelayBetweenWfs",-1),this._calcDynamicWfsValues()}},{key:"_calcDynamicWfsValues",value:function(){this._delayBetweenWfs=1e3*this._calcDelayBetweenWf(),this._delayBetweenWfs>0&&(this._minTimeBetweenWf=this._calcMinDelayBetweenWfs()),this._saveDynamicWfsValues()}},{key:"_calcDelayBetweenWf",value:function(){var e=T;if(this.timeBetweenWfFunc)try{e=this.timeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store,!document.hidden)}catch(t){e=this.defaultTimeBetweenWaterfalls}return e>this.maxTimeBetweenWaterfalls?e=T:e<this.minTimeBetweenWaterfalls&&(e=this.minTimeBetweenWaterfalls),e}},{key:"_calcMinDelayBetweenWfs",value:function(){var e=this.defaultMinTimeBetweenWf;if(this.minTimeBetweenWfFunc)try{e=this.minTimeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store,!document.hidden)}catch(t){e=this.defaultMinTimeBetweenWf}return e}},{key:"_saveDynamicWfsValues",value:function(){this.store.set("dynamicWf.lastDelayBetweenWfs",this.store.get("dynamicWf.currentDelayBetweenWfs")),this.store.set("dynamicWf.currentDelayBetweenWfs",this._delayBetweenWfs)}},{key:"_registerQueueEvent",value:function(){var e=this.store.get("run_wf_when_empty");e&&this.store.on("playFromEmptyQueue",this.runWaterfall.bind(this,"queueEmpty"))}},{key:"_isInIdleMode",value:function(){return this.store.get("isIdleMode")}},{key:"_runWaterfallTicker",value:function(){this.startNextWfTimeout(),this.runWaterfall("interval")}},{key:"init",value:function(e,t){this.creatives=e,this.store.set("creatives",e),this.adParams=t,this._loadWaterfallGenerator()}},{key:"_loadWaterfallGenerator",value:function(){var e=this;A.init(this.store.data),A.get("wf-generator",this.store.get("wfgenv"),function(t){e.debugTracker.info("Wf generator v"+e.store.get("wfgenv")+" loaded"),e.wfGenerator=new t(e.store,e.creatives),e.store.set("waterfallIndex",e.wfGenerator.getWfCounter()),e._shouldRunWaterfallOnInit()&&e.runWaterfall("run_wf_on_init")},function(){e.debugTracker.error("Load wf generator","Error while loading from service loader")})}},{key:"_shouldRunWaterfallOnInit",value:function(){return this.store.get("run_wf_on_init")}},{key:"_serveStaticWf",value:function(e){this._getRollType();var t=0;"mid-roll"==this.currentRollType?t=1:"post-roll"==this.currentRollType&&(t=2);var i=new Function("try { return "+this.staticWf[t].ad_parameters+";} catch(e){}")();this._handleWaterfallSuccess(c.stringify(i.waterfall),e)}},{key:"runWaterfall",value:function(e){var t=this;if((this.wfGenerator||this.staticWf)&&!this.passedMaxEmptyWaterfalls()&&!this.store.get("first_look")&&("function"!=typeof this.shouldRun||this.shouldRun())&&!this._shouldDelayWaterfall()&&!this._isInIdleMode()){var i=this,s=(new Date).getTime(),n=this.lastRun?s-this.lastRun:this._minTimeBetweenWf;if(!(n<this._minTimeBetweenWf)){this.lastRun=s;var r=new f.default(this.store);if(this.staticWf)return void setTimeout(function(){t._serveStaticWf(r)},20);if(this._tbWfResponseSuccess(r))return void c.reportByIndex("player_waterfall","firstWfFromTb",{type:"debug",message:"firstWfFromTb",fullPageUrl:this.store.get("fullPageUrl"),player_id:this.store.get("player_id")},this.store);var a=this.store.get("pstflrs")===!0;this.store.get("psthdrs")||"application/json",this.lastRun=s,r.requestTime=Date.now(),r.ignoredLineitems=[],r.push("reason",e),r.push("waterfallIndex",this.wfGenerator.getWfCounter()),r.push("sinceLastWf",n),r.push("queueLength",this.store.get("queueLength")),r.push("vpaidReadyCount",this.store.get("vpaidReadyCount")),r.push("vpaidPendingCount",this.store.get("queueLength")-this.store.get("vpaidReadyCount")),r.push("failsInARow",this.store.get("waterfallFailsInARow")),r.push("successesInARow",this.store.get("waterfallSuccessesInARow")),r.push("lastDelayBetweenWfs",this.store.get("dynamicWf.lastDelayBetweenWfs")),r.push("currentDelayBetweenWfs",this.store.get("dynamicWf.currentDelayBetweenWfs")),r.push("emptyWaterfallsInARow",this.store.get("emptyWaterfallsInARow")),r.push("maxAllowedEmptyWaterfalls",this.maxAllowedEmptyWaterfalls),r.push("encryptedResponse",this.encryptWaterfallResponse),r.push("waterfallVersion",this.wfv),r.push("navigatorConnection",this.store.get("navigatorConnection"));var o=this.wfGenerator.getConsentData(),d=this.wfGenerator.getRboxConsentData();this.updateCMPData&&(r.push("cdbUpdated",!!o.cdbUpdated),r.push("playerConsentData",o),r.push("rboxConsentData",d));var l=function(e,t){i._handleWaterfallError(e,r,t)},u=function(e,t,s){i._handleWaterfallSuccess(e,r,s)},h=this.wfGenerator.generateUrl({roll:this._getRollType(),pubid:this.pubid,tagid:this.tagid,isFirstRun:this.isFirstRun,unitWfParams:this.wfParamsFromUnit});r.push("url",h);var p=c.parseQueryString(h);if(r.push("urlParams",p),r.push("noaop",this.isFirstRun?this.store.get("firstWaterfallNoaop"):this.creatives.NOAOP),h){if(this.adParams&&this.adParams.waterfall)window.setTimeout(this._handleWaterfallSuccess.bind(this,c.stringify(this.adParams.waterfall)),0);else{if(!a)return this.wfGenerator.send({wfUrl:h,postData:"",onSuccess:u,onFail:l}),this.wfGenerator.increaseWfCounter(),this.store.set("waterfallIndex",this.wfGenerator.getWfCounter()),void(this.isFirstRun&&(this.isFirstRun=!1));var v=c.stringify(this.wfGenerator.generatePOSTParams({queueStatus:this.queueStatus,droppedAdTypes:this._getAdTypesToDrop()}));r.push("postData",v),this.wfGenerator.send({wfUrl:h,postData:v,onSuccess:u,onFail:l}),this.isFirstRun&&(this.isFirstRun=!1)}this._incrementWfCounter()}}}}},{key:"_getAdTypesToDrop",value:function(){var e=[];for(var t in this.adsToDrop)this.adsToDrop[t]&&e.push(t);return e}},{key:"passedMaxEmptyWaterfalls",value:function(){return!!this.maxAllowedEmptyWaterfalls&&this.store.get("emptyWaterfallsInARow")>this.maxAllowedEmptyWaterfalls}},{key:"_sendWaterfallResponsePixel",value:function(e){if(this.fireWaterfallErrorPixels){var t=c.createPixelParams(e,this.store);c.sendPixel(t)}}},{key:"_handleWaterfallSuccess",value:function(e,t,i){if(!this.igonreWfWhenHidden){if(this._addRoundTripDuration(),!e)return this.debugTracker.info("runWaterfall","Empty Waterfall!"),void this._updateWaterfallFailure("empty-response",t,i,_.emptyWFResponse);this.encryptWaterfallResponse&&(e=this._decodeText(e));var s=new Function("try { return "+e+";} catch(e){}")();if(!(s&&s.tags&&s.tags.length)){var n=s&&s.tags?"Failed to decode empty server response":"Failed to decode server response!";return this.debugTracker.warn("runWaterfall",n),void this._updateWaterfallFailure("no-tags",t,i,_.noTagsInWFResponse)}this.store.set("emptyWaterfallsInARow",0),this.debugTracker.info("Waterfall number "+(t.index+1)+" received",s.tags,{color:"#D15EFF"}),this.store.set("sessionData",s.sd),s&&s.pixel_piggies&&this._firePiggies(s.pixel_piggies);var a=[],o=!1;for(var d in s.tags){var l=s.tags[d];if(l.url||l.vast){var u,h=l.lp&&l.lp.length>0&&l.lp[0]?l.lp[0]:"",p=this._getPixel(l.pixel)||"",v=c.parseQueryString(p),f=v.cirid,m=v.dast,y=v["vid-dast"],b=void 0,w=c.parseDast(y);if(l.lineItemId||(b=c.parseDast(m)),l.getValueByKey=function(e,t){return this.dsm&&this.dsm.hasOwnProperty(t)?this.dsm[t]:e.get(t)}.bind(l,this.store),l=Object.assign(l,(u={score:-1,waterfallTagId:d,created:(new Date).getTime(),dp:h?h.replace(/http:\/\/|.com|https:\/\/|.com/g,""):"na",dpFull:h||"na",conversionPixels:l.conversionPixels||[],ts:Date.now(),wfIndex:t?t.get("waterfallIndex",-1):this.wfGenerator.getWfCounter(),url:l.url?c.replaceHttpWithHttps(c.replaceMacros(l.url,this.store)):"",vast:l.vast?c.replaceMacros(l.vast,this.store):"",pixel:p,eventTrackers:l.etrk?l.etrk:{},brand:l.brand||"",dsm:l.dsm||{},rollType:this.currentRollType,pubId:this.pubid,tagId:this.tagid,isRon:this.isRon,cstmdl:l.cstmdl||-1,singleAd:1===l.sa,adjacencyAd:1===l.adjac},r(u,void 0!==this.defaultTagPrice&&"price",l.price||this.defaultTagPrice),r(u,f&&"cirid",f),r(u,"dast",m),r(u,"vidDast",y),r(u,"campaignId",w&&w.hasOwnProperty("cipid")?w.cipid:-1),r(u,"lineItem",(l.lineItemId||b&&b.cicmp||"").toString()),r(u,"isDirectDemand",l.advType===k.DIRECT||l.advType===k.PMP_DIRECT),u),this._overrideParamsByDemand(l),this._decodeItemParams(l)),this._shouldDropAd(l))continue;this.requiredViewabilityFactor>0&&!l.requiredViewability&&(l.requiredViewability=this._drawRequiredViewabilityByFactor(l)),this._ignoreLineitem(l.lineItem)?(t.ignoredLineitems.push(l.lineItem),t.push("ignoreLineitems",t.ignoredLineitems),this.store.get(l.lineItem+".failsRow")?this.store.incr(l.lineItem+".failsRow"):this.store.set(l.lineItem+".failsRow",1)):a.push(l),this.store.get(l.lineItem)||this.store.set(l.lineItem,{failsRow:0,tries:0,conversions:0,fails:0}),l.lineItemStats=c.deepClone(this.store.get(l.lineItem))}}a.length>0?(this._pushTagsResponseToWaterfallLog(t,a),s.tags=a,s.data=new g.default(this.store,this.staticWf?1:this.wfGenerator.getWfCounter()),this.onWaterfallSuccess(s,t),t&&(t.push("duration",Date.now()-t.requestTime),t.push("response",e),t.push("tagsCount",a.length),t.push("success",!0),this._sendWfLog(t)),this.store.emit("waterfallData",s),this._logRetry(t,i,!0)):o||(this.debugTracker.error("runWaterfall","Failed to get any tags!"),this._handleWaterfallError("no-clean-tags",t,i))}}},{key:"_updateWaterfallFailure",value:function(e,t,i,s){this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0),this._handleWaterfallError(e,t,i),this._sendWaterfallResponsePixel(s)}},{key:"_handlePassbackTrigger",value:function(e){1===e.get("waterfallIndex")&&(this.store.emit("emptyFirstWaterfall"),e.push("emptyFirstWaterfallPassback",!0),this._sendEmptyFirstWaterfallPassbackPixel())}},{key:"_sendEmptyFirstWaterfallPassbackPixel",value:function(){this.fireEmptyWaterfallPassbackPixel&&c.sendPixel(c.createPixelParams(_.passbackOnEmptyFirstWF,this.store))}},{key:"_shouldDropAd",value:function(e){for(var t in this.adsToDrop)if(this.adsToDrop[t]&&e.hasOwnProperty(t)&&e[t])return!0;return!1}},{key:"_logRetry",value:function(e,t,i){if(e&&t){var s=t.indexOf("rt=1")>-1;if(!s)return;var n=t.match(/prst=(.*?)(&|$)/);e.push("retry",!0),e.push("statusBeforeRetry",n&&n.length>1?n[1]:"0"),e.push("successOnRetry",i)}}},{key:"_drawRequiredViewabilityByFactor",value:function(e){var t=c.getRandomInt(0,100)<=this.requiredViewabilityFactor&&e&&(e.advType===k.OPEN_EXCHANGE_RTB_DSP||e.advType===k.OPEN_EXCHANGE_RTB_SSP);return t&&(e.requiredViewabilityDrawn=!0),t}},{key:"_pushTagsResponseToWaterfallLog",value:function(e,t){e&&t.map(function(t,i){var s=Object.assign({},t);e.push("tagResponse_"+i,c.flattenObject(s))})}},{key:"_overrideParamsByDemand",value:function(e){return this.store.get("ovrtgbydc")?e.getValueByKey("ovrdtag"):{}}},{key:"_sendWfLog",value:function(e){var t={wfRoundTripAverageDuration:this.store.get("performance.wfRoundTripAverageDuration"),performanceMeasurment:this.store.get("performance.performanceMeasurment")};e.push("performance",t),e.push("conversionsCount",this.store.get("conversionsCount")),e.push("unit",{width:this.store.get("width"),height:this.store.get("height")}),this.store.get("vForce")&&e.push("getAdData",this.store.get("getAdData"))}},{key:"_addRoundTripDuration",value:function(){var e=Date.now()-this.lastRun;this._roundTripAverageDuration=parseInt((this._roundTripAverageDuration*this._roundTripsCount+e)/(this._roundTripsCount+1)),this.store.set("waterfall_data.last_duration",e),this.store.set("waterfall_data.average_duration",this._roundTripAverageDuration),this._roundTripsCount++}},{key:"_ignoreLineitem",value:function(e){if(this.lineitemMaxFails>0){var t=this.store.get(e),i=t?t.failsRow:-1;return i>this.lineitemMaxFails}return!1}},{key:"_decodeItemParams",value:function(e){return Object.assign({rpox:this._decodeValue(e.rpox),alfrox:this._decodeValue(e.alfrox),frox:this._decodeValue(e.frox),itemType:e.t},e.ex&&{crId:e.ex.ecrid,stId:e.ex.s,cmpgnId:e.ex.ecid},e.ex&&e.ex.b&&{brand:this.encryptWaterfallResponse?e.ex.b:this._decodeText(e.ex.b)})}},{key:"_decodeValue",value:function(e){return this.encryptWaterfallResponse?e:(2530^e)/1e3}},{key:"_decodeText",value:function(e){for(var t,i=c.cryptoParseBase64(e),s="",n="PlAyER",r=0;r<i.length;r++){t=r%n.length;var a=i[r].charCodeAt(0).toString(10),o=n[t].charCodeAt(0).toString(10),d=String.fromCharCode(a^o);s+=d}return s}},{key:"_firePiggies",value:function(e){var t=this.store.get("fire_piggies");if(t&&!(this.wfGenerator.getWfCounter()>=5))for(var i=0;i<e.length;i++){var s=e[i];if(s.url){var n=c.setUrlPrefix(s.url);try{(new Image).src=n}catch(e){this.debugTracker.error("_fireIframePig - Malformed url!",e)}}}}},{key:"_handleWaterfallError",value:function(e,t,i){this.store.incr("emptyWaterfallsInARow"),this._addRoundTripDuration(),t&&(this._logRetry(t,i,!1),t.push("duration",Date.now()-t.requestTime),t.push("error",e),t.push("success",!1),this._sendWfLog(t)),this.onWaterfallError(e),this._handlePassbackTrigger(t)}},{key:"_getPixel",value:function(e){if(e){var t=new RegExp(/src=[\"|\']([^"]+)[\"|\']/),i=t.exec(e),s=i&&i.length>1&&i[1]?i[1]:e;return s.substring(s.indexOf("//"))}}},{key:"onWaterfallError",value:function(){}},{key:"onWaterfallSuccess",value:function(){}},{key:"SetWaterfallError",value:function(e){this.onWaterfallError=e}},{key:"SetWaterfallSuccess",value:function(e){this.onWaterfallSuccess=e}},{key:"SetShouldRun",value:function(e){this.shouldRun=e||function(){}}},{key:"GetCounter",value:function(){return this.wfGenerator.getWfCounter()}},{key:"_getRollType",value:function(){var e,t=this.store.get("contentSchedule")||{},i=null,s=Object.keys(t)||[];return this.staticWf||1===this.wfGenerator.getWfCounter()?(e=s[0],i=t[e]):s.length>0&&(e=s[1],i=t[e]),this.currentRollType=i?i.roll_type:"",this.pubid=i?i.pubid:0,this.tagid=i?i.tagid:0,i}},{key:"_stop",value:function(){clearTimeout(this.wfInterval)}},{key:"start",value:function(){this.startNextWfTimeout()}},{key:"stop",value:function(){this._stop()}},{key:"_onQueueStatusChanged",value:function(e){var t=function(e){var t=Object.assign({},e);return t.aid=t.cstmdl=t.dp=t.pid=void 0,""===t.br&&(t.br=void 0),t};this.queueStatus={size:e.size,prevItems:e.previousQueue.map(t),items:e.items.map(t)}}},{key:"dropAds",value:function(e){this.adsToDrop.hasOwnProperty(e)&&!this.adsToDrop[e]&&(this.adsToDrop[e]=!0)}},{key:"addWfParameter",value:function(e,t){void 0!==t&&(this.wfParamsFromUnit[e]=encodeURIComponent(t))}},{key:"updateWfParameter",value:function(e,t){this.addWfParameter(e,t)}},{key:"removeWfParameter",value:function(e){this.wfParamsFromUnit[e]&&(this.wfParamsFromUnit[e]=void 0,delete this.wfParamsFromUnit[e])}},{key:"_incrementWfCounter",value:function(){this.wfGenerator.increaseWfCounter(),this.store.set("waterfallIndex",this.wfGenerator.getWfCounter())}},{key:"_tbWfResponseExists",value:function(){return!!this.store.get("firstWfRes")}},{key:"_tbWfResponseSuccess",value:function(e){if(this._tbWfResponseExists())try{return this._handleTbWfResponse(e),!0}catch(e){this.debugTracker.error("tbWaterfallResponse",e)}return!1}},{key:"_handleTbWfResponse",value:function(e){e.push("firstWfFromTb",!0);var t=this.wfGenerator.getWfCounter()-1;e.setWfCounter(t),e.push("waterfallIndex",t),this._handleWaterfallSuccess(this.store.get("firstWfRes"),e),this.store.set("firstWfRes",void 0)}}]),e}();t.default=C},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(1),o=s(a),d=function(){function e(t,i){n(this,e),this.id=Date.now()+"_"+o.generateGuid(20),this.index=i,this.store=t,this.vpaidsCount=0,this.reportedVpaidsCount=0,this.success=0,this.fails=0,this.isSuccessed=!1}return r(e,[{key:"increaseVpaidsCount",value:function(){this.vpaidsCount++}},{key:"increaseSuccess",value:function(){this.success++,this._update()}},{key:"increaseFailure",value:function(){this.fails++,this._update()}},{key:"_update",value:function(){this.reportedVpaidsCount++,this.isSuccessed||(1===this.success?(this.store.incr("waterfallSuccessesInARow"),this.store.set("waterfallFailsInARow",0),this.isSuccessed=!0):this.reportedVpaidsCount===this.vpaidsCount&&(this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0)))}},{key:"getData",value:function(){return{id:this.id,index:this.index,allVpaidsReported:this.vpaidsCount===this.reportedVpaidsCount,wf_sr:this.store.get("waterfallSuccessesInARow"),wf_fr:this.store.get("waterfallFailsInARow")}}}]),e}();t.default=d},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(1),d=s(o),l=0,u=1e4,h=function(){function e(t){var i=this;n(this,e),this.index=l++,this.numberOfConnectedVpaids=0,this.dataChanged=!0,this.store=t,this.created=Date.now(),this.data={_id:d.generateGuid(10),player_id:this.store.get("player_id"),isMobile:this.store.get("isMobile"),created:(new Date).toISOString(),unitType:this.store.get("unit_type"),fullPageUrl:this.store.get("fullPageUrl"),updatesCount:0,taboolaVpaid:this.store.get("istblvpd")},this.sendDataInterval=setInterval(function(){i.dataChanged&&i._sendData()},u)}return a(e,[{key:"push",value:function(e,t){this.data.hasOwnProperty(e)&&!this._hasValueChanged(this.data,e,t)||(this.dataChanged=!0),this.data[e]=t}},{key:"_hasValueChanged",value:function(e,t,i){if("object"!==("undefined"==typeof i?"undefined":r(i)))return e[t]!==i;if(Array.isArray(i)){for(var s=0;s<i.length;s++)if(e[t].indexOf(i[s])<0)return!0;return!1}for(var n in i)if(this._hasValueChanged(this.data[t],n,i[n]))return!0;return!1}},{key:"get",value:function(e,t){return this.data.hasOwnProperty(e)?this.data[e]:t}},{key:"_sendData",value:function(){if(this.data){this.data.updatesCount++;var e=Object.assign({},this.data);d.deletePropsFromObj(e,this.store.get("rmvwflg")),d.reportByIndex("player_waterfall","WfLog",e,this.store),this.dataChanged=!1}}},{key:"sendDataOnConversion",value:function(){var e=this;setTimeout(function(){e._sendData()},2e3)}},{key:"increaseNumberOfConnectedVpaids",value:function(){this.numberOfConnectedVpaids++}},{key:"complete",value:function(){0==--this.numberOfConnectedVpaids&&(this._sendData(),this.data=this.store=void 0,this.sendDataInterval=clearInterval(this.sendDataInterval))}},{key:"setWfCounter",value:function(e){this.index=e,l=e+1}}]),e}();t.default=h},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(1),d=n(o),l=i(2),u=s(l),h=void 0,c=function(){function e(t,i){return r(this,e),h?h:(this.debugTracker=new u.default("ClickThroughHandler"),this.store=t,this.ovaMediaPlayer=i,this.isMultiAdsActive=this.store.get("mltads"),void(h=this))}return a(e,[{key:"invokeClick",value:function(e){this.isMultiAdsActive||this.store.set("forcePause",!1),e&&e.url&&(e.playerHandles&&e.url&&this._openClickThroughUrl(e.url),this.ovaMediaPlayer.options.onAdClick(this.ovaMediaPlayer,this,e.url))}},{key:"_openClickThroughUrl",value:function(e){return this.debugTracker.info("Opening Url","Opening url: "+e),e=d.replaceMacros(e,this.store),this.store.get("isInApp")&&window.taboolaMobile&&window.taboolaMobile.getSupportedFeatures&&window.taboolaMobile.getSupportedFeatures().VideoClick?void window.taboolaBridge.emit("videoClick",e):void window.open(e)}}]),e}();t.default=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var s=t.get("dsm")||{},n=s.bl||[],r=i.concat(n),a=!1;return r.map(function(t){t.indexOf(e)!==-1&&(a=!0)}),a};var i=[".rtbauction.com","video.leadzu.com"]},function(e,t){"use strict";function i(e,t){function i(e,i){var n=s(e,t),r=s(i,t);return n>r?1:-1}var n=e.sort(i);return n}function s(e,t){var i=0,s=r(e.wfIndex),a=r(e.waterfallTagId),o=r(e.cpmFloor),d=r(e.fillrate),l=e.getValueByKey("scoreBoost")||0,u=n(e.type)||1,h={wg:s,wi:a,fr:d,cf:o,mt:u,advb:l};e.scoreSummary=h;var i=1,c=t.get("qsrtscr");if(c&&"function"==typeof c)try{i=c(h,e,t)}catch(e){i=999999}return e.score=i,i}function n(e){return"flash"===e?1:"javascript"===e?2:3}function r(e){return e=e||0,parseInt(e)}e.exports={sort:i}},function(t,i,s){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),u=function e(t,i,s){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,s)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(s):void 0},h=s(21),c=r(h),p=s(50),v=r(p),f=s(1),m=n(f),g=function(t){function i(e,t,s){a(this,i);var n=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,t,s));return n._initVpaid(e),setTimeout(e.onReady,2),n}return d(i,t),l(i,[{
key:"resumeAd",value:function(){u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"resumeAd",this).call(this,this.adRestarted)}},{key:"setAdVolume",value:function(e){this.store.get("frcvlm")&&(this.video.volume=e,this.emit(this.vpaidEvents.AdVolumeChange,{eventData:{dispatcher:this}})),u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setAdVolume",this).call(this,e)}},{key:"onMuteChanged",value:function(e){this.isMuted=e}},{key:"_initVpaid",value:function(e){this.pauseVideoProtection=this.store.get("pusvidprtctn"),this.adLoaded=!1,this.callIMAApi=void 0}},{key:"_hookIMA",value:function(){this.imaApi=new v.default(this.adUnit._iframe,this.store,this.vpaidLog),this.imaApi.listenToMessages(),this.callIMAApi=this.imaApi.callApi.bind(this.imaApi)}},{key:"_onBindIframe",value:function(e){this._soundProtection(this.video),this._blockDOMObjectInWin(e.contentWindow)}},{key:"_soundProtection",value:function(e){var t=this;e.addEventListener("volumechange",function(){t.adLoaded&&t.isMuted&&0!=e.volume&&t.emit(t.vpaidEvents.SoundViolation,{eventData:{vol:e.volume}}),e.volume!==t.volume&&(m.logToBI(this.vpaidLog,"soundProtection",{selfSound:t.volume,videoSound:e.volume}),e.volume=t.volume)})}},{key:"_blockDOMObjectInWin",value:function(e){var t="window.navigator.__defineGetter__('plugins', function () { return []; });",i="\n        "+(this.store.get("jsnoflshdtct")?t:"")+'\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "_data",\n            Object.getOwnPropertyDescriptor(\n                HTMLObjectElement.prototype,\n                "data"\n            )\n        );\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "data", {\n                set : function(val){\n                    console.log(\'HTMLObjectElement block\');\n                    return;\n                }\n            }\n        );';try{m.injectResource(e,i)}catch(e){console.log(e)}}},{key:"_onSafeCallAdError",value:function(t){this._onAdError(e)}}]),i}(c.default);i.default=g},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),l=function e(t,i,s){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,s)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(s):void 0},u=i(21),h=n(u),c=i(1),p=(s(c),function(e){function t(e,i,s){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,s));return n._initVpaid(e),setTimeout(e.onReady,2),n}return o(t,e),d(t,[{key:"initAd",value:function(e,i,s,n,r,a){this.isIOS&&this.slowConnectionLength&&(this.slowConnectionTimeout=setTimeout(this._onSlowConnecionDetected.bind(this),1e3*this.slowConnectionLength)),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initAd",this).call(this,e,i,s,n,r,a)}},{key:"resumeAd",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resumeAd",this).call(this,this.video.useResumeCallback&&this.video.useResumeCallback()||this.adRestarted)}},{key:"startAd",value:function(){this.video.emitStartAd&&this.video.emitStartAd(),this.pausePrefetchVideo(),this.reportBufferToDebugTracker(),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"startAd",this).call(this)}},{key:"setAdVolume",value:function(e,i){this.video.mutedChangeByUserGesture=i,l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setAdVolume",this).call(this,e)}},{key:"isReplayable",value:function(){return this.video&&!this.video.forceCanvas&&""!==this._getVideoSrc(this.video)}},{key:"removeClickableTarget",value:function(){this.isIOS&&this.clickableTarget&&this.clickableTarget.parentNode.removeChild(this.clickableTarget)}},{key:"_initVpaid",value:function(e){var t=this;this.isCanvasMpeg=this.video.forceCanvas,this.pauseVideoProtection=this.store.get("pusvidprtctn")&&!this.isCanvasMpeg,this.isIOS="iOS"===this.store.get("ua").os.name,this.clickableTarget=e.clickableTarget,this.store.get("sprssviderr")&&this.video.supressErrorEvents(),this.video.addEventListener("canvasToVideo",function(){t.playerDAST.set({ctv:!0})}),this.isIOS&&(this.slowConnectionLength=this.store.get("slwcnctlngt")||0)}},{key:"_onBindIframe",value:function(e){this._unmuteHook()}},{key:"_unmuteHook",value:function(){this.store.get("mtdhkactv")&&this.video.hookMutedProperty()}},{key:"_resizeAd",value:function(e){this.stopped||this.video.resize&&this.video.resize(e)}},{key:"_stopAd",value:function(){this.stopped||(this.video.destroy(),this.onComplete(),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_stopAd",this).call(this))}},{key:"prefetchVideo",value:function(e,i){this.debugTracker.info("JsVpaidMob -> prefetchVideo() -> super.prefetchVideo();"),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"prefetchVideo",this).call(this,e,i)}},{key:"_onSlowConnecionDetected",value:function(){this.stopped||(this.slowConnectionDetected=!0,this.emit(this.vpaidEvents.SlowConnection),this.emit(this.vpaidEvents.AdStopped))}},{key:"_allEventsHandler",value:function(e,i){this.stopped||e===this.vpaidEvents.AdLoaded&&(this.slowConnectionTimeout=clearTimeout(this.slowConnectionTimeout),this.slowConnectionDetected&&this._isBufferStuck())||l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_allEventsHandler",this).call(this,e,i)}},{key:"_isBufferStuck",value:function(){return!!(!this.video.forceCanvas&&this.video&&this.video.getSrc()&&this.video.buffered&&this.video.buffered.length>0&&this.video.buffered.end(0)<1)&&(this._onSlowConnecionDetected(),!0)}}]),t}(h.default));t.default=p},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),d=function e(t,i,s){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,s)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(s):void 0},l=i(22),u=s(l),h=function(e){function t(e,i,s){n(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,s));return window.setTimeout(e.onReady,0),a}return a(t,e),o(t,[{key:"startAd",value:function(){this.video.play(),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"startAd",this).call(this)}},{key:"_onCanPlay",value:function(){this.playerReady||this.video.pause(),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onCanPlay",this).call(this)}},{key:"_onPlay",value:function(){this.startAdFired&&d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onPlay",this).call(this,this.playerReady,200)}},{key:"_onClickThru",value:function(){this.stopped||(this.store.set("forcePause",!1),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onClickThru",this).call(this,this.adPaused))}},{key:"_prepareVideoTag",value:function(){this.stopped||(this.debugTracker.info("VideoVpaidDesk -> _prepareVideoTag()"),this.video.removeAttribute("controls"),this._connectToVideoTag(),this._connectVideoEvents(),this._loadVideoTagSources())}},{key:"isReplayable",value:function(){return!0}},{key:"dontDie",value:function(){this.stayAlive=!0}}]),t}(u.default);t.default=h},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),l=function e(t,i,s){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,s)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(s):void 0},u=i(22),h=n(u),c=i(1),p=s(c),v=function(e){function t(e,i,s){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,s));return n.firstResumeAd=!0,n._initVpaid(e),window.setTimeout(e.onReady,0),n}return o(t,e),d(t,[{key:"initAd",value:function(e,i,s){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initAd",this).call(this,e,i,s),this.prefetchVideo("video")}},{key:"startAd",value:function(){this.debugTracker.info("VideoVpaidMob -> startAd()"),this.debugTracker.time("[VpaidWrapper"+this.wrapperIndex+"] startAd->impression"),this.isVForceActive||(this.video.buffering=!1),this._onStartAd(this)}},{key:"resizeAd",value:function(e,i,s,n){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resizeAd",this).call(this,e,i,s,n),this.video.resize&&this.video.resize(e,i,n)}},{key:"stopAd",value:function(){this.stopped||(this.timeUpdateInterval=clearTimeout(this.timeUpdateInterval),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stopAd",this).call(this))}},{key:"_createBindedCallback",value:function(){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_createBindedCallback",this).call(this),this._bindedOnPlaying=this._onPlaying.bind(this)}},{key:"_prepareVideoTag",value:function(){this.stopped||(this.video.removeAttribute("controls"),this._connectToVideoTag(),this._loadVideoTagSources(),this.video.muted=!0,this.video.setAttribute("playsinline",""),this.isIOS&&this.video.load())}},{key:"_connectToVideoTag",value:function(){this.stopped||(this.slowConnectionLength>0&&(this.slowConnectionTimeout=setTimeout(this._onSlowConnecionDetected.bind(this),1e3*this.slowConnectionLength)),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_connectToVideoTag",this).call(this),this.video.addEventListener("playing",this._bindedOnPlaying,!0),this.isIOS&&this.clickableTarget&&this.clickableTarget.addEventListener("click",this._bindedOnClickThru,!0))}},{key:"_disconnectFromVideoTag",value:function(){this.video.removeEventListener("playing",this._bindedOnPlaying,!0),this.isIOS&&this.clickableTarget&&this.clickableTarget.removeEventListener("click",this._bindedOnClickThru,!0)}},{key:"_loadVideoTagSources",value:function(){this.stopped||(this._sortMediaFiles(),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_loadVideoTagSources",this).call(this))}},{key:"_onPlaying",value:function(){this.stopped||(this.eventsToFire.adImpression&&(this.adPaused=!1),p.logToBI(this.vpaidLog,"videoPlaying",{vidCurrentTime:this.video.currentTime}))}},{key:"_onPlay",value:function(){var e=this;if(!this.stopped){if(this.debugTracker.info("VideoVpaidMob -> onPlay()"),!this.video.forceCanvas&&this.store.get("dataSaverDetected")||(this.debugTracker.info("VideoVpaidMob -> _onPlay() -> video.play()because canvas or !dataSaverDetected!"),this.video.play()),this.startAdFired)return this.emit(this.vpaidEvents.AdPlaying),!0;this.emit(this.vpaidEvents.AdVideoStart),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onPlay",this).call(this,!0,2e3),this.timeUpdateInterval=setInterval(function(){e.stopped||e._onTimeUpdate()},250)}}},{key:"_onPlayerError",value:function(){this.isCanvasMpeg||l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onPlayerError",this).call(this)}},{key:"_onClickThru",value:function(){if(event.preventDefault(),event.stopPropagation(),!this.stopped){if(this.isIOS){var e=(new Date).getTime();if(null!==this.lastClickTime&&e-this.lastClickTime<=100)return;this.lastClickTime=e}l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onClickThru",this).call(this,this.adPaused||this.store.get("dataSaverDetected")&&0===this.video.currentTime)}}},{key:"_onCanPlay",value:function(){this.stopped||(this.slowConnectionTimeout=clearTimeout(this.slowConnectionTimeout),this.slowConnectionDetected&&this._isBufferStuck()||l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_onCanPlay",this).call(this))}},{key:"isReplayable",value:function(){return!this.video.forceCanvas}},{key:"_initVpaid",value:function(e){var t=this;this.videoLength=e.extra.duration||30,this.clickableTarget=e.clickableTarget||null,this.tag=e.tag,this.isCanvasMpeg=this.video.forceCanvas,this.lastClickTime=null,this.isIOS="iOS"===this.store.get("ua").os.name,this.isCanvasMpeg&&this.video.addEventListener("canvasToVideo",function(){t.playerDAST.set({ctv:!0}),t.adPaused=t.video.paused}),this.isIOS&&(this.slowConnectionLength=this.store.get("slwcnctlngt")||0)}},{key:"_sortMediaFiles",value:function(){var e=this.playerWidth;this.mediaFiles.sort(function(t,i){var s=Math.abs(e-t.width),n=Math.abs(e-i.width);return s-n}).sort(function(e,t){return e.bitRate-t.bitRate})}},{key:"_resizeAd",value:function(e,t){this.newVidCreated&&this.newVid&&(this.newVid.style.width=e+"px",this.newVid.style.height=t+"px")}},{key:"resumeAd",value:function(){this.debugTracker.info("VideoVpaidMob -> resumeAd()"),this.firstResumeAd&&(this.debugTracker.info("VideoVpaidMob -> first resumeAd()"),this.isIOS?this._handleIOSFirstResumeAd():this._handleAndroidFirstResumeAd(),this._connectVideoEvents(),this.firstResumeAd=!1),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resumeAd",this).call(this)}},{key:"_handleIOSFirstResumeAd",value:function(){this.pausePrefetchVideo(),this.reportBufferToDebugTracker()}},{key:"_handleAndroidFirstResumeAd",value:function(){this.video.buffered&&this.video.buffered.length>0&&this.video.buffered.end(0)&&this.debugTracker.info("VideoVpaidMob -> startAd() - video currentTime:"+this.video.currentTime+"; buffered:"+this.video.buffered.end(0)+" sec"),this.video.currentTime=0}},{key:"_onSlowConnecionDetected",value:function(){this.stopped||(this.slowConnectionDetected=!0,this.emit(this.vpaidEvents.SlowConnection),this.emit(this.vpaidEvents.AdStopped))}},{key:"_isBufferStuck",value:function(){return!!(!this.video.forceCanvas&&this.video.buffered&&this.video.buffered.length>0&&this.video.buffered.end(0)<1)&&(this._onSlowConnecionDetected(),!0)}}]),t}(h.default);t.default=v},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),o=i(72),d=n(o),l=i(73),u=n(l),h=i(70),c=n(h),p=i(71),v=n(p),f=i(76),m=n(f),g=i(1),y=s(g),_=function(){function e(t,i){r(this,e),this.vpaidLog=t,this.store=i,this.isMobile=this.store.get("isMobile"),this.handlers={video:{handlerType:"VideoVpaid"+(this.isMobile?"Mobile":""),handler:this.isMobile?u.default:d.default,filterVpaidFiles:function(e){return e.vpaidFiles.video}},javascript:{handlerType:"JsVpaid"+(this.isMobile?"Mobile":""),handler:this.isMobile?v.default:c.default,filterVpaidFiles:function(e){return e.vpaidFiles.vpaid.javascript}},dvBlockingTag:{handlerType:"dvBlockingTag",handler:m.default.vpaid}}}return a(e,[{key:"create",value:function(e,t){if(!this.stopped){if(!this.handlers.hasOwnProperty(e))return y.logToBI(this.vpaidLog,"creatingVpaidHandler",{error:"typeNotFound",type:e}),null;var i=this.handlers[e].handler;return this.handlers[e].hasOwnProperty("filterVpaidFiles")&&(t.vpaidFiles=this.handlers[e].filterVpaidFiles(t)),y.logToBI(this.vpaidLog,"creatingVpaidHandler",{type:this.handlers[e].handlerType}),new i(t,this.vpaidLog,this.store)}}},{key:"destroy",value:function(){this.stopped=!0,this.vpaidLog=this.store=this.handlers=void 0}}]),e}();t.default=_},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),a=i(2),o=s(a),d=i(6),l=s(d),u=i(9),h=(s(u),i(3)),c=function(){function e(t,i,s){n(this,e),h.mixin(this),this.vpaidLog=i,this.store=s,this.stopped=!1,this.target=t.slot,this.debugTracker=new o.default("BlockingTagsVpaid"),this.baseUrl=this.store.get("base_url"),this._onError=t.onError,this.vpaidEvents=Object.assign({},l.default),this.tag=t.tag.url,this.checkForConversionCounter=this.store.get("blckngtgcnvrsncnt")}return r(e,[{key:"subscribe",value:function(e,t){this.vpaidEvents[t]&&this.on(t,e)}},{key:"unsubscribe",value:function(e,t){if(this.vpaidEvents[t]){if(!e)return;this.off(t,e)}}},{key:"handshakeVersion",value:function(e){return"2.0"}},{key:"isReplayable",value:function(){return!1}},{key:"getAdWidth",value:function(){return this.width||this.store.get("width")}},{key:"getAdHeight",value:function(){return this.height||this.store.get("height")}},{key:"getDOMContainer",value:function(){return this.target}},{key:"getVPAIDVideoElement",value:function(){return null}},{key:"stopAd",value:function(){this.stopped=!0}},{key:"initAd",value:function(e,t,i,s,n,r){}},{key:"startAd",value:function(){}},{key:"resizeAd",value:function(e,t,i){}},{key:"getVideoUrl",value:function(){}},{key:"logVideoUrl",value:function(){}},{key:"pauseAd",value:function(){}},{key:"resumeAd",value:function(){}},{key:"skipAd",value:function(){}},{key:"expandAd",value:function(){}},{key:"collapseAd",value:function(){}},{key:"getAdSkippableRemainingTime",value:function(){}},{key:"getAdRemainingTime",value:function(){}},{key:"getAdDuration",value:function(){}},{key:"getAdSkippableState",value:function(){}},{key:"getAdVolume",value:function(){}},{key:"getAdIcons",value:function(){}},{key:"getAdCompanions",value:function(){}},{key:"getAdExpanded",value:function(){}},{key:"getAdLinear",value:function(){}}]),e}();t.default=c},function(e,t,i){"use strict";function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var d=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),l=i(75),u=n(l),h=i(9),c=n(h),p=i(1),v=s(p),f=function(e){function t(e,i,s){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,s));return n.impressionType=void 0,n.type=c.default.doubleVerifyBlockingTagVpaid.type,v.logToBI(n.vpaidLog,"blockingTag",{tag:n.tag,type:"doubleVerify"}),setTimeout(e.onReady,2),n}return o(t,e),d(t,[{key:"initAd",value:function(e,t,i,s,n,r){if(!this.stopped){var a=this._parseDOMFromString(this.tag);return this.blockingTagScripts=a.getElementsByTagName("script"),this.blockingTagScripts&&0!==this.blockingTagScripts.length?(this.adTagImage=this._parseImageSourceFromTag(a,"text/adtag"),this.passbackImage=this._parseImageSourceFromTag(a,"text/passback"),this.adTagImage&&this.passbackImage?void this.emit(this.vpaidEvents.AdLoaded,{}):void this.emit(this.vpaidEvents.AdError,{error:"imagesParsingIssue"})):void this.emit(this.vpaidEvents.AdError,{error:"scriptParsingIssue"})}}},{key:"_parseDOMFromString",value:function(e){return(new DOMParser).parseFromString(e,"text/html")}},{key:"_parseImageSourceFromTag",value:function(e,t){try{var i=e.querySelector('script[type="'+t+'"]'),s=this._parseDOMFromString(i.innerHTML).getElementsByTagName("img")[0];return s.src}catch(e){return""}}},{key:"_getMediaUrl",value:function(){return this.hadImpression?this.impressionType===this.vpaidEvents.AdImpression?this.adTagImage:this.passbackImage:""}},{key:"startAd",value:function(){var e=this;this.stopped||(this.iframe=document.createElement("iframe"),this.iframe.onload=function(){e.iframe.contentWindow.document.open(),e.iframe.contentWindow.document.write(e.tag),e.iframe.contentWindow.document.close(),e._checkForConversion()},this.target.appendChild(this.iframe))}},{key:"_checkForConversion",value:function(){var e=this;return this.checkForConversionCounter--<=0?void this.emit(this.vpaidEvents.AdError,{error:"noConversion"}):void setTimeout(function(){for(var t=e.iframe.contentWindow.document.getElementsByTagName("img"),i=0;i<t.length;i++)if(t[i].src===e.adTagImage?(e.hadImpression=!0,e.impressionType=e.vpaidEvents.AdImpression):t[i].src===e.passbackImage&&(e.hadImpression=!0,e.impressionType=e.vpaidEvents.BlockingTagPassback,e.emit(e.vpaidEvents.BlockingTagPassback,{})),e.hadImpression)return e.imageElement=t[i],e._setImagePlacement(),void e.emit(e.vpaidEvents.AdImpression,{});e._checkForConversion()},1e3)}},{key:"_setImagePlacement",value:function(){this.iframe.contentWindow.document.body.style.margin=0,this.imageElement.style.marginLeft=(this.width-this.imageElement.width)/2+"px",this.imageElement.style.marginTop=(this.height-this.imageElement.height)/2+"px"}},{key:"isReplayable",value:function(){return!1}},{key:"resizeAd",value:function(e,t,i){this.stopped||(this.width=e,this.height=t,this.iframe.style.width=this.width+"px",this.iframe.style.height=this.height+"px",this._setImagePlacement())}},{key:"getAdWidth",value:function(){return this.width||this.store.get("width")}},{key:"getAdHeight",value:function(){return this.height||this.store.get("height")}},{key:"getDOMContainer",value:function(){return this.target}},{key:"getVideoUrl",value:function(){return this._getMediaUrl()}},{key:"getVPAIDVideoElement",value:function(){return null}},{key:"stopAd",value:function(){this.stopped=!0}},{key:"logVideoUrl",value:function(){this.hadImpression&&v.logToBI(this.vpaidLog,"blockingTagImageUrl",{url:this.passbackImage})}}]),t}(u.default);t.default={type:c.default.doubleVerifyBlockingTagVpaid.id,vpaid:f}},function(e,t,i){"use strict";function s(e){var t=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}function n(e,t){var i,n,o,d,l,u,h=!1;t||(t={}),i=t.debug||!1;try{o=r(),d=document.createRange(),l=document.getSelection(),u=document.createElement("span"),u.textContent=e,u.style.all="unset",u.style.position="fixed",u.style.top=0,u.style.clip="rect(0, 0, 0, 0)",u.style.whiteSpace="pre",u.style.webkitUserSelect="text",u.style.MozUserSelect="text",u.style.msUserSelect="text",u.style.userSelect="text",u.addEventListener("copy",function(i){i.stopPropagation(),t.format&&(i.preventDefault(),i.clipboardData.clearData(),i.clipboardData.setData(t.format,e))}),document.body.appendChild(u),d.selectNodeContents(u),l.addRange(d);var c=document.execCommand("copy");if(!c)throw new Error("copy command was unsuccessful");h=!0}catch(r){i&&console.error("unable to copy using execCommand: ",r),i&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),h=!0}catch(r){i&&console.error("unable to copy using clipboardData: ",r),i&&console.error("falling back to prompt"),n=s("message"in t?t.message:a),window.prompt(n,e)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(d):l.removeAllRanges()),u&&document.body.removeChild(u),o()}return h}var r=i(86),a="Copy to clipboard: #{key}, Enter";e.exports=n},function(e,t,i){t=e.exports=i(79)(!1),t.push([e.id,"#_cm-css-reset {\n    height: inherit;\n    width: inherit;\n    direction: ltr;\n    text-align: left;\n}\n\n#_cm-css-reset.vpaid-player-container .vjs-tech {\n    background-color: #000000;\n}\n\n\n#_cm-css-reset.vpaid-player-container {\n    position: relative;\n    z-index: 99;\n}\n\n#_cm-css-reset.vpaid-player-container video ~ iframe {\n    z-index: 10;\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n#_cm-css-reset .vpaid-ad-controls {\n    -webkit-transition: opacity 500ms ease-out;\n    -moz-transition: opacity 500ms ease-out;\n    -o-transition: opacity 500ms ease-out;\n    transition: opacity 500ms ease-out;\n    opacity: 0;\n}\n\n#_cm-css-reset.vpaid-player-container:hover .vpaid-ad-controls {\n    opacity: 1;\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-controls,\n#_cm-css-reset.vpaid-player-container .vpaid-ad-pause {\n    height: 30px;\n    right: 0;\n    position: absolute;\n    left: 0px;\n    bottom: 0;\n    z-index: 1001;\n    background-color: rgba(0, 0, 0, 1);\n    border-top: 1px rgba(255, 255, 255, 0.7) solid;\n}\n\n#_cm-css-reset .vpaid-ad-controls.vjs-default-skin .vjs-control {\n    width: 2em;\n}\n/*\n#_cm-css-reset .vpaid-ad-controls.vjs-default-skin .vjs-control:before {\n    line-height: 2;\n    font-size: 16px;\n}*/\n\n#_cm-css-reset .vpaid-ad-controls.vjs-default-skin .vjs-control.c-paused:before {\n    content: \"\\e001\";\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-volume-container {\n    height: 30px;\n    width: 60px;\n    position: relative;\n    float: right;\n    margin-right: 10px;\n    top: 0;\n    cursor: pointer;\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-mute-container {\n    height: 30px;\n    width: 30px;\n    position: relative;\n    float: right;\n    top: 0;\n    cursor: pointer;\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-volume-track {\n    height: 8px;\n    border: 1px #000000 solid;\n    box-shadow: 0 0 5px 1px rgb(255, 255, 255);\n    position: absolute;\n    z-index: 0;\n    right: 0;\n    top: 11px;\n    left: 0;\n    background: rgba(51, 51, 51, 0.9)\n}\n\n#_cm-css-reset.vpaid-player-container .vpaid-ad-volume-slider {\n    height: 8px;\n    border: 1px #000000 solid;\n    position: absolute;\n    width: 40%;\n    top: 11px;\n    left: 0;\n    background: rgba(183, 234, 187, 0.9);\n    z-index: 1;\n}\n\n\n\n/*#_cm-css-reset .mpegcnv::before {\n    content: \"\";\n    position: absolute;\n    \n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 100;\n}*/\n\n#_cm-css-reset .tbl-text {\n    font-family: Arial,Helvetica,sans-serif;\n    white-space: nowrap;\n    font-size: 11px;\n    color: #fff;\n    left: 10px;\n    top: 4px;\n    position: absolute;\n    font-weight: bold;\n    z-index: 1001;\n}\n\n#_cm-css-reset .mc-video {\n    z-index: 101;\n}\n\n#_cm-css-reset .vpaid-handler {\n    z-index: 1000;\n    height: 100%;\n    width: 100%;\n}\n\n\n#_cm-css-reset .speaker {\n    position: absolute;\n    width: 46px;\n    height: 46px;\n    bottom: -3px;\n    right: -5px;\n    z-index: 1001;\n    background-image: url('https://vidstat.taboola.com/player-assets/mob-vol-on.svg'); \n}\n#_cm-css-reset .speaker.mute {\n    background-image: url('https://vidstat.taboola.com/player-assets/mob-vol-off.svg'); \n}\n\n#_cm-css-reset .hide {\n    display: none\n}\n\n\n#_cm-css-reset .mc-loud-video{\n    position:absolute;\n    pointer-events: none;\n}\n#_cm-css-reset .mc-loud-video::-webkit-media-controls-panel {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n/* Old shadow dom for play button */\n\n#_cm-css-reset .mc-loud-video::--webkit-media-controls-play-button {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n/* New shadow dom for play button */\n\n/* This one works */\n\n#_cm-css-reset .mc-loud-video::-webkit-media-controls-start-playback-button {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n#_cm-css-reset .mc-loud-video::-webkit-media-controls {\n  display:none !important;\n}\n#_cm-css-reset .mc-loud-video::-webkit-media-controls-enclosure {\n  display:none !important;\n}\n\n\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.show{\n    display: block;\n    margin: 0;\n    padding: 0;\n    position: initial;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.show *{\n    position: absolute !important;\n    display: block;\n    margin: 0;\n    padding: 0;\n    background-color: transparent;\n} \n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls {\n    width: 100%;\n    height: 100%;\n    z-index: 1000;\n    left: 0;\n    bottom: -32px;\n    -webkit-transition: bottom 0.35s ease-in-out;\n    -moz-transition: bottom 0.35s ease-in-out;\n    -o-transition: bottom 0.35s ease-in-out;\n    transition: bottom 0.35s ease-in-out;\n}\n\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .control {\n    z-index: 100;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .interactive {\n    pointer-events: all;\n    cursor: pointer;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.hide,\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .hide {\n    display: none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls.show,\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .show {\n    display: block;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_progressbar_area {\n    width: 100%;\n    height: 5px;\n    bottom: 0%;\n    cursor: default;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_progressbar_area .cm_video_controls_progressbar {\n    height: 100%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_progressbar_area .cm_video_controls_progressbar_bg {\n    width: 100%;\n    height: 100%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .white_bg {\n    background: rgba(255,255,255,0.3);\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .blue_bg {\n    background: rgba(21,75,145,1);\n    -webkit-transition : width 0.5s ease;\n    -moz-transition : width 0.5s ease;\n    -o-transition : width 0.5s ease;\n    transition : width 0.5s ease;\n    width: 0%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .blue_bg.init_bg {\n    -webkit-transition : none;\n    -moz-transition : none;\n    -o-transition : none;\n    transition : none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls {\n    width: 100%;\n    height: 27px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .play_pause {\n    top: 3px;\n    left: 5px;\n    width: 20px;\n    height: 20px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .play_pause .pause {\n    width: 40px;\n    height: 27px;\n    top: -7px;\n    left: -8px;\n    background-image: url('https://vidstat.taboola.com/player-assets/pause2.svg');\n    background-size: 36px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .play_pause .play {\n    border-top: 5px solid transparent;\n    border-left: 10px solid #fff;\n    border-bottom: 5px solid transparent;\n    left: 6px;\n    top: 5px;\n    z-index: 102;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .title {\n    top: 7px;\n    left: 30px;\n    width: 140px;\n    text-align: left;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .cm_video_controls_main_area .timer {\n    top: 6px;\n    right: 110px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .text {\n    color: white;\n    font-size: 13px;\n    font-weight: bold;\n    font-family: Arial,Helvetica,sans-serif;\n    top: 10px;\n    left: 28px;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    cursor: default;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .text.opt-out-hidden {\n    left: 13px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls {\n    width: 100%;\n    height: 100%;\n    right: 0px;\n    bottom: 0;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_mute {\n    width: 35px;\n    height: 27px;\n    right: 8px;\n    bottom: 5px;\n    background-size: 44px;\n    box-sizing: content-box;\n    background-position-y: center;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_mute.display_mute {\n    background-image: url('https://vidstat.taboola.com/player-assets/desk_muted2.svg');\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_mute.display_unmute {\n    background-image: url('https://vidstat.taboola.com/player-assets/desk_playing2.svg');\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .video-controls-scroller-area {\n    width: 80px;\n    height: 100%;\n    right: 5px;\n    top: 0%;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .playerSaveButton {\n    position: absolute;\n    border: 1px solid #fff;\n    border-radius: 9px;\n    width: 50px;\n    height: 24px;\n    top: 20%;\n    left: 0;\n    font-size: 14px;\n    color: #fff;\n    text-align: center;\n    line-height: 24px;\n    cursor: pointer;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls_mobile {\n    width: 100%; \n    height: 100%; \n    top: 0; \n    left: 0; \n    pointer-events: none; \n    z-index: 1001;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area {\n    pointer-events: none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause.hide {\n    display: none;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause.show {\n    display: block;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause {\n    bottom: 28px;\n    left: 5px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause .pause {\n    width: 40px;\n    height: 27px;\n    top: -10px;\n    left: -8px;\n    background-image: url(https://vidstat.taboola.com/player-assets/pause2.svg);\n    background-size: 40px;\n}\n\n#_cm-css-reset ._cm-video-ad.vpaid-player-container .video_controls .video_controls_main_area .cm_video_controls_playpause .play {\n    border-top: 6px solid transparent;\n    border-left: 10px solid #fff;\n    border-bottom: 6px solid transparent;\n    left: 7px;\n    top: 3px;\n    z-index: 102;\n}\n\n#_cm-css-reset .mc-play {\n    width: 0;\n    height: 0;\n    border-top: 7px solid transparent;\n    border-left: 9px solid #fff;\n    border-bottom: 7px solid transparent;\n    left: 14px;\n    position: absolute;\n    bottom: 10px;\n    z-index: 1001;\n}\n\n#_cm-css-reset .mc-pause {\n    display: block;\n    width: 42px;\n    height: 42px;\n    left: -4px;\n    position: absolute;\n    bottom: -2px;\n    z-index: 1001;\n    background-image: url('https://vidstat.taboola.com/player-assets/mob-pause.svg');\n}\n\n#_cm-css-reset .mc-pause.hide, #_cm-css-reset .mc-play.hide {\n    display: none;\n}\n\n#_cm-css-reset .mc-pause.show, #_cm-css-reset .mc-play.show {\n    display: block;\n}\n\n\n#_cm-css-reset .mc-progressbar_area {\n    width: 100%;\n    height: 5px;\n    bottom: 0%;\n    position: absolute;\n    z-index: 9999;\n}\n\n#_cm-css-reset .mc-progressbar_area .mc-progressbar_bg.white_bg {\n    background: rgba(255,255,255,0.3);\n    width: 100%;\n    height: 100%;\n}\n\n#_cm-css-reset .mc-progressbar_area .mc-progressbar_bg.blue_bg {\n    background: rgba(21,75,145,1);\n    -webkit-transition : width 0.5s ease;\n    -moz-transition : width 0.5s ease;\n    -o-transition : width 0.5s ease;\n    transition : width 0.5s ease;\n    position: absolute;\n    bottom: 0%;\n    height: 100%;\n}\n\n#_cm-css-reset .mc-progressbar_area .mc-progressbar_bg.blue_bg.init_bg {\n    -webkit-transition : none;\n    -moz-transition : none;\n    -o-transition : none;\n    transition : none;\n}\n\n#_cm-css-reset > .multi-vpaids {\n    height: 0px;\n}\n\n\n\n\n\n\n#_cm-css-reset *::-webkit-media-controls-panel {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n/* Old shadow dom for play button */\n\n#_cm-css-reset *::-webkit-media-controls-play-button {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n/* New shadow dom for play button */\n\n/* This one works! */\n\n#_cm-css-reset *::-webkit-media-controls-start-playback-button {\n  display: none!important;\n  -webkit-appearance: none;\n}\n\n#_cm-css-reset .cm-ad-player {\n    cursor: pointer; \n    position: absolute; \n    left: 0px; \n    top: 0px; \n    z-index: 0;\n}\n\n@supports (object-fit:cover) {\n    #_cm-css-reset .cm-ad-player {\n        object-fit: cover;\n    }\n\n    #_cm-css-reset .cm-ad-player.vertical-video {\n        object-fit: contain;\n    }\n}\n\n#_cm-css-reset .cm-ad-player.ie-black-edges {\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%,-50%);\n}\n\n#_cm-css-reset .cm-ad-player-active {\n    visibility: visible;\n}\n\n#_cm-css-reset ._cm-ad-feed-manager ._cm-ad {\n    display: block !important;\n    visibility: hidden !important;\n}\n\n#_cm-css-reset ._cm-ad-choices-player {\n    position: absolute;\n    top: 16px;\n    left: 13px;\n}\n\n#_cm-css-reset ._cm-ad-choices-player-anchor {\n    display: inline-block;\n    opacity: 0.5;\n    vertical-align: middle;\n}\n\n#_cm-css-reset .interactive-video {\n    position: absolute;\n    z-index: 999 !important;\n    cursor: pointer;\n    transition: visibility 0.2s, opacity 0.5s linear;\n    display: initial !important;\n    opacity: 0.8;\n    font-size: .875rem;\n    padding-left: .75rem;\n    padding-right: .75rem;\n    padding-top: .25rem;\n    padding-bottom: .25rem;\n    font-weight: 600;\n    border-radius: 9999px;\n    font-size: 3.5vmin;\n    text-shadow: 1px 1px black;\n    font-family: Impact, Charcoal, sans-serif !important;\n    letter-spacing: 0.2px;\n}\n\n#_cm-css-reset .interactive-video-lbls {\n    font-family: Impact, Charcoal, sans-serif !important;\n    letter-spacing: 0.2px;\n}\n\n#_cm-css-reset .interactive-video.center {\n    position: relative;\n}\n\n#_cm-css-reset .interactive-video.hide {\n    opacity: 0;\n    visibility: hidden;\n}\n\n#_cm-css-reset .interactive-video-wrapper {\n    position: absolute;\n    width: 100%;\n    text-align: center;\n}\n\n#_cm-css-reset .interactive-video-wrapper.hide {\n    opacity: 0;\n    visibility: hidden;\n}\n\n#_cm-css-reset .interactive-video.show {\n    opacity: 1;\n    visibility: visible;\n}\n\n#_cm-css-reset .interactive-video-effect {\n    -webkit-transition : width 0s ease;\n    -moz-transition : width 0s ease;\n    -o-transition : width 0s ease;\n    transition : width 0s ease;\n    height: 1px;\n    background-color: white;\n    pointer-events: none;\n}\n\n#_cm-css-reset .interactive-video-effect-wrapper {\n    padding-left: .75rem;\n}\n\n@media only screen and (max-width : 768px) {\n    #_cm-css-reset .interactive-video {\n        font-size: 3vmin;\n    }\n}\n\n#_cm-css-reset .cm-vpaid-iframe {\n    position: absolute;\n    left: 0px;\n    top: 0px;\n    margin: 0px !important;\n    padding: 0px;\n    border: none;\n    width: 100%;\n    height: 100%;\n    z-index: 1;\n}\n\n.buff-vid {\n    z-index: 2147483647 !important;\n    position: fixed;\n    right: 0;\n    width: 1px;\n    height: 1px;\n    \n}",""]);
},function(e,t){"use strict";function i(e,t){var i=e[1]||"",n=e[3];if(!n)return i;if(t&&"function"==typeof btoa){var r=s(n),a=n.sources.map(function(e){return"/*# sourceURL=".concat(n.sourceRoot).concat(e," */")});return[i].concat(a).concat([r]).join("\n")}return[i].join("\n")}function s(e){var t=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(t);return"/*# ".concat(i," */")}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var s=i(t,e);return t[2]?"@media ".concat(t[2],"{").concat(s,"}"):s}).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var s={},n=0;n<this.length;n++){var r=this[n][0];null!=r&&(s[r]=!0)}for(var a=0;a<e.length;a++){var o=e[a];null!=o[0]&&s[o[0]]||(i&&!o[2]?o[2]=i:i&&(o[2]="(".concat(o[2],") and (").concat(i,")")),t.push(o))}},t}},function(e,t,i){(function(t,i){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   v4.2.6+9869a4bc
	 */
!function(t,i){e.exports=i()}(this,function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function s(e){return"function"==typeof e}function n(e){z=e}function r(e){G=e}function a(){return function(){return t.nextTick(h)}}function o(){return"undefined"!=typeof q?function(){q(h)}:u()}function d(){var e=0,t=new X(h),i=document.createTextNode("");return t.observe(i,{characterData:!0}),function(){i.data=e=++e%2}}function l(){var e=new MessageChannel;return e.port1.onmessage=h,function(){return e.port2.postMessage(0)}}function u(){var e=setTimeout;return function(){return e(h,1)}}function h(){for(var e=0;e<H;e+=2){var t=$[e],i=$[e+1];t(i),$[e]=void 0,$[e+1]=void 0}H=0}function c(){try{var e=Function("return this")().require("vertx");return q=e.runOnLoop||e.runOnContext,o()}catch(e){return u()}}function p(e,t){var i=this,s=new this.constructor(f);void 0===s[ee]&&O(s);var n=i._state;if(n){var r=arguments[n-1];G(function(){return x(n,s,r,i._result)})}else P(i,s,e,t);return s}function v(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var i=new t(f);return A(i,e),i}function f(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function g(){return new TypeError("A promises callback cannot return that same promise.")}function y(e){try{return e.then}catch(e){return ne.error=e,ne}}function _(e,t,i,s){try{e.call(t,i,s)}catch(e){return e}}function b(e,t,i){G(function(e){var s=!1,n=_(i,t,function(i){s||(s=!0,t!==i?A(e,i):C(e,i))},function(t){s||(s=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!s&&n&&(s=!0,E(e,n))},e)}function w(e,t){t._state===ie?C(e,t._result):t._state===se?E(e,t._result):P(t,void 0,function(t){return A(e,t)},function(t){return E(e,t)})}function k(e,t,i){t.constructor===e.constructor&&i===p&&t.constructor.resolve===v?w(e,t):i===ne?(E(e,ne.error),ne.error=null):void 0===i?C(e,t):s(i)?b(e,t,i):C(e,t)}function A(t,i){t===i?E(t,m()):e(i)?k(t,i,y(i)):C(t,i)}function T(e){e._onerror&&e._onerror(e._result),V(e)}function C(e,t){e._state===te&&(e._result=t,e._state=ie,0!==e._subscribers.length&&G(V,e))}function E(e,t){e._state===te&&(e._state=se,e._result=t,G(T,e))}function P(e,t,i,s){var n=e._subscribers,r=n.length;e._onerror=null,n[r]=t,n[r+ie]=i,n[r+se]=s,0===r&&e._state&&G(V,e)}function V(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var s=void 0,n=void 0,r=e._result,a=0;a<t.length;a+=3)s=t[a],n=t[a+i],s?x(i,s,n,r):n(r);e._subscribers.length=0}}function I(e,t){try{return e(t)}catch(e){return ne.error=e,ne}}function x(e,t,i,n){var r=s(i),a=void 0,o=void 0,d=void 0,l=void 0;if(r){if(a=I(i,n),a===ne?(l=!0,o=a.error,a.error=null):d=!0,t===a)return void E(t,g())}else a=n,d=!0;t._state!==te||(r&&d?A(t,a):l?E(t,o):e===ie?C(t,a):e===se&&E(t,a))}function S(e,t){try{t(function(t){A(e,t)},function(t){E(e,t)})}catch(t){E(e,t)}}function D(){return re++}function O(e){e[ee]=re++,e._state=void 0,e._result=void 0,e._subscribers=[]}function M(){return new Error("Array Methods must be provided an Array")}function B(e){return new ae(this,e).promise}function R(e){var t=this;return new t(N(e)?function(i,s){for(var n=e.length,r=0;r<n;r++)t.resolve(e[r]).then(i,s)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function F(e){var t=this,i=new t(f);return E(i,e),i}function L(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function W(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function j(){var e=void 0;if("undefined"!=typeof i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var s=null;try{s=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===s&&!t.cast)return}e.Promise=oe}var U=void 0;U=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var N=U,H=0,q=void 0,z=void 0,G=function(e,t){$[H]=e,$[H+1]=t,H+=2,2===H&&(z?z(h):Z())},Q="undefined"!=typeof window?window:void 0,K=Q||{},X=K.MutationObserver||K.WebKitMutationObserver,Y="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),J="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$=new Array(1e3),Z=void 0;Z=Y?a():X?d():J?l():void 0===Q?c():u();var ee=Math.random().toString(36).substring(2),te=void 0,ie=1,se=2,ne={error:null},re=0,ae=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(f),this.promise[ee]||O(this.promise),N(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&C(this.promise,this._result))):E(this.promise,M())}return e.prototype._enumerate=function(e){for(var t=0;this._state===te&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,s=i.resolve;if(s===v){var n=y(e);if(n===p&&e._state!==te)this._settledAt(e._state,t,e._result);else if("function"!=typeof n)this._remaining--,this._result[t]=e;else if(i===oe){var r=new i(f);k(r,e,n),this._willSettleAt(r,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(s(e),t)},e.prototype._settledAt=function(e,t,i){var s=this.promise;s._state===te&&(this._remaining--,e===se?E(s,i):this._result[t]=i),0===this._remaining&&C(s,this._result)},e.prototype._willSettleAt=function(e,t){var i=this;P(e,void 0,function(e){return i._settledAt(ie,t,e)},function(e){return i._settledAt(se,t,e)})},e}(),oe=function(){function e(t){this[ee]=D(),this._result=this._state=void 0,this._subscribers=[],f!==t&&("function"!=typeof t&&L(),this instanceof e?S(this,t):W())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,i=t.constructor;return s(e)?t.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){throw t})}):t.then(e,e)},e}();return oe.prototype.then=p,oe.all=B,oe.race=R,oe.resolve=v,oe.reject=F,oe._setScheduler=n,oe._setAsap=r,oe._asap=G,oe.polyfill=j,oe.Promise=oe,oe})}).call(t,i(83),function(){return this}())},function(e,t,i){var s,n,r;/*!
	 *  javascript-debounce 1.0.1
	 *
	 *  A lightweight, dependency-free JavaScript module for debouncing functions based on David Walsh's debounce function.
	 *
	 *  Source code available at: https://github.com/jgarber623/javascript-debounce
	 *
	 *  (c) 2015-2019 Jason Garber (http://sixtwothree.org)
	 *
	 *  javascript-debounce may be freely distributed under the MIT license.
	 */
!function(i,a){n=[],s=a,r="function"==typeof s?s.apply(t,n):s,!(void 0!==r&&(e.exports=r))}(this,function(){"use strict";return function(e,t){var i;return function(){var s=this,n=arguments;clearTimeout(i),i=setTimeout(function(){e.apply(s,n)},t)}}})},function(e,t,i){!function(t,i){e.exports=i()}(this,function(){return function(e){function t(e){delete installedChunks[e]}function i(e){var t=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.charset="utf-8",i.src=p.p+"hot_updater/hot-update.js",t.appendChild(i)}function s(){return new Promise(function(e,t){if("undefined"==typeof XMLHttpRequest)return t(new Error("No browser support"));try{var i=new XMLHttpRequest,s=p.p+"hot_updater/hot-update.json";i.open("GET",s,!0),i.timeout=1e4,i.send(null)}catch(e){return t(e)}i.onreadystatechange=function(){if(4===i.readyState)if(0===i.status)t(new Error("Manifest request to "+s+" timed out."));else if(404===i.status)e();else if(200!==i.status&&304!==i.status)t(new Error("Manifest request to "+s+" failed."));else{try{var n=JSON.parse(i.responseText)}catch(e){return void t(e)}e(n)}}})}function n(e){var t=S[e];if(!t)return p;var i=function(i){return t.hot.active?(S[i]?S[i].parents.indexOf(e)<0&&S[i].parents.push(e):(k=[e],f=i),t.children.indexOf(i)<0&&t.children.push(i)):(console.warn("[HMR] unexpected require("+i+") from disposed module "+e),k=[]),p(i)};for(var s in p)Object.prototype.hasOwnProperty.call(p,s)&&"e"!==s&&Object.defineProperty(i,s,function(e){return{configurable:!0,enumerable:!0,get:function(){return p[e]},set:function(t){p[e]=t}}}(s));return i.e=function(e){function t(){P--,"prepare"===C&&(V[e]||u(e),0===P&&0===E&&h())}return"ready"===C&&a("prepare"),P++,p.e(e).then(t,function(e){throw t(),e})},i}function r(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:f!==e,active:!0,accept:function(e,i){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var s=0;s<e.length;s++)t._acceptedDependencies[e[s]]=i||function(){};else t._acceptedDependencies[e]=i||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var i=0;i<e.length;i++)t._declinedDependencies[e[i]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var i=t._disposeHandlers.indexOf(e);i>=0&&t._disposeHandlers.splice(i,1)},check:d,apply:c,status:function(e){return e?void T.push(e):C},addStatusHandler:function(e){T.push(e)},removeStatusHandler:function(e){var t=T.indexOf(e);t>=0&&T.splice(t,1)},data:w[e]};return f=void 0,t}function a(e){C=e;for(var t=0;t<T.length;t++)T[t].call(null,e)}function o(e){return+e+""===e?+e:e}function d(e){if("idle"!==C)throw new Error("check() is only allowed in idle status");return _=e,a("check"),s().then(function(e){if(!e)return a("idle"),null;I={},V={},x=e.c,y=e.h,a("prepare");var t=new Promise(function(e,t){m={resolve:e,reject:t}});return g={},u(0),"prepare"===C&&0===P&&0===E&&h(),t})}function l(e,t){if(x[e]&&I[e]){I[e]=!1;for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(g[i]=t[i]);0==--E&&0===P&&h()}}function u(e){x[e]?(I[e]=!0,E++,i(e)):V[e]=!0}function h(){a("ready");var e=m;if(m=null,e)if(_)c(_).then(function(t){e.resolve(t)},function(t){e.reject(t)});else{var t=[];for(var i in g)Object.prototype.hasOwnProperty.call(g,i)&&t.push(o(i));e.resolve(t)}}function c(i){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];e.indexOf(s)<0&&e.push(s)}}if("ready"!==C)throw new Error("apply() is only allowed in ready status");i=i||{};var n,r,d,l,u,h={},c=[],v={},f=function(){console.warn("[HMR] unexpected require("+_.moduleId+") to disposed module")};for(var m in g)if(Object.prototype.hasOwnProperty.call(g,m)){u=o(m);var _;_=g[m]?function(e){for(var t=[e],i={},n=t.slice().map(function(e){return{chain:[e],id:e}});n.length>0;){var r=n.pop(),a=r.id,o=r.chain;if((l=S[a])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:o,moduleId:a};if(l.hot._main)return{type:"unaccepted",chain:o,moduleId:a};for(var d=0;d<l.parents.length;d++){var u=l.parents[d],h=S[u];if(h){if(h.hot._declinedDependencies[a])return{type:"declined",chain:o.concat([u]),moduleId:a,parentId:u};t.indexOf(u)>=0||(h.hot._acceptedDependencies[a]?(i[u]||(i[u]=[]),s(i[u],[a])):(delete i[u],t.push(u),n.push({chain:o.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:i}}(u):{type:"disposed",moduleId:m};var A=!1,T=!1,E=!1,P="";switch(_.chain&&(P="\nUpdate propagation: "+_.chain.join(" -> ")),_.type){case"self-declined":i.onDeclined&&i.onDeclined(_),i.ignoreDeclined||(A=new Error("Aborted because of self decline: "+_.moduleId+P));break;case"declined":i.onDeclined&&i.onDeclined(_),i.ignoreDeclined||(A=new Error("Aborted because of declined dependency: "+_.moduleId+" in "+_.parentId+P));break;case"unaccepted":i.onUnaccepted&&i.onUnaccepted(_),i.ignoreUnaccepted||(A=new Error("Aborted because "+u+" is not accepted"+P));break;case"accepted":i.onAccepted&&i.onAccepted(_),T=!0;break;case"disposed":i.onDisposed&&i.onDisposed(_),E=!0;break;default:throw new Error("Unexception type "+_.type)}if(A)return a("abort"),Promise.reject(A);if(T){v[u]=g[u],s(c,_.outdatedModules);for(u in _.outdatedDependencies)Object.prototype.hasOwnProperty.call(_.outdatedDependencies,u)&&(h[u]||(h[u]=[]),s(h[u],_.outdatedDependencies[u]))}E&&(s(c,[_.moduleId]),v[u]=f)}var V=[];for(r=0;r<c.length;r++)u=c[r],S[u]&&S[u].hot._selfAccepted&&V.push({module:u,errorHandler:S[u].hot._selfAccepted});a("dispose"),Object.keys(x).forEach(function(e){!1===x[e]&&t(e)});for(var I,D=c.slice();D.length>0;)if(u=D.pop(),l=S[u]){var O={},M=l.hot._disposeHandlers;for(d=0;d<M.length;d++)(n=M[d])(O);for(w[u]=O,l.hot.active=!1,delete S[u],d=0;d<l.children.length;d++){var B=S[l.children[d]];B&&(I=B.parents.indexOf(u))>=0&&B.parents.splice(I,1)}}var R,F;for(u in h)if(Object.prototype.hasOwnProperty.call(h,u)&&(l=S[u]))for(F=h[u],d=0;d<F.length;d++)R=F[d],(I=l.children.indexOf(R))>=0&&l.children.splice(I,1);a("apply"),b=y;for(u in v)Object.prototype.hasOwnProperty.call(v,u)&&(e[u]=v[u]);var L=null;for(u in h)if(Object.prototype.hasOwnProperty.call(h,u)){l=S[u],F=h[u];var W=[];for(r=0;r<F.length;r++)R=F[r],n=l.hot._acceptedDependencies[R],W.indexOf(n)>=0||W.push(n);for(r=0;r<W.length;r++){n=W[r];try{n(F)}catch(e){i.onErrored&&i.onErrored({type:"accept-errored",moduleId:u,dependencyId:F[r],error:e}),i.ignoreErrored||L||(L=e)}}}for(r=0;r<V.length;r++){var j=V[r];u=j.module,k=[u];try{p(u)}catch(e){if("function"==typeof j.errorHandler)try{j.errorHandler(e)}catch(t){i.onErrored&&i.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:t,orginalError:e}),i.ignoreErrored||L||(L=t),L||(L=e)}else i.onErrored&&i.onErrored({type:"self-accept-errored",moduleId:u,error:e}),i.ignoreErrored||L||(L=e)}}return L?(a("fail"),Promise.reject(L)):(a("idle"),new Promise(function(e){e(c)}))}function p(t){if(S[t])return S[t].exports;var i=S[t]={i:t,l:!1,exports:{},hot:r(t),parents:(A=k,k=[],A),children:[]};return e[t].call(i.exports,i,i.exports,n(t)),i.l=!0,i.exports}var v=this.webpackHotUpdate;this.webpackHotUpdate=function(e,t){l(e,t),v&&v(e,t)};var f,m,g,y,_=!0,b="13f87ce5e7ffeb2a618b",w={},k=[],A=[],T=[],C="idle",E=0,P=0,V={},I={},x={},S={};return p.m=e,p.c=S,p.i=function(e){return e},p.d=function(e,t,i){p.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},p.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return p.d(t,"a",t),t},p.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},p.p="",p.h=function(){return b},n(0)(p.s=0)}({"./src/index.js":function(e,t,i){"use strict";var s=i("./src/oppsula.js");try{if(window.cmTag){var n=window.cmTag.config.ms||{};n.oppsula=n.oppsula||{},n.oppsula["1.3.8"]=s,window.cmTag.set("ms",n)}}catch(e){}try{window.TRC&&(window.TRC.oppsula=window.TRC.oppsula||{},window.TRC.oppsula["1.3.8"]=s)}catch(e){}e.exports={}},"./src/opportunityType.js":function(e,t,i){"use strict";e.exports={tagStarted:0,tagImpression:1,vastFecthError:2,emptyVast:3,mediaFileNotSupported:4,adError:5,filterVastByRegex:6,playerClosed:7,vastError:8,totalTimeout:9,adErrorBeforeLoad:10,networkError:11,adUnitLoadFailed:12,queueExpired:13,queueTrimmed:14,globalTimeout:15,adtoTimeout:16,adSkiped:17,adloadedTimeout:18,hijackAttempt:19,idleMode:20,firstImpression:99,videoFirstQuartile:21,videoMidpoint:22,videoThirdQuartile:23,videoComplete:24,newCompletion:25,replayAd:27,soundViolation:34,firstWfMeasurment:35,playerClosedMeasurment:36,maxNetworkCalls:39,adLoaded:41,startAd:42,videoThrottle:43}},"./src/oppsula.js":function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),r=i("./src/xhr.js"),a=i("./src/store.js"),o=i("./src/utils.js"),d=i("./src/opportunityType.js"),l={},u=function(){function e(t,i){s(this,e);var n=this._getRedId(t)||this._getRedId(i)||"red_id";return l.hasOwnProperty(n)||(this.redId=n,this.store=new a(t,i),this.baseUrl=o.getOppsServletBaseUrl(this.store),this.xhr=new r(this.baseUrl,this.store.get("psthdrs")),this.opps=[],this.fireOppsInterval=null,this.stopped=!1,this.billableEvents=(this.store.get("bllblevt")||"").split(","),this.unloadCallbacks=[],this.fireOppsCallbacks=[],this._setFireOppsInterval(),this.unloadEventName=o.isOnIOS()?"pagehide":"beforeunload",this._setFireOppsBeforeUnload(),l[n]=this),l[n]}return n(e,[{key:"registerCallback",value:function(e,t){this[e].push(t)}},{key:"unRegisterCallback",value:function(e,t){this[e].splice(this[e].indexOf(t),1)}},{key:"_activateCallbacks",value:function(e){for(var t=0;t<this[e].length;t++){var i=this[e][t];this[e].splice(this[e].indexOf(i),1),i()}}},{key:"_getRedId",value:function(e){if(e)return e.get("redId")||e.get("red_id")}},{key:"send",value:function(e){e.tms=Date.now(),this.stopped||(this._isBillableEvent(e.rst)||!this.store.get("cmbopps")?this.xhr.send(o.stringify([e]),e.rst):this.opps.push(e))}},{key:"_setFireOppsInterval",value:function(){this.stopped||this.fireOppsInterval||(this.fireOpps=this._fireOpps.bind(this),this.fireOppsInterval=setInterval(this.fireOpps,this.store.get("timbtopps")))}},{key:"destroy",value:function(){this.stopped||(this._activateCallbacks("unloadCallbacks"),window.removeEventListener(this.unloadEventName,this._destroy),this.fireOppsInterval=clearInterval(this.fireOppsInterval),this._fireOpps(),this.stopped=!0,this.store&&this.store.destroy(),this.opps=this.store=this.fireOpps=this.xhr=this._destroy=void 0,l[this.redId]=void 0)}},{key:"_fireOpps",value:function(){this.stopped||(this._activateCallbacks("fireOppsCallbacks"),this.opps.length>0&&this.xhr.send(o.stringify(this.opps)),this.opps=[])}},{key:"_setFireOppsBeforeUnload",value:function(){this._destroy=this.destroy.bind(this),window.addEventListener(this.unloadEventName,this._destroy)}},{key:"_isBillableEvent",value:function(e){return this.billableEvents.indexOf(""+e)>-1}},{key:"OppsID",get:function(){return d}}]),e}();e.exports=u},"./src/store.js":function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),r=(i("./src/utils.js"),function(){function e(t,i){s(this,e),this.unitModel=t,this.playerModel=i,this.data={psthdrs:"application/json",timbtopps:2e3}}return n(e,[{key:"get",value:function(e){return this._getFromPlayerModel(e)}},{key:"_getFromPlayerModel",value:function(e){var t=this.playerModel?this.playerModel.get(e):void 0;return void 0!==t?t:this._getFromUnitModel(e)}},{key:"_getFromUnitModel",value:function(e){var t=this.unitModel?this.unitModel.get(e):void 0;return void 0!==t?t:this._getFromData(e)}},{key:"_getFromData",value:function(e){return e=e.toString(),-1===e.indexOf(".")?this.data[e]:a.get(e,!1,this.data)}},{key:"set",value:function(e,t){e=e.toString(),a.set(e,t,this.data)}},{key:"destroy",value:function(){this.unitModel=this.playerModel=this.data=void 0}}]),e}()),a=function(){var e=function(e,t,i){for(var s,n=i||data,r=0;n&&(s=e[r]);r++)n=s in n?n[s]:t?n[s]={}:void 0;return n};return{set:function(t,i,s){var n=t.split("."),r=n.pop(),a=e(n,!0,s);return a&&r?a[r]=i:void 0},get:function(t,i,s){return e(t.split("."),i,s)},exists:function(e,t){return void 0!==this.get(e,!1,t)}}}();e.exports=r},"./src/utils.js":function(e,t,i){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={getOppsServletBaseUrl:function(e){var t=e.get("ms_data.opps_base_path");return this.setUrlPrefix(t)+(/.*\/$/g.test(t)?"":"/")+"OpportunityServlet"},setUrlPrefix:function(e){return"string"!=typeof e?e:(e=e.replace(/^(http[s]?:|ftp:)/g,""),0!==e.indexOf("//")&&(e="//"+e),e)},stringify:function(e,t){try{var i=[];return JSON.stringify(e,function(e,t){if(null!=t&&"object"==(void 0===t?"undefined":s(t))){if(i.indexOf(t)>-1)return;i.push(t)}return t},t)}catch(e){return""}},fireOpp:function(e){try{(new Image).src=e}catch(e){}},flattenParams:function(e){var t=[];for(var i in e)t.push(i+"="+e[i]);return t.join("&")},isOnIOS:function(){return navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)}}},"./src/xhr.js":function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),r=(i("./src/utils.js"),function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;arguments.length>5&&void 0!==arguments[5]&&arguments[5],s(this,e),this.baseUrl=t,this.async=void 0==n||n,this.withCredentials=void 0==r||r,this.timeout=a||5e3,this.contentType=i||"application/x-www-form-urlencoded"}return n(e,[{key:"_onFail",value:function(){this.gotResponse||(this.gotResponse=!0)}},{key:"send",value:function(e,t){if(this.baseUrl){var i=this.baseUrl+(void 0!==t?"?rst="+t:""),s=new XMLHttpRequest;return e=e||"",s.open(e?"POST":"GET",i,!0),s.withCredentials=this.withCredentials,s.setRequestHeader("Content-type",this.contentType),s.async=this.async,s.timeout=this.timeout,s.gotResponse=!1,s.addEventListener("error",this._onFail),s.addEventListener("abort",this._onFail),s.addEventListener("timeout",this._onFail),s.addEventListener("readystatechange",function(e){if(4==this.readyState){if(this.gotResponse)return;this.gotResponse=!0}}),s.send(e),!0}}}]),e}());e.exports=r},0:function(e,t,i){e.exports=i("./src/index.js")}})})},function(e,t){function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function n(e){if(u===setTimeout)return setTimeout(e,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function r(e){if(h===clearTimeout)return clearTimeout(e);if((h===s||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{return h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}function a(){f&&p&&(f=!1,p.length?v=p.concat(v):m=-1,v.length&&o())}function o(){if(!f){var e=n(a);f=!0;for(var t=v.length;t;){for(p=v,v=[];++m<t;)p&&p[m].run();m=-1,t=v.length}p=null,f=!1,r(e)}}function d(e,t){this.fun=e,this.array=t}function l(){}var u,h,c=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:i}catch(e){u=i}try{h="function"==typeof clearTimeout?clearTimeout:s}catch(e){h=s}}();var p,v=[],f=!1,m=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];v.push(new d(e,t)),1!==v.length||f||n(o)},d.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=l,c.addListener=l,c.once=l,c.off=l,c.removeListener=l,c.removeAllListeners=l,c.emit=l,c.prependListener=l,c.prependOnceListener=l,c.listeners=function(e){return[]},c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},function(e,t,i){function s(e,t){for(var i=0;i<e.length;i++){var s=e[i],n=u[s.id];if(n){n.refs++;for(var r=0;r<n.parts.length;r++)n.parts[r](s.parts[r]);for(;r<s.parts.length;r++)n.parts.push(a(s.parts[r],t))}else{for(var o=[],r=0;r<s.parts.length;r++)o.push(a(s.parts[r],t));u[s.id]={id:s.id,refs:1,parts:o}}}}function n(e){for(var t=[],i={},s=0;s<e.length;s++){var n=e[s],r=n[0],a=n[1],o=n[2],d=n[3],l={css:a,media:o,sourceMap:d};i[r]?i[r].parts.push(l):t.push(i[r]={id:r,parts:[l]})}return t}function r(){var e=document.createElement("style"),t=p();return e.type="text/css",t.appendChild(e),e}function a(e,t){var i,s,n;if(t.singleton){var a=f++;i=v||(v=r()),s=d.bind(null,i,a,!1),n=d.bind(null,i,a,!0)}else i=r(),s=l.bind(null,i),n=function(){i.parentNode.removeChild(i)};return s(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;s(e=t)}else n()}}function o(e,t,i){var s=["/** >>"+t+" **/","/** "+t+"<< **/"],n=e.lastIndexOf(s[0]),r=i?s[0]+i+s[1]:"";if(e.lastIndexOf(s[0])>=0){var a=e.lastIndexOf(s[1])+s[1].length;return e.slice(0,n)+r+e.slice(a)}return e+r}function d(e,t,i,s){var n=i?"":s.css;if(e.styleSheet)e.styleSheet.cssText=o(e.styleSheet.cssText,t,n);else{var r=document.createTextNode(n),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function l(e,t){var i=t.css,s=t.media,n=t.sourceMap;if(n&&"function"==typeof btoa)try{i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(JSON.stringify(n))+" */",i='@import url("data:text/css;base64,'+btoa(i)+'")'}catch(e){}if(s&&e.setAttribute("media",s),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var u={},h=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},c=h(function(){return/msie 9\b/.test(window.navigator.userAgent.toLowerCase())}),p=h(function(){return document.head||document.getElementsByTagName("head")[0]}),v=null,f=0;e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=c());var i=n(e);return s(i,t),function(e){for(var r=[],a=0;a<i.length;a++){var o=i[a],d=u[o.id];d.refs--,r.push(d)}if(e){var l=n(e);s(l,t)}for(var a=0;a<r.length;a++){var d=r[a];if(0===d.refs){for(var h=0;h<d.parts.length;h++)d.parts[h]();delete u[d.id]}}}}},function(e,t,i){var s=i(78);"string"==typeof s&&(s=[[e.id,s,""]]),i(84)(s,{})},function(e,t){e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,i=[],s=0;s<e.rangeCount;s++)i.push(e.getRangeAt(s));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||i.forEach(function(t){e.addRange(t)}),t&&t.focus()}}},function(e,t){function i(e){for(var t={name:void 0,version:void 0,major:void 0},i=0;i<e.length;i++){var n=e[i],d=n.rgx.exec(r);if(d){var l=n.hasOwnProperty("nameIndex")?n.nameIndex:a,u=n.hasOwnProperty("versionIndex")?n.versionIndex:o,h=n.hasOwnProperty("nameReplacement")?n.nameReplacement:null,c=n.hasOwnProperty("versionReplacement")?n.versionReplacement:null;t.name=d[l],null!==h&&(t.name="string"==typeof h?h:h(t.name));var p=d[u];null!==c&&(p="string"==typeof c?c:c(p)),t.version=p,t.major=s(p);break}}return t}function s(e){if("string"==typeof e)return e.replace(/[^\d\.]/g,"").split(".")[0]}function n(e,t){if("string"==typeof t)for(var i in e)if("string"==typeof e[i]){if(t.indexOf(e[i])>-1)return i}else for(var s=0;s<e[i].length;s++)if(t.indexOf(e[i][s])>-1)return i}var r=window.navigator.userAgent,a=1,o=2,d={"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419"},l={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},u=[{rgx:/(opera\smini)\/([\w\.-]+)/i},{rgx:/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i},{rgx:/(opera).+version\/([\w\.]+)/i},{rgx:/(opera)[\/\s]+([\w\.]+)/i},{rgx:/(opios)[\/\s]+([\w\.]+)/i,nameReplacement:"Opera Mini"},{rgx:/\s(opr)\/([\w\.]+)/i,nameReplacement:"Opera"},{rgx:/(kindle)\/([\w\.]+)/i},{rgx:/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i},{rgx:/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i},{rgx:/(?:ms|\()(ie)\s([\w\.]+)/i},{rgx:/(rekonq)\/([\w\.]+)*/i},{rgx:/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i},{rgx:/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i,nameReplacement:"IE"},{rgx:/(edg[e]*)\/((\d+)?[\w\.]+)/i},{rgx:/(yabrowser)\/([\w\.]+)/i,nameReplacement:"Yandex"},{rgx:/(comodo_dragon)\/([\w\.]+)/i,nameReplacement:function(e){return e.replace(/_/g," ")}},{rgx:/(micromessenger)\/([\w\.]+)/i,nameReplacement:"WeChat"},{rgx:/xiaomi\/miuibrowser\/([\w\.]+)/i,nameReplacement:"MIUI Browser",versionIndex:1,nameIndex:2},{rgx:/\swv\).+(chrome)\/([\w\.]+)/i,nameReplacement:function(e){return e.replace(/(.+)/,"$1 WebView")}},{rgx:/android.+samsungbrowser\/([\w\.]+)/i,nameReplacement:"Android Browser",versionIndex:1,nameIndex:2},{rgx:/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i,nameReplacement:"Android Browser",versionIndex:1,nameIndex:2},{rgx:/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i},{rgx:/(qqbrowser)[\/\s]?([\w\.]+)/i},{rgx:/(uc\s?browser)[\/\s]?([\w\.]+)/i,nameReplacement:"UCBrowser"},{rgx:/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,nameReplacement:"UCBrowser"},{rgx:/juc.+(ucweb)[\/\s]?([\w\.]+)/i,nameReplacement:"UCBrowser"},{rgx:/(dolfin)\/([\w\.]+)/i,nameReplacement:"Dolphin"},{rgx:/((?:android.+)crmo|crios)\/([\w\.]+)/i,nameReplacement:"Chrome"},{rgx:/;fbav\/([\w\.]+);/i,nameReplacement:"Facebook",versionIndex:1,nameIndex:2},{rgx:/fxios\/([\w\.-]+)/i,nameReplacement:"Firefox",versionIndex:1,nameIndex:2},{rgx:/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i,nameReplacement:"Mobile Safari",versionIndex:1,nameIndex:2},{rgx:/version\/([\w\.]+).+?(mobile\s?safari|safari)/i,versionIndex:1,nameIndex:2},{rgx:/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i,versionReplacement:n.bind(this,d)},{rgx:/(konqueror)\/([\w\.]+)/i},{rgx:/(webkit|khtml)\/([\w\.]+)/i},{rgx:/(navigator|netscape)\/([\w\.-]+)/i,nameReplacement:"Netscape"},{rgx:/(swiftfox)/i},{rgx:/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i},{rgx:/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i},{rgx:/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i},{rgx:/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i},{rgx:/(links)\s\(([\w\.]+)/i},{rgx:/(gobrowser)\/?([\w\.]+)*/i},{rgx:/(ice\s?browser)\/v?([\w\._]+)/i},{rgx:/(mosaic)[\/\s]([\w\.]+)/i}],h=[{rgx:/microsoft\s(windows)\s(vista|xp)/i},{rgx:/(windows)\snt\s6\.2;\s(arm)/i,versionReplacement:n.bind(this,l)},{rgx:/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,versionReplacement:n.bind(this,l)},{rgx:/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i,versionReplacement:n.bind(this,l)},{rgx:/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i,nameReplacement:"Windows",versionReplacement:n.bind(this,l)},{rgx:/\((bb)(10);/i,nameReplacement:"BlackBerry"},{rgx:/(blackberry)\w*\/?([\w\.]+)*/i},{rgx:/(tizen)[\/\s]([\w\.]+)/i},{rgx:/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i},{rgx:/linux;.+(sailfish);/i},{rgx:/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i,nameReplacement:"Symbian"},{rgx:/\((series40);/i,versionReplacement:""},{rgx:/mozilla.+\(mobile;.+gecko.+firefox/i,nameReplacement:"Firefox OS"},{rgx:/(nintendo|playstation)\s([wids34portablevu]+)/i},{rgx:/(mint)[\/\s\(]?(\w+)*/i},{rgx:/(mageia|vectorlinux)[;\s]/i},{rgx:/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i},{rgx:/(hurd|linux)\s?([\w\.]+)*/i},{rgx:/(gnu)\s?([\w\.]+)*/i},{rgx:/(cros)\s[\w]+\s([\w\.]+\w)/i,nameReplacement:"Chromium OS"},{rgx:/(sunos)\s?([\w\.]+\d)*/i,nameReplacement:"Solaris"},{rgx:/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i},{rgx:/(haiku)\s(\w+)/i},{rgx:/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i,nameReplacement:"iOS",versionReplacement:function(e){return e.replace(/_/g,".")}},{rgx:/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,nameReplacement:"Mac OS",versionReplacement:function(e){return e.replace(/_/g,".")}},{rgx:/(macintosh|mac(?=_powerpc)\s)/i,nameReplacement:"Mac OS",versionReplacement:function(e){return e.replace(/_/g,".")}},{rgx:/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i},{rgx:/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i},{rgx:/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i},{rgx:/(unix)\s?([\w\.]+)*/i}];e.exports={parseUserAgent:function(){return{browser:i(u,!0),os:i(h,!1)}}}},function(e,t){!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,s){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var n in e)t.d(s,n,function(t){return e[t]}.bind(null,n));return s},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="./",t(t.s=1)}([function(e,t,i){"use strict";function s(){s.init.call(this)}function n(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function r(e,t,i,s){var r,a,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),o=a[t]),void 0===o)o=a[t]=i,++e._eventsCount;else if("function"==typeof o?o=a[t]=s?[i,o]:[o,i]:s?o.unshift(i):o.push(i),0<(r=n(e))&&o.length>r&&!o.warned){o.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=o.length,function(e){console&&console.warn&&console.warn(e)}(d)}return e}function a(e,t,i){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,c(this.listener,this.target,e))}.bind(s);return n.listener=i,s.wrapFn=n}function o(e,t,i){var s=e._events;if(void 0===s)return[];var n=s[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):l(n,n.length)}function d(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function l(e,t){for(var i=new Array(t),s=0;s<t;++s)i[s]=e[s];return i}var u,h="object"==typeof Reflect?Reflect:null,c=h&&"function"==typeof h.apply?h.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};u=h&&"function"==typeof h.ownKeys?h.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var p=Number.isNaN||function(e){return e!=e};((e.exports=s).EventEmitter=s).prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var v=10;Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(e){if("number"!=typeof e||e<0||p(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");v=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||p(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return n(this)},s.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var s="error"===e,n=this._events;if(void 0!==n)s=s&&void 0===n.error;else if(!s)return!1;if(s){var r;if(0<t.length&&(r=t[0]),r instanceof Error)throw r;var a=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw a.context=r,a}var o=n[e];if(void 0===o)return!1;if("function"==typeof o)c(o,this,t);else{var d=o.length,u=l(o,d);for(i=0;i<d;++i)c(u[i],this,t)}return!0},s.prototype.on=s.prototype.addListener=function(e,t){return r(this,e,t,!1)},s.prototype.prependListener=function(e,t){return r(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,a(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,a(this,e,t)),this},s.prototype.off=s.prototype.removeListener=function(e,t){var i,s,n,r,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(s=this._events))return this;if(void 0===(i=s[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,r=i.length-1;0<=r;r--)if(i[r]===t||i[r].listener===t){a=i[r].listener,n=r;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(s[e]=i[0]),void 0!==s.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.removeAllListeners=function(e){var t,i,s;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,r=Object.keys(i);for(s=0;s<r.length;++s)"removeListener"!==(n=r[s])&&this.removeAllListeners(n);
return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;0<=s;s--)this.removeListener(e,t[s]);return this},s.prototype.listeners=function(e){return o(this,e,!0)},s.prototype.rawListeners=function(e){return o(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},s.prototype.listenerCount=d,s.prototype.eventNames=function(){return 0<this._eventsCount?u(this._events):[]}},function(e,t,i){e.exports=i(3)},function(e,t){function i(e){for(var t={name:void 0,version:void 0,major:void 0},i=0;i<e.length;i++){var n=e[i],d=n.rgx.exec(r);if(d){var l=n.hasOwnProperty("nameIndex")?n.nameIndex:a,u=n.hasOwnProperty("versionIndex")?n.versionIndex:o,h=n.hasOwnProperty("nameReplacement")?n.nameReplacement:null,c=n.hasOwnProperty("versionReplacement")?n.versionReplacement:null;t.name=d[l],null!==h&&(t.name="string"==typeof h?h:h(t.name));var p=d[u];null!==c&&(p="string"==typeof c?c:c(p)),t.version=p,t.major=s(p);break}}return t}function s(e){if("string"==typeof e)return e.replace(/[^\d\.]/g,"").split(".")[0]}function n(e,t){if("string"==typeof t)for(var i in e)if("string"==typeof e[i]){if(-1<t.indexOf(e[i]))return i}else for(var s=0;s<e[i].length;s++)if(-1<t.indexOf(e[i][s]))return i}var r=window.navigator.userAgent,a=1,o=2,d={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},l=[{rgx:/(opera\smini)\/([\w\.-]+)/i},{rgx:/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i},{rgx:/(opera).+version\/([\w\.]+)/i},{rgx:/(opera)[\/\s]+([\w\.]+)/i},{rgx:/(opios)[\/\s]+([\w\.]+)/i,nameReplacement:"Opera Mini"},{rgx:/\s(opr)\/([\w\.]+)/i,nameReplacement:"Opera"},{rgx:/(kindle)\/([\w\.]+)/i},{rgx:/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i},{rgx:/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i},{rgx:/(?:ms|\()(ie)\s([\w\.]+)/i},{rgx:/(rekonq)\/([\w\.]+)*/i},{rgx:/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i},{rgx:/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i,nameReplacement:"IE"},{rgx:/(edg[e]*)\/((\d+)?[\w\.]+)/i},{rgx:/(yabrowser)\/([\w\.]+)/i,nameReplacement:"Yandex"},{rgx:/(comodo_dragon)\/([\w\.]+)/i,nameReplacement:function(e){return e.replace(/_/g," ")}},{rgx:/(micromessenger)\/([\w\.]+)/i,nameReplacement:"WeChat"},{rgx:/xiaomi\/miuibrowser\/([\w\.]+)/i,nameReplacement:"MIUI Browser",versionIndex:1,nameIndex:2},{rgx:/\swv\).+(chrome)\/([\w\.]+)/i,nameReplacement:function(e){return e.replace(/(.+)/,"$1 WebView")}},{rgx:/android.+samsungbrowser\/([\w\.]+)/i,nameReplacement:"Android Browser",versionIndex:1,nameIndex:2},{rgx:/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i,nameReplacement:"Android Browser",versionIndex:1,nameIndex:2},{rgx:/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i},{rgx:/(qqbrowser)[\/\s]?([\w\.]+)/i},{rgx:/(uc\s?browser)[\/\s]?([\w\.]+)/i,nameReplacement:"UCBrowser"},{rgx:/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,nameReplacement:"UCBrowser"},{rgx:/juc.+(ucweb)[\/\s]?([\w\.]+)/i,nameReplacement:"UCBrowser"},{rgx:/(dolfin)\/([\w\.]+)/i,nameReplacement:"Dolphin"},{rgx:/((?:android.+)crmo|crios)\/([\w\.]+)/i,nameReplacement:"Chrome"},{rgx:/;fbav\/([\w\.]+);/i,nameReplacement:"Facebook",versionIndex:1,nameIndex:2},{rgx:/fxios\/([\w\.-]+)/i,nameReplacement:"Firefox",versionIndex:1,nameIndex:2},{rgx:/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i,nameReplacement:"Mobile Safari",versionIndex:1,nameIndex:2},{rgx:/version\/([\w\.]+).+?(mobile\s?safari|safari)/i,versionIndex:1,nameIndex:2},{rgx:/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i,versionReplacement:n.bind(this,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419"})},{rgx:/(konqueror)\/([\w\.]+)/i},{rgx:/(webkit|khtml)\/([\w\.]+)/i},{rgx:/(navigator|netscape)\/([\w\.-]+)/i,nameReplacement:"Netscape"},{rgx:/(swiftfox)/i},{rgx:/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i},{rgx:/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i},{rgx:/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i},{rgx:/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i},{rgx:/(links)\s\(([\w\.]+)/i},{rgx:/(gobrowser)\/?([\w\.]+)*/i},{rgx:/(ice\s?browser)\/v?([\w\._]+)/i},{rgx:/(mosaic)[\/\s]([\w\.]+)/i}],u=[{rgx:/microsoft\s(windows)\s(vista|xp)/i},{rgx:/(windows)\snt\s6\.2;\s(arm)/i,versionReplacement:n.bind(this,d)},{rgx:/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,versionReplacement:n.bind(this,d)},{rgx:/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i,versionReplacement:n.bind(this,d)},{rgx:/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i,nameReplacement:"Windows",versionReplacement:n.bind(this,d)},{rgx:/\((bb)(10);/i,nameReplacement:"BlackBerry"},{rgx:/(blackberry)\w*\/?([\w\.]+)*/i},{rgx:/(tizen)[\/\s]([\w\.]+)/i},{rgx:/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i},{rgx:/linux;.+(sailfish);/i},{rgx:/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i,nameReplacement:"Symbian"},{rgx:/\((series40);/i,versionReplacement:""},{rgx:/mozilla.+\(mobile;.+gecko.+firefox/i,nameReplacement:"Firefox OS"},{rgx:/(nintendo|playstation)\s([wids34portablevu]+)/i},{rgx:/(mint)[\/\s\(]?(\w+)*/i},{rgx:/(mageia|vectorlinux)[;\s]/i},{rgx:/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i},{rgx:/(hurd|linux)\s?([\w\.]+)*/i},{rgx:/(gnu)\s?([\w\.]+)*/i},{rgx:/(cros)\s[\w]+\s([\w\.]+\w)/i,nameReplacement:"Chromium OS"},{rgx:/(sunos)\s?([\w\.]+\d)*/i,nameReplacement:"Solaris"},{rgx:/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i},{rgx:/(haiku)\s(\w+)/i},{rgx:/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i,nameReplacement:"iOS",versionReplacement:function(e){return e.replace(/_/g,".")}},{rgx:/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,nameReplacement:"Mac OS",versionReplacement:function(e){return e.replace(/_/g,".")}},{rgx:/(macintosh|mac(?=_powerpc)\s)/i,nameReplacement:"Mac OS",versionReplacement:function(e){return e.replace(/_/g,".")}},{rgx:/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i},{rgx:/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i},{rgx:/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i},{rgx:/(unix)\s?([\w\.]+)*/i}];e.exports={parseUserAgent:function(){return{browser:i(l),os:i(u)}}}},function(e,t,i){"use strict";function s(e,t,i,s){var n="alt_"+t;e.hasOwnProperty(n)||(e[n]="",Object.defineProperty(e,t,{get:function(){return i?i():this[n]},set:function(i){this[n]=i,s&&s(i)&&e.setAttribute(t,i)}}))}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e){function t(e,t){for(var i in t)e.style[i]=t[i]}var i=e.dataset.url;if(!i)throw"VideoElement has no `data-url` attribute";this.container=e,t(this.container,{display:"inline-block",position:"relative",minWidth:"80px",minHeight:"80px"}),this.canvas=document.createElement("canvas"),this.canvas.width=960,this.canvas.height=540,t(this.canvas,{display:"block",width:"100%"}),this.container.appendChild(this.canvas),this.playButton=document.createElement("div"),this.playButton.innerHTML=u.PLAY_BUTTON,t(this.playButton,{zIndex:2,position:"absolute",top:"0",bottom:"0",left:"0",right:"0",maxWidth:"75px",maxHeight:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.playButton);var s={canvas:this.canvas};for(var n in e.dataset)try{s[n]=JSON.parse(e.dataset[n])}catch(t){s[n]=e.dataset[n]}if(this.player=new B.Player(i,s),!s.poster||s.autoplay||this.player.options.streaming||(s.decodeFirstFrame=!1,this.poster=new Image,this.poster.src=s.poster,this.poster.addEventListener("load",this.posterLoaded),t(this.poster,{display:"block",zIndex:1,position:"absolute",top:0,left:0,bottom:0,right:0}),this.container.appendChild(this.poster)),this.player.options.streaming||this.container.addEventListener("click",this.onClick.bind(this)),(s.autoplay||this.player.options.streaming)&&(this.playButton.style.display="none"),this.player.audioOut&&!this.player.audioOut.unlocked){var r=this.container;(s.autoplay||this.player.options.streaming)&&(this.unmuteButton=document.createElement("div"),this.unmuteButton.innerHTML=u.UNMUTE_BUTTON,t(this.unmuteButton,{zIndex:2,position:"absolute",bottom:"10px",right:"20px",width:"75px",height:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.unmuteButton),r=this.unmuteButton),this.unlockAudioBound=this.onUnlockAudio.bind(this,r),r.addEventListener("touchstart",this.unlockAudioBound,!1),r.addEventListener("click",this.unlockAudioBound,!0)}}function h(e,t){this.options=t||{},e.match(/^wss?:\/\//)?(this.source=new B.Source.WebSocket(e,t),t.streaming=!0):(!1!==t.progressive?this.source=new B.Source.AjaxProgressive(e,t):this.source=new B.Source.Ajax(e,t),t.streaming=!1),this.maxAudioLag=t.maxAudioLag||.25,this.loop=!1!==t.loop,this.autoplay=!!t.autoplay||t.streaming,this.onFinished=t.onfinished,this.demuxer=new B.Demuxer.TS(t),this.source.connect(this.demuxer),!1!==t.video&&(this.video=new B.Decoder.MPEG1Video(t),this.renderer=!t.disableGl&&B.Renderer.WebGL.IsSupported()?new B.Renderer.WebGL(t):new B.Renderer.Canvas2D(t),this.demuxer.connect(B.Demuxer.TS.STREAM.VIDEO_1,this.video),this.video.connect(this.renderer)),!1!==t.audio&&B.AudioOutput.WebAudio.IsSupported()&&(this.audio=new B.Decoder.MP2Audio(t),this.audioOut=new B.AudioOutput.WebAudio(t),this.demuxer.connect(B.Demuxer.TS.STREAM.AUDIO_1,this.audio),this.audio.connect(this.audioOut)),Object.defineProperty(this,"currentTime",{get:this.getCurrentTime,set:this.setCurrentTime}),Object.defineProperty(this,"volume",{get:this.getVolume,set:this.setVolume}),(this.unpauseOnShow=!1)!==t.pauseWhenHidden&&document.addEventListener("visibilitychange",this.showHide.bind(this)),this.source.start(),this.autoplay&&this.play()}function c(e,t){"object"===l(e)?(this.bytes=e instanceof Uint8Array?e:new Uint8Array(e),this.byteLength=this.bytes.length):(this.bytes=new Uint8Array(e||1048576),this.byteLength=0),this.mode=t||c.MODE.EXPAND,this.index=0}function p(e,t){this.url=e,this.destination=null,this.request=null,this.completed=!1,this.established=!1,this.progress=0,this.onReadyCblk=t.onload,this.errHandler=t.errHndlr}function v(e,t){this.url=e,this.destination=null,this.request=null,this.completed=!1,this.established=!1,this.progress=0,this.fileSize=0,this.loadedSize=0,this.chunkSize=t.chunkSize||1048576,this.isLoading=!1,this.loadStartTime=0,this.throttled=!1!==t.throttled}function f(e,t){this.url=e,this.socket=null,this.callbacks={connect:[],data:[]},this.destination=null,this.reconnectInterval=t.reconnectInterval||5,this.shouldAttemptReconnect=!!this.reconnectInterval,this.completed=!1,this.established=!1,this.progress=0}function m(e){this.bits=null,this.leftoverBytes=null,this.guessVideoFrameEnd=!0,this.pidsToStreamIds={},this.pesPacketInfo={},this.startTime=0,this.currentTime=0}function g(e){this.destination=null,this.canPlay=!1,this.collectTimestamps=!e.streaming,this.timestamps=[],this.timestampIndex=0,this.startTime=0,this.decodedTime=0,Object.defineProperty(this,"currentTime",{get:this.getCurrentTime})}function y(e){B.Decoder.Base.call(this,e);var t=e.videoBufferSize||524288,i=e.streaming?B.BitBuffer.MODE.EVICT:B.BitBuffer.MODE.EXPAND;this.bits=new B.BitBuffer(t,i),this.customIntraQuantMatrix=new Uint8Array(64),this.customNonIntraQuantMatrix=new Uint8Array(64),this.blockData=new Int32Array(64),this.currentFrame=0,this.decodeFirstFrame=!1!==e.decodeFirstFrame}function _(e){B.Decoder.Base.call(this,e);var t=e.audioBufferSize||131072,i=e.streaming?B.BitBuffer.MODE.EVICT:B.BitBuffer.MODE.EXPAND;this.bits=new B.BitBuffer(t,i),this.left=new Float32Array(1152),this.right=new Float32Array(1152),this.sampleRate=44100,this.D=new Float32Array(1024),this.D.set(_.SYNTHESIS_WINDOW,0),this.D.set(_.SYNTHESIS_WINDOW,512),this.V=new Float32Array(1024),this.U=new Int32Array(32),this.VPos=0,this.allocation=[new Array(32),new Array(32)],this.scaleFactorInfo=[new Uint8Array(32),new Uint8Array(32)],this.scaleFactor=[new Array(32),new Array(32)],this.sample=[new Array(32),new Array(32)];for(var s=0;s<2;s++)for(var n=0;n<32;n++)this.scaleFactor[s][n]=[0,0,0],this.sample[s][n]=[0,0,0]}function b(e){this.canvas=e.canvas||document.createElement("canvas"),this.width=this.canvas.width,this.height=this.canvas.height,this.enabled=!0;var t={preserveDrawingBuffer:!!e.preserveDrawingBuffer,alpha:!1,depth:!1,stencil:!1,antialias:!1};if(this.gl=this.canvas.getContext("webgl",t)||this.canvas.getContext("experimental-webgl",t),!this.gl)throw new Error("Failed to get WebGL Context");var i=this.gl,s=null,n=i.createBuffer(),r=new Float32Array([0,0,0,1,1,0,1,1]);i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,r,i.STATIC_DRAW),this.program=this.createProgram(b.SHADER.VERTEX_IDENTITY,b.SHADER.FRAGMENT_YCRCB_TO_RGBA),s=i.getAttribLocation(this.program,"vertex"),i.enableVertexAttribArray(s),i.vertexAttribPointer(s,2,i.FLOAT,!1,0,0),this.textureY=this.createTexture(0,"textureY"),this.textureCb=this.createTexture(1,"textureCb"),this.textureCr=this.createTexture(2,"textureCr"),this.loadingProgram=this.createProgram(b.SHADER.VERTEX_IDENTITY,b.SHADER.FRAGMENT_LOADING),s=i.getAttribLocation(this.loadingProgram,"vertex"),i.enableVertexAttribArray(s),i.vertexAttribPointer(s,2,i.FLOAT,!1,0,0),this.shouldCreateUnclampedViews=!this.allowsClampedTextureData()}function w(e){this.canvas=e.canvas||document.createElement("canvas"),this.width=this.canvas.width,this.height=this.canvas.height,this.enabled=!0,this.context=this.canvas.getContext("2d")}function k(e){this.context=k.CachedContext=k.CachedContext||new(window.AudioContext||window.webkitAudioContext),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.destination=this.gain,this.startTime=0,this.buffer=null,this.wallclockStartTime=0,this.volume=1,this.enabled=!0,this.unlocked=!k.NeedsUnlocking(),Object.defineProperty(this,"enqueuedTime",{get:this.getEnqueuedTime})}function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function C(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function V(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}function x(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}i.r(t);var S=i(0),D=function(){function e(t){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(i=a(this,o(e).call(this))).params=t,i.os=i.params.userAgent.os.name,i.osVersion=parseInt(i.params.userAgent.os.version),i.browserName=i.params.userAgent.browser.name,i.browserMajorVersion=parseInt(i.params.userAgent.browser.major),window.navigator&&window.navigator.userAgent&&-1<window.navigator.userAgent.indexOf("UCBrowser")&&(i.browserName="UCBrowser"),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(e,S.EventEmitter),function(e,t,i){t&&r(e.prototype,t),i&&r(e,i)}(e,[{key:"isAutoplaySupported",value:function(){var e=this._isAutoplaySupportedByOS();e&&"Android"===this.os&&(e=!this._isDataSaverOn()),this._emitDetectionResult(e)}},{key:"_isAutoplaySupportedByOS",value:function(){switch(this.os){case"Android":return this.isAutoplaySupportedAndroid();case"iOS":return this.isAutoplaySupportedIOS();default:return!1}}},{key:"isAutoplaySupportedIOS",value:function(){if(this.osVersion<10)return!1;switch(this.browserName){case"Firefox":return 7<=this.browserMajorVersion;default:return!0}}},{key:"isAutoplaySupportedAndroid",value:function(){switch(this.browserName){case"Chrome":case"Chrome WebView":return 53<=parseInt(this.browserMajorVersion);case"Firefox":return 49<=parseInt(this.browserMajorVersion);case"Android Browser":return 7<=parseInt(this.browserMajorVersion);case"Silk":return 71<=parseInt(this.browserMajorVersion);case"Opera":case"MIUI Browser":case"Yandex":case"UCBrowser":return!0;default:return!1}}},{key:"_isDataSaverOn",value:function(){return this.params.canvas.dataSaverServerSide}},{key:"_emitDetectionResult",value:function(e){this.emit("detectIsAutoplaySupported",e)}}]),e}(),O="content",M={decodeUrl:!1,secureMediaFiles:!1,isMobile:!1,autoplay:!0,userAgent:{},isMultiVpaidUnit:!1,logToBI:function(){},videoState:O,canvas:{onCanvasUsage:function(){},dataSaverServerSide:!1,dataSaverUrl:"//vidutils.taboola.com",disableWebGl:!1,parent:document.body,defaultVolume:.4,aspectRatio:"16:9",canvasLoadRate:5,mpegServerBaseUrl:"//mpg.taboola.com/getts?url",ignoreAutoplayDetection:!1,additionalCss:{},repeat:!1}},B={Player:null,VideoElement:null,BitBuffer:null,Source:{},Demuxer:{},Decoder:{},Renderer:{},AudioOutput:{},Now:function(){return window.performance?window.performance.now()/1e3:Date.now()/1e3},CreateVideoElements:function(){for(var e=document.querySelectorAll(".jsmpeg"),t=0;t<e.length;t++)new B.VideoElement(e[t])},Fill:function(e,t){if(e.fill)e.fill(t);else for(var i=0;i<e.length;i++)e[i]=t}};"complete"===document.readyState?B.CreateVideoElements():document.addEventListener("DOMContentLoaded",B.CreateVideoElements),B.VideoElement=(u.prototype.onUnlockAudio=function(e,t){this.unmuteButton&&(t.preventDefault(),t.stopPropagation()),this.player.audioOut.unlock(function(){this.unmuteButton&&(this.unmuteButton.style.display="none"),e.removeEventListener("touchstart",this.unlockAudioBound),e.removeEventListener("click",this.unlockAudioBound)}.bind(this))},u.prototype.onClick=function(e){this.player.isPlaying?(this.player.pause(),this.playButton.style.display="block"):(this.player.play(),this.playButton.style.display="none",this.poster&&(this.poster.style.display="none"))},u.PLAY_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 200 200" alt="Play video"><circle cx="100" cy="100" r="90" fill="none" stroke-width="15" stroke="#fff"/><polygon points="70, 55 70, 145 145, 100" fill="#fff"/></svg>',u.UNMUTE_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 75 75"><polygon class="audio-speaker" stroke="none" fill="#fff" points="39,13 22,28 6,28 6,47 21,47 39,62 39,13"/><g stroke="#fff" stroke-width="5"><path d="M 49,50 69,26"/><path d="M 69,50 49,26"/></g></svg>',u),B.Player=(h.prototype.showHide=function(e){"hidden"===document.visibilityState?(this.unpauseOnShow=this.wantsToPlay,this.pause()):this.unpauseOnShow&&this.play()},h.prototype.play=function(e){this.isPlaying=!0,this.startTime=B.Now()-this.currentTime,this.animationId=requestAnimationFrame(this.update.bind(this)),this.wantsToPlay=!0},h.prototype.pause=function(e){cancelAnimationFrame(this.animationId),this.wantsToPlay=!1,this.isPlaying=!1,this.audio&&this.audio.canPlay&&(this.audioOut.stop(),this.seek(this.currentTime))},h.prototype.getVolume=function(){return this.audioOut?this.audioOut.volume:0},h.prototype.setVolume=function(e){this.audioOut&&(this.audioOut.volume=e)},h.prototype.stop=function(e){this.pause(),this.seek(0),this.video&&!1!==this.options.decodeFirstFrame&&this.video.decode()},h.prototype.seek=function(e){var t=this.audio&&this.audio.canPlay?this.audio.startTime:this.video.startTime;this.video&&this.video.seek(e+t),this.audio&&this.audio.seek(e+t),this.startTime=B.Now()-e},h.prototype.getCurrentTime=function(){return this.audio&&this.audio.canPlay?this.audio.currentTime-this.audio.startTime:this.video.currentTime-this.video.startTime},h.prototype.setCurrentTime=function(e){this.seek(e)},h.prototype.update=function(){this.isPlaying&&(this.animationId=requestAnimationFrame(this.update.bind(this)),this.source.established?this.options.streaming?this.updateForStreaming():this.updateForStaticFile():this.renderer&&this.renderer.renderProgress(this.source.progress))},h.prototype.updateForStreaming=function(){if(this.video&&this.video.decode(),this.audio){for(;this.audioOut.enqueuedTime>this.maxAudioLag&&(this.audioOut.resetEnqueuedTime(),this.audioOut.enabled=!1),this.audio.decode(););this.audioOut.enabled=!0}},h.prototype.updateForStaticFile=function(){var e=this,t=!1,i=0;if(this.audio&&this.audio.canPlay){for(;!t&&this.audio.decodedTime-this.audio.currentTime<.25;)t=!this.audio.decode();this.video&&this.video.currentTime<this.audio.currentTime&&(t=!this.video.decode()),i=this.demuxer.currentTime-this.audio.currentTime}else if(this.video){var s=B.Now()-this.startTime+this.video.startTime,n=s-this.video.currentTime,r=1/this.video.frameRate;this.video&&0<n&&(2*r<n&&(this.startTime+=n),t=!this.video.decode()),i=this.demuxer.currentTime-s}this.source.resume(i),t&&this.source.completed&&(this.loop?this.seek(0):(this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(function(){e.onFinished()},500),this.pause()))},h),B.BitBuffer=(c.prototype.resize=function(e){var t=new Uint8Array(e);0!==this.byteLength&&(this.byteLength=Math.min(this.byteLength,e),t.set(this.bytes,0,this.byteLength)),this.bytes=t,this.index=Math.min(this.index,this.byteLength<<3)},c.prototype.evict=function(e){var t=this.index>>3,i=this.bytes.length-this.byteLength;return this.index===this.byteLength<<3||i+t<e?(this.byteLength=0,void(this.index=0)):void(0!=t&&(this.bytes.copyWithin?this.bytes.copyWithin(0,t,this.byteLength):this.bytes.set(this.bytes.subarray(t,this.byteLength)),this.byteLength=this.byteLength-t,this.index-=t<<3))},c.prototype.write=function(e){var t="object"===l(e[0]),i=0,s=this.bytes.length-this.byteLength;if(t)for(var n=i=0;n<e.length;n++)i+=e[n].byteLength;else i=e.byteLength;if(s<i)if(this.mode===c.MODE.EXPAND){var r=Math.max(2*this.bytes.length,i-s);this.resize(r)}else this.evict(i);if(t)for(n=0;n<e.length;n++)this.appendSingleBuffer(e[n]);else this.appendSingleBuffer(e)},c.prototype.appendSingleBuffer=function(e){e=e instanceof Uint8Array?e:new Uint8Array(e),this.bytes.set(e,this.byteLength),this.byteLength+=e.length},c.prototype.findNextStartCode=function(){for(var e=this.index+7>>3;e<this.byteLength;e++)if(0==this.bytes[e]&&0==this.bytes[e+1]&&1==this.bytes[e+2])return this.index=e+4<<3,this.bytes[e+3];return this.index=this.byteLength<<3,-1},c.prototype.findStartCode=function(e){for(var t=0;;)if((t=this.findNextStartCode())===e||-1===t)return t;return-1},c.prototype.nextBytesAreStartCode=function(){var e=this.index+7>>3;return e>=this.byteLength||0==this.bytes[e]&&0==this.bytes[1+e]&&1==this.bytes[2+e]},c.prototype.peek=function(e){for(var t=this.index,i=0;e;){var s=8-(7&t),n=s<e?s:e,r=s-n;i=i<<n|(this.bytes[t>>3]&255>>8-n<<r)>>r,t+=n,e-=n}return i},c.prototype.read=function(e){var t=this.peek(e);return this.index+=e,t},c.prototype.skip=function(e){return this.index+=e},c.prototype.rewind=function(e){this.index=Math.max(this.index-e,0)},c.prototype.has=function(e){return(this.byteLength<<3)-this.index>=e},c.MODE={EVICT:1,EXPAND:2},c),B.Source.Ajax=(p.prototype.connect=function(e){this.destination=e},p.prototype.start=function(){this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&200===this.request.status&&(this.onLoad(this.request.response),this.onReadyCblk()),500!==this.request.status&&502!==this.request.status||this.errHandler({err:"error status ".concat(this.request.status," received for url:").concat(this.url)})}.bind(this),this.request.onprogress=this.onProgress.bind(this),this.request.open("GET",this.url),this.request.responseType="arraybuffer",this.request.send()},p.prototype.resume=function(e){},p.prototype.abort=function(){this.request.abort()},p.prototype.onProgress=function(e){this.progress=e.loaded/e.total},p.prototype.onLoad=function(e){this.established=!0,this.completed=!0,this.progress=1,this.destination&&this.destination.write(e)},p),B.Source.AjaxProgressive=(v.prototype.connect=function(e){this.destination=e},v.prototype.start=function(){this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&(this.fileSize=parseInt(this.request.getResponseHeader("Content-Length")),this.loadNextChunk())}.bind(this),this.request.onprogress=this.onProgress.bind(this),this.request.open("HEAD",this.url),this.request.send()},v.prototype.resume=function(e){!this.isLoading&&this.throttled&&e<8*this.loadTime+2&&this.loadNextChunk()},v.prototype.abort=function(){this.request.abort()},v.prototype.loadNextChunk=function(){var e=this.loadedSize,t=Math.min(this.loadedSize+this.chunkSize-1,this.fileSize-1);e>=this.fileSize?this.completed=!0:(this.isLoading=!0,this.loadStartTime=B.Now(),this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&200<=this.request.status&&this.request.status<300?this.onChunkLoad(this.request.response):this.request.readyState===this.request.DONE&&this.loadFails++<3&&this.loadNextChunk()}.bind(this),0===e&&(this.request.onprogress=this.onProgress.bind(this)),this.request.open("GET",this.url+"?"+e+"-"+t),this.request.setRequestHeader("Range","bytes="+e+"-"+t),this.request.responseType="arraybuffer",this.request.send())},v.prototype.onProgress=function(e){this.progress=e.loaded/e.total},v.prototype.onChunkLoad=function(e){this.established=!0,this.progress=1,this.loadedSize+=e.byteLength,this.loadFails=0,this.isLoading=!1,this.destination&&this.destination.write(e),this.loadTime=B.Now()-this.loadStartTime,this.throttled||this.loadNextChunk()},v),B.Source.WebSocket=(f.prototype.connect=function(e){this.destination=e},f.prototype.abort=function(){this.shouldAttemptReconnect=!1,this.socket.close()},f.prototype.start=function(){this.shouldAttemptReconnect=!!this.reconnectInterval,this.progress=0,this.established=!1,this.socket=new WebSocket(this.url),this.socket.binaryType="arraybuffer",this.socket.onmessage=this.onMessage.bind(this),this.socket.onopen=this.onOpen.bind(this),this.socket.onerror=this.onClose.bind(this),this.socket.onclose=this.onClose.bind(this)},f.prototype.resume=function(e){},f.prototype.onOpen=function(){this.progress=1,this.established=!0},f.prototype.onClose=function(){this.shouldAttemptReconnect&&setTimeout(function(){this.start()}.bind(this),1e3*this.reconnectInterval)},f.prototype.onMessage=function(e){this.destination&&this.destination.write(e.data)},f),B.Demuxer.TS=(m.prototype.connect=function(e,t){this.pesPacketInfo[e]={destination:t,currentLength:0,totalLength:0,pts:0,buffers:[]}},m.prototype.write=function(e){if(this.leftoverBytes){var t=e.byteLength+this.leftoverBytes.byteLength;this.bits=new B.BitBuffer(t),this.bits.write([this.leftoverBytes,e])}else this.bits=new B.BitBuffer(e);for(;this.bits.has(1504);)this.parsePacket();var i=this.bits.byteLength-(this.bits.index>>3);this.leftoverBytes=0<i?this.bits.bytes.subarray(this.bits.index>>3):null},m.prototype.parsePacket=function(){var e=188+(this.bits.index>>3);if(71!==this.bits.read(8))throw"Sync Token not found";this.bits.read(1);var t=this.bits.read(1),i=(this.bits.read(1),this.bits.read(13)),s=(this.bits.read(2),this.bits.read(2)),n=(this.bits.read(4),this.pidsToStreamIds[i]);if(t&&n&&(f=this.pesPacketInfo[n])&&f.currentLength&&this.packetComplete(f),1&s){if(2&s){var r=this.bits.read(8);this.bits.skip(r<<3)}if(t&&this.bits.nextBytesAreStartCode()){this.bits.skip(24),n=this.bits.read(8),this.pidsToStreamIds[i]=n;var a=this.bits.read(16);this.bits.skip(8);var o=this.bits.read(2);this.bits.skip(6);var d=this.bits.read(8),l=this.bits.index+(d<<3);if(f=this.pesPacketInfo[n]){var u=0;if(2&o){this.bits.skip(4);var h=this.bits.read(3);this.bits.skip(1);var c=this.bits.read(15);this.bits.skip(1);var p=this.bits.read(15);this.bits.skip(1),u=(1073741824*h+32768*c+p)/9e4,this.currentTime=u,-1===this.startTime&&(this.startTime=u)}var v=a?a-d-3:0;this.packetStart(f,u,v)}this.bits.index=l}var f;if(n&&(f=this.pesPacketInfo[n])){var m=this.bits.index>>3,g=!t&&2&s;(this.packetAddData(f,m,e)||this.guessVideoFrameEnd&&g)&&this.packetComplete(f)}}this.bits.index=e<<3},m.prototype.packetStart=function(e,t,i){e.totalLength=i,e.currentLength=0,e.pts=t},m.prototype.packetAddData=function(e,t,i){return e.buffers.push(this.bits.bytes.subarray(t,i)),e.currentLength+=i-t,0!==e.totalLength&&e.currentLength>=e.totalLength},m.prototype.packetComplete=function(e){e.destination.write(e.pts,e.buffers),e.totalLength=0,e.currentLength=0,e.buffers=[]},m.STREAM={PACK_HEADER:186,SYSTEM_HEADER:187,PROGRAM_MAP:188,PRIVATE_1:189,PADDING:190,PRIVATE_2:191,AUDIO_1:192,VIDEO_1:224,DIRECTORY:255},m),B.Decoder.Base=(g.prototype.connect=function(e){this.destination=e},g.prototype.write=function(e,t){this.collectTimestamps&&(0===this.timestamps.length&&(this.startTime=e,this.decodedTime=e),this.timestamps.push({index:this.bits.byteLength<<3,time:e})),this.bits.write(t),this.canPlay=!0},g.prototype.seek=function(e){if(this.collectTimestamps){for(var t=this.timestampIndex=0;t<this.timestamps.length&&!(this.timestamps[t].time>e);t++)this.timestampIndex=t;var i=this.timestamps[this.timestampIndex];i?(this.bits.index=i.index,this.decodedTime=i.time):(this.bits.index=0,this.decodedTime=this.startTime)}},g.prototype.decode=function(){this.advanceDecodedTime(0)},g.prototype.advanceDecodedTime=function(e){if(this.collectTimestamps){for(var t=-1,i=this.timestampIndex;i<this.timestamps.length&&!(this.timestamps[i].index>this.bits.index);i++)t=i;if(-1!==t&&t!==this.timestampIndex)return this.timestampIndex=t,void(this.decodedTime=this.timestamps[this.timestampIndex].time)}this.decodedTime+=e},g.prototype.getCurrentTime=function(){return this.decodedTime},g),B.Decoder.MPEG1Video=(((y.prototype=Object.create(B.Decoder.Base.prototype)).constructor=y).prototype.write=function(e,t){if(B.Decoder.Base.prototype.write.call(this,e,t),!this.hasSequenceHeader){if(-1===this.bits.findStartCode(y.START.SEQUENCE))return!1;
this.decodeSequenceHeader(),this.decodeFirstFrame&&this.decode()}},y.prototype.decode=function(){return!!this.hasSequenceHeader&&(-1!==this.bits.findStartCode(y.START.PICTURE)?(this.decodePicture(),this.advanceDecodedTime(1/this.frameRate),!0):(this.bits.byteLength,this.bits.index,!1))},y.prototype.readHuffman=function(e){for(var t=0;0<=(t=e[t+this.bits.read(1)])&&0!==e[t];);return e[t+2]},y.prototype.frameRate=30,y.prototype.decodeSequenceHeader=function(){var e=this.bits.read(12),t=this.bits.read(12);if(this.bits.skip(4),this.frameRate=y.PICTURE_RATE[this.bits.read(4)],this.bits.skip(30),e===this.width&&t===this.height||(this.width=e,this.height=t,this.initBuffers(),this.destination&&this.destination.resize(e,t)),this.bits.read(1)){for(var i=0;i<64;i++)this.customIntraQuantMatrix[y.ZIG_ZAG[i]]=this.bits.read(8);this.intraQuantMatrix=this.customIntraQuantMatrix}if(this.bits.read(1)){for(i=0;i<64;i++){var s=y.ZIG_ZAG[i];this.customNonIntraQuantMatrix[s]=this.bits.read(8)}this.nonIntraQuantMatrix=this.customNonIntraQuantMatrix}this.hasSequenceHeader=!0},y.prototype.initBuffers=function(){this.intraQuantMatrix=y.DEFAULT_INTRA_QUANT_MATRIX,this.nonIntraQuantMatrix=y.DEFAULT_NON_INTRA_QUANT_MATRIX,this.mbWidth=this.width+15>>4,this.mbHeight=this.height+15>>4,this.mbSize=this.mbWidth*this.mbHeight,this.codedWidth=this.mbWidth<<4,this.codedHeight=this.mbHeight<<4,this.codedSize=this.codedWidth*this.codedHeight,this.halfWidth=this.mbWidth<<3,this.halfHeight=this.mbHeight<<3,this.currentY=new Uint8ClampedArray(this.codedSize),this.currentY32=new Uint32Array(this.currentY.buffer),this.currentCr=new Uint8ClampedArray(this.codedSize>>2),this.currentCr32=new Uint32Array(this.currentCr.buffer),this.currentCb=new Uint8ClampedArray(this.codedSize>>2),this.currentCb32=new Uint32Array(this.currentCb.buffer),this.forwardY=new Uint8ClampedArray(this.codedSize),this.forwardY32=new Uint32Array(this.forwardY.buffer),this.forwardCr=new Uint8ClampedArray(this.codedSize>>2),this.forwardCr32=new Uint32Array(this.forwardCr.buffer),this.forwardCb=new Uint8ClampedArray(this.codedSize>>2),this.forwardCb32=new Uint32Array(this.forwardCb.buffer)},y.prototype.currentY=null,y.prototype.currentCr=null,y.prototype.currentCb=null,y.prototype.pictureType=0,y.prototype.forwardY=null,y.prototype.forwardCr=null,y.prototype.forwardCb=null,y.prototype.fullPelForward=!1,y.prototype.forwardFCode=0,y.prototype.forwardRSize=0,y.prototype.forwardF=0,y.prototype.decodePicture=function(e){if(this.currentFrame++,this.bits.skip(10),this.pictureType=this.bits.read(3),this.bits.skip(16),!(this.pictureType<=0||this.pictureType>=y.PICTURE_TYPE.B)){if(this.pictureType===y.PICTURE_TYPE.PREDICTIVE){if(this.fullPelForward=this.bits.read(1),this.forwardFCode=this.bits.read(3),0===this.forwardFCode)return;this.forwardRSize=this.forwardFCode-1,this.forwardF=1<<this.forwardRSize}for(var t=0;(t=this.bits.findNextStartCode())===y.START.EXTENSION||t===y.START.USER_DATA;);for(;t>=y.START.SLICE_FIRST&&t<=y.START.SLICE_LAST;)this.decodeSlice(255&t),t=this.bits.findNextStartCode();if(-1!==t&&this.bits.rewind(32),this.destination&&this.destination.render(this.currentY,this.currentCr,this.currentCb),this.pictureType===y.PICTURE_TYPE.INTRA||this.pictureType===y.PICTURE_TYPE.PREDICTIVE){var i=this.forwardY,s=this.forwardY32,n=this.forwardCr,r=this.forwardCr32,a=this.forwardCb,o=this.forwardCb32;this.forwardY=this.currentY,this.forwardY32=this.currentY32,this.forwardCr=this.currentCr,this.forwardCr32=this.currentCr32,this.forwardCb=this.currentCb,this.forwardCb32=this.currentCb32,this.currentY=i,this.currentY32=s,this.currentCr=n,this.currentCr32=r,this.currentCb=a,this.currentCb32=o}}},y.prototype.quantizerScale=0,y.prototype.sliceBegin=!1,y.prototype.decodeSlice=function(e){for(this.sliceBegin=!0,this.macroblockAddress=(e-1)*this.mbWidth-1,this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0,this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.quantizerScale=this.bits.read(5);this.bits.read(1);)this.bits.skip(8);for(;this.decodeMacroblock(),!this.bits.nextBytesAreStartCode(););},y.prototype.macroblockAddress=0,y.prototype.mbRow=0,y.prototype.mbCol=0,y.prototype.macroblockType=0,y.prototype.macroblockIntra=!1,y.prototype.macroblockMotFw=!1,y.prototype.motionFwH=0,y.prototype.motionFwV=0,y.prototype.motionFwHPrev=0,y.prototype.motionFwVPrev=0,y.prototype.decodeMacroblock=function(){for(var e=0,t=this.readHuffman(y.MACROBLOCK_ADDRESS_INCREMENT);34===t;)t=this.readHuffman(y.MACROBLOCK_ADDRESS_INCREMENT);for(;35===t;)e+=33,t=this.readHuffman(y.MACROBLOCK_ADDRESS_INCREMENT);if(e+=t,this.sliceBegin)this.sliceBegin=!1,this.macroblockAddress+=e;else{if(this.macroblockAddress+e>=this.mbSize)return;for(1<e&&(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.pictureType===y.PICTURE_TYPE.PREDICTIVE&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0));1<e;)this.macroblockAddress++,this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth,this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb),e--;this.macroblockAddress++}this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth;var i=y.MACROBLOCK_TYPE[this.pictureType];this.macroblockType=this.readHuffman(i),this.macroblockIntra=1&this.macroblockType,this.macroblockMotFw=8&this.macroblockType,0!=(16&this.macroblockType)&&(this.quantizerScale=this.bits.read(5)),this.macroblockIntra?(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0):(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.decodeMotionVectors(),this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb));for(var s=0!=(2&this.macroblockType)?this.readHuffman(y.CODE_BLOCK_PATTERN):this.macroblockIntra?63:0,n=0,r=32;n<6;n++)0!=(s&r)&&this.decodeBlock(n),r>>=1},y.prototype.decodeMotionVectors=function(){var e,t,i=0;this.macroblockMotFw?(0!==(e=this.readHuffman(y.MOTION))&&1!==this.forwardF?(i=this.bits.read(this.forwardRSize),t=(Math.abs(e)-1<<this.forwardRSize)+i+1,e<0&&(t=-t)):t=e,this.motionFwHPrev+=t,this.motionFwHPrev>(this.forwardF<<4)-1?this.motionFwHPrev-=this.forwardF<<5:this.motionFwHPrev<-this.forwardF<<4&&(this.motionFwHPrev+=this.forwardF<<5),this.motionFwH=this.motionFwHPrev,this.fullPelForward&&(this.motionFwH<<=1),0!==(e=this.readHuffman(y.MOTION))&&1!==this.forwardF?(i=this.bits.read(this.forwardRSize),t=(Math.abs(e)-1<<this.forwardRSize)+i+1,e<0&&(t=-t)):t=e,this.motionFwVPrev+=t,this.motionFwVPrev>(this.forwardF<<4)-1?this.motionFwVPrev-=this.forwardF<<5:this.motionFwVPrev<-this.forwardF<<4&&(this.motionFwVPrev+=this.forwardF<<5),this.motionFwV=this.motionFwVPrev,this.fullPelForward&&(this.motionFwV<<=1)):this.pictureType===y.PICTURE_TYPE.PREDICTIVE&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0)},y.prototype.copyMacroblock=function(e,t,i,s,n){var r,a,o,d,l,u,h,c,p,v,f,m,g,y,_,b,w,k,A,T=this.currentY32,C=this.currentCb32,E=this.currentCr32;if(a=(r=this.codedWidth)-16,o=e>>1,d=t>>1,l=1==(1&e),u=1==(1&t),h=((this.mbRow<<4)+d)*r+(this.mbCol<<4)+o,p=(c=this.mbRow*r+this.mbCol<<2)+(r<<2),l)if(u)for(;c<p;){for(f=i[h]+i[h+r],h++,v=0;v<4;v++)g=f+(m=i[h]+i[h+r])+2>>2&255,g|=(f=i[++h]+i[h+r])+m+2<<6&65280,g|=f+(m=i[++h]+i[h+r])+2<<14&16711680,f=i[++h]+i[h+r],h++,g|=f+m+2<<22&4278190080,T[c++]=g;c+=a>>2,h+=a-1}else for(;c<p;){for(f=i[h++],v=0;v<4;v++)g=f+(m=i[h++])+1>>1&255,g|=(f=i[h++])+m+1<<7&65280,g|=f+(m=i[h++])+1<<15&16711680,g|=(f=i[h++])+m+1<<23&4278190080,T[c++]=g;c+=a>>2,h+=a-1}else if(u)for(;c<p;){for(v=0;v<4;v++)g=i[h]+i[h+r]+1>>1&255,g|=i[++h]+i[h+r]+1<<7&65280,g|=i[++h]+i[h+r]+1<<15&16711680,g|=i[++h]+i[h+r]+1<<23&4278190080,h++,T[c++]=g;c+=a>>2,h+=a}else for(;c<p;){for(v=0;v<4;v++)g=i[h],g|=i[++h]<<8,g|=i[++h]<<16,g|=i[++h]<<24,h++,T[c++]=g;c+=a>>2,h+=a}if(a=(r=this.halfWidth)-8,o=e/2>>1,d=t/2>>1,l=1==(e/2&1),u=1==(t/2&1),h=((this.mbRow<<3)+d)*r+(this.mbCol<<3)+o,p=(c=this.mbRow*r+this.mbCol<<1)+(r<<1),l)if(u)for(;c<p;){for(y=s[h]+s[h+r],w=n[h]+n[h+r],h++,v=0;v<2;v++)b=y+(_=s[h]+s[h+r])+2>>2&255,A=w+(k=n[h]+n[h+r])+2>>2&255,b|=(y=s[++h]+s[h+r])+_+2<<6&65280,A|=(w=n[h]+n[h+r])+k+2<<6&65280,b|=y+(_=s[++h]+s[h+r])+2<<14&16711680,A|=w+(k=n[h]+n[h+r])+2<<14&16711680,y=s[++h]+s[h+r],w=n[h]+n[h+r],h++,b|=y+_+2<<22&4278190080,A|=w+k+2<<22&4278190080,E[c]=b,C[c]=A,c++;c+=a>>2,h+=a-1}else for(;c<p;){for(y=s[h],w=n[h],h++,v=0;v<2;v++)b=y+(_=s[h])+1>>1&255,A=w+(k=n[h++])+1>>1&255,b|=(y=s[h])+_+1<<7&65280,A|=(w=n[h++])+k+1<<7&65280,b|=y+(_=s[h])+1<<15&16711680,A|=w+(k=n[h++])+1<<15&16711680,b|=(y=s[h])+_+1<<23&4278190080,A|=(w=n[h++])+k+1<<23&4278190080,E[c]=b,C[c]=A,c++;c+=a>>2,h+=a-1}else if(u)for(;c<p;){for(v=0;v<2;v++)b=s[h]+s[h+r]+1>>1&255,A=n[h]+n[h+r]+1>>1&255,b|=s[++h]+s[h+r]+1<<7&65280,A|=n[h]+n[h+r]+1<<7&65280,b|=s[++h]+s[h+r]+1<<15&16711680,A|=n[h]+n[h+r]+1<<15&16711680,b|=s[++h]+s[h+r]+1<<23&4278190080,A|=n[h]+n[h+r]+1<<23&4278190080,h++,E[c]=b,C[c]=A,c++;c+=a>>2,h+=a}else for(;c<p;){for(v=0;v<2;v++)b=s[h],A=n[h],b|=s[++h]<<8,A|=n[h]<<8,b|=s[++h]<<16,A|=n[h]<<16,b|=s[++h]<<24,A|=n[h]<<24,h++,E[c]=b,C[c]=A,c++;c+=a>>2,h+=a}},y.prototype.dcPredictorY=0,y.prototype.dcPredictorCr=0,y.prototype.dcPredictorCb=0,y.prototype.blockData=null,y.prototype.decodeBlock=function(e){var t,i=0;if(this.macroblockIntra){var s,n;if(0<(n=e<4?(s=this.dcPredictorY,this.readHuffman(y.DCT_DC_SIZE_LUMINANCE)):(s=4===e?this.dcPredictorCr:this.dcPredictorCb,this.readHuffman(y.DCT_DC_SIZE_CHROMINANCE)))){var r=this.bits.read(n);this.blockData[0]=0!=(r&1<<n-1)?s+r:s+(-1<<n|r+1)}else this.blockData[0]=s;e<4?this.dcPredictorY=this.blockData[0]:4===e?this.dcPredictorCr=this.blockData[0]:this.dcPredictorCb=this.blockData[0],this.blockData[0]<<=8,t=this.intraQuantMatrix,i=1}else t=this.nonIntraQuantMatrix;for(var a,o,d,l=0;;){var u=0,h=this.readHuffman(y.DCT_COEFF);if(1===h&&0<i&&0===this.bits.read(1))break;65535===h?(u=this.bits.read(6),0===(l=this.bits.read(8))?l=this.bits.read(8):128===l?l=this.bits.read(8)-256:128<l&&(l-=256)):(u=h>>8,l=255&h,this.bits.read(1)&&(l=-l));var c=y.ZIG_ZAG[i+=u];i++,l<<=1,this.macroblockIntra||(l+=l<0?-1:1),0==(1&(l=l*this.quantizerScale*t[c]>>4))&&(l-=0<l?1:-1),2047<l?l=2047:l<-2048&&(l=-2048),this.blockData[c]=l*y.PREMULTIPLIER_MATRIX[c]}e<4?(a=this.currentY,d=this.codedWidth-8,o=this.mbRow*this.codedWidth+this.mbCol<<4,0!=(1&e)&&(o+=8),0!=(2&e)&&(o+=this.codedWidth<<3)):(a=4===e?this.currentCb:this.currentCr,d=(this.codedWidth>>1)-8,o=(this.mbRow*this.codedWidth<<2)+(this.mbCol<<3)),this.macroblockIntra?1===i?(y.CopyValueToDestination(this.blockData[0]+128>>8,a,o,d),this.blockData[0]=0):(y.IDCT(this.blockData),y.CopyBlockToDestination(this.blockData,a,o,d),B.Fill(this.blockData,0)):1===i?(y.AddValueToDestination(this.blockData[0]+128>>8,a,o,d),this.blockData[0]=0):(y.IDCT(this.blockData),y.AddBlockToDestination(this.blockData,a,o,d),B.Fill(this.blockData,0)),i=0},y.CopyBlockToDestination=function(e,t,i,s){for(var n=0;n<64;n+=8,i+=s+8)t[i+0]=e[n+0],t[i+1]=e[n+1],t[i+2]=e[n+2],t[i+3]=e[n+3],t[i+4]=e[n+4],t[i+5]=e[n+5],t[i+6]=e[n+6],t[i+7]=e[n+7]},y.AddBlockToDestination=function(e,t,i,s){for(var n=0;n<64;n+=8,i+=s+8)t[i+0]+=e[n+0],t[i+1]+=e[n+1],t[i+2]+=e[n+2],t[i+3]+=e[n+3],t[i+4]+=e[n+4],t[i+5]+=e[n+5],t[i+6]+=e[n+6],t[i+7]+=e[n+7]},y.CopyValueToDestination=function(e,t,i,s){for(var n=0;n<64;n+=8,i+=s+8)t[i+0]=e,t[i+1]=e,t[i+2]=e,t[i+3]=e,t[i+4]=e,t[i+5]=e,t[i+6]=e,t[i+7]=e},y.AddValueToDestination=function(e,t,i,s){for(var n=0;n<64;n+=8,i+=s+8)t[i+0]+=e,t[i+1]+=e,t[i+2]+=e,t[i+3]+=e,t[i+4]+=e,t[i+5]+=e,t[i+6]+=e,t[i+7]+=e},y.IDCT=function(e){for(var t,i,s,n,r,a,o,d,l,u,h,c,p,v,f,m,g,y,_=0;_<8;++_)t=e[32+_],i=e[16+_]+e[48+_],s=e[40+_]-e[24+_],a=e[8+_]+e[56+_],o=e[24+_]+e[40+_],l=(p=(473*(n=e[8+_]-e[56+_])-196*s+128>>8)-(r=a+o))-(362*(a-o)+128>>8),v=(u=(d=e[0+_])-t)+(h=(362*(e[16+_]-e[48+_])+128>>8)-i),f=(c=d+t)+i,m=u-h,g=c-i,y=-l-(473*s+196*n+128>>8),e[0+_]=r+f,e[8+_]=p+v,e[16+_]=m-l,e[24+_]=g-y,e[32+_]=g+y,e[40+_]=l+m,e[48+_]=v-p,e[56+_]=f-r;for(_=0;_<64;_+=8)t=e[4+_],i=e[2+_]+e[6+_],s=e[5+_]-e[3+_],a=e[1+_]+e[7+_],o=e[3+_]+e[5+_],l=(p=(473*(n=e[1+_]-e[7+_])-196*s+128>>8)-(r=a+o))-(362*(a-o)+128>>8),v=(u=(d=e[0+_])-t)+(h=(362*(e[2+_]-e[6+_])+128>>8)-i),f=(c=d+t)+i,m=u-h,g=c-i,y=-l-(473*s+196*n+128>>8),e[0+_]=r+f+128>>8,e[1+_]=p+v+128>>8,e[2+_]=m-l+128>>8,e[3+_]=g-y+128>>8,e[4+_]=g+y+128>>8,e[5+_]=l+m+128>>8,e[6+_]=v-p+128>>8,e[7+_]=f-r+128>>8},y.PICTURE_RATE=[0,23.976,24,25,29.97,30,50,59.94,60,0,0,0,0,0,0,0],y.ZIG_ZAG=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),y.DEFAULT_INTRA_QUANT_MATRIX=new Uint8Array([8,16,19,22,26,27,29,34,16,16,22,24,27,29,34,37,19,22,26,27,29,34,34,38,22,22,26,27,29,34,37,40,22,26,27,29,32,35,40,48,26,27,29,32,35,40,48,58,26,27,29,34,38,46,56,69,27,29,35,38,46,56,69,83]),y.DEFAULT_NON_INTRA_QUANT_MATRIX=new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),y.PREMULTIPLIER_MATRIX=new Uint8Array([32,44,42,38,32,25,17,9,44,62,58,52,44,35,24,12,42,58,55,49,42,33,23,12,38,52,49,44,38,30,20,10,32,44,42,38,32,25,17,9,25,35,33,30,25,20,14,7,17,24,23,20,17,14,9,5,9,12,12,10,9,7,5,2]),y.MACROBLOCK_ADDRESS_INCREMENT=new Int16Array([3,6,0,9,12,0,0,0,1,15,18,0,21,24,0,27,30,0,33,36,0,0,0,3,0,0,2,39,42,0,45,48,0,0,0,5,0,0,4,51,54,0,57,60,0,0,0,7,0,0,6,63,66,0,69,72,0,75,78,0,81,84,0,-1,87,0,-1,90,0,93,96,0,99,102,0,105,108,0,111,114,0,0,0,9,0,0,8,117,120,0,123,126,0,129,132,0,135,138,0,0,0,15,0,0,14,0,0,13,0,0,12,0,0,11,0,0,10,141,-1,0,-1,144,0,147,150,0,153,156,0,159,162,0,165,168,0,171,174,0,177,180,0,183,-1,0,-1,186,0,189,192,0,195,198,0,201,204,0,207,210,0,213,216,0,219,222,0,0,0,21,0,0,20,0,0,19,0,0,18,0,0,17,0,0,16,0,0,35,0,0,34,0,0,33,0,0,32,0,0,31,0,0,30,0,0,29,0,0,28,0,0,27,0,0,26,0,0,25,0,0,24,0,0,23,0,0,22]),y.MACROBLOCK_TYPE_INTRA=new Int8Array([3,6,0,-1,9,0,0,0,1,0,0,17]),y.MACROBLOCK_TYPE_PREDICTIVE=new Int8Array([3,6,0,9,12,0,0,0,10,15,18,0,0,0,2,21,24,0,0,0,8,27,30,0,33,36,0,-1,39,0,0,0,18,0,0,26,0,0,1,0,0,17]),y.MACROBLOCK_TYPE_B=new Int8Array([3,6,0,9,15,0,12,18,0,24,21,0,0,0,12,27,30,0,0,0,14,39,42,0,36,33,0,0,0,4,0,0,6,54,48,0,45,51,0,0,0,8,0,0,10,-1,57,0,0,0,1,60,63,0,0,0,30,0,0,17,0,0,22,0,0,26]),y.MACROBLOCK_TYPE=[null,y.MACROBLOCK_TYPE_INTRA,y.MACROBLOCK_TYPE_PREDICTIVE,y.MACROBLOCK_TYPE_B],y.CODE_BLOCK_PATTERN=new Int16Array([6,3,0,9,18,0,12,15,0,24,33,0,36,39,0,27,21,0,30,42,0,60,57,0,54,48,0,69,51,0,81,75,0,63,84,0,45,66,0,72,78,0,0,0,60,105,120,0,132,144,0,114,108,0,126,141,0,87,93,0,117,96,0,0,0,32,135,138,0,99,123,0,129,102,0,0,0,4,90,111,0,0,0,8,0,0,16,0,0,44,150,168,0,0,0,28,0,0,52,0,0,62,183,177,0,156,180,0,0,0,1,165,162,0,0,0,61,0,0,56,171,174,0,0,0,2,0,0,40,153,186,0,0,0,48,192,189,0,147,159,0,0,0,20,0,0,12,240,249,0,0,0,63,231,225,0,195,219,0,252,198,0,0,0,24,0,0,36,0,0,3,207,261,0,243,237,0,204,213,0,210,234,0,201,228,0,216,222,0,258,255,0,264,246,0,-1,282,0,285,291,0,0,0,33,0,0,9,318,330,0,306,348,0,0,0,5,0,0,10,279,267,0,0,0,6,0,0,18,0,0,17,0,0,34,339,357,0,309,312,0,270,276,0,327,321,0,351,354,0,303,297,0,294,288,0,300,273,0,342,345,0,315,324,0,336,333,0,363,375,0,0,0,41,0,0,14,0,0,21,372,366,0,360,369,0,0,0,11,0,0,19,0,0,7,0,0,35,0,0,13,0,0,50,0,0,49,0,0,58,0,0,37,0,0,25,0,0,45,0,0,57,0,0,26,0,0,29,0,0,38,0,0,53,0,0,23,0,0,43,0,0,46,0,0,42,0,0,22,0,0,54,0,0,51,0,0,15,0,0,30,0,0,39,0,0,47,0,0,55,0,0,27,0,0,59,0,0,31]),y.MOTION=new Int16Array([3,6,0,12,9,0,0,0,0,18,15,0,24,21,0,0,0,-1,0,0,1,27,30,0,36,33,0,0,0,2,0,0,-2,42,45,0,48,39,0,60,54,0,0,0,3,0,0,-3,51,57,0,-1,69,0,81,75,0,78,63,0,72,66,0,96,84,0,87,93,0,-1,99,0,108,105,0,0,0,-4,90,102,0,0,0,4,0,0,-7,0,0,5,111,123,0,0,0,-5,0,0,7,114,120,0,126,117,0,0,0,-6,0,0,6,153,162,0,150,147,0,135,138,0,156,141,0,129,159,0,132,144,0,0,0,10,0,0,9,0,0,8,0,0,-8,171,198,0,0,0,-9,180,192,0,168,183,0,165,186,0,174,189,0,0,0,-10,177,195,0,0,0,12,0,0,16,0,0,13,0,0,14,0,0,11,0,0,15,0,0,-16,0,0,-12,0,0,-14,0,0,-15,0,0,-11,0,0,-13]),y.DCT_DC_SIZE_LUMINANCE=new Int8Array([6,3,0,18,15,0,9,12,0,0,0,1,0,0,2,27,24,0,21,30,0,0,0,0,36,33,0,0,0,4,0,0,3,39,42,0,0,0,5,0,0,6,48,45,0,51,-1,0,0,0,7,0,0,8]),y.DCT_DC_SIZE_CHROMINANCE=new Int8Array([6,3,0,12,9,0,18,15,0,24,21,0,0,0,2,0,0,1,0,0,0,30,27,0,0,0,3,36,33,0,0,0,4,42,39,0,0,0,5,48,45,0,0,0,6,51,-1,0,0,0,7,0,0,8]),y.DCT_COEFF=new Int32Array([3,6,0,12,9,0,0,0,1,21,24,0,18,15,0,39,27,0,33,30,0,42,36,0,0,0,257,60,66,0,54,63,0,48,57,0,0,0,513,51,45,0,0,0,2,0,0,3,81,75,0,87,93,0,72,78,0,96,90,0,0,0,1025,69,84,0,0,0,769,0,0,258,0,0,1793,0,0,65535,0,0,1537,111,108,0,0,0,1281,105,102,0,117,114,0,99,126,0,120,123,0,156,150,0,162,159,0,144,147,0,129,135,0,138,132,0,0,0,2049,0,0,4,0,0,514,0,0,2305,153,141,0,165,171,0,180,168,0,177,174,0,183,186,0,0,0,2561,0,0,3329,0,0,6,0,0,259,0,0,5,0,0,770,0,0,2817,0,0,3073,228,225,0,201,210,0,219,213,0,234,222,0,216,231,0,207,192,0,204,189,0,198,195,0,243,261,0,273,240,0,246,237,0,249,258,0,279,276,0,252,255,0,270,282,0,264,267,0,0,0,515,0,0,260,0,0,7,0,0,1026,0,0,1282,0,0,4097,0,0,3841,0,0,3585,315,321,0,333,342,0,312,291,0,375,357,0,288,294,0,-1,369,0,285,303,0,318,363,0,297,306,0,339,309,0,336,348,0,330,300,0,372,345,0,351,366,0,327,354,0,360,324,0,381,408,0,417,420,0,390,378,0,435,438,0,384,387,0,0,0,2050,396,402,0,465,462,0,0,0,8,411,399,0,429,432,0,453,414,0,426,423,0,0,0,10,0,0,9,0,0,11,0,0,5377,0,0,1538,0,0,771,0,0,5121,0,0,1794,0,0,4353,0,0,4609,0,0,4865,444,456,0,0,0,1027,459,450,0,0,0,261,393,405,0,0,0,516,447,441,0,516,519,0,486,474,0,510,483,0,504,498,0,471,537,0,507,501,0,522,513,0,534,531,0,468,477,0,492,495,0,549,546,0,525,528,0,0,0,263,0,0,2562,0,0,2306,0,0,5633,0,0,5889,0,0,6401,0,0,6145,0,0,1283,0,0,772,0,0,13,0,0,12,0,0,14,0,0,15,0,0,517,0,0,6657,0,0,262,540,543,0,480,489,0,588,597,0,0,0,27,609,555,0,606,603,0,0,0,19,0,0,22,591,621,0,0,0,18,573,576,0,564,570,0,0,0,20,552,582,0,0,0,21,558,579,0,0,0,23,612,594,0,0,0,25,0,0,24,600,615,0,0,0,31,0,0,30,0,0,28,0,0,29,0,0,26,0,0,17,0,0,16,567,618,0,561,585,0,654,633,0,0,0,37,645,648,0,0,0,36,630,636,0,0,0,34,639,627,0,663,666,0,657,624,0,651,642,0,669,660,0,0,0,35,0,0,267,0,0,40,0,0,268,0,0,266,0,0,32,0,0,264,0,0,265,0,0,38,0,0,269,0,0,270,0,0,33,0,0,39,0,0,7937,0,0,6913,0,0,7681,0,0,4098,0,0,7425,0,0,7169,0,0,271,0,0,274,0,0,273,0,0,272,0,0,1539,0,0,2818,0,0,3586,0,0,3330,0,0,3074,0,0,3842]),y.PICTURE_TYPE={INTRA:1,PREDICTIVE:2,B:3},y.START={SEQUENCE:179,SLICE_FIRST:1,SLICE_LAST:175,PICTURE:0,EXTENSION:181,USER_DATA:178},y),B.Decoder.MP2Audio=(((_.prototype=Object.create(B.Decoder.Base.prototype)).constructor=_).prototype.decode=function(){var e=this.bits.index>>3;if(e>=this.bits.byteLength)return!1;var t=this.decodeFrame(this.left,this.right);return this.bits.index=e+t<<3,!!t&&(this.destination&&this.destination.play(this.sampleRate,this.left,this.right),this.advanceDecodedTime(this.left.length/this.sampleRate),!0)},_.prototype.getCurrentTime=function(){var e=this.destination?this.destination.enqueuedTime:0;return this.decodedTime-e},_.prototype.decodeFrame=function(e,t){var i=this.bits.read(11),s=this.bits.read(2),n=this.bits.read(2),r=!this.bits.read(1);if(i!==_.FRAME_SYNC||s!==_.VERSION.MPEG_1||n!==_.LAYER.II)return 0;var a=this.bits.read(4)-1;if(13<a)return 0;var o=this.bits.read(2),d=_.SAMPLE_RATE[o];if(3===o)return 0;s===_.VERSION.MPEG_2&&(o+=4,a+=14);var l=this.bits.read(1),u=(this.bits.read(1),this.bits.read(2)),h=0;h=u===_.MODE.JOINT_STEREO?this.bits.read(2)+1<<2:(this.bits.skip(2),u===_.MODE.MONO?0:32),this.bits.skip(4),r&&this.bits.skip(16);var c=144e3*_.BIT_RATE[a]/(d=_.SAMPLE_RATE[o])+l|0,p=0,v=0;if(s===_.VERSION.MPEG_2)p=2,v=30;else{var f=u===_.MODE.MONO?0:1,m=_.QUANT_LUT_STEP_1[f][a];v=63&(p=_.QUANT_LUT_STEP_2[m][o]),p>>=6}v<h&&(h=v);for(var g=0;g<h;g++)this.allocation[0][g]=this.readAllocation(g,p),this.allocation[1][g]=this.readAllocation(g,p);for(g=h;g<v;g++)this.allocation[0][g]=this.allocation[1][g]=this.readAllocation(g,p);var y=u===_.MODE.MONO?1:2;for(g=0;g<v;g++){for(b=0;b<y;b++)this.allocation[b][g]&&(this.scaleFactorInfo[b][g]=this.bits.read(2));u===_.MODE.MONO&&(this.scaleFactorInfo[1][g]=this.scaleFactorInfo[0][g])}for(g=0;g<v;g++){for(var b=0;b<y;b++)if(this.allocation[b][g]){var w=this.scaleFactor[b][g];switch(this.scaleFactorInfo[b][g]){case 0:w[0]=this.bits.read(6),w[1]=this.bits.read(6),w[2]=this.bits.read(6);break;case 1:w[0]=w[1]=this.bits.read(6),w[2]=this.bits.read(6);break;case 2:w[0]=w[1]=w[2]=this.bits.read(6);break;case 3:w[0]=this.bits.read(6),w[1]=w[2]=this.bits.read(6)}}u===_.MODE.MONO&&(this.scaleFactor[1][g][0]=this.scaleFactor[0][g][0],this.scaleFactor[1][g][1]=this.scaleFactor[0][g][1],this.scaleFactor[1][g][2]=this.scaleFactor[0][g][2])}for(var k=0,A=0;A<3;A++)for(var T=0;T<4;T++){for(g=0;g<h;g++)this.readSamples(0,g,A),this.readSamples(1,g,A);for(g=h;g<v;g++)this.readSamples(0,g,A),this.sample[1][g][0]=this.sample[0][g][0],this.sample[1][g][1]=this.sample[0][g][1],this.sample[1][g][2]=this.sample[0][g][2];for(g=v;g<32;g++)this.sample[0][g][0]=0,this.sample[0][g][1]=0,this.sample[0][g][2]=0,this.sample[1][g][0]=0,this.sample[1][g][1]=0,this.sample[1][g][2]=0;for(var C=0;C<3;C++){for(this.VPos=this.VPos-64&1023,b=0;b<2;b++){_.MatrixTransform(this.sample[b],C,this.V,this.VPos),B.Fill(this.U,0);for(var E=512-(this.VPos>>1),P=this.VPos%128>>1;P<1024;){for(var V=0;V<32;++V)this.U[V]+=this.D[E++]*this.V[P++];P+=96,E+=32}for(P=1120-P,E-=480;P<1024;){for(V=0;V<32;++V)this.U[V]+=this.D[E++]*this.V[P++];P+=96,E+=32}for(var I=0===b?e:t,x=0;x<32;x++)I[k+x]=this.U[x]/2147418112}k+=32}}return this.sampleRate=d,c},_.prototype.readAllocation=function(e,t){var i=_.QUANT_LUT_STEP_3[t][e],s=_.QUANT_LUT_STEP4[15&i][this.bits.read(i>>4)];return s?_.QUANT_TAB[s-1]:0},_.prototype.readSamples=function(e,t,i){var s=this.allocation[e][t],n=this.scaleFactor[e][t][i],r=this.sample[e][t],a=0;if(s){if(63===n)n=0;else{var o=n/3|0;n=_.SCALEFACTOR_BASE[n%3]+(1<<o>>1)>>o}var d=s.levels;s.group?(a=this.bits.read(s.bits),r[0]=a%d,a=a/d|0,r[1]=a%d,r[2]=a/d|0):(r[0]=this.bits.read(s.bits),r[1]=this.bits.read(s.bits),r[2]=this.bits.read(s.bits));var l=65536/(d+1)|0;a=((d=(d+1>>1)-1)-r[0])*l,r[0]=a*(n>>12)+(a*(4095&n)+2048>>12)>>12,a=(d-r[1])*l,r[1]=a*(n>>12)+(a*(4095&n)+2048>>12)>>12,a=(d-r[2])*l,r[2]=a*(n>>12)+(a*(4095&n)+2048>>12)>>12}else r[0]=r[1]=r[2]=0},_.MatrixTransform=function(e,t,i,s){var n,r,a,o,d,l,u,h,c,p,v,f,m,g,y,_,b,w,k,A,T,C,E,P,V,I,x,S,D,O,M,B,R;n=e[0][t]+e[31][t],r=.500602998235*(e[0][t]-e[31][t]),a=e[1][t]+e[30][t],o=.505470959898*(e[1][t]-e[30][t]),d=e[2][t]+e[29][t],l=.515447309923*(e[2][t]-e[29][t]),u=e[3][t]+e[28][t],h=.53104259109*(e[3][t]-e[28][t]),c=e[4][t]+e[27][t],p=.553103896034*(e[4][t]-e[27][t]),v=e[5][t]+e[26][t],f=.582934968206*(e[5][t]-e[26][t]),m=e[6][t]+e[25][t],g=.622504123036*(e[6][t]-e[25][t]),y=e[7][t]+e[24][t],_=.674808341455*(e[7][t]-e[24][t]),b=e[8][t]+e[23][t],w=.744536271002*(e[8][t]-e[23][t]),k=e[9][t]+e[22][t],A=.839349645416*(e[9][t]-e[22][t]),T=e[10][t]+e[21][t],C=.972568237862*(e[10][t]-e[21][t]),E=e[11][t]+e[20][t],P=1.16943993343*(e[11][t]-e[20][t]),V=e[12][t]+e[19][t],I=1.48416461631*(e[12][t]-e[19][t]),x=e[13][t]+e[18][t],S=2.05778100995*(e[13][t]-e[18][t]),D=e[14][t]+e[17][t],O=3.40760841847*(e[14][t]-e[17][t]),R=n+(M=e[15][t]+e[16][t]),M=.502419286188*(n-M),n=a+D,D=.52249861494*(a-D),a=d+x,x=.566944034816*(d-x),d=u+V,V=.64682178336*(u-V),u=c+E,E=.788154623451*(c-E),c=v+T,T=1.06067768599*(v-T),v=m+k,k=1.72244709824*(m-k),m=y+b,b=5.10114861869*(y-b),y=R+m,m=.509795579104*(R-m),R=n+v,n=.601344886935*(n-v),v=a+c,c=.899976223136*(a-c),a=d+u,u=2.56291544774*(d-u),d=y+a,y=.541196100146*(y-a),a=R+v,v=1.30656296488*(R-v),R=d+a,d=.707106781187*(d-a),a=y+v,a+=y=.707106781187*(y-v),v=m+u,m=.541196100146*(m-u),u=n+c,c=1.30656296488*(n-c),n=v+u,u=.707106781187*(v-u),v=m+c,n+=v+=m=.707106781187*(m-c),v+=u,u+=m,c=M+b,M=.509795579104*(M-b),b=D+k,D=.601344886935*(D-k),k=x+T,T=.899976223136*(x-T),x=V+E,E=2.56291544774*(V-E),V=c+x,c=.541196100146*(c-x),x=b+k,k=1.30656296488*(b-k),b=V+x,x=.707106781187*(V-x),V=c+k,k=.707106781187*(c-k),c=M+E,M=.541196100146*(M-E),E=D+T,T=1.30656296488*(D-T),D=c+E,E=.707106781187*(c-E),c=M+T,b+=D+=c+=M=.707106781187*(M-T),D+=V+=k,V+=c+=E,c+=x,x+=E+=M,E+=k,k+=M,T=r+(B=10.1900081235*(e[15][t]-e[16][t])),r=.502419286188*(r-B),B=o+O,o=.52249861494*(o-O),O=l+S,S=.566944034816*(l-S),l=h+I,h=.64682178336*(h-I),I=p+P,p=.788154623451*(p-P),P=f+C,C=1.06067768599*(f-C),f=g+A,A=1.72244709824*(g-A),g=_+w,_=5.10114861869*(_-w),w=T+g,g=.509795579104*(T-g),T=B+f,B=.601344886935*(B-f),f=O+P,P=.899976223136*(O-P),O=l+I,I=2.56291544774*(l-I),l=w+O,w=.541196100146*(w-O),O=T+f,f=1.30656296488*(T-f),T=l+O,O=.707106781187*(l-O),l=w+f,f=.707106781187*(w-f),w=g+I,I=.541196100146*(g-I),g=B+P,P=1.30656296488*(B-P),B=w+g,g=.707106781187*(w-g),w=I+P,B+=w+=P=.707106781187*(I-P),w+=g,I=g+P,g=r+_,r=.509795579104*(r-_),_=o+A,o=.601344886935*(o-A),A=S+C,C=.899976223136*(S-C),S=h+p,p=2.56291544774*(h-p),h=g+S,g=.541196100146*(g-S),S=_+A,A=1.30656296488*(_-A),_=h+S,S=.707106781187*(h-S),h=g+A,A=.707106781187*(g-A),g=r+p,r=.541196100146*(r-p),p=o+C,C=1.30656296488*(o-C),o=g+p,p=.707106781187*(g-p),g=r+C,T+=_+=o+=g+=r=.707106781187*(r-C),_+=B,B+=o+=h+=A,o+=l+=f,l+=h+=g+=p,h+=w,w+=g+=S,g+=O,O+=S+=p+=r,S+=I,I+=p+=A,p+=f,f+=A+=r,A+=P,P+=r,i[s+48]=-R,i[s+49]=i[s+47]=-T,i[s+50]=i[s+46]=-b,i[s+51]=i[s+45]=-_,i[s+52]=i[s+44]=-n,i[s+53]=i[s+43]=-B,i[s+54]=i[s+42]=-D,i[s+55]=i[s+41]=-o,i[s+56]=i[s+40]=-a,i[s+57]=i[s+39]=-l,i[s+58]=i[s+38]=-V,i[s+59]=i[s+37]=-h,i[s+60]=i[s+36]=-v,i[s+61]=i[s+35]=-w,i[s+62]=i[s+34]=-c,i[s+63]=i[s+33]=-g,i[s+32]=-d,i[s+0]=d,i[s+31]=-O,i[s+1]=O,i[s+30]=-x,i[s+2]=x,i[s+29]=-S,i[s+3]=S,i[s+28]=-u,i[s+4]=u,i[s+27]=-I,i[s+5]=I,i[s+26]=-E,i[s+6]=E,i[s+25]=-p,i[s+7]=p,i[s+24]=-y,i[s+8]=y,i[s+23]=-f,i[s+9]=f,i[s+22]=-k,i[s+10]=k,i[s+21]=-A,i[s+11]=A,i[s+20]=-m,i[s+12]=m,i[s+19]=-P,i[s+13]=P,i[s+18]=-M,i[s+14]=M,i[s+17]=-r,i[s+15]=r,i[s+16]=0},_.FRAME_SYNC=2047,_.VERSION={MPEG_2_5:0,MPEG_2:2,MPEG_1:3},_.LAYER={III:1,II:2,I:3},_.MODE={STEREO:0,JOINT_STEREO:1,DUAL_CHANNEL:2,MONO:3},_.SAMPLE_RATE=new Uint16Array([44100,48e3,32e3,0,22050,24e3,16e3,0]),_.BIT_RATE=new Uint16Array([32,48,56,64,80,96,112,128,160,192,224,256,320,384,8,16,24,32,40,48,56,64,80,96,112,128,144,160]),_.SCALEFACTOR_BASE=new Uint32Array([33554432,26632170,21137968]),_.SYNTHESIS_WINDOW=new Float32Array([0,-.5,-.5,-.5,-.5,-.5,-.5,-1,-1,-1,-1,-1.5,-1.5,-2,-2,-2.5,-2.5,-3,-3.5,-3.5,-4,-4.5,-5,-5.5,-6.5,-7,-8,-8.5,-9.5,-10.5,-12,-13,-14.5,-15.5,-17.5,-19,-20.5,-22.5,-24.5,-26.5,-29,-31.5,-34,-36.5,-39.5,-42.5,-45.5,-48.5,-52,-55.5,-58.5,-62.5,-66,-69.5,-73.5,-77,-80.5,-84.5,-88,-91.5,-95,-98,-101,-104,106.5,109,111,112.5,113.5,114,114,113.5,112,110.5,107.5,104,100,94.5,88.5,81.5,73,63.5,53,41.5,28.5,14.5,-1,-18,-36,-55.5,-76.5,-98.5,-122,-147,-173.5,-200.5,-229.5,-259.5,-290.5,-322.5,-355.5,-389.5,-424,-459.5,-495.5,-532,-568.5,-605,-641.5,-678,-714,-749,-783.5,-817,-849,-879.5,-908.5,-935,-959.5,-981,-1000.5,-1016,-1028.5,-1037.5,-1042.5,-1043.5,-1040,-1031.5,1018.5,1e3,976,946.5,911,869.5,822,767.5,707,640,565.5,485,397,302.5,201,92.5,-22.5,-144,-272.5,-407,-547.5,-694,-846,-1003,-1165,-1331.5,-1502,-1675.5,-1852.5,-2031.5,-2212.5,-2394,-2576.5,-2758.5,-2939.5,-3118.5,-3294.5,-3467.5,-3635.5,-3798.5,-3955,-4104.5,-4245.5,-4377.5,-4499,-4609.5,-4708,-4792.5,-4863.5,-4919,-4958,-4979.5,-4983,-4967.5,-4931.5,-4875,-4796,-4694.5,-4569.5,-4420,-4246,-4046,-3820,-3567,3287,2979.5,2644,2280.5,1888,1467.5,1018.5,541,35,-499,-1061,-1650,-2266.5,-2909,-3577,-4270,-4987.5,-5727.5,-6490,-7274,-8077.5,-8899.5,-9739,-10594.5,-11464.5,-12347,-13241,-14144.5,-15056,-15973.5,-16895.5,-17820,-18744.5,-19668,-20588,-21503,-22410.5,-23308.5,-24195,-25068.5,-25926.5,-26767,-27589,-28389,-29166.5,-29919,-30644.5,-31342,-32009.5,-32645,-33247,-33814.5,-34346,-34839.5,-35295,-35710,-36084.5,-36417.5,-36707.5,-36954,-37156.5,-37315,-37428,-37496,37519,37496,37428,37315,37156.5,36954,36707.5,36417.5,36084.5,35710,35295,34839.5,34346,33814.5,33247,32645,32009.5,31342,30644.5,29919,29166.5,28389,27589,26767,25926.5,25068.5,24195,23308.5,22410.5,21503,20588,19668,18744.5,17820,16895.5,15973.5,15056,14144.5,13241,12347,11464.5,10594.5,9739,8899.5,8077.5,7274,6490,5727.5,4987.5,4270,3577,2909,2266.5,1650,1061,499,-35,-541,-1018.5,-1467.5,-1888,-2280.5,-2644,-2979.5,3287,3567,3820,4046,4246,4420,4569.5,4694.5,4796,4875,4931.5,4967.5,4983,4979.5,4958,4919,4863.5,4792.5,4708,4609.5,4499,4377.5,4245.5,4104.5,3955,3798.5,3635.5,3467.5,3294.5,3118.5,2939.5,2758.5,2576.5,2394,2212.5,2031.5,1852.5,1675.5,1502,1331.5,1165,1003,846,694,547.5,407,272.5,144,22.5,-92.5,-201,-302.5,-397,-485,-565.5,-640,-707,-767.5,-822,-869.5,-911,-946.5,-976,-1e3,1018.5,1031.5,1040,1043.5,1042.5,1037.5,1028.5,1016,1000.5,981,959.5,935,908.5,879.5,849,817,783.5,749,714,678,641.5,605,568.5,532,495.5,459.5,424,389.5,355.5,322.5,290.5,259.5,229.5,200.5,173.5,147,122,98.5,76.5,55.5,36,18,1,-14.5,-28.5,-41.5,-53,-63.5,-73,-81.5,-88.5,-94.5,-100,-104,-107.5,-110.5,-112,-113.5,-114,-114,-113.5,-112.5,-111,-109,106.5,104,101,98,95,91.5,88,84.5,80.5,77,73.5,69.5,66,62.5,58.5,55.5,52,48.5,45.5,42.5,39.5,36.5,34,31.5,29,26.5,24.5,22.5,20.5,19,17.5,15.5,14.5,13,12,10.5,9.5,8.5,8,7,6.5,5.5,5,4.5,4,3.5,3.5,3,2.5,2.5,2,2,1.5,1.5,1,1,1,1,.5,.5,.5,.5,.5,.5]),_.QUANT_LUT_STEP_1=[[0,0,1,1,1,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,1,1,1,2,2,2,2,2]],_.QUANT_LUT_STEP_2=[[(_.QUANT_TAB={A:91,B:94,C:8,D:12}).C,_.QUANT_TAB.C,_.QUANT_TAB.D],[_.QUANT_TAB.A,_.QUANT_TAB.A,_.QUANT_TAB.A],[_.QUANT_TAB.B,_.QUANT_TAB.A,_.QUANT_TAB.B]],_.QUANT_LUT_STEP_3=[[68,68,52,52,52,52,52,52,52,52,52,52],[67,67,67,66,66,66,66,66,66,66,66,49,49,49,49,49,49,49,49,49,49,49,49,32,32,32,32,32,32,32],[69,69,69,69,52,52,52,52,52,52,52,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36]],_.QUANT_LUT_STEP4=[[0,1,2,17],[0,1,2,3,4,5,6,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,17],[0,1,3,5,6,7,8,9,10,11,12,13,14,15,16,17],[0,1,2,4,5,6,7,8,9,10,11,12,13,14,15,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],_.QUANT_TAB=[{levels:3,group:1,bits:5},{levels:5,group:1,bits:7},{levels:7,group:0,bits:3},{levels:9,group:1,bits:10},{levels:15,group:0,bits:4},{levels:31,group:0,bits:5},{levels:63,group:0,bits:6},{levels:127,group:0,bits:7},{levels:255,group:0,bits:8},{levels:511,group:0,bits:9},{levels:1023,group:0,bits:10},{levels:2047,group:0,bits:11},{levels:4095,group:0,bits:12},{levels:8191,group:0,bits:13},{levels:16383,group:0,bits:14},{levels:32767,group:0,bits:15},{levels:65535,group:0,bits:16}],_),B.Renderer.WebGL=(b.prototype.resize=function(e,t){this.width=0|e,this.height=0|t,this.canvas.width=this.width,this.canvas.height=this.height,this.gl.useProgram(this.program),this.gl.viewport(0,0,this.width,this.height)},b.prototype.createTexture=function(e,t){var i=this.gl,s=i.createTexture();return i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.uniform1i(i.getUniformLocation(this.program,t),e),s},b.prototype.createProgram=function(e,t){var i=this.gl,s=i.createProgram();return i.attachShader(s,this.compileShader(i.VERTEX_SHADER,e)),i.attachShader(s,this.compileShader(i.FRAGMENT_SHADER,t)),i.linkProgram(s),i.useProgram(s),s},b.prototype.compileShader=function(e,t){var i=this.gl,s=i.createShader(e);if(i.shaderSource(s,t),i.compileShader(s),!i.getShaderParameter(s,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(s));return s},b.prototype.allowsClampedTextureData=function(){var e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.LUMINANCE,1,1,0,e.LUMINANCE,e.UNSIGNED_BYTE,new Uint8ClampedArray([0])),
0===e.getError()},b.prototype.renderProgress=function(e){var t=this.gl,i=t.getUniformLocation(this.loadingProgram,"progress");t.uniform1f(i,e),t.drawArrays(t.TRIANGLE_STRIP,0,4)},b.prototype.render=function(e,t,i){if(this.enabled){var s=this.gl,n=this.width+15>>4<<4,r=this.height,a=n>>1,o=r>>1;this.shouldCreateUnclampedViews&&(e=new Uint8Array(e.buffer),t=new Uint8Array(t.buffer),i=new Uint8Array(i.buffer)),this.updateTexture(s.TEXTURE0,this.textureY,n,r,e),this.updateTexture(s.TEXTURE1,this.textureCb,a,o,t),this.updateTexture(s.TEXTURE2,this.textureCr,a,o,i),s.drawArrays(s.TRIANGLE_STRIP,0,4)}},b.prototype.updateTexture=function(e,t,i,s,n){var r=this.gl;r.activeTexture(e),r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.LUMINANCE,i,s,0,r.LUMINANCE,r.UNSIGNED_BYTE,n)},b.IsSupported=function(){try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas");return!(!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},b.SHADER={FRAGMENT_YCRCB_TO_RGBA:["precision mediump float;","uniform sampler2D textureY;","uniform sampler2D textureCb;","uniform sampler2D textureCr;","varying vec2 texCoord;","mat4 rec601 = mat4(","1.16438,  0.00000,  1.59603, -0.87079,","1.16438, -0.39176, -0.81297,  0.52959,","1.16438,  2.01723,  0.00000, -1.08139,","0, 0, 0, 1",");","void main() {","float y = texture2D(textureY, texCoord).r;","float cb = texture2D(textureCb, texCoord).r;","float cr = texture2D(textureCr, texCoord).r;","gl_FragColor = vec4(y, cr, cb, 1.0) * rec601;","}"].join("\n"),FRAGMENT_LOADING:["precision mediump float;","uniform float progress;","varying vec2 texCoord;","void main() {","float c = ceil(progress-(1.0-texCoord.y));","gl_FragColor = vec4(c,c,c,1);","}"].join("\n"),VERTEX_IDENTITY:["attribute vec2 vertex;","varying vec2 texCoord;","void main() {","texCoord = vertex;","gl_Position = vec4((vertex * 2.0 - 1.0) * vec2(1, -1), 0.0, 1.0);","}"].join("\n")},b),B.Renderer.Canvas2D=(w.prototype.resize=function(e,t){this.width=0|e,this.height=0|t,this.canvas.width=this.width,this.canvas.height=this.height,this.imageData=this.context.getImageData(0,0,this.width,this.height),B.Fill(this.imageData.data,255)},w.prototype.renderProgress=function(e){var t=this.canvas.width,i=this.canvas.height,s=this.context;s.fillStyle="#222",s.fillRect(0,0,t,i),s.fillStyle="#fff",s.fillRect(0,i-i*e,t,i*e)},w.prototype.render=function(e,t,i){this.YCbCrToRGBA(e,t,i,this.imageData.data),this.context.putImageData(this.imageData,0,0)},w.prototype.YCbCrToRGBA=function(e,t,i,s){if(this.enabled)for(var n,r,a,o,d,l=this.width+15>>4<<4,u=l>>1,h=0,c=l,p=l+(l-this.width),v=0,f=u-(this.width>>1),m=0,g=4*this.width,y=4*this.width,_=this.width>>1,b=this.height>>1,w=0;w<b;w++){for(var k=0;k<_;k++){n=t[v],r=i[v],v++,a=n+(103*n>>8)-179,o=(88*r>>8)-44+(183*n>>8)-91,d=r+(198*r>>8)-227;var A=e[h++],T=e[h++];s[m]=A+a,s[m+1]=A-o,s[m+2]=A+d,s[m+4]=T+a,s[m+5]=T-o,s[m+6]=T+d,m+=8;var C=e[c++],E=e[c++];s[g]=C+a,s[g+1]=C-o,s[g+2]=C+d,s[g+4]=E+a,s[g+5]=E-o,s[g+6]=E+d,g+=8}h+=p,c+=p,m+=y,g+=y,v+=f}},w),B.AudioOutput.WebAudio=(k.prototype.play=function(e,t,i){if(this.enabled){if(!this.unlocked){var s=B.Now();return this.wallclockStartTime<s&&(this.wallclockStartTime=s),void(this.wallclockStartTime+=t.length/e)}this.gain.gain.value=this.volume;var n=this.context.createBuffer(2,t.length,e);n.getChannelData(0).set(t),n.getChannelData(1).set(i);var r=this.context.createBufferSource();r.buffer=n,r.connect(this.destination);var a=this.context.currentTime,o=n.duration;this.startTime<a&&(this.startTime=a,this.wallclockStartTime=B.Now()),r.start(this.startTime),this.startTime+=o,this.wallclockStartTime+=o}},k.prototype.stop=function(){this.gain.gain.value=0},k.prototype.getEnqueuedTime=function(){return Math.max(this.wallclockStartTime-B.Now(),0)},k.prototype.resetEnqueuedTime=function(){this.startTime=this.context.currentTime,this.wallclockStartTime=B.Now()},k.prototype.unlock=function(e){if(this.unlocked)e&&e();else{this.unlockCallback=e;var t=this.context.createBuffer(1,1,22050),i=this.context.createBufferSource();i.buffer=t,i.connect(this.destination),i.start(0),setTimeout(this.checkIfUnlocked.bind(this,i,0),0)}},k.prototype.checkIfUnlocked=function(e,t){e.playbackState===e.PLAYING_STATE||e.playbackState===e.FINISHED_STATE?(this.unlocked=!0,this.unlockCallback&&(this.unlockCallback(),this.unlockCallback=null)):t<10&&setTimeout(this.checkIfUnlocked.bind(this,e,t+1),100)},k.NeedsUnlocking=function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},k.IsSupported=function(){return window.AudioContext||window.webkitAudioContext},k.CachedContext=null,k);var R=function(e,t){return new B.Player(e,t)},F=function(){function e(t,i){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(s=C(this,E(e).call(this))).video=t,s.params=i,s.target=s.params.canvas.parent,s.logToBI=s.params.logToBI,s.playingEventTimeout=s.params.canvas.playingEventTimeout||100,s.createCanvas(),s.modifyVideo(t),s.shouldAutoPlay=!1,s.canvasCss=i.canvas.additionalCss||{},s.bypass=!1,s.clntRedirRslvWhiteList=s.params.clientRedirRslvWhiteList||[],s.ready=!1,s.loop=!1,s.vidAttr={},t.muted=!0,s.status="LOADING",s._addCanvasProgressPrecentageProperty(),s._addCanvasCurrentTimeProperty(),s._addCanvasMethods(),s.quartiles=[{event:"AdVideoFirstQuartile",percentage:.25},{event:"AdVideoMidpoint",percentage:.5},{event:"AdVideoThirdQuartile",percentage:.75}],s.logToBI("canvas",{ctor:!0}),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(e,S.EventEmitter),function(e,t,i){t&&T(e.prototype,t),i&&T(e,i)}(e,[{key:"_addCanvasProgressPrecentageProperty",value:function(){Object.defineProperty(this,"progressPrecentage",{get:function(){return this.video.currentTime/this.video.duration}})}},{key:"_addCanvasCurrentTimeProperty",value:function(){Object.defineProperty(this,"currentTime",{get:function(){return this.video.currentTime}})}},{key:"_addCanvasMethods",value:function(){this._addMuteButtonClickedMethod(),this._addPlayButtonClickedMethod(),this._addResizeMethod(),this._addUseResumeCallbackMethod(),this._addEmitStartAdMethod(),this._addShowCanvasMethod(),this._addHideCanvasMethod()}},{key:"_addMuteButtonClickedMethod",value:function(){var e=this;this.video.muteButtonClicked=function(){e.muteButtonClick()}}},{key:"_addPlayButtonClickedMethod",value:function(){var e=this;this.video.playButtonClicked=function(){e.playButtonClick()}}},{key:"_addResizeMethod",value:function(){var e=this;this.video.resize=function(){var t=1<arguments.length?arguments:arguments[0],i=t[0],s=t[1],n=t[2];n&&(e.params.canvas.aspectRatio=n),e.onResize(i,s)}}},{key:"_addUseResumeCallbackMethod",value:function(){var e=this;this.video.useResumeCallback=function(){return e}}},{key:"_addEmitStartAdMethod",value:function(){var e=this;this.video.emitStartAd=function(){return e.emitStartAd()}}},{key:"_addShowCanvasMethod",value:function(){var e=this;this.video.showCanvas=function(){return e.show()}}},{key:"_addHideCanvasMethod",value:function(){var e=this;this.video.hideCanvas=function(){return e.hide()}}},{key:"emitStartAd",value:function(){var e=this;this.stratAdCalled=!0,this._playTimeout=setTimeout(function(){e._play()},2e3)}},{key:"backToVideoTag",value:function(e){var t=this;if(!this.bypass&&this.src){this.bypass=!0;var i=this.jsmpeg.currentTime,s=this.video.style,n=this.video.parentElement||this.target,r=parseInt(this.canvas.style.zIndex),a=this.jsmpeg.loop;this.newVid=n.insertBefore(document.createElement("video"),this.canvas),this.newVid.className="mc-loud-video",this.newVid.setAttribute("playsinline",""),this.newVid.setAttribute("autoplay",""),a&&this.newVid.setAttribute("loop",""),this.newVid.style.height=s.height,this.newVid.style.width=s.width,this.newVid.style.top=s.top?s.top:"0",this.newVid.style.left=s.left?s.left:"0",this.newVid.style.background="#000000",this.newVid.style.zIndex=r,this.newVid.style.display="none",this.newVid.src=this.src,this.newVid.volume="muteChanged"===e.type?this.params.canvas.defaultVolume:0,this.newVid.muted=0===this.newVid.volume,this.newVid.addEventListener("ended",function(e){t._dispatchEvent("ended")},!1),this.newVid.addEventListener("click",function(e){t._dispatchEvent("click",e)}),this.newVid.addEventListener("durationchange",function s(){if(0!==t.newVid.duration){t.newVid.removeEventListener("durationchange",s);var n=t.jsmpeg&&0<t.jsmpeg.currentTime?t.jsmpeg.currentTime:i;(0===t.newVid.currentTime||t.newVid.currentTime<n)&&(t.newVid.currentTime=n,t.newVid.addEventListener("timeupdate",function i(){t.newVid.currentTime>n&&(t.newVid.removeEventListener("timeupdate",i),t.tuTicker=clearInterval(t.tuTicker),t.jsmpeg.stop(),t.jsmpeg=void 0,t.newVid.style.display="block",t.canvas.style.display="none",t.video.style.display="none","playChanged"!==e.type&&!t.video.paused||t._pause(),t._dispatchEvent("newVidCreated",t.newVid))}))}}),this.newVid.addEventListener("timeupdate",function(){t._dispatchEvent("timeupdate")}),this.newVid.currentTime=i,this.newVid.play().then(function(){t.newVid.currentTime=i}),this.isCanvasFinished=!1}}},{key:"mpegFinish",value:function(){this.isCanvasFinished||(this._dispatchEvent("ended"),this.isCanvasFinished=!0)}},{key:"onLoad",value:function(){if(!this.loaded){this.loaded=!0;var e=parseInt(this.video.width),t=parseInt(this.video.height);this.onResize(e,t),this.ready=!0,this.emit("ready"),this.emit("canplay"),this._dispatchEvent("loadedmetadata")}}},{key:"createCanvas",value:function(){var e=this,t=document.createElement("canvas");t.className="mc-canvas",this.params.isMultiVpaidUnit&&function(e,t){e.className.indexOf(t)<0&&(e.className+=" ".concat(t)),e.className=e.className.split(" ").join(" ")}(t,"multi-vpaids");var i=this.video.parentElement||this.target;this.canvas=i.appendChild(t),i.className+=" mpegcnv",i._appendChild=i.appendChild,i.appendChild=function(t){i.insertBefore(t,e.canvas)},this.video&&this.video._addEventListener("resize",function(t){e.onResize(t.target.clientWidth,t.target.clientHeight)}),this.canvas.addEventListener("click",function(t){e._dispatchEvent("click",t)})}},{key:"_getAspectRatio",value:function(){var e=this.params.canvas.aspectRatio;if(e&&e.indexOf(":")){var t=e.split(":");if(2===t.length&&t[0]&&t[1])return t}return!1}},{key:"onResize",value:function(e,t){var i,s;if(e||t){var n=this._getAspectRatio();if(n?e?(t=t||this.video.clientHeight,s=e,i=Math.floor(parseFloat(e)*parseInt(n[1])/parseInt(n[0]))):(e=this.video.clientWidth,i=t,s=Math.floor(parseFloat(t)*parseInt(n[0])/parseInt(n[1]))):(s=e,i=t),this.newVid)this.newVid.style.width="".concat(e,"px"),this.newVid.style.height="".concat(t,"px");else if(this.jsmpeg&&this.canvas){var r=this.video.videoWidth/this.video.videoHeight,a=e/t;this.canvas.style.position="absolute",this.canvas.style.top="0px",r<=1&&1<a?this._rescaleVerticalToWide(e,t):(this.canvas.style.left="0px",this.canvas.style.width=s+"px",this.canvas.style.height=i+"px",this.canvas.style.marginTop=(t-i)/2+"px",this.canvas.style.marginLeft=(e-s)/2+"px")}this.height=t,this.width=e}}},{key:"_rescaleVerticalToWide",value:function(e,t){var i=this.video.videoHeight/t,s=this.video.videoWidth/i,n=(e-s)/2;this.canvas.style.width=s+"px",this.canvas.style.height=t+"px",this.canvas.style.left=n+"px",this.canvas.parentElement&&this.canvas.parentElement.parentElement&&(this.canvas.parentElement.parentElement.style.backgroundColor="black")}},{key:"hookMethod",value:function(e,t,i){this.hooks||(this.hooks=[]),this.hooks[t]=e[t];var s=this;e[t]=function(){var e={};if(i(arguments,e)){if(!s.hooks.hasOwnProperty(t)||"function"!=typeof s.hooks[t])return!1;var n=s.hooks[t].apply(this,arguments);return e.res?e.res:n}}}},{key:"subscribe",value:function(e,t){this.on(e,t)}},{key:"unsubscribe",value:function(e,t){this.off(e,t)}},{key:"_dispatchEvent",value:function(e,t){var i={};i.type=e,i.data=t||{},this.emit(e,i)}},{key:"errHndlr",value:function(e){this.logToBI("jsmpegError",e),this.video.destroy()}},{key:"isUrlInRslvWhiteList",value:function(e){if(!this.clntRedirRslvWhiteList.length)return!0;for(var t=0;t<this.clntRedirRslvWhiteList.length;++t)if(-1<e.indexOf(this.clntRedirRslvWhiteList[t]))return!0;return!1}},{key:"setSrc",value:function(e){if((e=e.trim())&&!this.hasVidUrl){this.logToBI("canvasUrl",{url:e},!1,!1),this.hasVidUrl=!0,this.video&&this.video._vidSetAttr("src",e),this.src=e;var t=this.params.canvas.canvasLoadRate,i=parseInt(this.video.clientWidth),s=parseInt(this.video.clientHeight),n={loadeReadyRate:t,canvas:this.canvas,audio:!1,centerVertically:!0,autoplay:this.shouldAutoPlay,loop:this.loop||!1,pcy:s,pcx:i,onload:this.onLoad.bind(this),errHndlr:this.errHndlr.bind(this),onfinished:this.mpegFinish.bind(this),progressive:!1,canvasCss:this.canvasCss,disableGl:this.params.canvas.disableWebGl},r=this.params.canvas.mpegServerBaseUrl+"="+encodeURIComponent(e);return(/\.mpg$/.test(e)||/\.mpeg$/.test(e))&&(r=e),this.jsmpeg=new R(r,n,this),this._setVideoDuration(this.src),!1}}},{key:"_play",value:function(){var e=this;this.blockActions||(clearTimeout(this._playTimeout),this._timeUpdateTicker(),this.ready?(this.newVid?this.newVid.play():this.jsmpeg.play(),setTimeout(function(){e._dispatchEvent("playing")},this.playingEventTimeout),this.status="PLAYING",this._render()):this.on("ready",function(){e._dispatchEvent("play"),e._play()}))}},{key:"_timeUpdateTicker",value:function(){var e=this;clearInterval(this.tuTicker),this.tuTicker=setInterval(function(){e._dispatchEvent("timeupdate"),0<e.quartiles.length&&e.video.currentTime/e.video.duration>=e.quartiles[0].percentage&&e.logToBI("canvas_quartiles",{event:e.quartiles.shift().event})},250)}},{key:"_pause",value:function(){this.stopped||(this.status="PAUSED",this._render(),this.newVid?this.newVid.pause():this.jsmpeg&&this.jsmpeg.pause(),this.tuTicker&&(this.tuTicker=clearInterval(this.tuTicker)))}},{key:"muteButtonClick",value:function(e){if(!this.stopped){var t=!!this.newVid&&!this.newVid.muted;this.logToBI("canvasMuteToggle",{muted:t}),this.newVid?(this.newVid.volume=t?0:this.params.canvas.defaultVolume,this.newVid.muted=0===this.newVid.volume):this.backToVideoTag({type:"muteChanged"})}}},{key:"playButtonClick",value:function(e){if(!this.stopped){var t="PLAYING"===this.status?"PAUSED":"PLAYING";if(this.logToBI("canvasPlayToggle",{status:t,view:this.newVid?"newVid":"canvas"}),this.status=t,this.newVid){var i=this.newVid||this.jsmpeg;"PLAYING"===this.status?i.play():i.pause(),this._render()}else this.backToVideoTag({type:"playChanged"})}}},{key:"modifyVideo",value:function(e){var t=this;this.stopped||(e._vidSetAttr=e.setAttribute,e.getAttribute=function(e,i){return t.vidAttr[e]},e.setAttribute=function(i,s){if(!t.stopped)return t.vidAttr[i]=s,"volume"===i&&(t._volume=s),t.logToBI("hookSetAttribute",{key:i,val:s}),"src"===i?void t.setSrc(s):e._vidSetAttr(i,s)},this.hookMethod(e,"play",function(){if(!t.stopped)return t._play(),setTimeout(function(){t._dispatchEvent("playing")},t.playingEventTimeout),!1}),this.hookMethod(e,"pause",function(){if(!t.stopped)return t._pause(),t._dispatchEvent("pause"),!0}),this.hookMethod(e,"stop",function(){if(!t.stopped)return t.jsmpeg.stop(),!0}),s(e,"paused",function(){return"PAUSED"===t.status},null),s(e,"src",function(){return t.src},this.setSrc.bind(this)),s(this.video,"volume",function(){return t.newVid?t.newVid.volume:t._volume},function(e){return t._volume=e,!0}),s(e,"currentTime",function(){var e=t.newVid||t.jsmpeg;return e?e.currentTime:0},function(e){t.newVid?t.newVid.currentTime=e:t.jsmpeg.seek(e)}),s(e,"ended",function(){return t.newVid?t.newVid.ended:t.isCanvasFinished},null),s(e,"duration",function(){if(t.duration)return t.duration},function(e){t.duration=e}))}},{key:"_setVideoDuration",value:function(e){var t=this,i=document.createElement("video");i.src=e,i.addEventListener("loadedmetadata",function(){t.video&&(t.video.duration=i.duration),i.src="",i=void 0}),i.load()}},{key:"_render",value:function(){this.newVid||this.canvas}},{key:"hide",value:function(){this.stopped||(this.canvas.style.display="none",this._render())}},{key:"show",value:function(){this.stopped||(this.canvas.style.display="block",this._render())}},{key:"removeDomMember",value:function(e){e.parentNode.removeChild(e)}},{key:"restartAd",value:function(){var e=this;this.stopped||(this.newVid?(this.newVid.currentTime=0,this.newVid.play()):this.jsmpeg&&(this.blockActions=!0,this.jsmpeg.stop(),setTimeout(function(){e.jsmpeg.play()},20),setTimeout(function(){e.blockActions=!1},2e3)))}},{key:"destroy",value:function(){if(this.stopped)this.logToBI("canvasDuplicatedDestroy",{});else{this.stopped=!0,clearTimeout(this._playTimeout),clearInterval(this.tuTicker),this.jsmpeg=void 0;var e=this._events;for(var t in e)this.removeAllListeners(t);this.removeDomMember(this.canvas),this.canvas=void 0}}}]),e}(),L=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.video=document.createElement("video"),this.params=t,this._addVideoTagMethods(),this._addVideoTagProperties(),this._addVideoTagAttributes(),this.video}return function(e,t,i){t&&V(e.prototype,t),i&&V(e,i)}(e,[{key:"_addVideoTagMethods",value:function(){this._addClearVideoSourcesMethod(),this._addRestartMethod(),this._addAppendSourceMethod(),this._addAppendVideoSourcesMethod(),this._addProtectVideoPauseMethod(),this._addGetSrcMethod(),this._addHookMutedPropertyMethod(),this._addSupressErrorEventsMethod(),this._addDispatchEventMethod(),this._addSubscribeMethod(),this._addUnsubscribeMethod()}},{key:"_addClearVideoSourcesMethod",value:function(){this.video.clearVideoSources=function(){for(;this.childNodes.length;)this.removeChild(this.childNodes[0])}}},{key:"_addRestartMethod",value:function(){this.video.restart=function(){this.currentTime=0,this.play()}}},{key:"_addAppendSourceMethod",value:function(){this.video.appendSource=function(e,t){if(this.forceCanvas)this.setAttribute("src",e),this.setAttribute("type",t);else{var i=document.createElement("source");i.src=e,i.setAttribute("type",t),this.appendChild(i)}this.relevantSources++}}},{key:"_addAppendVideoSourcesMethod",value:function(){var e=this;this.video.appendVideoSources=function(t){var i=null;e.video.clearVideoSources();for(var s=0;s<t.length;s++){var n=t[s],r=n.url;e.video.canPlayType(n.originalType)&&(e.params.decodeUrl&&(r=decodeURI(r)),e.params.secureMediaFiles&&(r=r.replace("http:","https:")),i||((i=n).mediaUrl=r),e.video.appendSource(r,n.originalType))}return i}}},{key:"_addProtectVideoPauseMethod",value:function(){this.video.protectPause=function(){this._play=this.play,this.play=function(){this.resumeInvoked&&this._play()}}}},{key:"_addGetSrcMethod",value:function(){this.video.getSrc=function(){return this.src||this.currentSrc||""}}},{key:"_addHookMutedPropertyMethod",value:function(){this.params.isMobile&&(this.video.hookMutedProperty=function(){this.__defineSetter__("_muted",this.__lookupSetter__("muted")),this.__defineSetter__("muted",function(e){return this.mutedChangeByUserGesture?(this._muted=e,void this.__defineSetter__("muted",this.__lookupSetter__("_muted"))):void(this._muted=!0)})})}},{key:"_addSupressErrorEventsMethod",value:function(){this.video.supressErrorEvents=function(){this.__addEventListener=this.addEventListener,this.addEventListener=function(e,t){"error"!==e&&this.__addEventListener(e,t)}}}},{key:"_addDispatchEventMethod",value:function(){this.video._dispatchEvent=function(e,t){var i=document.createEvent("Event");i.initEvent(e,!0,!0),i.data=t||{},this.dispatchEvent(i)}}},{key:"_addSubscribeMethod",value:function(){this.video.subscribe=function(e,t){this.addEventListener(e,t,!0)}}},{key:"_addUnsubscribeMethod",value:function(){this.video.unsubscribe=function(e,t){this.removeEventListener(e,t,!0)}}},{key:"_addVideoTagProperties",value:function(){this._addTbVersionProperty(),this._addProgressPrecentageProperty(),this._addRemainingTimeProperty(),this._addRelevantSourcesProperty(),this._addBufferSizeProperty(),this._addResumeInvokedProperty(),this._addMutedChangeByUserGestureProperty(),this._hookSrcProperty()}},{key:"_addTbVersionProperty",value:function(){Object.defineProperty(this.video,"TB__VERSION",{get:function(){return"2.2.12"}})}},{key:"_addProgressPrecentageProperty",value:function(){Object.defineProperty(this.video,"progressPrecentage",{get:function(){return this.currentTime/this.duration}})}},{key:"_addRemainingTimeProperty",value:function(){Object.defineProperty(this.video,"remainingTime",{get:function(){return this.duration-this.currentTime}})}},{key:"_addRelevantSourcesProperty",value:function(){Object.defineProperty(this.video,"relevantSources",{get:function(){return this._relevantSources||0},set:function(e){this._relevantSources=e}})}},{key:"_addBufferSizeProperty",value:function(){Object.defineProperty(this.video,"bufferSize",{get:function(){if(this.buffered)return 0===this.buffered.length||0!==this.buffered.start(0)?0:this.buffered.end(0)-this.buffered.start(0)}})}},{key:"_addResumeInvokedProperty",value:function(){Object.defineProperty(this.video,"resumeInvoked",{get:function(){return this._resumeInvoked||!1},set:function(e){this._resumeInvoked=e}})}},{key:"_addMutedChangeByUserGestureProperty",value:function(){this.params.isMobile&&Object.defineProperty(this.video,"mutedChangeByUserGesture",{get:function(){return this._mutedChangeByUserGesture||!1},set:function(e){this._mutedChangeByUserGesture=e}})}},{key:"_hookSrcProperty",value:function(){var e=this;s(this.video,"src",null,function(t){return!(""==t&&!e.video.removeSrc)})}},{key:"_addVideoTagAttributes",value:function(){this.params.isMobile&&(this.video.muted=!0,this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),"iOS"===this.params.userAgent.os.name&&this.video.removeAttribute("autoplay",""))}}]),e}(),W=i(2),j=M,U=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._initVideoElementParams(t),this.video=new L(this.params),this._overrideVideoAddEventListener(),this._initVideoMobileParams(),this._addVideoElementProperties(),this._addVideoElementMethods(),this._addTimeupdateEvents(),this._loopThroughMediaSources(),this.video.videoState=t.videoState||O,this.video}return function(e,t,i){t&&x(e.prototype,t),i&&x(e,i)}(e,[{key:"_initVideoElementParams",value:function(e){var t=0<arguments.length&&void 0!==e?e:{};this.params=I({},j,t),this.params.canvas=I({},j.canvas,t.canvas),this.params.secureMediaFiles=this.params.secureMediaFiles&&"https:"===window.location.protocol,this.params.userAgent=W.parseUserAgent()}},{key:"_initVideoMobileParams",value:function(){if(this.params.isMobile)if(this.params.logToBI("videoElement",{forceCanvas:this.params.canvas.force},!1,!1),this.params.canvas.force){if(this._isAutoplayContent())return;this._initCanvas()}else this._shouldDetectAutoplay()&&this._detectAutoplay()}},{key:"_isAutoplayContent",value:function(){return this.params.videoState===O&&this.params.canvas.useAutoplayForContent}},{key:"_shouldDetectAutoplay",value:function(){return this.params.isMobile&&!this.params.canvas.ignoreAutoplayDetection}},{key:"_detectAutoplay",value:function(){var e=new D(this.params);e.on("detectIsAutoplaySupported",this._onIsAutoplaySupportedDetected.bind(this)),e.isAutoplaySupported()}},{key:"_onIsAutoplaySupportedDetected",value:function(e){this.params.logToBI("videoElement",{isAutoplaySupported:e},!1,!1),e||this._initCanvas()}},{key:"_initCanvas",value:function(){this.canvasInited||(this.canvasInited=!0,this.video.forceCanvas=!0,this.canvas=new F(this.video,this.params),this._handleEventListenersVideoToCanvas(),this._registerToCanvasEvents(),this.params.canvas.onCanvasUsage())}},{key:"_overrideVideoAddEventListener",value:function(){this.eventsCb={};var e=this;this.video._addEventListener=this.video.addEventListener,this.video.addEventListener=function(t,i,s){e._addEventCb(t,i),this._addEventListener(t,i,s)}}},{key:"_addEventCb",value:function(e,t){this.eventsCb[e]=this.eventsCb[e]||[],this.eventsCb[e].push(t)}},{key:"_handleEventListenersVideoToCanvas",value:function(){this._removeListenersFrom(this.video),this._addListenersTo(this.canvas),this._overrideAddEventListener(this.canvas)}},{key:"_removeListenersFrom",value:function(e){for(var t in this.eventsCb){var i=!0,s=!1,n=void 0;try{for(var r,a=this.eventsCb[t][Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var o=r.value;e.unsubscribe(t,o)}}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}}}},{key:"_addListenersTo",value:function(e){for(var t in this.eventsCb){var i=!0,s=!1,n=void 0;try{for(var r,a=this.eventsCb[t][Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var o=r.value;e.subscribe(t,o)}}catch(e){s=!0,n=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw n}}}}},{key:"_overrideAddEventListener",value:function(e){var t=this;this.video.addEventListener=function(i,s){t._addEventCb(i,s),e.subscribe(i,s)}}},{key:"_addGetSrcMethod",value:function(){this.video.getSrc=function(){return this.src||this.currentSrc||""}}},{key:"_registerToCanvasEvents",value:function(){this._registerToCanvasNewVidCreatedEvent()}},{key:"_registerToCanvasNewVidCreatedEvent",value:function(){var e=this;this._onNewVidCreated=function(t){var i=t.data;i.style.pointerEvents="all",i.style.zIndex=i.style.zIndex||e.zIndex,e.newVidCreated=!0,e._removeCanvasMethods(),e._unregisterFromCanvasEvents(),e.video._dispatchEvent("canvasToVideo",{videoElement:i}),e.params.logToBI("canvasToVideo",{newVidCreated:!0})},this.canvas.on("newVidCreated",this._onNewVidCreated)}},{key:"_addMuteButtonClickedMethod",value:function(){var e=this;this.video.muteButtonClicked=function(){e.canvas&&e.canvas.muteButtonClick()}}},{key:"_addPlayButtonClickedMethod",value:function(){var e=this;this.video.playButtonClicked=function(){e.canvas&&e.canvas.playButtonClick()}}},{key:"_addResizeMethod",value:function(){var e=this,t=arguments;this.video.resize=function(){if(e.canvas){var i=1<t.length?t:t[0],s=i[0],n=i[1],r=i[2];r&&(e.params.canvas.aspectRatio=r),e.canvas.onResize(s,n)}}}},{key:"_addUseResumeCallbackMethod",value:function(){var e=this;this.video.useResumeCallback=function(){return e.canvas}}},{key:"_addEmitStartAdMethod",value:function(){var e=this;this.video.emitStartAd=function(){return e.canvas.emitStartAd()}}},{key:"_addShowCanvasMethod",value:function(){var e=this;this.video.showCanvas=function(){return e.canvas.show()}}},{key:"_addHideCanvasMethod",value:function(){var e=this;this.video.hideCanvas=function(){return e.canvas.hide()}}},{key:"_addVideoElementProperties",value:function(){this._addVideoStateProperty(),this._addForceCanvasProperty(),this._addBufferingProperty()}},{key:"_addVideoStateProperty",value:function(){Object.defineProperty(this.video,"videoState",{get:function(){return this._videoState||O},set:function(e){this._videoState=e}})}},{key:"_addForceCanvasProperty",value:function(){if(this.params.isMobile){var e=this.video.forceCanvas||!1;Object.defineProperty(this.video,"forceCanvas",{get:function(){return this._forceCanvas||e},set:function(e){this._forceCanvas=e}})}}},{key:"_addBufferingProperty",value:function(){if(this.params.isMobile){var e=this.video.buffering||!1;Object.defineProperty(this.video,"buffering",{get:function(){return this._buffering||e},set:function(e){this._buffering=e}})}}},{key:"_addVideoElementMethods",value:function(){this._addRegisterProgressEventsMethod(),this._addRegisterTickingEventsMethod(),this._addDestroyMethod()}},{key:"_addRegisterProgressEventsMethod",value:function(){var e=this;this.video.registerProgressEvents=function(t){e._progressEvents={};for(var i=0;i<t.length;i++){var s="precentage"===t[i].offsetType?t[i].offset:t[i].offset/e.video.duration;e._progressEvents[s]={offset:s,fired:!1}}}}},{key:"_addRegisterTickingEventsMethod",value:function(){var e=this;this.video.registerTickingEvents=function(t){e._ticker=t}}},{key:"_addDestroyMethod",value:function(){var e=this;this.video.destroy=function(){e.video.pause(),e.video.clearVideoSources(),e._cleanVideoSrcProp(),e.canvas&&e.canvas.destroy()}}},{key:"_cleanVideoSrcProp",value:function(){this.video.removeSrc=!0,this.video.src=""}},{key:"_removeCanvasMethods",value:function(){this.video.emitStartAd=this.video.showCanvas=this.video.hideCanvas=void 0}},{key:"_unregisterFromCanvasEvents",value:function(){this.canvas.off("newVidCreated",this._onNewVidCreated),this._onNewVidCreated=void 0}},{key:"_addTimeupdateEvents",value:function(){this.quartiles={q1:!1,q2:!1,q3:!1};var e=this;this.video.addEventListener("timeupdate",function t(){if(!this._buffering){.75<=this.progressPrecentage&&!e.quartiles.q3?(e.quartiles.q3=!0,this._dispatchEvent("thirdQuartile")):.5<=this.progressPrecentage&&!e.quartiles.q2?(e.quartiles.q2=!0,this._dispatchEvent("midpoint")):.25<=this.progressPrecentage&&!e.quartiles.q1&&(e.quartiles.q1=!0,this._dispatchEvent("firstQuartile"));var i=!0;for(var s in e._progressEvents)e._progressEvents[s].fired||(e._progressEvents[s].offset<=this.progressPrecentage?(e._progressEvents[s].fired=!0,this._dispatchEvent("timeProgress",{pre:this.progressPrecentage,time:this.currentTime})):i=!1);if(e._ticker){var n=Math.floor(this.currentTime);this._currentTimeFloored!==n&&n%e._ticker==0&&(this._currentTimeFloored=n,this._dispatchEvent("ticking",{time:n}))}i&&e.quartiles.q3&&!e._ticker&&this.unsubscribe("timeupdate",t)}})}},{key:"_loopThroughMediaSources",value:function(){var e=this;this.video.addEventListener("ended",function(){if(e._isPlayingContent()&&1<e.video.childNodes.length){var t=e.video.removeChild(e.childNodes[0]);e.video.appendChild(t),e.video.load(),e.video.play()}})}},{key:"_isPlayingContent",value:function(){return this.video.videoState===O}}]),e}();try{if(window.cmTag){var N=window.cmTag.config.ms||{};N["video-element"]=N["video-element"]||{},N["video-element"]["2.2.12"]=U,window.cmTag.set("ms",N)}}catch(e){}try{window.TRC=window.TRC||{},window.TRC["video-element"]=window.TRC["video-element"]||{},window.TRC["video-element"]["2.2.12"]=U}catch(e){}}])},function(e,t){!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,s){t.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,i){if(1&i&&(e=t(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var n in e)t.d(s,n,function(t){return e[t]}.bind(null,n));return s},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){"use strict";function s(e){if(!e||"string"!=typeof e)return 0;var t;void 0===t&&(t=0);var i=0;t^=-1;for(var s=0,n=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):(127<s&&s<2048?t+=String.fromCharCode(s>>6|192):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128)),t+=String.fromCharCode(63&s|128))}return t}(e)).length;s<n;s++)i=255&(t^e.charCodeAt(s)),t=t>>>8^"0x"+"00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".substr(9*i,8);
return-1^t}function n(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}function a(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}i.r(t);var o=function(){function e(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,s=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.async=null==i||i,this.withCredentials=null==s||s,this.timeout=n||5e3,this.contentType=t||"application/x-www-form-urlencoded"}var t,i,s;return t=e,(i=[{key:"send",value:function(e){var t=new XMLHttpRequest,i=e.postData||"";t.open(i?"POST":"GET",e.wfUrl,!0),t.withCredentials=this.withCredentials,t.setRequestHeader("Content-type",this.contentType),t.async=this.async,t.timeout=this.timeout,t.gotResponse=!1;var s=this._onFail.bind(t,e),n=this._onReadyStateChanged.bind(t,e);return t.addEventListener("error",s),t.addEventListener("abort",s),t.addEventListener("timeout",s),t.addEventListener("readystatechange",n),t.send(i),!0}},{key:"_onFail",value:function(e){this.gotResponse||(this.gotResponse=!0,e.onFail&&e.onFail([this.status],e.wfUrl))}},{key:"_onReadyStateChanged",value:function(e){if(4==this.readyState){if(this.gotResponse)return;this.gotResponse=!0,e.onSuccess&&e.onSuccess(this.responseText,void 0,e.wfUrl)}}}])&&n(t.prototype,i),s&&n(t,s),e}(),d=[{id:5,mime:"application/javascript",video:!1},{id:8,mime:"video/x-ms-wmv",video:!0},{id:10,mime:"video/mp4",video:!0},{id:11,mime:"video/ogg",video:!0},{id:12,mime:"video/webm",video:!0}];window._cm_wfCounter=window._cm_wfCounter||1;var l=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.store=t,this.creatives=i,this.XHR=new o(this.store.get("psthdrs")||"application/json",!0,!0,5e3),this._init(),this._setBaseUrl(),this._getConsentData(),this._checkMimeTypes()}var t,i,n;return t=e,(i=[{key:"_init",value:function(){this.dynamicNoaopMaxValue=this.store.get("dnapmxvl"),this.playerVersion=this.store.get("player_version"),this.timezoneOffset=-1*(new Date).getTimezoneOffset(),this.waterfallVersion=this.store.get("wfv"),this.isAmp=this.store.get("isAmp")?"1":"0",this.encodeWaterfallResponse=this.store.get("encwfrs")?1:void 0}},{key:"_setBaseUrl",value:function(){var e,t=this.store.get("wf_base_path")||this.creatives.CM_DOMAIN,i=this.store.get("wf_path")||this.creatives.SERVICE;this.baseUrl="".concat(("string"!=typeof(e=t)||0!==(e=e.replace(/^(http[s]?:|ftp:)/g,"")).indexOf("//")&&(e="//"+e),e)).concat(/.*\/$/g.test(t)?"":"/").concat(i)}},{key:"_getConsentData",value:function(){this.updateCMPData=this.store.get("updtcmpbfrwf"),this.updateCMPData&&this._initConsentData()}},{key:"_initConsentData",value:function(){this.rboxConsentData=window.TRC&&window.TRC.consentData?window.TRC.consentData:{},this.consentData={cdb:this.store.get("cdb")||this.rboxConsentData.consentDaisyBit,gdprApplies:this.store.get("gdprApplies")||this.rboxConsentData.gdprApplies}}},{key:"_checkMimeTypes",value:function(){var e=document.createElement("video");this.supportedMimeTypes=[],this.supportedMimeTypes.push(5);for(var t=0;t<d.length;t++){var i=d[t];i.video&&e.canPlayType(i.mime)&&this.supportedMimeTypes.push(i.id)}e=void 0,this.supportedMimeTypes=this.supportedMimeTypes.join(",")}},{key:"generateUrl",value:function(e){var t="".concat(this.baseUrl,"?").concat(this._setWfUrlQuerystring(e));return window.lastWfUrl=t}},{key:"_setServiceName",value:function(){return this.store.get("wf_path")||this.creatives.SERVICE}},{key:"_setWfUrlQuerystring",value:function(e){if(!e.roll)return"";this._updateConsentData();var t=r(this._buildParamsForQuerystring(e),this._buildOptionalParamsForQuerystring(),this._buildGDPRParamsForQuerystring(e));t=this._appendUnitParams(t,e);var i,s=(i=t,Object.keys(i).map(function(e){return"".concat(e,"=").concat(i[e])}));return(s=this._appendWfExtraParams(s)).join("&")}},{key:"_updateConsentData",value:function(){var e=this;this.updateCMPData&&void 0!==window.__cmp&&window.__cmp("getConsentData",null,function(t){e.consentData.cdbUpdated=e.consentData.cdb!==t.consentData,e.consentData.cdb=t.consentData,e.consentData.gdprApplies=t.gdprApplies})}},{key:"_buildParamsForQuerystring",value:function(e){return{oid:this.creatives.OID,width:this.creatives.PLAYER_WIDTH||this.creatives["PLAYER-WIDTH"],height:this.creatives.PLAYER_HEIGHT||this.creatives["PLAYER-HEIGHT"],pubid:e.pubid||this.creatives.PUBID,tagid:e.tagid||this.creatives.TAGID,crid:this.store.get("creativeId")||"",noaop:this._decideNoaop(e.isFirstRun,this.creatives.NOAOP),sortOrderType:this.creatives.SORTORDERTYPE,cb:(new Date).getTime(),mimes:this.supportedMimeTypes,isvideo:this.creatives.ISVIDEO,plmd:this.creatives.PLMD,mindur:this.creatives.MINDUR,maxdur:this.creatives.MAXDUR,minbr:this.creatives.MINBR,maxbr:this.creatives.MAXBR,st:(t=e.roll.roll_type,(n={"pre-roll":i=0,preroll:0,"mid-roll":-1,midroll:-1,"post-roll":-2,postroll:-2}).hasOwnProperty(t)&&(i=n[t]),i),seq:window._cm_wfCounter,pv:this.playerVersion||999,pt:s(this.store.get("ab_test")||999),tz:this.timezoneOffset,viewable:!document.hidden,ddast:this.store.get("auc_dast"),proto:"2,3,5,6",encoded:1,pstn:this.store.get("pstn")||1,callback:"",wfv:this.waterfallVersion,amp:this.isAmp,qsz:this.store.get("queue_size")||10,ft:this.store.get("frameType"),pb:"yes"===this.store.get("isPrivateBrowsing")?"1":"0",pagg:this.store.get("preset.level")||1};var t,i,n}},{key:"_decideNoaop",value:function(e,t){var i;if(e)i=this.store.get("firstWaterfallNoaop");else if(0<this.dynamicNoaopMaxValue){var s=this.store.get("max_ready_vpaid")||0,n=this.store.get("vpaidReadyCount")||0;i=Math.min(this.dynamicNoaopMaxValue,s-n)}else i=t;return i||t}},{key:"_buildOptionalParamsForQuerystring",value:function(){var e=this.store.get("mprdct"),t=this.store.get("subUnitType"),i={dtagid:this.store.get("dtagid")||void 0,dpubid:this.store.get("dpubid")||void 0,abtst:this.store.get("ab_test")||void 0,mPre:void 0!==e?e:void 0,fmli:this.store.get("fmli")||void 0,fmpw:this.store.get("fmpw")||void 0,cirf:this.creatives.CIRF?encodeURIComponent(decodeURIComponent(this.creatives.CIRF)):void 0,en:this.encodeWaterfallResponse,subu:"undefiend"!=typeof t?t:void 0};return JSON.parse(JSON.stringify(i))}},{key:"_buildGDPRParamsForQuerystring",value:function(){return{cdb:(this.updateCMPData?this.consentData.cdb:this.store.get("cdb"))||"",gdprApplies:(this.updateCMPData?this.consentData.gdprApplies:this.store.get("gdprApplies"))||!1}}},{key:"_appendUnitParams",value:function(e,t){return 0<Object.keys(t.unitWfParams).length?r(e,t.unitWfParams):e}},{key:"_appendWfExtraParams",value:function(e){var t=this.store.get("wf_xrta");return t&&e.push(t),e}},{key:"generatePOSTParams",value:function(e){return r(this._buildParamsForPOSTData(e),this._buildOptionalParamsForPOSTData())}},{key:"_buildParamsForPOSTData",value:function(e){var t=this.store.get("navigatorConnection")||{};return{fv:this._buildLineItemsDataForPOSTData(),wfv:this.waterfallVersion,adv:this.store.getWfData(),cdl:t.downlink||0,cet:t.effectiveTypeId||0,ct:t.typeId||0,crt:t.rtt||0,csd:!0===t.saveData?1:0,q:e.queueStatus?e.queueStatus.items:[],qs:e.queueStatus?e.queueStatus.size:0,pq:e.queueStatus?e.queueStatus.prevItems:[],drp:btoa(JSON.stringify(e.droppedAdTypes))}}},{key:"_buildLineItemsDataForPOSTData",value:function(){var e=this,t=this.store.get("lineItems")||[];return 0===t.length?[]:t.map(function(t){var i=e.store.get(t);return{li:t,f:i.fails,fr:i.failsRow,c:i.conversions,t:i.tries}})}},{key:"_buildOptionalParamsForPOSTData",value:function(){var e=this.store.get("subUnitType"),t=this.store.get("EP_PLAYER"),i=this.store.get("sessionData"),s={sd:i&&"undefined"!==i?i:void 0,en:this.encodeWaterfallResponse,subu:void 0!==e?e:void 0,ls:!this.sentCookiesData&&t?t:void 0};return this.sentCookiesData||(this.sentCookiesData=!0),JSON.parse(JSON.stringify(s))}},{key:"send",value:function(e){this.XHR.send(e)}},{key:"getWfCounter",value:function(){return window._cm_wfCounter}},{key:"increaseWfCounter",value:function(){window._cm_wfCounter++}},{key:"getConsentData",value:function(){return this.consentData}},{key:"getRboxConsentData",value:function(){return this.rboxConsentData}}])&&a(t.prototype,i),n&&a(t,n),e}();try{if(window.cmTag){var u=window.cmTag.config.ms||{};u["wf-generator"]=u["wf-generator"]||{},u["wf-generator"]["1.0.6"]=l,window.cmTag.set("ms",u)}}catch(e){}try{window.TRC=window.TRC||{},window.TRC["wf-generator"]=window.TRC["wf-generator"]||{},window.TRC["wf-generator"]["1.0.6"]=l}catch(e){}}])}]);