var checker = false,
    images,
    loadedImage = 0,
    limit = 1,
    isFallback = false,
    imageError = 0,
    countError = 0;

var carouselIndex = 0;
var frameCount = 0; //frameCount of images
var currTransl = []
var translationComplete = true;

var promoWidthArray = []; // 08.27.2019 Start ~ End

var transitionCompleted = function() {
    translationComplete = true;
}

var startTime;
var feedLENGTH;
var autoCar, ctr;
var f2_hex_VAR;
//Check the status of the richload
var checkRL = function() {
    if (myFT.richloadsLoaded) {
        clearInterval(startTime);
        instantInit(); //once the rl was loaded call the instantInit
    }
}

//Check the status of the instant ads
var checkIA = function() {
    if (myFT.instantAdsLoaded && myFT.richloadsLoaded) {
        clearInterval(startTime);
        feedInitialize(); // once both the IA and RL were initialize, call the feedInitialize
    }
}

//initialy load the rl
function ftInit() {
    myFT.on("richload", function(e) {
        startTime = setInterval(checkRL, 500);
    });
}

//this will load the instantads
function instantInit() {
    myFT.on("instantads", function(e) {
        startTime = setInterval(checkIA, 500);
    });
}

//this will process the feedEndpoint
function feedInitialize() {
    var feedParams = new FTFeedParams();
    feedParams.segmentId = myFT.instantAds.F2_segmentId; //not sure why? if remove error occur
    feedParams.feedEndpoint = myFT.instantAds.F2_feedEndpoint;
    feedParams.defaultFeedEndpoint = myFT.instantAds.F2_defaultFeedEndpoint;
    //set feed and backup
    var ftFeed = new FTFeed(myFT, feedParams);
    ftFeed.getFeed(feedLoaded, defaultError);
}

//feed storage
function feedLoaded(feedItems, feedUrl) {
    //try catch for error handling
    try {
    if (feedItems.length == 2) {
        console.log(feedItems);
        console.log("two items");
        feedItems = feedItems.concat(feedItems)
        feedLENGTH = feedItems.length-2;
         if (!isFallback) {
            var productArray = [];
            //iterate all items within limit
            for (var i = 0; i < feedItems.length; i++) {

                if (myFT.instantAds.F2_feed_image_node == "image_urlfrontpng" || myFT.instantAds.F2_feed_image_node == "image_urlleftpng" || myFT.instantAds.F2_feed_image_node == "image_urlrightpng" || myFT.instantAds.F2_feed_image_node == "image_url") {

                    if (myFT.instantAds.layout_name == "microsoft") {
                         // 08.27.2019 Start ~ End
                        createCarousel(feedItems.length, i, feedItems[i].display_name, feedItems[i].powerfeeds_id, feedItems[i].pc_processor_short, feedItems[i][myFT.instantAds.F2_feed_image_node], feedItems[i].regular_price, feedItems[i].sale_price, feedItems[i].isintel, feedItems[i].badge_image, feedItems[i].buy_url, feedItems[i].promo_msg_1);
                    } else {
                         // 08.27.2019 Start ~ End
                        createCarousel(feedItems.length, i, feedItems[i].display_name, feedItems[i].powerfeeds_id, feedItems[i].pc_processor_short, feedItems[i][myFT.instantAds.F2_feed_image_node], feedItems[i].regular_price, feedItems[i].sale_price, feedItems[i].isintel, feedItems[i].badge_image, feedItems[i].buy_url, feedItems[i].promo_msg_1);
                    }


                    productArray.push(feedItems[i].powerfeeds_id + "|" + feedItems[i].subcategory + "|" + feedItems[i].regular_price + "|" + feedItems[i].sale_price);

                } else {
                    defaultError();
                }
            }
            if (myFT.instantAds.main_logo.indexOf('.svg') >= 0) {
                f1_main_logo.classList.add("svg")
            }

            if (myFT.instantAds.F1_partner_logo.indexOf('.svg') >= 0) {
                f1_partner_logo.classList.add("svg")
            }
             productArray.pop();
             productArray.pop();
            console.log(productArray);
            Tracker.impressionTrackEvent(productArray);
            preload();

        } else {
            feedLoadError();
        }
    } else if (feedItems.length == 1) {
        console.log(feedItems);
        console.log("one item");
        rightbtn.style.opacity = 0;
        leftbtn.style.opacity = 0;
        rightbtn.style.pointerEvents = "none";
        leftbtn.style.pointerEvents = "none";
        feedLENGTH = 1;
         if (!isFallback) {
            var productArray = [];
            //iterate all items within limit
            for (var i = 0; i < feedItems.length; i++) {
                if (myFT.instantAds.F2_feed_image_node == "image_urlfrontpng" || myFT.instantAds.F2_feed_image_node == "image_urlleftpng" || myFT.instantAds.F2_feed_image_node == "image_urlrightpng" || myFT.instantAds.F2_feed_image_node == "image_url") {

                    if (myFT.instantAds.layout_name == "microsoft") {
                        // 08.27.2019 Start ~ End
                        createCarousel(feedItems.length, i, feedItems[i].display_name, feedItems[i].powerfeeds_id, feedItems[i].pc_processor_short, feedItems[i][myFT.instantAds.F2_feed_image_node], feedItems[i].regular_price, feedItems[i].sale_price, feedItems[i].isintel, feedItems[i].badge_image, feedItems[i].buy_url, feedItems[i].promo_msg_1);
                    } else {
                        // 08.27.2019 Start ~ End
                        createCarousel(feedItems.length, i, feedItems[i].display_name, feedItems[i].powerfeeds_id, feedItems[i].pc_processor_short, feedItems[i][myFT.instantAds.F2_feed_image_node], feedItems[i].regular_price, feedItems[i].sale_price, feedItems[i].isintel, feedItems[i].badge_image, feedItems[i].buy_url, feedItems[i].promo_msg_1);
                    }

                    productArray.push(feedItems[i].powerfeeds_id + "|" + feedItems[i].subcategory + "|" + feedItems[i].regular_price + "|" + feedItems[i].sale_price);

                } else {
                    defaultError();
                }
            }
            if (myFT.instantAds.main_logo.indexOf('.svg') >= 0) {
                f1_main_logo.classList.add("svg")
            }

            if (myFT.instantAds.F1_partner_logo.indexOf('.svg') >= 0) {
                f1_partner_logo.classList.add("svg")
            }
            console.log(productArray);
            Tracker.impressionTrackEvent(productArray);
            preload();
             carousel_frame0.style.left = "298px";
             carousel_frame0.style.opacity = "1 !important";
        } else {
            feedLoadError();
        }
    } else {
        console.log(feedItems);
        feedLENGTH = feedItems.length;
        if (!isFallback) {
            var productArray = [];
            //iterate all items within limit
            for (var i = 0; i < feedItems.length; i++) {
                if (myFT.instantAds.F2_feed_image_node == "image_urlfrontpng" || myFT.instantAds.F2_feed_image_node == "image_urlleftpng" || myFT.instantAds.F2_feed_image_node == "image_urlrightpng" || myFT.instantAds.F2_feed_image_node == "image_url") {

                    if (myFT.instantAds.layout_name == "microsoft") {
                         // 08.27.2019 Start ~ End
                        createCarousel(feedItems.length, i, feedItems[i].display_name, feedItems[i].powerfeeds_id, feedItems[i].pc_processor_short, feedItems[i][myFT.instantAds.F2_feed_image_node], feedItems[i].regular_price, feedItems[i].sale_price, feedItems[i].isintel, feedItems[i].badge_image, feedItems[i].buy_url, feedItems[i].promo_msg_1);
                    } else {
                         // 08.27.2019 Start ~ End
                        createCarousel(feedItems.length, i, feedItems[i].display_name, feedItems[i].powerfeeds_id, feedItems[i].pc_processor_short, feedItems[i][myFT.instantAds.F2_feed_image_node], feedItems[i].regular_price, feedItems[i].sale_price, feedItems[i].isintel, feedItems[i].badge_image, feedItems[i].buy_url, feedItems[i].promo_msg_1);
                    }


                    productArray.push(feedItems[i].powerfeeds_id + "|" + feedItems[i].subcategory + "|" + feedItems[i].regular_price + "|" + feedItems[i].sale_price);

                } else {
                    defaultError();
                }
            }
            if (myFT.instantAds.main_logo.indexOf('.svg') >= 0) {
                f1_main_logo.classList.add("svg")
            }

            if (myFT.instantAds.F1_partner_logo.indexOf('.svg') >= 0) {
                f1_partner_logo.classList.add("svg")
            }
            console.log(productArray);
            Tracker.impressionTrackEvent(productArray);
            preload();

        } else {
            feedLoadError();
        }
    }

    } catch (err) {
        feedLoadError();
        console.error("%cError: " + err.message + " on function feedLoaded", 'color: #9C4A46');
    }
}
var runArrow = false;
function createCarousel(itemLength, id, productName, skuTxt, procName, imageNode, regPrice, salePrice, isIntel, badgeImage, buyURL, promo_msg_1) { // 08.27.2019 Start ~ End
    try {
        if (((imageNode.match(/https:\/\//g) || []).length) > 1) {
            imageNode = "https://" + imageNode.split("https://")[1];
        }

        var f2_main_logo_style;
        var f2_partner_logo_style;
        var product_name_style;
        var price_prefix_style;
        var sale_price_style;
        var regular_price_styl;
        var processor_name_style;
        var sku_style;
        var f2_cta_txt_style;
        var f2_cta_button_style;
        var carousel_cont = document.getElementById('carousel_cont');
        var sku_salePrice_promo_toggle = myFT.instantAds.F2_showSKU_showStrikethroughPrice_showProcessor_promoToggle.split("|");
        var carouselBadge = myFT.instantAds.F2_carousel_xy_badge_xy.split("|");
        var carousel_XY = carouselBadge[0].split(",");
        var carousel_frame = document.createElement("div");
        carousel_cont.style.width = (itemLength * 298) + "px";
        carousel_frame.setAttribute("id", "carousel_frame" + id);
        carousel_frame.setAttribute("class", "carousel_frame animate");
        carousel_cont.appendChild(carousel_frame);
        var carousel_frames = document.getElementById("carousel_frame" + id);

        if (!runArrow) {
            runArrow = true;
            Helpers.XYLogic(carousel_XY[0], carousel_XY[1], carousel_cont);
            console.log(carousel_cont.offsetLeft)
            console.log(carousel_cont.offsetTop)
            arrowCont.style.left = carousel_cont.offsetLeft + "px";
            arrowCont.style.top = carousel_cont.offsetTop + "px";
        }

        // 07.29.2019 Start
        var promo_txt_style = myFT.instantAds.F2_promo_txt_size_hex_weight_align_xy.split("|");
        var promo_txt_bg = myFT.instantAds.F2_promo_bckgrdHex_bckgrdWidth.split("|");
        var promo_txt_XY = promo_txt_style[4].split(",");
        var promo_txt = document.createElement("div");
        promo_txt.setAttribute("id", "promo_txt" + id);
        promo_txt.setAttribute("class", "promo_txt");
        carousel_frames.appendChild(promo_txt);
        document.getElementById("promo_txt" + id).innerHTML = myFT.instantAds.F2_promo_txt;
        promo_txt.style.fontSize = promo_txt_style[0] + "px";
        promo_txt.style.color = promo_txt_style[1];
        promo_txt.style.fontWeight = promo_txt_style[2];
        promo_txt.style.textAlign = promo_txt_style[3];
        promo_txt.style.width = promo_txt_bg[1] + "px";
        if (promo_txt_style[3] == "left") {
            promo_txt.style.paddingLeft = "20px";
            promo_txt.style.width = (promo_txt_bg[1] - 20) + "px";
        }
        if (promo_txt_style[3] == "right") {
            promo_txt.style.paddingRight = "20px";
            promo_txt.style.width = (promo_txt_bg[1] - 20) + "px";
        }
        promo_txt.style.backgroundColor = promo_txt_bg[0];
        var promo_txt_XY = myFT.instantAds.F2_promo_txt_size_hex_weight_align_xy.split('|')[4].split(',');
        Helpers.XYLogic(promo_txt_XY[0], promo_txt_XY[1], promo_txt);
        // 07.29.2019 End

        //        Helpers.resizeTextPromo("promo_txt",'3px');

        switch (myFT.instantAds.layout_name) {
            case "intel":
                console.log("intel")
                //                myFT.instantAds.F2_footer_txt = "";
                //                F2_mainLogo_hex_width_xy
                var f2_main_logo_style_VAR = "#FFFFFF|52|247,195";
                //                F2_partnerLogo_hex_width_xy
                var f2_partner_logo_style_VAR = "#FFFFFF|40|0,0";
                //                F2_product_txt_hex_size_align_xy
                var product_name_style_VAR = "#000000|16.5|400|left|0,0";
                //                F2_pricePrefix_size_hex_xy
                var price_prefix_style_VAR = "14|#000000|400|0,0";
                //                F2_salePrice_size_hex_xy
                var sale_price_style_VAR = "14|#000000|0,0";
                //                F2_regPrice_size_hex_xy
                var regular_price_style_VAR = "14|#2189ca|400|0,0";
                //                F2_processor_size_hex_xy
                var processor_name_style_VAR = "12|#000000|400|0,0";
                //                F2_SKU_size_hex_xy
                var sku_style_VAR = "8|#000000|400|0,0";
                //                F2_ctaTxt_hex_hexHov_size_align
                var f2_cta_txt_style_VAR = "#000000|#000000|12|left";
                //                F2_ctaBtn_borderHex_borderHexHov_bkgdHex_bkgdHexHov_xy
                var f2_cta_button_style_VAR = "#000000|#000000|transparent|transparent|0,0";
                //                F2_backgroundHex_borderHex_arrowsHex
                f2_hex_VAR = "#248fc3|#000000|#000000";
                break;
            case "microsoft":
                isIntel == 0
                console.log("microsoft");
                //                sku_salePrice_promo_toggle[0] = "false";
                //                F2_mainLogo_hex_width_xy
                var f2_main_logo_style_VAR = "#FFFFFF|35|0,0";
                //                F2_partnerLogo_hex_width_xy
                var f2_partner_logo_style_VAR = "#FFFFFF|29|0,0";
                //                F2_product_txt_hex_size_align_xy
                var product_name_style_VAR = "#000000|16.5|400|left|0,0";
                //                F2_pricePrefix_size_hex_xy
                var price_prefix_style_VAR = "14|#000000|400|0,0";
                //                F2_salePrice_size_hex_xy
                var sale_price_style_VAR = "14|#000000|0,0";
                //                F2_regPrice_size_hex_xy
                var regular_price_style_VAR = "14|#2189ca|400|0,0";
                //                F2_processor_size_hex_xy
                var processor_name_style_VAR = "12|#000000|400|0,0";
                //                F2_SKU_size_hex_xy
                var sku_style_VAR = "8|#000000|400|0,0";
                //                F2_ctaTxt_hex_hexHov_size_align
                var f2_cta_txt_style_VAR = "#000000|#000000|12|left";
                //                F2_ctaBtn_borderHex_borderHexHov_bkgdHex_bkgdHexHov_xy
                var f2_cta_button_style_VAR = "#000000|#000000|transparent|transparent|0,0";
                //                F2_backgroundHex_borderHex_arrowsHex
                f2_hex_VAR = "#248fc3|#000000|#000000";

                promo_txt.style.backgroundColor = promo_txt_bg[0];
                promo_txt.style.width = 298 + "px";

                break;
            case "supplies":
                console.log("supplies");
                //                myFT.instantAds.F2_footer_txt = "";
                //                sku_salePrice_promo_toggle[0] = "false";
                //                F2_mainLogo_hex_width_xy
                var f2_main_logo_style_VAR = "#248fc3|52|247,195";
                //                F2_partnerLogo_hex_width_xy
                var f2_partner_logo_style_VAR = "#FFFFFF|40|0,0";
                //                F2_product_txt_hex_size_align_xy
                var product_name_style_VAR = "#000000|16.5|400|left|0,0";
                //                F2_pricePrefix_size_hex_xy
                var price_prefix_style_VAR = "14|#000000|400|0,0";
                //                F2_salePrice_size_hex_xy
                var sale_price_style_VAR = "14|#000000|0,0";
                //                F2_regPrice_size_hex_xy
                var regular_price_style_VAR = "14|#2189ca|400|0,0";
                //                F2_processor_size_hex_xy
                var processor_name_style_VAR = "12|#000000|400|0,0";
                //                F2_SKU_size_hex_xy
                var sku_style_VAR = "8|#000000|400|0,0";
                //                F2_ctaTxt_hex_hexHov_size_align
                var f2_cta_txt_style_VAR = "#248ec1|#248ec1|12|left";
                //                F2_ctaBtn_borderHex_borderHexHov_bkgdHex_bkgdHexHov_xy
                var f2_cta_button_style_VAR = "#248ec1|#248ec1|transparent|transparent|0,0";
                //                F2_backgroundHex_borderHex_arrowsHex
                f2_hex_VAR = "#FFFFFF|#000000|#000000";
                break;
            case "omen":
                console.log("omen");
                //                myFT.instantAds.F2_footer_txt = "";
                //                sku_salePrice_promo_toggle[0] = "false";
                //                F2_mainLogo_hex_width_xy
                var f2_main_logo_style_VAR = "#FFFFFF|35|0,0";
                //                F2_partnerLogo_hex_width_xy
                var f2_partner_logo_style_VAR = "#FFFFFF|29|0,0";
                //                F2_product_txt_hex_size_align_xy
                var product_name_style_VAR = "#FFFFFF|16.5|400|left|0,0";
                //                F2_pricePrefix_size_hex_xy
                var price_prefix_style_VAR = "14|#FFFFFF|400|0,0";
                //                F2_salePrice_size_hex_xy
                var sale_price_style_VAR = "14|#FFFFFF|0,0";
                //                F2_regPrice_size_hex_xy
                var regular_price_style_VAR = "14|#c4141e|400|0,0";
                //                F2_processor_size_hex_xy
                var processor_name_style_VAR = "12|#FFFFFF|400|0,0";
                //                F2_SKU_size_hex_xy
                var sku_style_VAR = "8|#FFFFFF|400|0,0";
                //                F2_ctaTxt_hex_hexHov_size_align
                var f2_cta_txt_style_VAR = "#FFFFFF|#FFFFFF|12|left";
                //                F2_ctaBtn_borderHex_borderHexHov_bkgdHex_bkgdHexHov_xy
                var f2_cta_button_style_VAR = "#FFFFFF|#FFFFFF|transparent|transparent|0,0";
                //                F2_backgroundHex_borderHex_arrowsHex
                f2_hex_VAR = "#FFFFFF|#000000|#FFFFFF";
                break;
            case "premium":
                console.log("premium");
                //                myFT.instantAds.F2_footer_txt = "";
                //                sku_salePrice_promo_toggle[0] = "false";
                //                F2_mainLogo_hex_width_xy
                var f2_main_logo_style_VAR = "#FFFFFF|52|247,195";
                //                F2_partnerLogo_hex_width_xy
                var f2_partner_logo_style_VAR = "#FFFFFF|40|0,0";
                //                F2_product_txt_hex_size_align_xy
                var product_name_style_VAR = "#c69237|16.5|400|left|0,0";
                //                F2_pricePrefix_size_hex_xy
                var price_prefix_style_VAR = "14|#FFFFFF|400|0,0";
                //                F2_salePrice_size_hex_xy
                var sale_price_style_VAR = "14|#FFFFFF|0,0";
                //                F2_regPrice_size_hex_xy
                var regular_price_style_VAR = "14|#c69237|400|0,0";
                //                F2_processor_size_hex_xy
                var processor_name_style_VAR = "12|#FFFFFF|400|0,0";
                //                F2_SKU_size_hex_xy
                var sku_style_VAR = "8|#FFFFFF|400|0,0";
                //                F2_ctaTxt_hex_hexHov_size_align
                var f2_cta_txt_style_VAR = "#c69237|#c69237|12|left";
                //                F2_ctaBtn_borderHex_borderHexHov_bkgdHex_bkgdHexHov_xy
                var f2_cta_button_style_VAR = "#c69237|#c69237|transparent|transparent|0,0";
                //                F2_backgroundHex_borderHex_arrowsHex
                f2_hex_VAR = "#000000|#000000|#FFFFFF";
                break;
            case "z":
                console.log("z");
                //                myFT.instantAds.F2_footer_txt = "";
                //                sku_salePrice_promo_toggle[0] = "false";
                //                F2_mainLogo_hex_width_xy
                var f2_main_logo_style_VAR = "#FFFFFF|35|0,0";
                //                F2_partnerLogo_hex_width_xy
                var f2_partner_logo_style_VAR = "#FFFFFF|29|0,0";
                //                F2_product_txt_hex_size_align_xy
                var product_name_style_VAR = "#FFFFFF|16.5|400|left|0,0";
                //                F2_pricePrefix_size_hex_xy
                var price_prefix_style_VAR = "14|#FFFFFF|400|0,0";
                //                F2_salePrice_size_hex_xy
                var sale_price_style_VAR = "14|#FFFFFF|0,0";
                //                F2_regPrice_size_hex_xy
                var regular_price_style_VAR = "14|#FFFFFF|400|0,0";
                //                F2_processor_size_hex_xy
                var processor_name_style_VAR = "12|#FFFFFF|400|0,0";
                //                F2_SKU_size_hex_xy
                var sku_style_VAR = "8|#FFFFFF|400|0,0";
                //                F2_ctaTxt_hex_hexHov_size_align
                var f2_cta_txt_style_VAR = "#FFFFFF|#FFFFFF|12|left";
                //                F2_ctaBtn_borderHex_borderHexHov_bkgdHex_bkgdHexHov_xy
                var f2_cta_button_style_VAR = "#FFFFFF|#FFFFFF|transparent|transparent|0,0";
                //                F2_backgroundHex_borderHex_arrowsHex
                f2_hex_VAR = "#FFFFFF|#000000|#FFFFFF";
                break;
            default:
                defaultError();
        }

        //PRODUCT NAME
        if (myFT.instantAds.F2_product_txt_hex_size_weight_align_xy != "") {
            product_name_style = myFT.instantAds.F2_product_txt_hex_size_weight_align_xy.split("|");
        } else {
            product_name_style = product_name_style_VAR.split("|");
        }
        var product_name_XY = product_name_style[4].split(",");
        var product_name = document.createElement("div");
        product_name.setAttribute("id", "product_name" + id);
        product_name.setAttribute("class", "product_name");
        carousel_frames.appendChild(product_name);
        document.getElementById("product_name" + id).innerHTML = productName;
        product_name.style.color = product_name_style[0];
        product_name.style.fontSize = product_name_style[1] + "px";
        product_name.style.fontWeight = product_name_style[2];
        product_name.style.textAlign = product_name_style[3];
        var prodN = document.getElementById("product_name" + id);
        Helpers.XYLogic(product_name_XY[0], product_name_XY[1], prodN);
        Helpers.resizeText("product_name" + id, '3px');

        if (sku_salePrice_promo_toggle[2].toLowerCase() == "true") {
            //PROCESSOR NAME
            if (myFT.instantAds.layout_name == "supplies") {
                // 07.29.2019 Start same block of code as below
                if (myFT.instantAds.F2_processor_size_hex_weight_xy != "") {
                    processor_name_style = myFT.instantAds.F2_processor_size_hex_weight_xy.split('|');
                } else {
                    processor_name_style = processor_name_style_VAR.split('|');
                }
                var processor_name_XY = processor_name_style[3].split(',');
                var processor_name = document.createElement("div");
                processor_name.setAttribute("id", "processor_name" + id);
                processor_name.setAttribute("class", "processor_name");
                carousel_frames.appendChild(processor_name);
            if (procName.toLowerCase() !== "n/a") {
                document.getElementById("processor_name" + id).innerHTML = "with " + procName;
            }
                processor_name.style.fontSize = processor_name_style[0] + "px";
                processor_name.style.color = processor_name_style[1];
                processor_name.style.fontWeight = processor_name_style[2];
                var procN = document.getElementById("processor_name" + id);
                Helpers.XYLogic(processor_name_XY[0], processor_name_XY[1], procN);
                // 07.29.2019 End

            } else {
                if (myFT.instantAds.F2_processor_size_hex_weight_xy != "") {
                    processor_name_style = myFT.instantAds.F2_processor_size_hex_weight_xy.split('|');
                } else {
                    processor_name_style = processor_name_style_VAR.split('|');
                }
                var processor_name_XY = processor_name_style[3].split(',');
                var processor_name = document.createElement("div");
                processor_name.setAttribute("id", "processor_name" + id);
                processor_name.setAttribute("class", "processor_name");
                carousel_frames.appendChild(processor_name);
            if (procName.toLowerCase() !== "n/a") {
                document.getElementById("processor_name" + id).innerHTML = "with " + procName;
            }
                processor_name.style.fontSize = processor_name_style[0] + "px";
                processor_name.style.color = processor_name_style[1];
                processor_name.style.fontWeight = processor_name_style[2];
                var procN = document.getElementById("processor_name" + id);
                Helpers.XYLogic(processor_name_XY[0], processor_name_XY[1], procN);
            }

        } else if (sku_salePrice_promo_toggle[2].toLowerCase() == "false") {

        } else {
            defaultError();
        }

        //PRODUCT SHADOW
        var product_shadow_style = myFT.instantAds.F2_product_dropShadow_hex_opacity_hw_xy.split('|');
        var product_shadow_HW = product_shadow_style[2].split(',');
        var product_shadow_XY = product_shadow_style[3].split(',');
        var product_shadow_cont = document.createElement("div");
        var product_shadow = document.createElement("div");
        product_shadow_cont.setAttribute("class", "product_shadow_cont");
        product_shadow.setAttribute("id", "product_shadow" + id);
        product_shadow.setAttribute("class", "product_shadow");
        product_shadow_cont.appendChild(product_shadow);
        carousel_frames.appendChild(product_shadow_cont);
        document.getElementById("product_shadow" + id).style.height = product_shadow_HW[0] + "px";
        document.getElementById("product_shadow" + id).style.width = product_shadow_HW[1] + "px";
        var shadowBG = 'radial-gradient(ellipse at center,' + hexToRGB(product_shadow_style[0], product_shadow_style[1]) + '0%, rgba(255,255,255,0) 50%, rgba(255,255,255,0) 100%)';
        document.getElementById("product_shadow" + id).style.background = shadowBG;
        var procS = document.getElementsByClassName("product_shadow_cont");
        Helpers.XYLogic(product_shadow_XY[0], product_shadow_XY[1], procS[id]);

        function hexToRGB(hex, alpha) {
            hex = hex.replace('#', '');
            var r = parseInt(hex.length == 3 ? hex.slice(0, 1).repeat(2) : hex.slice(0, 2), 16);
            var g = parseInt(hex.length == 3 ? hex.slice(1, 2).repeat(2) : hex.slice(2, 4), 16);
            var b = parseInt(hex.length == 3 ? hex.slice(2, 3).repeat(2) : hex.slice(4, 6), 16);
            if (alpha) {
                return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + alpha + ')';
            } else {
                return 'rgb(' + r + ', ' + g + ', ' + b + ')';
            }
        }

        //PRODUCT IMAGE CONT
        var product_image_cont_style = myFT.instantAds.F2_productImg_width_productImg_xy.split("|");
        var product_image_cont_XY = product_image_cont_style[1].split(",");
        var product_image_cont = document.createElement("div");
        product_image_cont.setAttribute("id", "product_image_cont" + id);
        product_image_cont.setAttribute("class", "product_image_cont");
        carousel_frames.appendChild(product_image_cont);
        product_image_cont.style.width = product_image_cont_style[0] + "px";
        var prodI = document.getElementById("product_image_cont" + id);
        Helpers.XYLogic(product_image_cont_XY[0], product_image_cont_XY[1], prodI);

        //PRODUCT IMAGE
        var product_image = document.createElement("img");
        product_image.setAttribute("id", "product_image" + id);
        product_image.setAttribute("class", "product_image");
        document.getElementById("product_image_cont" + id).appendChild(product_image);
        document.getElementById("product_image" + id).setAttribute("src", imageNode);
        if (product_image_cont_XY[0] == 0 && product_image_cont_XY[1] == 0) {

        } else {
            //            product_image.style.left = product_image_cont_XY[0] + "px";
            //            product_image.style.top = product_image_cont_XY[1] + "px";
            //            product_image.style.position = "absolute";
            product_image.style.width = product_image_cont_style[0] + "px";
        }

        //SKU
        if (sku_salePrice_promo_toggle[0].toLowerCase() == "true") {
            product_image.style.width = "90%";
            if (myFT.instantAds.F2_SKU_size_hex_weight_xy != "") {
                sku_style = myFT.instantAds.F2_SKU_size_hex_weight_xy.split('|');
            } else {
                sku_style = sku_style_VAR.split('|');
            }
            var sku_XY = sku_style[3].split(',');
            var sku = document.createElement("div");
            sku.setAttribute("id", "sku" + id);
            sku.setAttribute("class", "sku");
            document.getElementById("product_image_cont" + id).appendChild(sku);
            document.getElementById("sku" + id).innerHTML = "#" + skuTxt;
            sku.style.fontSize = sku_style[0] + "px";
            sku.style.color = sku_style[1];
            sku.style.fontWeight = sku_style[2];
            var skuN = document.getElementById("sku" + id);
            Helpers.XYLogic(sku_XY[0], sku_XY[1], skuN);

        } else if (sku_salePrice_promo_toggle[0].toLowerCase() == "false") {

        } else {
            defaultError();
        }

        //FOOTER
        if (myFT.instantAds.F2_footer_txt != "" && sku_salePrice_promo_toggle[0].toLowerCase() == "true") {
            product_image.style.width = "70%";
            var footer_text_style = myFT.instantAds.F2_footer_txt_size_hex_weight_align_xy.split('|');
            var footer_text_XY = footer_text_style[4].split(',');
            var footer_text = document.createElement("div");
            footer_text.setAttribute("id", "footer_text" + id);
            footer_text.setAttribute("class", "footer_text");
            document.getElementById("product_image_cont" + id).appendChild(footer_text);
            document.getElementById("footer_text" + id).innerHTML = myFT.instantAds.F2_footer_txt;
            footer_text.style.fontSize = footer_text_style[0] + "px";
            footer_text.style.color = footer_text_style[1];
            footer_text.style.fontWeight = footer_text_style[2];
            footer_text.style.textAlign = footer_text_style[3];
            var footT = document.getElementById("footer_text" + id);
            Helpers.XYLogic(footer_text_XY[0], footer_text_XY[1], footT);
            //            footer_text.style.position = "absolute";
            //                sku.style.marginTop = "";


        } else if (myFT.instantAds.F2_footer_txt != "" && sku_salePrice_promo_toggle[0].toLowerCase() == "false") {
            product_image.style.width = "84%";
            var footer_text_style = myFT.instantAds.F2_footer_txt_size_hex_weight_align_xy.split('|');
            var footer_text_XY = footer_text_style[4].split(',');
            var footer_text = document.createElement("div");
            footer_text.setAttribute("id", "footer_text" + id);
            footer_text.setAttribute("class", "footer_text");
            document.getElementById("product_image_cont" + id).appendChild(footer_text);
            document.getElementById("footer_text" + id).innerHTML = myFT.instantAds.F2_footer_txt;
            footer_text.style.fontSize = footer_text_style[0] + "px";
            footer_text.style.color = footer_text_style[1];
            footer_text.style.fontWeight = footer_text_style[2];
            footer_text.style.textAlign = footer_text_style[3];
            var footT = document.getElementById("footer_text" + id);
            Helpers.XYLogic(footer_text_XY[0], footer_text_XY[1], footT);
            //            footer_text.style.position = "absolute";
            //                sku.style.marginTop = "";


        } else {

        }

        //PRICE CONT
        var price_cont = document.createElement("div");
        price_cont.setAttribute("id", "price_cont" + id);
        price_cont.setAttribute("class", "price_cont");
        carousel_frames.appendChild(price_cont);

        //PRICE PREFIX
        if (myFT.instantAds.F2_pricePrefix_size_hex_weight_xy != "") {
            price_prefix_style = myFT.instantAds.F2_pricePrefix_size_hex_weight_xy.split("|");
        } else {
            price_prefix_style = price_prefix_style_VAR.split("|");
        }
        var price_prefix_XY = price_prefix_style[3].split(",");
        var price_prefix = document.createElement("div");
        price_prefix.setAttribute("id", "price_prefix" + id);
        price_prefix.setAttribute("class", "price_prefix");
        price_cont.appendChild(price_prefix);
        document.getElementById("price_prefix" + id).innerHTML = myFT.instantAds.F2_pricePrefix_txt + "&nbsp;";
        price_prefix.style.fontSize = price_prefix_style[0] + "px";
        price_prefix.style.color = price_prefix_style[1];
        price_prefix.style.fontWeight = price_prefix_style[2];
        if (price_prefix_XY[0] == 0 && price_prefix_XY[1] == 0) {

        } else {
            var priP = document.getElementById("price_prefix" + id);
            Helpers.XYLogic(price_prefix_XY[0], price_prefix_XY[1], priP);
            //            price_prefix.style.position = "absolute";
        }

        //07.29.2019 Start

        // 08.27.2019 Start
        setTimeout(function () {
            var promoOffset = sale_price.getBoundingClientRect().width;

            if (sku_salePrice_promo_toggle[1].toLowerCase() == "true" && regPrice != salePrice) {
                //REGULAR PRICE
                if (myFT.instantAds.F2_regPrice_size_hex_weight_xy != "") {
                    regular_price_style = myFT.instantAds.F2_regPrice_size_hex_weight_xy.split("|");
                } else {
                    regular_price_style = regular_price_style_VAR.split("|");
                }
                var regular_price_XY = regular_price_style[3].split(",");
                var regular_price = document.createElement("div");
                regular_price.setAttribute("id", "regular_price" + id);
                regular_price.setAttribute("class", "regular_price");
                price_cont.appendChild(regular_price);
                document.getElementById("regular_price" + id).innerHTML = "$" + regPrice;
                regular_price.style.fontSize = regular_price_style[0] + "px";
                regular_price.style.color = regular_price_style[1];
                regular_price.style.fontWeight = regular_price_style[2];
                if (regular_price_XY[0] == 0 && regular_price_XY[1] == 0) {

                } else {
                    //            regular_price.style.position = "absolute";
                    var regP = document.getElementById("regular_price" + id);
                    Helpers.XYLogic(regular_price_XY[0], regular_price_XY[1], regP);

                }

                promoOffset += regular_price.getBoundingClientRect().width;
            } else if (sku_salePrice_promo_toggle[1].toLowerCase() == "false" && regPrice != salePrice) {
            } else if (sku_salePrice_promo_toggle[1].toLowerCase() == "true" && regPrice == salePrice) {
            } else if (sku_salePrice_promo_toggle[1].toLowerCase() == "false" && regPrice == salePrice) {
            } else {
                defaultError();
            }

            if (sku_salePrice_promo_toggle[1].toLowerCase() == "true" && regPrice != salePrice) {
                regular_price.classList.add("strikeout");
            } else if (sku_salePrice_promo_toggle[1].toLowerCase() == "false" && regPrice != salePrice) {
            } else if (sku_salePrice_promo_toggle[1].toLowerCase() == "true" && regPrice == salePrice) {
            } else if (sku_salePrice_promo_toggle[1].toLowerCase() == "false" && regPrice == salePrice) {
            } else {
                defaultError();
            }

            if (myFT.instantAds.F2_saleSpecial_toggle.toLowerCase() == "true" && (promo_msg_1 != undefined && promo_msg_1 != "" && promo_msg_1 != "n/a")) {
                if (myFT.instantAds.F2_saleSpecial_img.indexOf("blank") < 0) {
                    var offsetX = parseFloat(myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[4].split(",")[0]);
                } else {
                    var offsetX = (parseFloat(myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[4].split(",")[0]) + promoOffset);
                }
                var promo_message_container = document.createElement("div");
                promo_message_container.id = "promo_message_container" + id;
                promo_message_container.className = "promo_message_container";
                promo_message_container.style.cssText = "color: " + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[1] + ";" +
                    "font-weight: " + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[2] + ";" +
                    "font-size: " + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[0] + "px;" +
//                    "left: " + offsetX + "px;" +
//                    "top: " + (parseFloat(myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[4].split(",")[1])) + "px;";

                price_cont.appendChild(promo_message_container);
                var promoCont = document.getElementById("promo_message_container" + id);
                Helpers.XYLogic(myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[4].split(",")[0], myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[4].split(",")[1],promoCont);
                var promo_message = document.createElement("span");
                promo_message.id = "promo_message" + id;
                promo_message.className = "promo_message";
                promo_message.innerHTML = promo_msg_1;
                if(checkPlatform()[1] == "Firefox") {
                    promo_message.style.cssText = "transform: perspective(1px) rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);" +
                                                  "-o-transform: perspective(1px) rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);" +
                                                  "-ms-transform: perspective(1px) rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);" +
                                                  "-moz-transform: perspective(1px) rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);" +
                                                  "-webkit-transform: perspective(1px) rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);";
                } else {
                    promo_message.style.cssText = "transform: rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);" +
                                                  "-o-transform: rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);" +
                                                  "-ms-transform: rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);" +
                                                  "-moz-transform: rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);" +
                                                  "-webkit-transform: rotate(" + myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[3] + "deg);";
                }

                promo_message_container.appendChild(promo_message);

                var promo_specialImage = document.createElement("img");
                promo_specialImage.id = "promo_specialImage" + id;
                promo_specialImage.className = "promo_specialImage";
                promo_specialImage.height = 250;
                promo_specialImage.width = 300;
                promo_specialImage.src = myFT.instantAds.F2_saleSpecial_img;

                carousel_frames.appendChild(promo_specialImage);

                //start update 08.30.2019

                if (myFT.instantAds.F2_saleSpecial_img.indexOf("blank") < 0) {
                  promoCont.style.position = "absolute";
                  var promoMessageX = window.getComputedStyle(promoCont, null).getPropertyValue('left').split("px");
                  if(myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[4].split(",")[0] == "0") {
                    promoCont.style.left = -parseFloat(carousel_XY[0])+"px";
                  } else {
                     promoCont.style.left = parseFloat(promoMessageX) - parseFloat(carousel_XY[0]) + "px";
                  }
                  var promoMessageY = window.getComputedStyle(promoCont, null).getPropertyValue('top').split("px");
                  if(myFT.instantAds.F2_saleSpecialtxt_size_hex_weight_angle_xy.split("|")[4].split(",")[1] == "0") {
                    promoCont.style.top = -parseFloat(carousel_XY[1])+"px";
                  } else {
                      promoCont.style.top = parseFloat(promoMessageY) - parseFloat(carousel_XY[1]) + "px";
                  }
                }

                var promoImageXY = document.getElementById("promo_specialImage"+id);
                var promoImageX = window.getComputedStyle(promoImageXY, null).getPropertyValue('left').split("px");
                document.getElementById("promo_specialImage" + id).style.left = parseFloat(promoImageX) - parseFloat(carousel_XY[0]) + "px";
                var promoImageY = window.getComputedStyle(promoImageXY, null).getPropertyValue('top').split("px");
                document.getElementById("promo_specialImage" + id).style.top = parseFloat(promoImageY) - parseFloat(carousel_XY[1]) + "px";

                //end update 08.30.2019

                promoWidthArray.push(promo_message_container.getBoundingClientRect().width);
            }
        }, 0);
        // 08.27.2019 End



        //Sale PRICE
        if (myFT.instantAds.F2_salePrice_size_hex_xy != "") {
            sale_price_style = myFT.instantAds.F2_salePrice_size_hex_xy.split("|");
        } else {
            sale_price_style = sale_price_style_VAR.split("|");
        }
        var sale_price_XY = sale_price_style[2].split(",");
        var sale_price = document.createElement("div");
        sale_price.setAttribute("id", "sale_price" + id);
        sale_price.setAttribute("class", "sale_price");
        price_cont.appendChild(sale_price);
        document.getElementById("sale_price" + id).innerHTML = "$" + salePrice + "&nbsp;&nbsp;";
        sale_price.style.fontSize = sale_price_style[0] + "px";
        sale_price.style.color = sale_price_style[1];
        if (sale_price_XY[0] == 0 && sale_price_XY[1] == 0) {

        } else {
            //            sale_price.style.position = "absolute";
            var saleP = document.getElementById("sale_price" + id);
            Helpers.XYLogic(sale_price_XY[0], sale_price_XY[1], saleP);
        }

        //07.29.2019 End

        // FOR SUPPLIES LAYOUT
        //07.29.2019 Start
        //        if (myFT.instantAds.layout_name == "supplies" ) {
        //            product_name.style.top = "26px";
        //            price_prefix.style.top = "45px";
        //            sale_price.style.top = "45px";
        //            regular_price.style.top = "45px";
        //        }
        //07.29.2019 End

        // CTA
        var f2_cta = document.createElement("div");
        f2_cta.setAttribute("id", "f2_cta" + id);
        f2_cta.setAttribute("class", "f2_cta");
        carousel_frames.appendChild(f2_cta);

        var f2_cta_button = document.createElement("div");
        f2_cta_button.setAttribute("id", "f2_cta_button" + id);
        f2_cta_button.setAttribute("class", "f2_cta_button");
        document.getElementById("f2_cta" + id).appendChild(f2_cta_button);

        var f2_cta_txt = document.createElement("div");
        f2_cta_txt.setAttribute("id", "f2_cta_txt" + id);
        f2_cta_txt.setAttribute("class", "f2_cta_txt");
        document.getElementById("f2_cta_button" + id).appendChild(f2_cta_txt);

        if (myFT.instantAds.F2_ctaTxt_hex_hexHov_size_align != "") {
            f2_cta_txt_style = myFT.instantAds.F2_ctaTxt_hex_hexHov_size_align.split("|");
        } else {
            f2_cta_txt_style = f2_cta_txt_style_VAR.split("|");
        }
        if (myFT.instantAds.F2_ctaBtn_borderHex_borderHexHov_bkgdHex_bkgdHexHov_xy != "") {
            f2_cta_button_style = myFT.instantAds.F2_ctaBtn_borderHex_borderHexHov_bkgdHex_bkgdHexHov_xy.split("|");
        } else {
            f2_cta_button_style = f2_cta_button_style_VAR.split("|");
        }

        var f2_cta_button_XY = f2_cta_button_style[4].split(",");

        f2_cta_txt.innerHTML = myFT.instantAds.F2_cta_txt;
        f2_cta_txt.style.color = f2_cta_txt_style[0];
        f2_cta_txt.style.fontSize = f2_cta_txt_style[2] + "px";
        f2_cta.style.textAlign = f2_cta_txt_style[3];

        f2_cta_button.style.backgroundColor = f2_cta_button_style[2];
        f2_cta_button.style.borderColor = f2_cta_button_style[0];
        if (f2_cta_button_XY[0] == 0 && f2_cta_button_XY[1] == 0) {

        } else {
            var cta2 = document.getElementById("f2_cta" + id);
            Helpers.XYLogic(f2_cta_button_XY[0], f2_cta_button_XY[1], cta2);
            f2_cta.style.width = "298px";
            f2_cta.style.textAlign = "";
        }
        f2_cta_button.addEventListener("mouseover", f2_cta_button_HoverStart);
        f2_cta_button.addEventListener("mouseout", f2_cta_button_HoverEnd);

        function f2_cta_button_HoverStart() {
            f2_cta_txt.style.color = f2_cta_txt_style[1];
            f2_cta_button.style.backgroundColor = f2_cta_button_style[3];
            f2_cta_button.style.borderColor = f2_cta_button_style[1];
        }

        function f2_cta_button_HoverEnd() {
            f2_cta_txt.style.color = f2_cta_txt_style[0];
            f2_cta_button.style.backgroundColor = f2_cta_button_style[2];
            f2_cta_button.style.borderColor = f2_cta_button_style[0];
        }
        f2_cta_button.addEventListener('click', function() {
            onCTAClick(buyURL);
        })

        // F2 MAIN LOGO
        var f2_main_logo_cont = document.createElement("div");
        var f2_main_logo = document.createElement("img");
        f2_main_logo_cont.setAttribute("class", "f2_main_logo_cont");
        f2_main_logo_cont.setAttribute("id", "f2_main_logo_cont" + id);
        f2_main_logo.setAttribute("id", "f2_main_logo" + id);
        f2_main_logo.setAttribute("class", "f2_main_logo");
        f2_main_logo.setAttribute("src", myFT.instantAds.main_logo);
        carousel_frames.appendChild(f2_main_logo_cont);
        f2_main_logo_cont.appendChild(f2_main_logo);
        if (myFT.instantAds.main_logo.indexOf('.svg') >= 0) {
            f2_main_logo.classList.add("svg");
            setTimeout(function() {
                if (myFT.instantAds.F2_mainLogo_hex_width_xy != "") {
                    f2_main_logo_style = myFT.instantAds.F2_mainLogo_hex_width_xy.split('|');
                } else {
                    f2_main_logo_style = f2_main_logo_style_VAR.split('|');
                }
                var f2_main_logo_XY = f2_main_logo_style[2].split(',');
                if (f2_main_logo_XY[0] == 0 && f2_main_logo_XY[1] == 0) {

                } else {
                    //                    document.getElementById("f2_main_logo" + id).style.left = f2_main_logo_XY[0] + "px";
                    //                    document.getElementById("f2_main_logo" + id).style.top = f2_main_logo_XY[1] + "px";
                    var mlg2 = document.getElementsByClassName("f2_main_logo_cont");
                    Helpers.XYLogic(f2_main_logo_XY[0], f2_main_logo_XY[1], mlg2[id]);
                }
                svgConverter(document.querySelector("#f2_main_logo" + id), f2_main_logo_style[0], f2_main_logo_style[1]);

            }, 0);
        } else {
            if (myFT.instantAds.F2_mainLogo_hex_width_xy != "") {
                f2_main_logo_style = myFT.instantAds.F2_mainLogo_hex_width_xy.split('|');
            } else {
                f2_main_logo_style = f2_main_logo_style_VAR.split('|');
            }
            var f2_main_logo_XY = f2_main_logo_style[2].split(',');
            f2_main_logo.style.width = f2_main_logo_style[1] + "px";
            if (f2_main_logo_XY[0] == 0 && f2_main_logo_XY[1] == 0) {

            } else {
                var mlg2 = document.getElementsByClassName("f2_main_logo_cont");
                Helpers.XYLogic(f2_main_logo_XY[0], f2_main_logo_XY[1], mlg2[id]);
            }

        }

        // F2 PARTNER LOGO
        var f2_partner_logo_cont = document.createElement("div");
        var f2_partner_logo = document.createElement("img");
        f2_partner_logo_cont.setAttribute("class", "f2_partner_logo_cont");
        f2_partner_logo_cont.setAttribute("id", "f2_partner_logo_cont" + id);
        f2_partner_logo.setAttribute("id", "f2_partner_logo" + id);
        f2_partner_logo.setAttribute("class", "f2_partner_logo");

        if (isIntel == 1 && myFT.instantAds.F2_partner_logo.indexOf("blank") >= 0 && myFT.instantAds.layout_name != "microsoft") {
            f2_partner_logo.setAttribute("src", badgeImage);

            carousel_frames.appendChild(f2_partner_logo_cont);
            f2_partner_logo_cont.appendChild(f2_partner_logo);

            f2_partner_logo_style = f2_partner_logo_style_VAR.split('|');

            var badge_XY = carouselBadge[1].split(",");
            f2_partner_logo.style.width = f2_partner_logo_style[1] + "px";

            var plg2 = document.getElementsByClassName("f2_partner_logo_cont");
            Helpers.XYLogic(badge_XY[0], badge_XY[1], plg2[id]);

        } else {
            f2_partner_logo.setAttribute("src", myFT.instantAds.F2_partner_logo);
            carousel_frames.appendChild(f2_partner_logo_cont);
            f2_partner_logo_cont.appendChild(f2_partner_logo);
            if (myFT.instantAds.F2_partner_logo.indexOf('.svg') >= 0) {
                f2_partner_logo.classList.add("svg");
                setTimeout(function() {
                    if (myFT.instantAds.F2_partnerLogo_hex_width_xy != "") {
                        f2_partner_logo_style = myFT.instantAds.F2_partnerLogo_hex_width_xy.split('|');
                    } else {
                        f2_partner_logo_style = f2_partner_logo_style_VAR.split('|');
                    }
                    var f2_partner_logo_XY = f2_partner_logo_style[2].split(',');

                    var plg2 = document.getElementsByClassName("f2_partner_logo_cont");
                    Helpers.XYLogic(f2_partner_logo_XY[0], f2_partner_logo_XY[1], plg2[id]);

                    svgConverter(document.querySelector("#f2_partner_logo" + id), f2_partner_logo_style[0], f2_partner_logo_style[1]);

                }, 0);
            } else {
                if (myFT.instantAds.F2_partnerLogo_hex_width_xy != "") {
                    f2_partner_logo_style = myFT.instantAds.F2_partnerLogo_hex_width_xy.split('|');
                } else {
                    f2_partner_logo_style = f2_partner_logo_style_VAR.split('|');
                }
                var f2_partner_logo_XY = f2_partner_logo_style[2].split(',');
                f2_partner_logo.style.width = f2_partner_logo_style[1] + "px";
                var plg2 = document.getElementsByClassName("f2_partner_logo_cont");
                Helpers.XYLogic(f2_partner_logo_XY[0], f2_partner_logo_XY[1], plg2[id]);

            }
        }

        //start update 08.30.2019

        setTimeout(function() {
          var mainImageXY = document.getElementById("f2_main_logo_cont"+id);

          var mainImageX = window.getComputedStyle(mainImageXY, null).getPropertyValue('left').split("px");
          mainImageXY.style.left = parseFloat(mainImageX) - parseFloat(carousel_XY[0]) + "px";

          var mainImageY = window.getComputedStyle(mainImageXY, null).getPropertyValue('top').split("px");
          mainImageXY.style.top = parseFloat(mainImageY) - parseFloat(carousel_XY[1]) + "px";

          var partnerImageXY = document.getElementById("f2_partner_logo_cont"+id);

          var partnerImageX = window.getComputedStyle(partnerImageXY, null).getPropertyValue('left').split("px");
          partnerImageXY.style.left = parseFloat(partnerImageX) - parseFloat(carousel_XY[0]) + "px";

          var partnerImageY = window.getComputedStyle(partnerImageXY, null).getPropertyValue('top').split("px");
          partnerImageXY.style.top = parseFloat(partnerImageY) - parseFloat(carousel_XY[1]) + "px";

        },0);

        //end update 08.30.2019

        //CAROUSEL HOTSPOT
        var carousel_hotspot = document.createElement("div");
        carousel_hotspot.setAttribute("id", "carousel_hotspot" + id);
        carousel_hotspot.setAttribute("class", "carousel_hotspot");
        carousel_frames.appendChild(carousel_hotspot);
        carousel_hotspot.addEventListener('click', function() {
            onCarouselClick(buyURL);
        })


        currTransl[id] = -298;
        document.getElementsByClassName("carousel_frame")[id].addEventListener("transitionend", transitionCompleted, true);
        frameCount = itemLength;
        if (id == itemLength - 1) {
            right();
        }
    } catch (err) {

    }

}

function right() {
    if (translationComplete === true) {
        translationComplete = false;
        carouselIndex--;
        if (carouselIndex == -1) {
            carouselIndex = frameCount - 1;
        }
        var outercarouselIndex = (carouselIndex) % frameCount;
        for (var i = 0; i < frameCount; i++) {
            var frames = document.getElementsByClassName("carousel_frame")[i];
            frames.style.opacity = '1';
            frames.style.transform = 'translate(' + (currTransl[i] + 298) + 'px)';
            //frames.className = 'frames';
            //frames.className.replace( /(?:^|\s)animate(?!\S)/g , '' );
            currTransl[i] = currTransl[i] + 298;
        }

        var outerframes = document.getElementsByClassName("carousel_frame")[outercarouselIndex];
        outerframes.style.transform = 'translate(' + (currTransl[outercarouselIndex] - 298 * (frameCount)) + 'px)';
        if (feedLENGTH == 1) {
            outerframes.style.opacity = '1';
        } else {
            outerframes.style.opacity = '0';
        }
        currTransl[outercarouselIndex] = currTransl[outercarouselIndex] - 298 * (frameCount);
    }

    runOnce();
}

var runOnce = (function() {
    var executed = false;
    return function() {
        if (!executed) {
            executed = true;
            translationComplete = true;
        }
    };

})();

function left() {
  if (translationComplete === true) {
    translationComplete = false;
    carouselIndex++;
    var outercarouselIndex = (carouselIndex - 1) % frameCount;
    var nextcarouselIndex = (carouselIndex) % frameCount;

    for (var i = 0; i < frameCount; i++) {
      var frames = document.getElementsByClassName("carousel_frame")[i];
      frames.style.opacity = '1';
      frames.style.transform = 'translate(' + (currTransl[i] - 298) + 'px)';
      currTransl[i] = currTransl[i] - 298;
    }

    var nextframes = document.getElementsByClassName("carousel_frame")[nextcarouselIndex];
    var outerframes = document.getElementsByClassName("carousel_frame")[outercarouselIndex];
    outerframes.style.transform = 'translate(' + (currTransl[outercarouselIndex] + 298 * (frameCount)) + 'px)';
    if (feedLENGTH == 1) {
      outerframes.style.opacity = '1';
    } else {
      outerframes.style.opacity = '0';
      setTimeout(function(){
        nextframes.style.opacity = '0';
      },1000)
    }
    currTransl[outercarouselIndex] = currTransl[outercarouselIndex] + 298 * (frameCount);
  }
}

leftbtn.addEventListener('click', function() {
    ctr = feedLENGTH;
    clearInterval(autoCar);
    right();
});

rightbtn.addEventListener('click', function() {
    ctr = feedLENGTH;
    clearInterval(autoCar);
    left();
});

function svgConverter(svgImg, elemHex, elemWidth) {

    /*
     * Replace all SVG images with inline SVG to make it possible to change fill color.
     */
    var svgid = svgImg.getAttribute('id');

    // 07.29.2019 Start
    var imgID = svgImg.getAttribute('id');
    var imgClass = svgImg.getAttribute('class');
    var imgURL = svgImg.getAttribute('src');

    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4 && xhr.status == 200) {
            var svg = xhr.responseXML.getElementsByTagName('svg')[0];

            if (imgID != null) {
                svg.setAttribute('id', imgID);
            }

            if (imgClass != null) {
                svg.setAttribute('class', imgClass + ' replaced-svg');
            }
            svg.setAttribute('preserveAspectRatio', 'xMinYMin');
            svg.removeAttribute('xmlns:a')

            if (!svg.hasAttribute('viewBox') && svg.hasAttribute('height') && svg.hasAttribute('width')) {
                svg.setAttribute('viewBox', '0 0 ' + svg.getAttribute('height') + ' ' + svg.getAttribute('width'))
            }
            svgImg.parentNode.replaceChild(svg, svgImg);
            document.querySelector("#" + imgID + " path").style.fill = elemHex;
            document.getElementById(imgID).style.width = elemWidth + "px";
        }
    }
    xhr.open('GET', imgURL, true)
    xhr.send(null)
    // 07.29.2019 Start
}

function preload() {
    try {
        images = new Array(
            myFT.instantAds.F1_background_img,
            myFT.instantAds.main_logo,
            myFT.instantAds.failsafe_img,
            myFT.instantAds.default,
            myFT.instantAds.F1_partner_logo,
            myFT.instantAds.F2_background_img,
            myFT.instantAds.F2_partner_logo
        );

        for (var i = 0; i < images.length; i++) {
            imageObj = new Image();
            imageObj.src = images[i];
            imageObj.addEventListener("load", iLoad, false);
            //adding the image error load function, once an image was not found or error, this will call feedLoadError
            imageObj.addEventListener("error", function() {
                imageError++;
                if (imageError > 0) {
                    defaultError();
                }
            }, false);
        }
        console.log('Entering preload');
    } catch (err) {
        feedLoadError();
        console.error("%cError: " + err.message + " on function preload", 'color: #9C4A46');
    }
}

function iLoad() {
    loadedImage++;
    if (images.length == loadedImage) {
        intro_frame_bg_image.src = images[0];
        f1_main_logo.src = images[1];
        f1_partner_logo.src = images[4];
        carousel_background_image.src = images[5];


        if (myFT.instantAds.F1_toggle.toLowerCase() == "true") {
            introFrame();
            carouselFrame();
        } else if (myFT.instantAds.F1_toggle.toLowerCase() == "false") {
            carouselFrame();
        } else {
            defaultError();
        }

    }
}

function introFrame() {
    try {

        intro_frame_cont.addEventListener('click', function() {
            onIntroClick(myFT.instantAds.clickTag1_url);
        })
        //F1 HEADLINE 1 TEXT
        F1_headline1_txt.innerHTML = myFT.instantAds.F1_headline1_txt;
        var f1_headline1_txt_style = myFT.instantAds.F1_headline1_txt_hex_size_weight_align_xy.split('|');
        var f1_headline1_txt_XY = f1_headline1_txt_style[4].split(',');
        F1_headline1_txt.style.color = f1_headline1_txt_style[0];
        F1_headline1_txt.style.fontSize = f1_headline1_txt_style[1] + 'px';
        F1_headline1_txt.style.fontWeight = f1_headline1_txt_style[2];
        F1_headline1_txt.style.textAlign = f1_headline1_txt_style[3];

        Helpers.XYLogic(f1_headline1_txt_XY[0], f1_headline1_txt_XY[1], F1_headline1_txt);

        //F1 HEADLINE 2 TEXT
        F1_headline2_txt.innerHTML = myFT.instantAds.F1_headline2_txt;
        var f1_headline2_txt_style = myFT.instantAds.F1_headline2_txt_hex_size_weight_align_xy.split('|');
        var f1_headline2_txt_XY = f1_headline2_txt_style[4].split(',');
        F1_headline2_txt.style.color = f1_headline2_txt_style[0];
        F1_headline2_txt.style.fontSize = f1_headline2_txt_style[1] + 'px';
        F1_headline2_txt.style.fontWeight = f1_headline2_txt_style[2];
        F1_headline2_txt.style.textAlign = f1_headline2_txt_style[3];

        Helpers.XYLogic(f1_headline2_txt_XY[0], f1_headline2_txt_XY[1], F1_headline2_txt);


        //F1 HEADLINE 3 TEXT
        F1_headline3_txt.innerHTML = myFT.instantAds.F1_headline3_txt;
        var f1_headline3_txt_style = myFT.instantAds.F1_headline3_txt_hex_size_weight_align_xy.split('|');
        var f1_headline3_txt_XY = f1_headline3_txt_style[4].split(',');
        F1_headline3_txt.style.color = f1_headline3_txt_style[0];
        F1_headline3_txt.style.fontSize = f1_headline3_txt_style[1] + 'px';
        F1_headline3_txt.style.fontWeight = f1_headline3_txt_style[2];
        F1_headline3_txt.style.textAlign = f1_headline3_txt_style[3];

        Helpers.XYLogic(f1_headline3_txt_XY[0], f1_headline3_txt_XY[1], F1_headline3_txt);

        // CTA
        var f1_cta_txt_style = myFT.instantAds.F1_ctaTxt_hex_hexHov_size_align.split("|");
        var f1_cta_button_style = myFT.instantAds.F1_ctaBtn_borderHex_borderHexHov_bkgdHex_bkgdHexHov_xy.split("|");
        var f1_cta_button_XY = f1_cta_button_style[4].split(",");

        f1_cta_txt.innerHTML = myFT.instantAds.F1_cta_txt;
        f1_cta_txt.style.color = f1_cta_txt_style[0];
        f1_cta_txt.style.fontSize = f1_cta_txt_style[2] + "px";
        f1_cta.style.textAlign = f1_cta_txt_style[3];

        f1_cta_button.style.backgroundColor = f1_cta_button_style[2];
        f1_cta_button.style.borderColor = f1_cta_button_style[0];
        if (f1_cta_button_XY[0] == 0 && f1_cta_button_XY[1] == 0) {

        } else {
            //            f1_cta.style.left = f1_cta_button_XY[0] + "px";
            //            f1_cta.style.top = f1_cta_button_XY[1] + "px";
            f1_cta.style.width = "298px";
            f1_cta.style.textAlign = "";
        }

        Helpers.XYLogic(f1_cta_button_XY[0], f1_cta_button_XY[1], f1_cta);

        f1_cta_button.addEventListener("mouseover", f1_cta_button_HoverStart);
        f1_cta_button.addEventListener("mouseout", f1_cta_button_HoverEnd);

        function f1_cta_button_HoverStart() {
            f1_cta_txt.style.color = f1_cta_txt_style[1];
            f1_cta_button.style.backgroundColor = f1_cta_button_style[3];
            f1_cta_button.style.borderColor = f1_cta_button_style[1];
        }

        function f1_cta_button_HoverEnd() {
            f1_cta_txt.style.color = f1_cta_txt_style[0];
            f1_cta_button.style.backgroundColor = f1_cta_button_style[2];
            f1_cta_button.style.borderColor = f1_cta_button_style[0];
        }

        // F1 MAIN LOGO
        if (myFT.instantAds.main_logo.indexOf('.svg') >= 0) {
            setTimeout(function() {
                var f1_main_logo_style = myFT.instantAds.F1_mainLogo_hex_width_xy.split('|');
                var f1_main_logo_XY = f1_main_logo_style[2].split(',');

                Helpers.XYLogic(f1_main_logo_XY[0], f1_main_logo_XY[1], f1_main_logo_cont);

                svgConverter(document.querySelector("#f1_main_logo"), f1_main_logo_style[0], f1_main_logo_style[1]);

            }, 0);
        } else {
            var f1_main_logo_style = myFT.instantAds.F1_mainLogo_hex_width_xy.split('|');
            var f1_main_logo_XY = f1_main_logo_style[2].split(',');
            f1_main_logo.style.width = f1_main_logo_style[1] + "px";

            Helpers.XYLogic(f1_main_logo_XY[0], f1_main_logo_XY[1], f1_main_logo_cont);
        }

        // F1 PARTNER LOGO
        if (myFT.instantAds.F1_partner_logo.indexOf('.svg') >= 0) {
            setTimeout(function() {
                var f1_partner_logo_style = myFT.instantAds.F1_partnerLogo_hex_width_xy.split('|');
                var f1_partner_logo_XY = f1_partner_logo_style[2].split(',');

                Helpers.XYLogic(f1_partner_logo_XY[0], f1_partner_logo_XY[1], f1_partner_logo_cont);

                svgConverter(document.querySelector("#f1_partner_logo"), f1_partner_logo_style[0], f1_partner_logo_style[1]);
            }, 0);
        } else {
            var f1_partner_logo_style = myFT.instantAds.F1_partnerLogo_hex_width_xy.split('|');
            var f1_partner_logo_XY = f1_partner_logo_style[2].split(',');
            f1_partner_logo.style.width = f1_partner_logo_style[1] + "px";
            Helpers.XYLogic(f1_partner_logo_XY[0], f1_partner_logo_XY[1], f1_partner_logo_cont);
        }
        setTimeout(function() {
            init();
        }, 2000)


    } catch (err) {
        defaultError();
        console.error("%cError: " + err.message + " on function introFrame", 'color: #9C4A46');
    }
}

function carouselFrame() {
    try {

        if (myFT.instantAds.F2_backgroundHex_borderHex_arrowsHex != "") {
            f2_hex = myFT.instantAds.F2_backgroundHex_borderHex_arrowsHex.split("|");
        } else {
            f2_hex = f2_hex_VAR.split("|");
        }
        carousel_static_elem.style.backgroundColor = f2_hex[0];
        carousel_static_elem.addEventListener('click', function() {
            onF2Click(myFT.instantAds.clickTag2_url);
        })
        main.style.borderColor = f2_hex[1];
        document.querySelector("#leftbtn svg polyline").style.stroke = f2_hex[2];
        document.querySelector("#rightbtn svg polyline").style.stroke = f2_hex[2];

        setTimeout(function() {
            init();
        }, 2000);

    } catch (err) {
        defaultError();
        console.error("%cError: " + err.message + " on function carouselFrame", 'color: #9C4A46');
    }
}

function init() {
    // 11.22.2019 Start
    for (var i = 0; i < document.getElementsByClassName("promo_txt").length; i++) {
        resizePromoText(document.getElementsByClassName("promo_txt")[i]);
    }

    for (var i = 0; i < document.getElementsByClassName("product_image_cont").length; i++) {
        centerProduct(document.getElementsByClassName("product_image_cont")[i]);
    }
    // 11.22.2019 End

    // 08.27.2019 Start
    if (myFT.instantAds.F2_saleSpecial_img.indexOf("blank") < 0) {
        var maxWidth = 0;

        for (var i = 0; i < promoWidthArray.length; i++) {
            if (promoWidthArray[i] > maxWidth) maxWidth = promoWidthArray[i];
        }

        for (var j = 0; j < document.getElementsByClassName("promo_message_container").length; j++) {
            var otherBrowser = (checkPlatform()[1] == "Firefox") ? 12 : 0;
            document.getElementsByClassName("promo_message_container")[j].style.width = maxWidth + otherBrowser + "px";
            document.getElementsByClassName("promo_message_container")[j].style.textAlign = "center";
        }
    }
    // 08.27.2019 End

    main.style.visibility = "visible";
    if (myFT.instantAds.F1_toggle.toLowerCase() == "true") {
        intro_frame_cont.style.visibility = "visible";
        startIntroAnimation();
    } else if (myFT.instantAds.F1_toggle.toLowerCase() == "false") {
        startCarousel();
    } else {
        defaultError();
    }
}

function startIntroAnimation() {
    f1_headline_cont.style.transition = "transform 0.5s";
    f1_headline_cont.style.transform = "translateX(0px)";
    f1_cta.style.transition = "opacity 0.5s 1s";
    f1_cta.style.opacity = 1;
    setTimeout(function() {
        intro_frame_cont.style.transition = "opacity 1s";
        intro_frame_cont.style.opacity = "0";

        setTimeout(function() {
            intro_frame_cont.style.visibility = "hidden";
            startCarousel();
        }, 1000)

    }, 3500)
}


function startCarousel() {
    if (myFT.instantAds.F1_toggle.toLowerCase() == "true") {
        ctr = -2;
    } else if (myFT.instantAds.F1_toggle.toLowerCase() == "false") {
        ctr = 0;
    }
    autoCar = setInterval(function() {
        if (ctr < feedLENGTH) {
            left();
            ctr++;
        } else {
            clearInterval(autoCar);
        }
    }, 2000);
}

//set the click on items
function onIntroClick(e) {
    myFT.clickTag(1, e);
}

function onF2Click(e) {
    myFT.clickTag(2, e);
}

function onCarouselClick(e) {
    myFT.clickTag(3, e);
}

function onCTAClick(e) {
    myFT.clickTag(4, e);
}

//This will be call when they found error at the feed, this will initiate backup image
function feedLoadError() {
    isFallback = true;
    countError++;
    if (countError == 1) {
        var backUpImage = document.createElement('div');
        backUpImage.id = "backUpImage";
        backUpImage.className = "backUpImage";
        backUpImage.addEventListener('click', function() {
            backupClick();
        });
        backUpImage.style.backgroundImage = "url('" + myFT.instantAds.failsafe_img + "')";
        main.appendChild(backUpImage);
        main.style.visibility = "visible";
    }

    console.log('Initializing Feed Error Backup image...');
}

//This will be call when they found error at the manifest or there is no feed, this will initiate backup image
function defaultError() {
    countError++;
    if (countError == 1) {
        var defaultBackUpImage = document.createElement('div');
        defaultBackUpImage.id = "defaultBackUpImage";
        defaultBackUpImage.className = "defaultBackUpImage";
        defaultBackUpImage.addEventListener('click', function() {
            backupClick();
        });
        defaultBackUpImage.style.backgroundImage = "url('" + myFT.instantAds.default+"')";
        main.appendChild(defaultBackUpImage);
        main.style.visibility = "visible";
    }

    console.log('Initializing Backup image...');
}

function backupClick() {
    myFT.clickTag(1, myFT.instantAds.clickTag1_url);
}

function checkPlatform() {
    try {
        var a = new Array();

        if (navigator.platform.toLowerCase().indexOf("mac") > -1) {
            a[0] = "macOS";
        } else if (navigator.platform.toLowerCase().indexOf("win") > -1) {
            a[0] = "Windows";
        } else {
            if (navigator.userAgent.match(/iPhone|iPad|iPod/i)) {
                a[0] = "iOS";
            } else if (navigator.userAgent.match(/Opera Mini/i)) {
                a[0] = "Opera";
            } else if (navigator.userAgent.match(/Android/i)) {
                a[0] = "Android";
            } else if (navigator.userAgent.match(/BlackBerry/i)) {
                a[0] = "BlackBerry";
            } else if (navigator.userAgent.match(/IEMobile/i) || navigator.userAgent.match(/WPDesktop/i)) {
                a[0] = "WindowsPhone";
            }
        }

        var MSIE = window.navigator.userAgent.indexOf("MSIE ");
        var Edge = window.navigator.userAgent.indexOf("Edge/");
        var Trdt = window.navigator.userAgent.indexOf("Trident/");

        if (navigator.userAgent.toLowerCase().indexOf("chrome") > -1) {
            a[1] = "Chrome";
        } else if (navigator.userAgent.toLowerCase().indexOf("firefox") > -1) {
            a[1] = "Firefox";
        } else if (navigator.vendor && navigator.vendor.toLowerCase().indexOf("apple") > -1) {
            a[1] = "Safari";
        } else if (MSIE > 0 || Edge > 0 || Trdt > 0) {
            a[1] = "IE";
        }

        return a;
    } catch (error) {
        console.error("Error on checkPlatform(): " + error.message);
    }
}

function resizePromoText(e) {
    if (myFT.instantAds.F2_promo_bckgrdHex_bckgrdWidth.split("|")[1] != "300") {
        e.style.boxSizing = "border-box";
        e.style.paddingRight = "6px";
        e.style.paddingLeft = "6px";
        e.style.maxWidth = "300px";
        e.style.width = "auto";
    }

    var domFontSize = parseFloat(window.getComputedStyle(e, null).getPropertyValue("font-size")),
        lineHeight = parseInt(window.getComputedStyle(e, null).getPropertyValue("line-height")),
        domHeight = e.scrollHeight;

    while (domHeight > lineHeight) {
        if (domFontSize <= 1) {
            break;
        } else {
            e.style.fontSize = (domFontSize - 1) + "px";

            domFontSize = parseFloat(window.getComputedStyle(e, null).getPropertyValue("font-size"));
            domHeight = e.scrollHeight;
        }
    }
}

function centerProduct(e) {
    var domWidth = parseFloat(e.getBoundingClientRect().width);

    if (myFT.instantAds.F2_productImg_width_productImg_xy.split("|")[1].split(",")[0] == "0") {
        console.log("Product X position is set to 0. Centering element");
        var l = (300 - domWidth) / 2;
        e.style.left = l + "px";
    }
}
